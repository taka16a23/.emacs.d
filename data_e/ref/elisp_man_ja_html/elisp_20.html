<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML lang="ja">
<!-- Created on October, 1  2005 by texi2html 1.64 -->
<!-- 
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Olaf Bachmann <obachman@mathematik.uni-kl.de>
Send bugs and suggestions to <texi2html@mathematik.uni-kl.de>
 
-->
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html;CHARSET=euc-jp">
<META NAME="keywords" CONTENT="meadow,mule,emacs,lisp,elisp,gnus,setting,設定,unix,cygwin">
<META http-equiv="Content-Script-Type" content="text/javascript">
<META NAME="description" CONTENT="Meadowの設定を紹介するページです">
<TITLE>GNU Emacs Lispリファレンスマニュアル:  ミニバッファ</TITLE>

<META NAME="description" CONTENT="GNU Emacs Lispリファレンスマニュアル:  ミニバッファ">
<META NAME="keywords" CONTENT="GNU Emacs Lispリファレンスマニュアル:  ミニバッファ">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META NAME="Generator" CONTENT="texi2html 1.64">

<LINK REL="contents" HREF="elisp_toc.html#SEC_Contents">
<LINK REL="index" HREF="elisp_48.html#SEC681">
<LINK REL="next" HREF="elisp_21.html#SEC281">
<LINK REL="prev" HREF="elisp_19.html#SEC258">

<META http-equiv="Content-Style-Type" content="text/css">
<!-- 鶯と龜 ←日本語EUC誤判別対策用らしい; -->
<link rel="StyleSheet" href="../../../../soft/css/midnight.css" type="text/css" id="css1">
<script type="text/javascript" src="style1.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../soft/css/meadowmemo.css">

</HEAD>
<BODY LANG="ja" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">
<!--Infoseek Analyzer start-->
<script LANGUAGE="javascript">PgNo=6;</script>
<script src="http://js1.infoseek.co.jp/bin/57/00170.js"></script>
<noscript><a href="http://ax1.www.infoseek.co.jp/bin/go?0017057f" target="_blank">
<img src="http://ax1.www.infoseek.co.jp/bin/logo?0017057f" border=0></a></noscript>
<!--Infoseek Analyzer end-->
<a name="top"> </a>

<br><A NAME="SEC265"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_19.html#SEC264"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC266"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_19.html#SEC258"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC281"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Minibuffers"></A>
<H1> 19. ミニバッファ </H1>
<!--docid::SEC265::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Minibuffers">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Minibuffers</a>"<br>
"texi/elisp21/ミニバッファ"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%DF%A5%CB%A5%D0%A5%C3%A5%D5%A5%A1">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX994"></A>
<A NAME="IDX995"></A>
<A NAME="IDX996"></A>
<P>

<EM>ミニバッファ</EM>（minibuffer）は、単純な数値前置引数ではなく、
より複雑な引数を読み取るためにEmacsのコマンドが使う特別なバッファです。
これらの引数には、ファイル名、バッファ名、
（<KBD>M-x</KBD>での）コマンド名があります。
ミニバッファは、エコー領域と同様に、フレームの最下行に表示されますが、
引数を読み取るときにのみ表示されます。
<P>

<div class="menuindex"><SCRIPT language=JavaScript src="index19.js"></SCRIPT></div><noscript><BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_20.html#SEC266">19.1 ミニバッファの紹介</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Basic information about minibuffers.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_20.html#SEC267">19.2 ミニバッファでのテキスト文字列の読み取り</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How to read a straight text string.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_20.html#SEC268">19.3 ミニバッファでのLispオブジェクトの読み取り</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How to read a Lisp object or expression.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_20.html#SEC269">19.4 ミニバッファの履歴</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Recording previous minibuffer inputs
				so the user can reuse them.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_20.html#SEC270">19.5 補完</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How to invoke and customize completion.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_20.html#SEC277">19.6 Yes/Noの問い合わせ</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Asking a question with a simple answer.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_20.html#SEC278">19.7 複数のY/Nの問い合わせ</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Asking a series of similar questions.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_20.html#SEC279">19.8 パスワードの読み取り</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Reading a password from the terminal.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_20.html#SEC280">19.9 ミニバッファに関するその他</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Various customization hooks and variables.</TD></TR>
</TABLE></BLOCKQUOTE></noscript>
<P>

<A NAME="Intro to Minibuffers"></A>
<HR SIZE="6">
<br><A NAME="SEC266"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC265"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC267"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Intro to Minibuffers"></A>
<H2> 19.1 ミニバッファの紹介 </H2>
<!--docid::SEC266::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Intro%20to%20Minibuffers">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Intro%20to%20Minibuffers</a>"<br>
"texi/elisp21/ミニバッファの紹介"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%DF%A5%CB%A5%D0%A5%C3%A5%D5%A5%A1%A4%CE%BE%D2%B2%F0">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

ほとんどの意味において、ミニバッファはEmacsの普通のバッファです。
編集コマンドなどのバッファ<EM>内</EM>でのほとんどの操作は、
ミニバッファでも普通に動作します。
しかし、バッファを操作するコマンドの多くは、
ミニバッファには適用できません。
ミニバッファの名前はつねに`<SAMP>*Minibuf-<VAR>number</VAR></SAMP>'という形式であって、
変更できません。
ミニバッファはミニバッファ専用の特別なウィンドウだけに表示されます。
これらのウィンドウはつねにフレームの最下行に現れます。
（ミニバッファを持たないフレームや、
ミニバッファ用ウィンドウのみの特殊なフレームもある。
<A HREF="elisp_29.html#SEC446">28.8 ミニバッファとフレーム</A>を参照。）
<P>

ミニバッファ用のウィンドウは通常は1行だけです。
ウィンドウサイズを変更するコマンドで一時的に大きさを変えられますが、
ミニバッファから抜けると通常サイズに戻ります。
ミニバッファ用ウィンドウのサイズを恒久的に変更するには、
ミニバッファを使っていないときに、フレームの別のウィンドウにおいて
ウィンドウサイズを変更するコマンドを使います。
ミニバッファだけを持つフレームの場合、
フレームのサイズを変更すればミニバッファのサイズを変更できます。
<P>

すでにミニバッファが活性であるときにコマンドがミニバッファを使用することを
<EM>再帰ミニバッファ</EM>と呼びます。
最初のミニバッファの名前は`<SAMP> *Minibuf-0*</SAMP>'です。
再帰ミニバッファは、名前の最後の数を増やして命名します。
（名前は空白で始まるため、通常のバッファの一覧には表示されない。）
再帰ミニバッファの中で、もっとも内側の（つまりもっとも再帰が深い）ものが
活性なミニバッファです。
これを単にミニバッファと呼びます。
変数<CODE>enable-recursive-minibuffers</CODE>を設定すれば、
再帰ミニバッファを許可したり禁止できます。
あるいは、コマンドシンボルにこの名前の属性を入れます
（see 節 <A HREF="elisp_20.html#SEC280">19.9 ミニバッファに関するその他</A>）。
<P>

他のバッファと同様に、ミニバッファは
複数のローカルキーマップ（see 節 <A HREF="elisp_22.html#SEC317">21. キーマップ</A>）を使うことがあります。
これらには、さまざまな終了コマンドや補完コマンド（see 節 <A HREF="elisp_20.html#SEC270">19.5 補完</A>）
が含まれます。
<P>

<UL>
<LI>
<CODE>minibuffer-local-map</CODE>は（補完なしの）普通の入力用。
<P>

<LI>
<CODE>minibuffer-local-ns-map</CODE>も同様だが、
<KBD>RET</KBD>と同様に<KBD>SPC</KBD>で抜ける。
これは主にMocklisp互換用に使われる。
<P>

<LI>
<CODE>minibuffer-local-completion-map</CODE>は弱い補完用。
<P>

<LI>
<CODE>minibuffer-local-completion-map</CODE>は強い補完や慎重な補完用。
</UL>
<P>

<A NAME="Text from Minibuffer"></A>
<HR SIZE="6">
<br><A NAME="SEC267"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC266"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC268"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Text from Minibuffer"></A>
<H2> 19.2 ミニバッファでのテキスト文字列の読み取り </H2>
<!--docid::SEC267::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Text%20from%20Minibuffer">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Text%20from%20Minibuffer</a>"<br>
"texi/elisp21/ミニバッファでのテキスト文字列の読み取り"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%DF%A5%CB%A5%D0%A5%C3%A5%D5%A5%A1%A4%C7%A4%CE%A5%C6%A5%AD%A5%B9%A5%C8%CA%B8%BB%FA%CE%F3%A4%CE%C6%C9%A4%DF%BC%E8%A4%EA">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

多くの場合、テキストを文字列として読み取るためにミニバッファを使います。
Lispオブジェクトのテキスト表現を読み取るためにも使えます。
ミニバッファでの入力のもっとも基本的な関数は
<CODE>read-from-minibuffer</CODE>であり、どちらの目的にも使えます。
<P>

多くの場合、Lisp関数の途中でミニバッファの入力関数を呼ぶべきではありません。
そのかわりに、<CODE>interactive</CODE>の指定で、
コマンドの引数を読み取る操作の一部として
すべてのミニバッファ入力を行います。
See 節 <A HREF="elisp_21.html#SEC283">20.2 コマンドの定義</A>。
<P>

<A NAME="IDX997"></A>
<DL>
<DT><U>Function:</U> <B>read-from-minibuffer</B> <I>prompt-string &#38;optional initial-contents keymap read hist default inherit-input-method</I>
<DD>この関数は、ミニバッファから入力を得るもっとも汎用の方法である。
デフォルトでは、任意のテキストを受け取り文字列として返す。
しかし、<VAR>read</VAR>が<CODE>nil</CODE>以外であれば、
<CODE>read</CODE>を用いてテキストを
Lispオブジェクトへ変換する（see 節 <A HREF="elisp_19.html#SEC261">18.3 入力関数</A>）。
<P>

この関数がまず行うことは、ミニバッファを活性にし、
プロンプト<VAR>prompt-string</VAR>とともに表示することである。
<VAR>prompt-string</VAR>は文字列であること。
これで、ユーザーはミニバッファでテキストを編集できるようになる。
<P>

ユーザーがミニバッファを抜けるコマンドを打つと、
<CODE>read-from-minibuffer</CODE>は
ミニバッファ内のテキストから戻り値を構築する。
通常、当該テキストを含む文字列を返す。
しかし、<VAR>read</VAR>が<CODE>nil</CODE>以外であると、
<CODE>read-from-minibuffer</CODE>はテキストを読み取った結果である
Lispオブジェクトを評価せずに返す。
（読み取りについてはsee 節 <A HREF="elisp_19.html#SEC261">18.3 入力関数</A>。）
<P>

引数<VAR>default</VAR>は、履歴コマンドで使うデフォルト値を指定する。
これは文字列か<CODE>nil</CODE>であること。
<VAR>read</VAR>が<CODE>nil</CODE>以外である場合、
ユーザーの入力が空であるときには、
<CODE>read</CODE>への入力としても<VAR>default</VAR>を用いる。
しかし、（<VAR>read</VAR>が<CODE>nil</CODE>である）通常の場合、
ユーザーの入力が空のとき、<CODE>read-from-minibuffer</CODE>は
<VAR>default</VAR>を返さずに空文字列<CODE>""</CODE>を返す。
この意味において、この関数は本章の他のミニバッファ用入力関数と異なる。
<P>

<VAR>keymap</VAR>が<CODE>nil</CODE>以外であると、
ミニバッファのローカルキーマップとして用いる。
<VAR>keymap</VAR>を省略したり<CODE>nil</CODE>であると、
<CODE>minibuffer-local-map</CODE>の値をキーマップとして用いる。
キーマップを指定することは、
補完などのさまざまな応用向けにミニバッファをカスタマイズする
もっとも重要な方法である。
<P>

引数<VAR>hist</VAR>は、ミニバッファでの入力を保存し履歴コマンドを使用可能に
するために用いる履歴リスト変数を指定する。
デフォルトは<CODE>minibuffer-history</CODE>である。
see 節 <A HREF="elisp_20.html#SEC269">19.4 ミニバッファの履歴</A>。
<P>

変数<CODE>minibuffer-allow-text-properties</CODE>が<CODE>nil</CODE>以外であると、
返される文字列には、ミニバッファで指定されたテキスト属性が含まれる。
さもなければ、値を返すときにすべてのテキスト属性を取り除く。
<P>

引数<VAR>inherit-input-method</VAR>が<CODE>nil</CODE>以外であると、
ミニバッファに入るまえにどのバッファにいたかに関わらず、
そのバッファから現在の入力方式（see 節 <A HREF="elisp_33.html#SEC548">32.11 入力方式</A>）と
<CODE>enable-multibyte-characters</CODE>（see 節 <A HREF="elisp_33.html#SEC529">32.1 テキスト表現</A>）の設定を
継承する。
<P>

<VAR>initial-contents</VAR>が文字列であれば、
<CODE>read-from-minibuffer</CODE>は、
ユーザーがテキスト編集を始めるまえに、
この文字列をミニバッファに挿入しその末尾にポイントを置く。
この文字列を初期内容とするミニバッファが現れる。
<P>

あるいは、<VAR>initial-contents</VAR>は、
<CODE>(<VAR>string</VAR> . <VAR>position</VAR>)</CODE>という形式のコンスセルでもよい。
これは、文字列<VAR>string</VAR>をミニバッファに挿入し、
ポイントは末尾にではなく
先頭から<VAR>position</VAR>番目の文字に置くことを意味する。
<P>

<STRONG>使用上の注意：</STRONG><CODE> </CODE>
引数<VAR>initial-contents</VAR>と<VAR>default</VAR>は、
多かれ少なかれ同じことを行う代替方法を提供する。
<CODE>read-from-minibuffer</CODE>の1つの呼び出しにおいて、
両者の機能を同時に使うことに意味はない。
一般には、<VAR>default</VAR>を使うことを勧める。
というのは、ユーザーがデフォルト値を望む場合にはデフォルト値を挿入でき、
それ以外の場合にはデフォルト値を削除しなくてもよいからである。
</DL>
<P>

<A NAME="IDX998"></A>
<DL>
<DT><U>Function:</U> <B>read-string</B> <I>prompt &#38;optional initial history default inherit-input-method</I>
<DD>この関数はミニバッファから文字列を読み取り、それを返す。
引数<VAR>prompt</VAR>と<VAR>initial</VAR>は、
<CODE>read-from-minibuffer</CODE>と同様に使われる。
使用するキーマップは<CODE>minibuffer-local-map</CODE>である。
<P>

省略可能な引数<VAR>history</VAR>は、<CODE>nil</CODE>以外であると、
履歴リストと（省略可能な）リスト内での初期位置を指定する。
省略可能な引数<VAR>default</VAR>は、
ユーザー入力が空の場合に返されるデフォルト値であり、文字列であること。
省略可能な引数<VAR>inherit-input-method</VAR>は、
カレントバッファの入力方式を継承するかどうかを指定する。
<P>

この関数は関数<CODE>read-from-minibuffer</CODE>の
インターフェイスを単純化したものである。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(read-string <VAR>prompt</VAR> <VAR>initial</VAR> <VAR>history</VAR> <VAR>default</VAR> <VAR>inherit</VAR>)
==
(let ((value
       (read-from-minibuffer <VAR>prompt</VAR> <VAR>initial</VAR> nil nil
                             <VAR>history</VAR> <VAR>default</VAR> <VAR>inherit</VAR>)))
  (if (equal value "")
      <VAR>default</VAR>
    value))
</FONT></pre></td></tr></table></DL>
<P>

<A NAME="IDX999"></A>
<DL>
<DT><U>Variable:</U> <B>minibuffer-allow-text-properties</B>
<DD>この変数が<CODE>nil</CODE>であると、
<CODE>read-from-minibuffer</CODE>はミニバッファで指定されたすべての
テキスト属性を返すまえに取り除く。
すべてのミニバッファが<CODE>read-from-minibuffer</CODE>を使うので、
この変数はすべてのミニバッファ入力に適用される。
<P>

この変数の値に関わらず、
補完関数は無条件にテキスト属性を廃棄することに注意。
</DL>
<P>

<A NAME="IDX1000"></A>
<DL>
<DT><U>Variable:</U> <B>minibuffer-local-map</B>
<DD>ミニバッファから読み取るときのデフォルトのローカルキーマップ。
デフォルトでは、以下のバインディングである。
<P>

<DL COMPACT>
<DT><KBD>C-j</KBD>
<DD><CODE>exit-minibuffer</CODE>
<P>

<DT><KBD>RET</KBD>
<DD><CODE>exit-minibuffer</CODE>
<P>

<DT><KBD>C-g</KBD>
<DD><CODE>abort-recursive-edit</CODE>
<P>

<DT><KBD>M-n</KBD>
<DD><CODE>next-history-element</CODE>
<P>

<DT><KBD>M-p</KBD>
<DD><CODE>previous-history-element</CODE>
<P>

<DT><KBD>M-r</KBD>
<DD><CODE>next-matching-history-element</CODE>
<P>

<DT><KBD>M-s</KBD>
<DD><CODE>previous-matching-history-element</CODE>
</DL>
</DL>
<P>

<A NAME="IDX1001"></A>
<DL>
<DT><U>Function:</U> <B>read-no-blanks-input</B> <I>prompt &#38;optional initial inherit-input-method</I>
<DD>この関数はミニバッファから文字列を読み取るが、
入力には白文字を許さず、白文字は入力を終らせる。
引数<VAR>prompt</VAR>、<VAR>initial</VAR>、<VAR>inherit-input-method</VAR>は、
<CODE>read-from-minibuffer</CODE>と同様に使われる。
<P>

これは関数<CODE>read-from-minibuffer</CODE>の
インターフェイスを単純化したものであり、
引数<VAR>keymap</VAR>として<CODE>minibuffer-local-ns-map</CODE>の値を渡す。
キーマップ<CODE>minibuffer-local-ns-map</CODE>では
<KBD>C-q</KBD>を再バインドしないため、
クォートすれば空白を文字列に含めることが<EM>できる</EM>。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(read-no-blanks-input <VAR>prompt</VAR> <VAR>initial</VAR>)
==
(read-from-minibuffer <VAR>prompt</VAR> <VAR>initial</VAR> minibuffer-local-ns-map)
</FONT></pre></td></tr></table></DL>
<P>

<A NAME="IDX1002"></A>
<DL>
<DT><U>Variable:</U> <B>minibuffer-local-ns-map</B>
<DD>この組み込み変数は、関数<CODE>read-no-blanks-input</CODE>が
ミニバッファ用のローカルキーマップとして使うキーマップである。
デフォルトでは、<CODE>minibuffer-local-map</CODE>のバインディングに加えて
以下のバインディングである。
<P>

<DL COMPACT>
<DT><KBD>SPC</KBD>
<DD><A NAME="IDX1003"></A>
<A NAME="IDX1004"></A>
<CODE>exit-minibuffer</CODE>
<P>

<DT><KBD>TAB</KBD>
<DD><A NAME="IDX1005"></A>
<A NAME="IDX1006"></A>
<CODE>exit-minibuffer</CODE>
<P>

<DT><KBD>?</KBD>
<DD><A NAME="IDX1007"></A>
<A NAME="IDX1008"></A>
<CODE>self-insert-and-exit</CODE>
</DL>
</DL>
<P>

<A NAME="Object from Minibuffer"></A>
<HR SIZE="6">
<br><A NAME="SEC268"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC267"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC269"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Object from Minibuffer"></A>
<H2> 19.3 ミニバッファでのLispオブジェクトの読み取り </H2>
<!--docid::SEC268::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Object%20from%20Minibuffer">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Object%20from%20Minibuffer</a>"<br>
"texi/elisp21/ミニバッファでのLispオブジェクトの読み取り"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%DF%A5%CB%A5%D0%A5%C3%A5%D5%A5%A1%A4%C7%A4%CELisp%A5%AA%A5%D6%A5%B8%A5%A7%A5%AF%A5%C8%A4%CE%C6%C9%A4%DF%BC%E8%A4%EA">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

本節では、ミニバッファでLispオブジェクトを読み取る関数について述べます。
<P>

<A NAME="IDX1009"></A>
<DL>
<DT><U>Function:</U> <B>read-minibuffer</B> <I>prompt &#38;optional initial</I>
<DD>この関数はミニバッファを用いてLispオブジェクトを読み取り、
それを評価せずに返す。
引数<VAR>prompt</VAR>と<VAR>initial</VAR>は、
<CODE>read-from-minibuffer</CODE>と同様に使われる。
<P>

これは関数<CODE>read-from-minibuffer</CODE>の
インターフェイスを単純化したものである。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(read-minibuffer <VAR>prompt</VAR> <VAR>initial</VAR>)
==
(read-from-minibuffer <VAR>prompt</VAR> <VAR>initial</VAR> nil t)
</FONT></pre></td></tr></table><P>

初期入力として文字列<CODE>"(testing)"</CODE>を与えた例を示す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(read-minibuffer
 "Enter an expression: " (format "%s" '(testing)))

;; 以下のようにミニバッファが表示される

---------- Buffer: Minibuffer ----------
Enter an expression: (testing)-!-
---------- Buffer: Minibuffer ----------
</FONT></pre></td></tr></table><P>

デフォルトとして初期入力を使うには、ユーザーはただちに<KBD>RET</KBD>を打てばよい。
あるいは、入力を編集する。
</DL>
<P>

<A NAME="IDX1010"></A>
<DL>
<DT><U>Function:</U> <B>eval-minibuffer</B> <I>prompt &#38;optional initial</I>
<DD>この関数はミニバッファを用いてLisp式を読み取り、
それを評価してその結果を返す。
引数<VAR>prompt</VAR>と<VAR>initial</VAR>は、
<CODE>read-from-minibuffer</CODE>と同様に使われる。
<P>

この関数は<CODE>read-from-minibuffer</CODE>の
インターフェイスを単純化したものである。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(eval-minibuffer <VAR>prompt</VAR> <VAR>initial</VAR>)
==
(eval (read-minibuffer <VAR>prompt</VAR> <VAR>initial</VAR>))
</FONT></pre></td></tr></table></DL>
<P>

<A NAME="IDX1011"></A>
<DL>
<DT><U>Function:</U> <B>edit-and-eval-command</B> <I>prompt form</I>
<DD>この関数はミニバッファを用いてLisp式を読み取り、それを評価する。
このコマンドと<CODE>eval-minibuffer</CODE>との違いは、
初期フォーム<VAR>form</VAR>を省略できないことであり、
このフォームをテキスト文字列としではなく表示表現に
変換するLispオブジェクトとして扱うことである。
<CODE>prin1</CODE>を用いて表示するので、
これが文字列であると初期テキストにはダブルクォート文字（`<SAMP>"</SAMP>'）が現れる。
see 節 <A HREF="elisp_19.html#SEC263">18.5 出力関数</A>。
<P>

<CODE>edit-and-eval-command</CODE>はまず、<VAR>prompt</VAR>をプロンプトとして
ミニバッファを活性にする。
続いて、ミニバッファに<VAR>form</VAR>の表示表現を挿入し、ユーザーに編集させる。
ユーザーがミニバッファから抜けると、
編集後のテキストを<CODE>read</CODE>で読み取り評価する。
評価結果が<CODE>edit-and-eval-command</CODE>の値になる。
<P>

以下の例では、すでに正しいフォームである
初期テキストの式をユーザーに提示する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(edit-and-eval-command "Please edit: " '(forward-word 1))

;; 上の式を評価後には、ミニバッファは以下のようになる 

---------- Buffer: Minibuffer ----------
Please edit: (forward-word 1)-!-
---------- Buffer: Minibuffer ----------
</FONT></pre></td></tr></table><P>

ただちに<KBD>RET</KBD>を打つと、
ミニバッファから抜けて式を評価するので、
ポイントを1単語分先へ進めることになる。
この例では、<CODE>edit-and-eval-command</CODE>は<CODE>nil</CODE>を返す。
</DL>
<P>

<A NAME="Minibuffer History"></A>
<HR SIZE="6">
<br><A NAME="SEC269"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC268"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC270"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Minibuffer History"></A>
<H2> 19.4 ミニバッファの履歴 </H2>
<!--docid::SEC269::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Minibuffer%20History">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Minibuffer%20History</a>"<br>
"texi/elisp21/ミニバッファの履歴"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%DF%A5%CB%A5%D0%A5%C3%A5%D5%A5%A1%A4%CE%CD%FA%CE%F2">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1012"></A>
<A NAME="IDX1013"></A>
<P>

<EM>ミニバッファ履歴リスト</EM>（minibuffer history list）は
ミニバッファでの以前の入力を記録し、
ユーザーがそれらを手軽に再利用できるようにします。
履歴リストは実際にはシンボルでありリストではありません。
最新のものが先頭にある（以前の入力の）文字列のリストを値とする変数です。
<P>

異なる種類の入力に用いる多くの別々の履歴リストがあります。
ミニバッファを利用するたびに適した履歴リストを指定するのは、
Lispプログラマの責任です。
<P>

基本的なミニバッファ入力関数
<CODE>read-from-minibuffer</CODE>と<CODE>completing-read</CODE>の両者は、
読者が指定する履歴リストを省略可能な引数<VAR>hist</VAR>として受け付けます。
指定可能な値はつぎのとおりです。
<P>

<DL COMPACT>
<DT><VAR>variable</VAR>
<DD>変数<VAR>variable</VAR>（シンボル）を履歴リストとして用いる。
<P>

<DT>(<VAR>variable</VAR> . <VAR>startpos</VAR>)
<DD>変数<VAR>variable</VAR>（シンボル）を履歴リストとして用い、
初期履歴位置を<VAR>startpos</VAR>
（履歴リストの最新要素を0とする整数）と仮定する。
<P>

<VAR>startpos</VAR>を指定した場合、整合性を保つために、
履歴リストの当該要素をミニバッファの初期内容にも指定すること。
</DL>
<P>

<VAR>hist</VAR>を指定しなければ、
デフォルトの履歴リスト<CODE>minibuffer-history</CODE>を用いる。
その他の標準的な履歴リストについては以下を参照。
読者が独自の履歴リスト変数を作成してもよい。
初めて使用するまえに単に<CODE>nil</CODE>で初期化しておく。
<P>

<CODE>read-from-minibuffer</CODE>と<CODE>completing-read</CODE>の両者は
履歴リストに新たな要素を自動的に追加し、
リスト上の要素を再利用するためのコマンドをユーザーに提供する。
履歴リストを使うために読者のプログラムで行うべきことは、
履歴リストを初期化し必要なときにその名前を入力関数に渡すだけである。
ミニバッファ入力関数が履歴リストを使用していないときには、
履歴リストを変更しても安全である。
<P>

標準的なミニバッファ履歴リスト変数を以下にあげておく。
<P>

<A NAME="IDX1014"></A>
<DL>
<DT><U>Variable:</U> <B>minibuffer-history</B>
<DD>ミニバッファの履歴入力用のデフォルトの履歴リスト。
</DL>
<P>

<A NAME="IDX1015"></A>
<DL>
<DT><U>Variable:</U> <B>query-replace-history</B>
<DD><CODE>query-replace</CODE>（および同様のコマンド）の引数用の履歴リスト。
</DL>
<P>

<A NAME="IDX1016"></A>
<DL>
<DT><U>Variable:</U> <B>file-name-history</B>
<DD>ファイル名引数用の履歴リスト。
</DL>
<P>

<A NAME="IDX1017"></A>
<DL>
<DT><U>Variable:</U> <B>buffer-name-history</B>
<DD><A NAME="IDX1018"></A>
バッファ名引数用の履歴リスト。
</DL>
<P>

<A NAME="IDX1019"></A>
<DL>
<DT><U>Variable:</U> <B>regexp-history</B>
<DD>正規表現引数用の履歴リスト。
</DL>
<P>

<A NAME="IDX1020"></A>
<DL>
<DT><U>Variable:</U> <B>extended-command-history</B>
<DD>拡張コマンド名である引数用の履歴リスト。
</DL>
<P>

<A NAME="IDX1021"></A>
<DL>
<DT><U>Variable:</U> <B>shell-command-history</B>
<DD>シェルコマンドである引数用の履歴リスト。
</DL>
<P>

<A NAME="IDX1022"></A>
<DL>
<DT><U>Variable:</U> <B>read-expression-history</B>
<DD>Lisp式として評価する引数用の履歴リスト。
</DL>
<P>

<A NAME="Completion"></A>
<HR SIZE="6">
<br><A NAME="SEC270"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC269"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC271"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Completion"></A>
<H2> 19.5 補完 </H2>
<!--docid::SEC270::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Completion">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Completion</a>"<br>
"texi/elisp21/補完"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%CA%E4%B4%B0">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1023"></A>
<P>

<EM>補完</EM>（completion）とは、
名前の省略から始まる名前の残り部分を補充する機能です。
ユーザー入力を正しい名前のリストと比較し、
すでにユーザーが入力したものに名前が
どの程度一致するかを決定することで補完します。
たとえば、<KBD>C-x b</KBD>（<CODE>switch-to-buffer</CODE>）と打って、
切り替えたいバッファ名の始めの数文字を打って
<KBD>TAB</KBD>（<CODE>minibuffer-complete</CODE>）を打つと、
Emacsは可能な限りその名前を補充します。
<P>

Emacsの標準のコマンドは、
シンボル、ファイル、バッファ、プロセスの名前を補完できます。
本節の関数を用いれば、その他の種類の名前の補完も実装できます。
<P>

関数<CODE>try-completion</CODE>は補完のための基本関数です。
与えられた文字列の集まりから
初期文字列にもっとも適合する最長のものを返します。
<P>

関数<CODE>completing-read</CODE>は補完のための上位レベルの
インターフェイスを提供します。
<CODE>completing-read</CODE>の呼び出しには、
正しい名前のリストを決定する方法を指定します。
この関数は、補完に有用なコマンドを数個のキーにバインドした
ローカルキーマップを使うミニバッファを活性にします。
その他の関数は、特定の種類の名前を補完して読み取るために
単純化したインターフェイスを提供します。
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_20.html#SEC271">19.5.1 基本補完関数</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Low-level functions for completing strings.</TD></TR>
</TABLE>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(These&nbsp;are&nbsp;too&nbsp;low&nbsp;level&nbsp;to&nbsp;use&nbsp;the&nbsp;minibuffer.)
<br>
<TABLE BORDER=0 CELLSPACING=0>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_20.html#SEC272">19.5.2 補完とミニバッファ</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Invoking the minibuffer with completion.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_20.html#SEC273">19.5.3 補完を行うミニバッファコマンド</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Minibuffer commands that do completion.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_20.html#SEC274">19.5.4 高レベルの補完関数</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Convenient special cases of completion</TD></TR>
</TABLE>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(reading&nbsp;buffer&nbsp;name,&nbsp;file&nbsp;name,&nbsp;etc.)
<br>
<TABLE BORDER=0 CELLSPACING=0>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_20.html#SEC275">19.5.5 ファイル名の読み取り</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Using completion to read file names.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_20.html#SEC276">19.5.6 プログラム補完</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Finding the completions for a given file name.</TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Basic Completion"></A>
<HR SIZE="6">
<br><A NAME="SEC271"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC270"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC272"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Basic Completion"></A>
<H3> 19.5.1 基本補完関数 </H3>
<!--docid::SEC271::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Basic%20Completion">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Basic%20Completion</a>"<br>
"texi/elisp21/基本補完関数"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%B4%F0%CB%DC%CA%E4%B4%B0%B4%D8%BF%F4">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

2つの関数<CODE>try-completion</CODE>と<CODE>all-completions</CODE>は、
それ自身ではミニバッファを使いません。
これらについて本章で述べるのは、
ミニバッファを使う上位レベルの補完機能と同列にしておくためです。
<P>

<A NAME="IDX1024"></A>
<DL>
<DT><U>Function:</U> <B>try-completion</B> <I>string collection &#38;optional predicate</I>
<DD>この関数は、<VAR>collection</VAR>にある<VAR>string</VAR>を補完する
共通の最長な部分文字列を返す。
<VAR>collection</VAR>の値は、連想リスト、オブジェクト配列、あるいは、
実質的な文字列の集まりを返す関数（下記参照）であること。
<P>

補完では、<VAR>collection</VAR>で指定した各補完候補と
<VAR>string</VAR>を比較する。
補完候補の先頭部分が<VAR>string</VAR>に等しければ、
その補完候補は一致するという。
一致する補完候補がなければ、<CODE>try-completion</CODE>は<CODE>nil</CODE>を返す。
たった1つの補完候補に一致し、かつ、完全に一致すれば、
<CODE>try-completion</CODE>は<CODE>t</CODE>を返す。
さもなければ、一致する補完候補すべてに共通する最長の文字列を値とする。
<P>

<VAR>collection</VAR>が連想リスト（see 節 <A HREF="elisp_6.html#SEC92">5.8 連想リスト</A>）であると、
連想リストの要素のCAR群が補完候補の集まりになる。
<P>

<A NAME="IDX1025"></A>
<VAR>collection</VAR>がオブジェクト配列（see 節 <A HREF="elisp_8.html#SEC104">7.3 シンボルの作成とインターン</A>）であると、
オブジェクト配列内のすべてのシンボルの名前が補完候補の集まりになる。
グローバル変数<CODE>obarray</CODE>は、インターンしたすべてのLispシンボルの
名前を収めたオブジェクト配列を保持する。
<P>

新たなオブジェクト配列を作成する唯一の正しい方法は、
まず空で作成してから<CODE>intern</CODE>で1つ1つシンボルを追加することである
ことに注意。
なお、1つのシンボルを複数のオブジェクト配列にはインターンできない。
<P>

引数<VAR>predicate</VAR>が<CODE>nil</CODE>以外である場合、
それは1引数の関数であること。
その関数は一致する補完候補の検査に使われ、
<VAR>predicate</VAR>が<CODE>nil</CODE>以外を返す場合にのみ一致した候補とみなす。
<VAR>predicate</VAR>に渡す引数は、
（CARが文字列である）連想リストのコンスセルであるか、
オブジェクト配列からの（シンボル名では<EM>ない</EM>）シンボルである。
<P>

<VAR>collection</VAR>には、関数であるシンボルを使うこともできる。
その関数には補完処理を完遂する責任がある。
<CODE>try-completion</CODE>はその関数が返したものを返す。
その関数は3引数、つまり、
<VAR>string</VAR>、<VAR>predicate</VAR>、<CODE>nil</CODE>で呼ばれる。
（第3引数がある理由は、
<CODE>all-completions</CODE>でも同じ関数を使い、
いずれの場合にも適切に動作できるようにするため。）
see 節 <A HREF="elisp_20.html#SEC276">19.5.6 プログラム補完</A>。
<P>

以下の最初の例では、
文字列`<SAMP>foo</SAMP>'は連想リストの3つのCARに一致する。
すべての一致は`<SAMP>fooba</SAMP>'で始まるため、これが結果になる。
2番目の例では、たった1つの一致があり、しかも、完全に一致するので、
値は<CODE>t</CODE>である。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(try-completion 
 "foo"
 '(("foobar1" 1) ("barfoo" 2) ("foobaz" 3) ("foobar2" 4)))
     => "fooba"

(try-completion "foo" '(("barfoo" 2) ("foo" 3)))
     => t
</FONT></pre></td></tr></table><P>

つぎの例では、`<SAMP>forw</SAMP>'で始まるシンボルが多数あり、
それらはすべて単語`<SAMP>forward</SAMP>'で始まる。
ほとんどのシンボルでは、これに`<SAMP>-</SAMP>'が続くが、
すべてがそうではないので、`<SAMP>forward</SAMP>'までしか補完できない。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(try-completion "forw" obarray)
     => "forward"
</FONT></pre></td></tr></table><P>

最後の例は、述語<CODE>test</CODE>の検査に通るのは3つの一致のうち2つだけである
（文字列`<SAMP>foobaz</SAMP>'は短すぎる）。
両者は文字列`<SAMP>foobar</SAMP>'で始まる。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(defun test (s) 
  (&#62; (length (car s)) 6))
     => test
(try-completion 
 "foo"
 '(("foobar1" 1) ("barfoo" 2) ("foobaz" 3) ("foobar2" 4)) 
 'test)
     => "foobar"
</FONT></pre></td></tr></table></DL>
<P>

<A NAME="IDX1026"></A>
<DL>
<DT><U>Function:</U> <B>all-completions</B> <I>string collection &#38;optional predicate nospace</I>
<DD>この関数は<VAR>string</VAR>の補完すべてのリストを返す。
この関数の引数は、<CODE>try-completion</CODE>のものと同じである。
<P>

<VAR>collection</VAR>が関数であると、
<VAR>string</VAR>、<VAR>predicate</VAR>、<CODE>t</CODE>の3引数で呼ばれる。
<CODE>all-completions</CODE>はこの関数が返す値を返す。
see 節 <A HREF="elisp_20.html#SEC276">19.5.6 プログラム補完</A>。
<P>

<VAR>nospace</VAR>が<CODE>nil</CODE>以外であると、
<VAR>string</VAR>が空白で始まらない限り、空白で始まる補完は無視する。
<P>

<CODE>try-completion</CODE>の例に示した関数<CODE>test</CODE>を用いた例を示す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(defun test (s) 
  (&#62; (length (car s)) 6))
     => test

(all-completions  
 "foo"
 '(("foobar1" 1) ("barfoo" 2) ("foobaz" 3) ("foobar2" 4))
 'test)
     => ("foobar1" "foobar2")
</FONT></pre></td></tr></table></DL>
<P>

<A NAME="IDX1027"></A>
<DL>
<DT><U>Variable:</U> <B>completion-ignore-case</B>
<DD>この変数の値が<CODE>nil</CODE>以外であると、
Emacsは補完において大文字小文字を区別しない。
</DL>
<P>

<A NAME="Minibuffer Completion"></A>
<HR SIZE="6">
<br><A NAME="SEC272"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC271"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC273"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Minibuffer Completion"></A>
<H3> 19.5.2 補完とミニバッファ </H3>
<!--docid::SEC272::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Minibuffer%20Completion">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Minibuffer%20Completion</a>"<br>
"texi/elisp21/補完とミニバッファ"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%CA%E4%B4%B0%A4%C8%A5%DF%A5%CB%A5%D0%A5%C3%A5%D5%A5%A1">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

本節ではミニバッファからの補完による読み取り用の
基本インターフェイスについて述べます。
<P>

<A NAME="IDX1028"></A>
<DL>
<DT><U>Function:</U> <B>completing-read</B> <I>prompt collection &#38;optional predicate require-match initial hist default inherit-input-method</I>
<DD>この関数は、与えられた補完でユーザーを補佐して
ミニバッファで文字列を読み取る。
文字列であるプロンプト<VAR>prompt</VAR>でミニバッファを活性にする。
<P>

実際の補完は、<VAR>collection</VAR>と<VAR>predicate</VAR>を
関数<CODE>try-completion</CODE>に渡して行う。
これは、補完を用いるローカルキーマップでバインドされたコマンドで行われる。
<P>

<VAR>require-match</VAR>が<CODE>nil</CODE>であると、
ミニバッファでの入力に関わらず
ミニバッファから抜けるコマンドは動作する。
<VAR>require-match</VAR>が<CODE>t</CODE>であると、
ミニバッファでの入力が<VAR>collection</VAR>の1つの要素に補完できない限り、
ミニバッファから抜ける通常のコマンドは動作しない。
<VAR>require-match</VAR>が<CODE>nil</CODE>でも<CODE>t</CODE>でもないと、
ミニバッファでの入力が<VAR>collection</VAR>の1つの要素に一致しない限り、
ミニバッファから抜けるコマンドは動作しない。
<P>

しかし、<VAR>require-match</VAR>の値に関わらず、
空の入力はつねに許される。
その場合、<CODE>completing-read</CODE>は<VAR>default</VAR>を返す。
<VAR>default</VAR>の値は（<CODE>nil</CODE>でなければ）履歴コマンドを介しても
ユーザーが使える。
<P>

ミニバッファが空の状態で<KBD>RET</KBD>を打つと、
ユーザーは空入力で抜けることができる。
そうすると、<CODE>completing-read</CODE>は<CODE>""</CODE>を返す。
これにより、読み取った値に対してコマンドが使うどんなデフォルトでも指定できる。
<VAR>require-match</VAR>の値、および、<VAR>collection</VAR>に空文字列が
含まれるかどうかに関わらず、ユーザーはこのようにして<KBD>RET</KBD>で戻れる。
<P>

関数<CODE>completing-read</CODE>は<CODE>read-minibuffer</CODE>を呼び出すことで動作する。
<VAR>require-match</VAR>が<CODE>nil</CODE>であると、
キーマップとして<CODE>minibuffer-local-completion-map</CODE>を使い、
<CODE>nil</CODE>以外であると<CODE>minibuffer-local-must-match-map</CODE>を使う。
see 節 <A HREF="elisp_20.html#SEC273">19.5.3 補完を行うミニバッファコマンド</A>。
<P>

引数<VAR>hist</VAR>は、入力を保存しミニバッファ履歴コマンドで
使う履歴リスト変数を指定する。
デフォルトは<CODE>minibuffer-history</CODE>である。
see 節 <A HREF="elisp_20.html#SEC269">19.4 ミニバッファの履歴</A>。
<P>

<VAR>initial</VAR>が<CODE>nil</CODE>以外であると、
<CODE>completing-read</CODE>はこれを入力の一部としてミニバッファに挿入する。
これにより、ユーザーは補完コマンドとともに入力を編集できる。
ほとんどの場合、<VAR>initial</VAR>ではなく<VAR>default</VAR>を使うことを勧める。
<P>

引数<VAR>inherit-input-method</VAR>が<CODE>nil</CODE>以外であると、
ミニバッファに入るまえのカレントバッファがなんであれ、
カレントバッファから現在の入力方式（see 節 <A HREF="elisp_33.html#SEC548">32.11 入力方式</A>）と
<CODE>enable-multibyte-characters</CODE>（see 節 <A HREF="elisp_33.html#SEC529">32.1 テキスト表現</A>）
の設定を継承する。
<P>

組み込み変数<CODE>completion-ignore-case</CODE>が<CODE>nil</CODE>以外であると、
大文字小文字を区別せずに候補に対して入力を比較する。
see 節 <A HREF="elisp_20.html#SEC271">19.5.1 基本補完関数</A>。
<P>

<CODE>completing-read</CODE>を用いた例を以下に示す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(completing-read
 "Complete a foo: "
 '(("foobar1" 1) ("barfoo" 2) ("foobaz" 3) ("foobar2" 4))
 nil t "fo")

;; 上の式を評価するとミニバッファはつぎのようになる 

---------- Buffer: Minibuffer ----------
Complete a foo: fo-!-
---------- Buffer: Minibuffer ----------
</FONT></pre></td></tr></table><P>

ユーザーが<KBD><KBD>DEL</KBD> <KBD>DEL</KBD> b <KBD>RET</KBD></KBD>を打つと、
<CODE>completing-read</CODE>は<CODE>barfoo</CODE>を返す。
<P>

関数<CODE>completing-read</CODE>は、
補完を実際に行うコマンドに情報を渡すために3つの変数を束縛する。
3つの変数とは、<CODE>minibuffer-completion-table</CODE>、
<CODE>minibuffer-completion-predicate</CODE>、
<CODE>minibuffer-completion-confirm</CODE>である。
これらについて詳しくは、<A HREF="elisp_20.html#SEC273">19.5.3 補完を行うミニバッファコマンド</A>を参照。
</DL>
<P>

<A NAME="Completion Commands"></A>
<HR SIZE="6">
<br><A NAME="SEC273"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC272"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC274"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Completion Commands"></A>
<H3> 19.5.3 補完を行うミニバッファコマンド </H3>
<!--docid::SEC273::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Completion%20Commands">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Completion%20Commands</a>"<br>
"texi/elisp21/補完を行うミニバッファコマンド"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%CA%E4%B4%B0%A4%F2%B9%D4%A4%A6%A5%DF%A5%CB%A5%D0%A5%C3%A5%D5%A5%A1%A5%B3%A5%DE%A5%F3%A5%C9">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

本節では、補完を行うためにミニバッファで用いられるキーマップ、
コマンド、ユーザーオプションについて述べます。
<P>

<A NAME="IDX1029"></A>
<DL>
<DT><U>Variable:</U> <B>minibuffer-local-completion-map</B>
<DD><CODE>completing-read</CODE>は、
補完候補の1つと完全に一致しなくてもよい場合に
ローカルキーマップとしてこの値を使う。
デフォルトでは、このキーマップのバインディングはつぎのとおり。
<P>

<DL COMPACT>
<DT><KBD>?</KBD>
<DD><CODE>minibuffer-completion-help</CODE>
<P>

<DT><KBD>SPC</KBD>
<DD><CODE>minibuffer-complete-word</CODE>
<P>

<DT><KBD>TAB</KBD>
<DD><CODE>minibuffer-complete</CODE>
</DL>
<P>

他の文字は<CODE>minibuffer-local-map</CODE>
（see 節 <A HREF="elisp_20.html#SEC267">19.2 ミニバッファでのテキスト文字列の読み取り</A>）と同様にバインドされる。
</DL>
<P>

<A NAME="IDX1030"></A>
<DL>
<DT><U>Variable:</U> <B>minibuffer-local-must-match-map</B>
<DD><CODE>completing-read</CODE>は、
補完候補の1つと完全に一致する必要がある場合に
ローカルキーマップとしてこの値を使う。
そのため、ミニバッファから無条件に抜けるコマンド<CODE>exit-minibuffer</CODE>に
バインドしたキーはない。
デフォルトでは、このキーマップのバインディングはつぎのとおり。
<P>

<DL COMPACT>
<DT><KBD>?</KBD>
<DD><CODE>minibuffer-completion-help</CODE>
<P>

<DT><KBD>SPC</KBD>
<DD><CODE>minibuffer-complete-word</CODE>
<P>

<DT><KBD>TAB</KBD>
<DD><CODE>minibuffer-complete</CODE>
<P>

<DT><KBD>C-j</KBD>
<DD><CODE>minibuffer-complete-and-exit</CODE>
<P>

<DT><KBD>RET</KBD>
<DD><CODE>minibuffer-complete-and-exit</CODE>
</DL>
<P>

他の文字は<CODE>minibuffer-local-map</CODE>と同様にバインドされる。
</DL>
<P>

<A NAME="IDX1031"></A>
<DL>
<DT><U>Variable:</U> <B>minibuffer-completion-table</B>
<DD>この変数の値は、ミニバッファでの補完に用いられる
連想リストやオブジェクト配列である。
これは、<CODE>completing-read</CODE>が<CODE>try-completion</CODE>に渡すものを
保持したグローバル変数である。
<CODE>minibuffer-complete-word</CODE>などの
ミニバッファ補完コマンドで使用される。
</DL>
<P>

<A NAME="IDX1032"></A>
<DL>
<DT><U>Variable:</U> <B>minibuffer-completion-predicate</B>
<DD>この変数の値は、<CODE>completing-read</CODE>が
<CODE>try-completion</CODE>へ渡す述語である。
この変数は、他のミニバッファ補完関数でも使われる。
</DL>
<P>

<A NAME="IDX1033"></A>
<DL>
<DT><U>コマンド:</U> <B>minibuffer-complete-word</B>
<DD>この関数は、ミニバッファの内容を多くても1単語分補完する。
ミニバッファの内容に対応する補完がたった1つであっても、
単語構成文字ではない文字以降は補充しない。
see 節 <A HREF="elisp_35.html#SEC564">34. 構文テーブル</A>。
</DL>
<P>

<A NAME="IDX1034"></A>
<DL>
<DT><U>コマンド:</U> <B>minibuffer-complete</B>
<DD>この関数は、ミニバッファの内容を可能な限り補完する。
</DL>
<P>

<A NAME="IDX1035"></A>
<DL>
<DT><U>コマンド:</U> <B>minibuffer-complete-and-exit</B>
<DD>この関数は、確認が必要でないとき、つまり、
<CODE>minibuffer-completion-confirm</CODE>が<CODE>nil</CODE>であるときには、
ミニバッファの内容を補完後に抜ける。
確認が必要<EM>である</EM>ときには、
このコマンドをただちに繰り返すことで確認をとる。
このコマンドは、連続して2回呼ばれると、
確認しないようにプログラムしてある。
</DL>
<P>

<A NAME="IDX1036"></A>
<DL>
<DT><U>Variable:</U> <B>minibuffer-completion-confirm</B>
<DD>この変数の値が<CODE>nil</CODE>以外の場合、
Emacsはミニバッファから抜けるまえに補完を確認してくる。
関数<CODE>minibuffer-complete-and-exit</CODE>は、
抜けるまえにこの変数の値を検査する。
</DL>
<P>

<A NAME="IDX1037"></A>
<DL>
<DT><U>コマンド:</U> <B>minibuffer-completion-help</B>
<DD>この関数は、ミニバッファの現在の内容に対する補完のリストを作る。
引数<VAR>collection</VAR>として変数<CODE>minibuffer-completion-table</CODE>の値を、
引数<VAR>predicate</VAR>として<CODE>minibuffer-completion-predicate</CODE>の値を
用いて<CODE>all-completions</CODE>を呼び出すことで動作する。
補完のリストは、`<SAMP>*Completions*</SAMP>'という名前のバッファに
テキストとして表示される。
</DL>
<P>

<A NAME="IDX1038"></A>
<DL>
<DT><U>Function:</U> <B>display-completion-list</B> <I>completions</I>
<DD>この関数は、通常はバッファであるストリーム<CODE>standard-output</CODE>に
<VAR>completions</VAR>を表示する。
（ストリームについては詳しくはsee 節 <A HREF="elisp_19.html#SEC258">18. Lispオブジェクトの読み取りと表示</A>。）
引数<VAR>completions</VAR>は、普通は、<CODE>all-completions</CODE>が
返した補完のリストであるが、そうでなくてもよい。
各要素は、シンボルか文字列であり、その場合、そのまま表示される。
各要素が2つの文字列から成るリストである場合、
文字列を連結したものを表示する。
<P>

この関数は、<CODE>minibuffer-completion-help</CODE>から呼ばれる。
以下のように、<CODE>with-output-to-temp-buffer</CODE>とともに
用いるのがもっとも一般的である。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(with-output-to-temp-buffer "*Completions*"
  (display-completion-list
    (all-completions (buffer-string) my-alist)))
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1039"></A>
<DL>
<DT><U>User Option:</U> <B>completion-auto-help</B>
<DD>この変数が<CODE>nil</CODE>以外であると、
つぎの補充文字が一意に決まらない場合には、
自動的に補完のリストを表示する。
</DL>
<P>

<A NAME="High-Level Completion"></A>
<HR SIZE="6">
<br><A NAME="SEC274"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC273"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC275"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="High-Level Completion"></A>
<H3> 19.5.4 高レベルの補完関数 </H3>
<!--docid::SEC274::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=High-Level%20Completion">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=High-Level%20Completion</a>"<br>
"texi/elisp21/高レベルの補完関数"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%B9%E2%A5%EC%A5%D9%A5%EB%A4%CE%CA%E4%B4%B0%B4%D8%BF%F4">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

本節では、特定の種類の名前を補完付きで読み取るための
高レベルの便利な関数について述べます。
<P>

多くの場合、これらの関数をLisp関数の途中では呼び出さないでください。
可能な場合には、<CODE>interactive</CODE>の指定で、
コマンドの引数を読み取る操作の一部としてすべてのミニバッファ入力を
行ってください。
See 節 <A HREF="elisp_21.html#SEC283">20.2 コマンドの定義</A>。
<P>

<A NAME="IDX1040"></A>
<DL>
<DT><U>Function:</U> <B>read-buffer</B> <I>prompt &#38;optional default existing</I>
<DD>この関数はバッファ名を読み取り、文字列として返す。
引数<VAR>default</VAR>はデフォルトの名前を表し、
ユーザーがミニバッファから空で抜け出したときに返される値である。
<CODE>nil</CODE>以外であるときには、文字列かバッファであること。
これはプロンプトとして現れるが、
ミニバッファには初期入力として挿入されない。
<P>

<VAR>existing</VAR>が<CODE>nil</CODE>以外であると、
指定した名前は既存のバッファ名であること。
テキストが正しくないとミニバッファから抜ける通常のコマンドは動作せず、
<KBD>RET</KBD>は正しい名前を探すため補完を行う。
（しかし、<VAR>default</VAR>が正しいかどうかは検査しない。
ユーザーがミニバッファを空で抜ければ、
なんであろうと<VAR>default</VAR>が返される。）
<P>

以下の例では、ユーザーは`<SAMP>minibuffer.t</SAMP>'と入力してから<KBD>RET</KBD>を打つ。
引数<VAR>existing</VAR>は<CODE>t</CODE>であり、
入力した名前で始まる唯一のバッファ名は`<SAMP>minibuffer.texi</SAMP>'であるので、
この名前が値になる。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(read-buffer "Buffer name? " "foo" t)
;; 上の式を評価すると、ミニバッファは空で
;; つぎのようなプロンプトが表示される

---------- Buffer: Minibuffer ----------
Buffer name? (default foo) -!-
---------- Buffer: Minibuffer ----------

;; ユーザーは<KBD>minibuffer.t <KBD>RET</KBD></KBD>と打つ
     => "minibuffer.texi"
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1041"></A>
<DL>
<DT><U>Variable:</U> <B>read-buffer-function</B>
<DD>この変数は、バッファ名の読み取り方を指定する。
たとえば、この変数に<CODE>iswitchb-read-buffer</CODE>を設定すると、
バッファ名を読み取るために<CODE>read-buffer</CODE>を呼び出す
すべてのEmacsコマンドは、
バッファ名を読むためにパッケージ<CODE>iswitchb</CODE>を使うようになる。
</DL>
<P>

<A NAME="IDX1042"></A>
<DL>
<DT><U>Function:</U> <B>read-command</B> <I>prompt &#38;optional default</I>
<DD>この関数はコマンド名を読み取り、Lispシンボルとして返す。
引数<VAR>prompt</VAR>は、<CODE>read-from-minibuffer</CODE>と同様に使われる。
なんであっても<CODE>commandp</CODE>が<CODE>t</CODE>を返せばコマンドであり、
<CODE>commandp</CODE>が<CODE>t</CODE>を返すシンボルはコマンド名であることに注意。
see 節 <A HREF="elisp_21.html#SEC287">20.3 対話的呼び出し</A>。
<P>

引数<VAR>default</VAR>は、ユーザー入力が空だった場合に返したい値を指定する。
これは、シンボルか文字列であること。
文字列であると、<CODE>read-command</CODE>は、これを返すまえにインターンする。
<VAR>default</VAR>が<CODE>nil</CODE>であると、デフォルトを指定しないことを意味し、
ユーザー入力が空であると戻り値は<CODE>nil</CODE>である。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(read-command "Command name? ")

;; 上の式を評価後には、ミニバッファは空で 
;; つぎのようなプロンプトが表示される

---------- Buffer: Minibuffer ---------- 
Command name?  
---------- Buffer: Minibuffer ----------
</pre></td></tr></table><P>

ユーザーが<KBD>forward-c <KBD>RET</KBD></KBD>と打つと、
この関数は<CODE>forward-char</CODE>を返す。
<P>

関数<CODE>read-command</CODE>は<CODE>completing-read</CODE>のインターフェイスを
単純化したものである。
既存のLispシンボルの集まりから補完するために変数<CODE>obarray</CODE>を使い、
コマンド名のみを対象とするために述語<CODE>commandp</CODE>を使う。
<P>

<A NAME="IDX1043"></A>
<A NAME="IDX1044"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(read-command <VAR>prompt</VAR>)
==
(intern (completing-read <VAR>prompt</VAR> obarray 
                         'commandp t nil))
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1045"></A>
<DL>
<DT><U>Function:</U> <B>read-variable</B> <I>prompt &#38;optional default</I>
<DD>この関数はユーザー変数の名前を読み取り、シンボルとして返す。
<P>

引数<VAR>default</VAR>は、ユーザー入力が空だった場合に返したい値を指定する。
これは、シンボルか文字列であること。
文字列であると、<CODE>read-variable</CODE>は、これを返すまえにインターンする。
<VAR>default</VAR>が<CODE>nil</CODE>であると、デフォルトを指定しないことを意味し、
ユーザー入力が空であると戻り値は<CODE>nil</CODE>である。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(read-variable "Variable name? ")

;; 上の式を評価後には、ミニバッファは空で 
;; つぎのようなプロンプトが表示される

---------- Buffer: Minibuffer ----------
Variable name? -!-
---------- Buffer: Minibuffer ----------
</pre></td></tr></table><P>

ユーザーが<KBD>fill-p <KBD>RET</KBD></KBD>と打つと、
<CODE>read-variable</CODE>は<CODE>fill-prefix</CODE>を返す。
<P>

この関数は<CODE>read-command</CODE>に似ているが、
<CODE>commandp</CODE>のかわりに述語<CODE>user-variable-p</CODE>を使う。
<P>

<A NAME="IDX1046"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(read-variable <VAR>prompt</VAR>)
==
(intern
 (completing-read <VAR>prompt</VAR> obarray
                  'user-variable-p t nil))
</pre></td></tr></table></DL>
<P>

<A HREF="elisp_33.html#SEC542">32.10.4 ユーザー指定のコーディングシステム</A>の関数<CODE>read-coding-system</CODE>や
<CODE>read-non-nil-coding-system</CODE>も参照してください。
<P>

<A NAME="Reading File Names"></A>
<HR SIZE="6">
<br><A NAME="SEC275"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC274"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC276"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Reading File Names"></A>
<H3> 19.5.5 ファイル名の読み取り </H3>
<!--docid::SEC275::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Reading%20File%20Names">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Reading%20File%20Names</a>"<br>
"texi/elisp21/ファイル名の読み取り"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A1%A5%A4%A5%EB%CC%BE%A4%CE%C6%C9%A4%DF%BC%E8%A4%EA">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

ここでは、ファイル名を読み取るように設計された高レベルの
別の補完関数について述べます。
デフォルトディレクトリの自動挿入などの特別な機能を提供します。
<P>

<A NAME="IDX1047"></A>
<DL>
<DT><U>Function:</U> <B>read-file-name</B> <I>prompt &#38;optional directory default existing initial</I>
<DD>この関数は、<VAR>prompt</VAR>をプロンプトとし、
補完を行ってミニバッファでファイル名を読み取る。
<VAR>default</VAR>が<CODE>nil</CODE>以外であると、
ユーザーが単に<KBD>RET</KBD>を打つと、この関数は<VAR>default</VAR>を返す。
<VAR>default</VAR>が正しいかどうかは検査せず、
それがなんであれ、ユーザーがミニバッファを空で抜けるとそれを返す。
<P>

<VAR>existing</VAR>が<CODE>nil</CODE>以外であると、
ユーザーは既存ファイルの名前を指定する必要がある。
<KBD>RET</KBD>は、可能ならば正しい名前に補完を行うが、
それが正しくない場合には抜けない。
<VAR>existing</VAR>の値が<CODE>nil</CODE>でも<CODE>t</CODE>でもないと、
<KBD>RET</KBD>は補完後の確認を必要とする。
<VAR>existing</VAR>が<CODE>nil</CODE>であると、
存在しないファイルの名前も許す。
<P>

引数<VAR>directory</VAR>は、相対ファイル名の補完に用いるディレクトリを指定する。
<CODE>insert-default-directory</CODE>が<CODE>nil</CODE>以外であると、
初期入力として<VAR>directory</VAR>をミニバッファに挿入する。
カレントバッファの<CODE>default-directory</CODE>の値がデフォルトになる。
<P>

<VAR>initial</VAR>を指定すると、
（<VAR>directory</VAR>があればそれを挿入後に）バッファに
挿入される初期ファイル名になる。
この場合、ポイントは<VAR>initial</VAR>の先頭に置かれる。
<VAR>initial</VAR>のデフォルトは<CODE>nil</CODE>であり、
いかなるファイル名も挿入しない。
<VAR>initial</VAR>の動作を見るには、コマンド<KBD>C-x C-v</KBD>を試してほしい。
<STRONG>注意：</STRONG><CODE> </CODE>
ほとんどの場合、<VAR>initial</VAR>ではなく<VAR>default</VAR>を使うことを勧める。
<P>

例を示す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(read-file-name "The file is ")

;; 上の式を評価後には、ミニバッファはつぎのようになる

---------- Buffer: Minibuffer ----------
The file is /gp/gnu/elisp/-!-
---------- Buffer: Minibuffer ----------
</pre></td></tr></table><P>

<KBD>manual <KBD>TAB</KBD></KBD>を打つと、つぎのようになる。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>---------- Buffer: Minibuffer ----------
The file is /gp/gnu/elisp/manual.texi-!-
---------- Buffer: Minibuffer ----------
</pre></td></tr></table><P>

ユーザーが<KBD>RET</KBD>と打つと、
<CODE>read-file-name</CODE>は
ファイル名を文字列<CODE>"/gp/gnu/elisp/manual.texi"</CODE>として返す。
</DL>
<P>

<A NAME="IDX1048"></A>
<DL>
<DT><U>User Option:</U> <B>insert-default-directory</B>
<DD>この変数は<CODE>read-file-name</CODE>が使う。
その値は、<CODE>read-file-name</CODE>が、
デフォルトディレクトリの名前と（あれば）初期ファイル名を
ミニバッファに入れて動作を開始するかどうかを制御する。
この変数の値が<CODE>nil</CODE>であると、
<CODE>read-file-name</CODE>は
（引数<VAR>initial</VAR>で初期入力を指定しない限り）
ミニバッファに初期入力を入れない。
その場合でも、相対ファイル名の補完には
デフォルトディレクトリを使うが表示はしない。
<P>

例を示す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>;; デフォルトディレクトリを入れて始める
(let ((insert-default-directory t))
  (read-file-name "The file is "))

---------- Buffer: Minibuffer ----------
The file is ~lewis/manual/-!-
---------- Buffer: Minibuffer ----------

;; ミニバッファは空であり、プロンプトのみ
(let ((insert-default-directory nil))
  (read-file-name "The file is "))

---------- Buffer: Minibuffer ----------
The file is -!-
---------- Buffer: Minibuffer ----------
</pre></td></tr></table></DL>
<P>

<A NAME="Programmed Completion"></A>
<HR SIZE="6">
<br><A NAME="SEC276"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC275"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC277"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Programmed Completion"></A>
<H3> 19.5.6 プログラム補完 </H3>
<!--docid::SEC276::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Programmed%20Completion">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Programmed%20Completion</a>"<br>
"texi/elisp21/プログラム補完"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D7%A5%ED%A5%B0%A5%E9%A5%E0%CA%E4%B4%B0">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1049"></A>
<P>

意図した補完候補を持った連想リストやオブジェクト配列を
作成することが困難な場合もあります。
そのような場合、与えられた文字列に対する補完を計算する
独自の関数を与えることができます。
これを<EM>プログラム補完</EM>（programmed completion）と呼びます。
<P>

この機能を使うには、<CODE>completing-read</CODE>の引数<VAR>collection</VAR>に
関数定義を持つシンボルを渡します。
関数<CODE>completing-read</CODE>は、
<CODE>try-completion</CODE>や<CODE>all-completions</CODE>に
読者の補完関数を渡すようにして、読者の関数にすべてを任せます。
<P>

補完関数はつぎの3つの引数を受け取ります。
<P>

<UL>
<LI>
補完すべき文字列。
<P>

<LI>
補完候補を選別する述語関数、あるいは、選別しないのならば<CODE>nil</CODE>。
読者の関数では、各補完候補についてこの述語を呼び出し、
<CODE>nil</CODE>が返されたら当該候補を無視する。
<P>

<LI>
操作の型を示すフラグ。
</UL>
<P>

3つの操作型に対応してフラグの値は3つあります。
<P>

<UL>
<LI>
<CODE>nil</CODE>は<CODE>try-completion</CODE>を指定する。
補完関数は、指定された文字列の補完を返すこと。
あるいは、文字列が一意に完全に一致する場合には<CODE>t</CODE>を返し、
文字列の補完がまったくなければ<CODE>nil</CODE>を返す。
<P>

文字列が一意に完全に一致する場合であっても、
より長い候補に一致する場合には、
この関数は<CODE>t</CODE>ではなく文字列を返すこと。
<P>

<LI>
<CODE>t</CODE>は<CODE>all-completions</CODE>を指定する。
補完関数は、指定された文字列に対する補完のリストを返すこと。
<P>

<LI>
<CODE>lambda</CODE>は、完全な一致を指定する。
補完関数は、指定された文字列が候補に完全に一致する場合には<CODE>t</CODE>を返し、
さもなければ<CODE>nil</CODE>を返すこと。
</UL>
<P>

補完関数<VAR>collection</VAR>には関数シンボルに加えて、
ラムダ式（関数であるリスト）も許すほうが
一貫性があって見通しがよいはずですが、それは不可能です。
リストには補完候補表としての意味がすでにあり、連想リストがそれです。
関数としての可能性もある通常の連想リストの扱いに失敗するようでは、
信頼性がなくなります。
そのため、読者が補完に使用したい関数は、
シンボルに入れておく必要があるのです。
<P>

Emacsは、ファイル名の補完にはプログラム補完を用います。
See 節 <A HREF="elisp_25.html#SEC389">24.8.6 ファイル名の補完</A>。
<P>

<A NAME="Yes-or-No Queries"></A>
<HR SIZE="6">
<br><A NAME="SEC277"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC276"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC278"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Yes-or-No Queries"></A>
<H2> 19.6 Yes/Noの問い合わせ </H2>
<!--docid::SEC277::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Yes-or-No%20Queries">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Yes-or-No%20Queries</a>"<br>
"texi/elisp21/Yes/Noの問い合わせ"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2FYes%2FNo%A4%CE%CC%E4%A4%A4%B9%E7%A4%EF%A4%BB">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1050"></A>
<A NAME="IDX1051"></A>
<P>

本節ではユーザーにyes/noを問い合わせるための関数について述べます。
関数<CODE>y-or-n-p</CODE>には、1文字で答えます。
誤った答えでも重大な問題に至らないような問い合わせに便利です。
<CODE>yes-or-no-p</CODE>には3文字か4文字で答える必要があるため、
より重要な問い合わせに適しています。
<P>

これらの関数がマウスを使って起動されたコマンドから呼ばれると、
より正確には、<CODE>last-nonmenu-event</CODE>（see 節 <A HREF="elisp_21.html#SEC288">20.4 コマンドループからの情報</A>）が
<CODE>nil</CODE>かリストであると、
関数は問い合わせのための対話ボックスやポップアップメニューを使います。
さもなければ、キーボード入力を使います。
呼び出しにおいて<CODE>last-nonmenu-event</CODE>に適切な値を束縛することで
マウスかキーボード入力の使用を強制できます。
<P>

厳密にいえば、<CODE>yes-or-no-p</CODE>はミニバッファを使いますが、
<CODE>y-or-n-p</CODE>は使いません。
ですが、両者をここで説明しておきます。
<P>

<A NAME="IDX1052"></A>
<DL>
<DT><U>Function:</U> <B>y-or-n-p</B> <I>prompt</I>
<DD>この関数はユーザーに問い合わせ、エコー領域で入力を待ちます。
ユーザーが<KBD>y</KBD>を打てば<CODE>t</CODE>を返し、
<KBD>n</KBD>を打てば<CODE>nil</CODE>を返します。
さらに、<KBD>SPC</KBD>を「y」、<KBD>DEL</KBD>を「n」ともみなします。
<KBD>C-]</KBD>を<KBD>C-g</KBD>のように『中断』ともみなします。
というのは、問い合わせはミニバッファを使っているようにみえるので、
これから抜けるためにユーザーが<KBD>C-]</KBD>を使いそうだからである。
応答は1文字であり、<KBD>RET</KBD>で終える必要はない。
大文字と小文字は同じ意味である。
<P>

『問い合わせ』では、エコー領域に<VAR>prompt</VAR>を表示し、
文字列`<SAMP>(y or n) </SAMP>'が続きます。
入力が正しい応答（<KBD>y</KBD>、<KBD>n</KBD>、<KBD><KBD>SPC</KBD></KBD>、
<KBD><KBD>DEL</KBD></KBD>、中断など）でないと、
関数は`<SAMP>Please answer y or n.</SAMP>'を表示して
問い合わせるを繰り返す。
<P>

応答は編集できないので、この関数は実際にはミニバッファを使わない。
ミニバッファが使うのと同じ画面領域を使う
エコー領域（see 節 <A HREF="elisp_38.html#SEC602">37.3 エコー領域</A>）を実際には使う。
問い合わせ中は、カーソルはエコー領域に移動する。
<P>

応答とその意味は、
たとえ`<SAMP>y</SAMP>'や`<SAMP>n</SAMP>'であっても組み込まれているわけではない。
キーマップ<CODE>query-replace-map</CODE>がそれらを指定する。
see 節 <A HREF="elisp_34.html#SEC556">33.5 探索と置換</A>。
<P>

以下の例では、ユーザーはまず<KBD>q</KBD>を打つが、これは正しくない。
つぎのプロンプトに対して、ユーザーは<KBD>y</KBD>を打つ。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(y-or-n-p "Do you need a lift? ")

;; 上の式を評価後には、エコー領域には
;; つぎのプロンプトが表示される

---------- Echo area ----------
Do you need a lift? (y or n) 
---------- Echo area ----------

;; ユーザーが<KBD>q</KBD>を打つと、つぎのようになる

---------- Echo area ----------
Please answer y or n.  Do you need a lift? (y or n) 
---------- Echo area ----------

;; ユーザーが正しい応答を打つと
;; 問い合わせのうしろに表示される

---------- Echo area ----------
Do you need a lift? (y or n) y
---------- Echo area ----------
</FONT></pre></td></tr></table><P>

ここでは、エコー領域のメッセージを複数行示したが、
実際には、1度に1つのメッセージだけが表示される。
</DL>
<P>

<A NAME="IDX1053"></A>
<DL>
<DT><U>Function:</U> <B>y-or-n-p-with-timeout</B> <I>prompt seconds default-value</I>
<DD><CODE>y-or-n-p</CODE>と同様だが、ユーザーが<VAR>seconds</VAR>秒以内に答えないと、
入力を待たずに<VAR>default-value</VAR>を返す。
これにはタイマを使う。
<A HREF="elisp_40.html#SEC649">39.7 遅延実行のためのタイマ</A>を参照。
引数<VAR>seconds</VAR>は整数でも浮動小数点でもよい。
</DL>
<P>

<A NAME="IDX1054"></A>
<DL>
<DT><U>Function:</U> <B>yes-or-no-p</B> <I>prompt</I>
<DD>この関数はユーザーに問い合わせ、ミニバッファでの入力を仮定する。
ユーザーが`<SAMP>yes</SAMP>'を入力すると<CODE>t</CODE>を返し、
`<SAMP>no</SAMP>'を入力すると<CODE>nil</CODE>を返す。
応答を終えるためにユーザーは<KBD>RET</KBD>を打つ必要がある。
大文字と小文字は同じ意味である。
<P>

<CODE>yes-or-no-p</CODE>は、まず、<VAR>prompt</VAR>に続けて
`<SAMP>(yes or no) </SAMP>'をエコー領域に表示する。
ユーザーは正しい応答の1つを入力する必要がある。
さもないと、この関数は`<SAMP>Please answer yes or no.</SAMP>'を2秒ほど
表示してから問い合わせを繰り返す。
<P>

<CODE>yes-or-no-p</CODE>は<CODE>y-or-n-p</CODE>よりもユーザーの手間を必要とし、
より重要な決定に適している。
<P>

例を示す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(yes-or-no-p "Do you really want to remove everything? ")

;; 上の式を評価後には、つぎのプロンプトが 
;; 空のミニバッファとともに表示される 

---------- Buffer: minibuffer ----------
Do you really want to remove everything? (yes or no) 
---------- Buffer: minibuffer ----------
</FONT></pre></td></tr></table><P>

ユーザーは、まず<KBD>y <KBD>RET</KBD></KBD>を打つが、
この関数は完全な単語`<SAMP>yes</SAMP>'を要求するので正しくない。
以下のプロンプトを少し時間をおいて表示する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>---------- Buffer: minibuffer ----------
Please answer yes or no.
Do you really want to remove everything? (yes or no)
---------- Buffer: minibuffer ----------
</FONT></pre></td></tr></table></DL>
<P>

<A NAME="Multiple Queries"></A>
<HR SIZE="6">
<br><A NAME="SEC278"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC277"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC279"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Multiple Queries"></A>
<H2> 19.7 複数のY/Nの問い合わせ </H2>
<!--docid::SEC278::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Multiple%20Queries">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Multiple%20Queries</a>"<br>
"texi/elisp21/複数のY/Nの問い合わせ"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%CA%A3%BF%F4%A4%CEY%2FN%A4%CE%CC%E4%A4%A4%B9%E7%A4%EF%A4%BB">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

各バッファについて『バッファを保存するか』などの
一連の単純な問い合わせをする場合には、
個々に問い合わせるかわりに
<CODE>map-y-or-n-p</CODE>を用いてまとめて問い合わせるべきです。
<P>

<A NAME="IDX1055"></A>
<DL>
<DT><U>Function:</U> <B>map-y-or-n-p</B> <I>prompter actor list &#38;optional help action-alist</I>
<DD>この関数は、各問について1文字の応答をエコー領域から読み取ることで、
ユーザーに一連の問い合わせを行う。
<P>

<VAR>list</VAR>の値は、問い合わせ対象のオブジェクトを指定する。
オブジェクトのリストであるか、生成関数であること。
関数である場合、それは引数なしで呼ばれ、
つぎの問い合わせ対象のオブジェクトを返すか、
問い合わせの終了を意味する<CODE>nil</CODE>を返す。
<P>

引数<VAR>prompter</VAR>は、各問い合わせをどのように問うかを指定する。
<VAR>prompter</VAR>が文字列であると、問い合わせ文はつぎのように計算される。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(format <VAR>prompter</VAR> <VAR>object</VAR>)
</pre></td></tr></table><P>

ここで、<VAR>object</VAR>は（<VAR>list</VAR>から得た）
問い合わせ対象のオブジェクトである。
<P>

文字列でなければ、<VAR>prompter</VAR>は
1引数（問い合わせ対象のオブジェクト）の関数であり、
問い合わせ文を返す。
値が文字列であれば、それがユーザーへの問い合わせ文になる。
関数は、（ユーザーに問い合わせずに）
当該オブジェクトを処理することを意味する<CODE>t</CODE>か、
（ユーザーに問い合わせずに）当該オブジェクトを無視することを意味する
<CODE>nil</CODE>を返してもよい。
<P>

引数<VAR>actor</VAR>は、ユーザーの応答に対してどのように動作するかを指定する。
これは1引数の関数であり、ユーザーが「はい」と答えたオブジェクトで
呼ばれる。
引数は、つねに<VAR>list</VAR>から得たオブジェクトである。
<P>

引数<VAR>help</VAR>を指定する場合、つぎの形のリストであること。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(<VAR>singular</VAR> <VAR>plural</VAR> <VAR>action</VAR>)
</pre></td></tr></table><P>

ここで、
<VAR>singular</VAR>は操作対象のオブジェクトを
記述する単数形の名詞を含んだ文字列であり、
<VAR>plural</VAR>は対応する複数形の名詞であり、
<VAR>action</VAR>は動作を記述する他動詞であること。
<P>

<VAR>help</VAR>を指定しないと、デフォルトは
<CODE>("object" "objects" "act on")</CODE>である。
<P>

各問い合わせでは、ユーザーは当該対象オブジェクトに対する操作に
<KBD>y</KBD>、<KBD>Y</KBD>、<KBD>SPC</KBD>で答える。
<KBD>n</KBD>、<KBD>N</KBD>、<KBD>DEL</KBD>は、そのオブジェクトを無視する。
<KBD>!</KBD>はそのオブジェクトを含めて後続のものも処理する。
<KBD>ESC</KBD>や<KBD>q</KBD>は（後続のオブジェクトをすべて無視して）抜ける。
<KBD>.</KBD>（ピリオド）は現在の対象オブジェクトを処理してから抜ける。
<KBD>C-h</KBD>はヘルプメッセージを表示する。
これらは、<CODE>query-replace</CODE>が受け付ける応答と同じである。
キーマップ<CODE>query-replace-map</CODE>が、
<CODE>query-replace</CODE>と同様に
<CODE>map-y-or-n-p</CODE>に対する（応答の）意味を定義する。
<A HREF="elisp_34.html#SEC556">33.5 探索と置換</A>を参照。
<P>

<VAR>action-alist</VAR>を使って、
可能な応答とそれらの意味を追加指定することもできる。
これは、<CODE>(<VAR>char</VAR> <VAR>function</VAR> <VAR>help</VAR>)</CODE>の形の要素から成る
連想リストであり、それぞれが1つの追加応答を定義する。
この要素の中で、
<VAR>char</VAR>は（応答である）1つの文字、
<VAR>function</VAR>は1引数（<VAR>list</VAR>からのオブジェクト）の関数、
<VAR>help</VAR>は文字列である。
<P>

ユーザーが<VAR>char</VAR>で答えると、
<CODE>map-y-or-n-p</CODE>は<VAR>function</VAR>を呼び出す。
これが<CODE>nil</CODE>以外を返せば、当該オブジェクトを『処理』したとみなして、
<CODE>map-y-or-n-p</CODE>は<VAR>list</VAR>のつぎのオブジェクトに移る。
<CODE>nil</CODE>であると、同じオブジェクトについてプロンプトを繰り返す。
<P>

<CODE>map-y-or-n-p</CODE>がマウスを使って起動されたコマンドから呼ばれると、
より正確には、<CODE>last-nonmenu-event</CODE>（see 節 <A HREF="elisp_21.html#SEC288">20.4 コマンドループからの情報</A>）が、
<CODE>nil</CODE>かリストであると、
関数は問い合わせのための対話ボックスやポップアップメニューを使う。
その場合、キーボード入力やエコー領域は使わない。
呼び出しにおいて<CODE>last-nonmenu-event</CODE>に適切な値を束縛することで
マウスかキーボード入力の使用を強制できる。
<P>

<CODE>map-y-or-n-p</CODE>の戻り値は、処理したオブジェクトの個数である。
</DL>
<P>

<A NAME="Reading a Password"></A>
<HR SIZE="6">
<br><A NAME="SEC279"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC278"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC280"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Reading a Password"></A>
<H2> 19.8 パスワードの読み取り </H2>
<!--docid::SEC279::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Reading%20a%20Password">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Reading%20a%20Password</a>"<br>
"texi/elisp21/パスワードの読み取り"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D1%A5%B9%A5%EF%A1%BC%A5%C9%A4%CE%C6%C9%A4%DF%BC%E8%A4%EA">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1056"></A>
<P>

別のプログラムへ渡すパスワードを読み取るには、
関数<CODE>read-passwd</CODE>を使います。
<P>

<A NAME="IDX1057"></A>
<A NAME="IDX1058"></A>
<DL>
<DT><U>Function:</U> <B>read-passwd</B> <I>prompt &#38;optional confirm default</I>
<DD>この関数は、プロンプト<VAR>prompt</VAR>を表示してパスワードを読み取る。
ユーザーが入力するパスワードは表示せず、
そのかわりにパスワードの各文字ごとに`<SAMP>.</SAMP>'を表示する。
<P>

省略可能な引数<VAR>confirm</VAR>が<CODE>nil</CODE>以外であると、
パスワードを2回読み取り、両者が同一である必要がある。
同一でないと、連続して2回同じパスワードを打つまで
ユーザーは何度でも繰り返す必要がある。
<P>

省略可能な引数<VAR>default</VAR>は、ユーザーが空のパスワードを
入力したときに返すデフォルトのパスワードを指定する。
<VAR>default</VAR>が<CODE>nil</CODE>であると、
<CODE>read-passwd</CODE>はそのような場面では空文字列を返す。
</DL>
<P>

<A NAME="Minibuffer Misc"></A>
<HR SIZE="6">
<br><A NAME="SEC280"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC279"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC281"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Minibuffer Misc"></A>
<H2> 19.9 ミニバッファに関するその他 </H2>
<!--docid::SEC280::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Minibuffer%20Misc">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Minibuffer%20Misc</a>"<br>
"texi/elisp21/ミニバッファに関するその他"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%DF%A5%CB%A5%D0%A5%C3%A5%D5%A5%A1%A4%CB%B4%D8%A4%B9%A4%EB%A4%BD%A4%CE%C2%BE">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

本節では、ミニバッファに関係する他の基本関数や変数について述べます。
<P>

<A NAME="IDX1059"></A>
<DL>
<DT><U>コマンド:</U> <B>exit-minibuffer</B>
<DD>このコマンドは活性なミニバッファから抜ける。
通常、ミニバッファのローカルキーマップでキーにバインドされる。
</DL>
<P>

<A NAME="IDX1060"></A>
<DL>
<DT><U>コマンド:</U> <B>self-insert-and-exit</B>
<DD>このコマンドは（<A HREF="elisp_21.html#SEC288">20.4 コマンドループからの情報</A>の<CODE>last-command-char</CODE>にある）
最新のキーボード入力文字を活性なミニバッファに挿入してから抜ける。
</DL>
<P>

<A NAME="IDX1061"></A>
<DL>
<DT><U>コマンド:</U> <B>previous-history-element</B> <I>n</I>
<DD>このコマンドは、ミニバッファの内容を
<VAR>n</VAR>番目まえの（古い）履歴要素の値で置き換える。
</DL>
<P>

<A NAME="IDX1062"></A>
<DL>
<DT><U>コマンド:</U> <B>next-history-element</B> <I>n</I>
<DD>このコマンドは、ミニバッファの内容を
<VAR>n</VAR>番目先のより新しい履歴要素の値で置き換える。
</DL>
<P>

<A NAME="IDX1063"></A>
<DL>
<DT><U>コマンド:</U> <B>previous-matching-history-element</B> <I>pattern</I>
<DD>このコマンドは、ミニバッファの内容を
<VAR>pattern</VAR>（正規表現）に一致するまえの（古い）履歴要素の値で置き換える。
</DL>
<P>

<A NAME="IDX1064"></A>
<DL>
<DT><U>コマンド:</U> <B>next-matching-history-element</B> <I>pattern</I>
<DD>このコマンドは、ミニバッファの内容を
<VAR>pattern</VAR>（正規表現）に一致するつぎの（新しい）履歴要素の値で置き換える。
</DL>
<P>

<A NAME="IDX1065"></A>
<DL>
<DT><U>Function:</U> <B>minibuffer-prompt</B>
<DD>この関数は、現在活性なミニバッファのプロンプト文字列を返す。
活性なミニバッファがなければ<CODE>nil</CODE>を返す。
</DL>
<P>

<A NAME="IDX1066"></A>
<DL>
<DT><U>Function:</U> <B>minibuffer-prompt-width</B>
<DD>この関数は、現在活性なミニバッファのプロンプト文字列の表示幅を返す。
活性なミニバッファがなければ0を返す。
</DL>
<P>

<A NAME="IDX1067"></A>
<DL>
<DT><U>Variable:</U> <B>minibuffer-setup-hook</B>
<DD>ミニバッファに入るたびに実行されるノーマルフック。
see 節 <A HREF="elisp_23.html#SEC362">22.6 フック</A>。
</DL>
<P>

<A NAME="IDX1068"></A>
<DL>
<DT><U>Variable:</U> <B>minibuffer-exit-hook</B>
<DD>ミニバッファから抜けるたびに実行されるノーマルフック。
see 節 <A HREF="elisp_23.html#SEC362">22.6 フック</A>。
</DL>
<P>

<A NAME="IDX1069"></A>
<DL>
<DT><U>Variable:</U> <B>minibuffer-help-form</B>
<DD>この変数の現在値は、
ミニバッファの内側で<CODE>help-form</CODE>のローカルな束縛に使われる。
（see 節 <A HREF="elisp_24.html#SEC368">23.5 ヘルプ機能</A>）。
</DL>
<P>

<A NAME="IDX1070"></A>
<DL>
<DT><U>Function:</U> <B>active-minibuffer-window</B>
<DD>この関数は、現在活性なミニバッファのウィンドウを返す。
あるいは、活性なミニバッファがなければ<CODE>nil</CODE>を返す。
</DL>
<P>

<A NAME="IDX1071"></A>
<DL>
<DT><U>Function:</U> <B>minibuffer-window</B> <I>&#38;optional frame</I>
<DD>この関数は、フレーム<VAR>frame</VAR>で使われるミニバッファ用ウィンドウを返す。
<VAR>frame</VAR>が<CODE>nil</CODE>であると、カレントフレームを意味する。
フレームで使うミニバッファ用ウィンドウは、
そのフレームの一部である必要はない。
ミニバッファを持たないフレームでは、
他のフレームのミニバッファ用ウィンドウを使う。
</DL>
<P>

<A NAME="IDX1072"></A>
<DL>
<DT><U>Function:</U> <B>window-minibuffer-p</B> <I>window</I>
<DD>この関数は、<VAR>window</VAR>がミニバッファ用ウィンドウであると
<CODE>nil</CODE>以外を返す。
</DL>
<P>

与えられたウィンドウがミニバッファ用であるかどうかを調べるために、
<CODE>(minibuffer-window)</CODE>の戻り値と比較するのは正しくありません。
というのは、フレームが複数個あると
複数のミニバッファ用ウィンドウがあるからです。
<P>

<A NAME="IDX1073"></A>
<DL>
<DT><U>Function:</U> <B>minibuffer-window-active-p</B> <I>window</I>
<DD>この関数は、ミニバッファ用ウィンドウ<VAR>window</VAR>が活性であると
<CODE>nil</CODE>以外を返す。
</DL>
<P>

<A NAME="IDX1074"></A>
<DL>
<DT><U>Variable:</U> <B>minibuffer-scroll-window</B>
<DD>この変数の値が<CODE>nil</CODE>以外であると、
値はウィンドウオブジェクトであること。
ミニバッファで関数<CODE>scroll-other-window</CODE>が呼ばれると、
<CODE>scroll-other-window</CODE>はこのウィンドウをスクロールする。
</DL>
<P>

最後に、再帰ミニバッファ（see 節 <A HREF="elisp_21.html#SEC313">20.11 再帰編集</A>）を扱う
関数と変数について述べます。
<P>

<A NAME="IDX1075"></A>
<DL>
<DT><U>Function:</U> <B>minibuffer-depth</B>
<DD>この関数は、活性なミニバッファの現在の深さを非負整数で返す。
活性なミニバッファがなければ0を返す。
</DL>
<P>

<A NAME="IDX1076"></A>
<DL>
<DT><U>User Option:</U> <B>enable-recursive-minibuffers</B>
<DD>この変数が<CODE>nil</CODE>以外であると、
ミニバッファ用ウィンドウが活性であっても、
（<CODE>find-file</CODE>などの）ミニバッファを使うコマンドを起動できる。
そのような起動では、新たなミニバッファに対する再帰編集レベルが作られる。
内側の（深い）ミニバッファを編集中には、
外側の（浅い）レベルのミニバッファは見えない。
<P>

この変数が<CODE>nil</CODE>であると、
ミニバッファ用ウィンドウが活性なときには、
別のウィンドウに切り替えたとしてもミニバッファコマンドは使えない。
</DL>
<P>

コマンド名に<CODE>nil</CODE>以外の
属性<CODE>enable-recursive-minibuffers</CODE>があると、
当該コマンドをミニバッファから起動したときでさえ、
当該コマンドはミニバッファを使って引数を読み取れます。
ミニバッファコマンド<CODE>next-matching-history-element</CODE>
（ミニバッファでは通常<KBD>M-s</KBD>）は、この機能を使っています。
<A NAME="Command Loop"></A>
<HR SIZE="6">
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<a name="bottom"> </a>
<script type="text/javascript" src="style2.js"></script>
<div class="footer">
    <br>
    このページはMeadow (Emacs) の紹介ページです <br>
このWebページの各文書は自由にリンク・複製・再配布・改変していただいて構いません．
<br>ただし，複製・再配布・改変の場合は Meadow Memo のURLを記載しておいて下さい．<br>
<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=about%20link">Medow memoへのリンクについて</a>．<br>

間違い，要望等があれば<a href="mailto:akihisa@mail.ne.jp">akihisa@mail.ne.jp</a> か下記でどうぞ<br>

<br>

<FORM METHOD="post" ACTION="http://www.bookshelf.jp/cgi-bin/wwwmail.cgi" >
お名前：<INPUT TYPE="text" NAME="name" SIZE="30" MAXLENGTH="40" VALUE="ななしさん"><br>
メールアドレス：<INPUT TYPE="text" NAME="EMAIL" SIZE="25" MAXLENGTH="60" VALUE="secret@mail.adr"><br>
<input type="hidden" name="HPAGE" value="">
つっこみ：<br><TEXTAREA NAME="MESSAGE" ROWS="5" COLS="50">
</TEXTAREA><br><br>
<INPUT TYPE="submit" VALUE="送信">
<INPUT TYPE="reset" VALUE="クリア">
</FORM>

<br><A HREF="http://www.bookshelf.jp/cgi-bin/xct.cgi">ページ別カウンタ</a>
<br> Since 2002/12/13 <br>
</div>

</BODY>

</HTML>
