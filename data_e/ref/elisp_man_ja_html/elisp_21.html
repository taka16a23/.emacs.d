<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML lang="ja">
<!-- Created on October, 1  2005 by texi2html 1.64 -->
<!-- 
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Olaf Bachmann <obachman@mathematik.uni-kl.de>
Send bugs and suggestions to <texi2html@mathematik.uni-kl.de>
 
-->
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html;CHARSET=euc-jp">
<META NAME="keywords" CONTENT="meadow,mule,emacs,lisp,elisp,gnus,setting,設定,unix,cygwin">
<META http-equiv="Content-Script-Type" content="text/javascript">
<META NAME="description" CONTENT="Meadowの設定を紹介するページです">
<TITLE>GNU Emacs Lispリファレンスマニュアル:  コマンドループ</TITLE>

<META NAME="description" CONTENT="GNU Emacs Lispリファレンスマニュアル:  コマンドループ">
<META NAME="keywords" CONTENT="GNU Emacs Lispリファレンスマニュアル:  コマンドループ">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META NAME="Generator" CONTENT="texi2html 1.64">

<LINK REL="contents" HREF="elisp_toc.html#SEC_Contents">
<LINK REL="index" HREF="elisp_48.html#SEC681">
<LINK REL="next" HREF="elisp_22.html#SEC317">
<LINK REL="prev" HREF="elisp_20.html#SEC265">

<META http-equiv="Content-Style-Type" content="text/css">
<!-- 鶯と龜 ←日本語EUC誤判別対策用らしい; -->
<link rel="StyleSheet" href="../../../../soft/css/midnight.css" type="text/css" id="css1">
<script type="text/javascript" src="style1.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../soft/css/meadowmemo.css">

</HEAD>
<BODY LANG="ja" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">
<!--Infoseek Analyzer start-->
<script LANGUAGE="javascript">PgNo=6;</script>
<script src="http://js1.infoseek.co.jp/bin/57/00170.js"></script>
<noscript><a href="http://ax1.www.infoseek.co.jp/bin/go?0017057f" target="_blank">
<img src="http://ax1.www.infoseek.co.jp/bin/logo?0017057f" border=0></a></noscript>
<!--Infoseek Analyzer end-->
<a name="top"> </a>

<br><A NAME="SEC281"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC280"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC282"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_20.html#SEC265"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC317"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Command Loop"></A>
<H1> 20. コマンドループ </H1>
<!--docid::SEC281::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Command%20Loop">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Command%20Loop</a>"<br>
"texi/elisp21/コマンドループ"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%B3%A5%DE%A5%F3%A5%C9%A5%EB%A1%BC%A5%D7">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1077"></A>
<A NAME="IDX1078"></A>
<P>

読者がEmacsを起動すると、Emacsはほぼただちに<EM>エディタコマンドループ</EM>
（editor command loop）に入ります。
このループは、キー列を読み取り、それらの定義を実行し、結果を表示します。
本章では、これがどのように行われるのか、および、
Lispプログラムからこれを行うためのサブルーティンについて述べます。
<P>

<div class="menuindex"><SCRIPT language=JavaScript src="index20.js"></SCRIPT></div><noscript><BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC282">20.1 コマンドループの概要</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How the command loop reads commands.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC283">20.2 コマンドの定義</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Specifying how a function should read arguments.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC287">20.3 対話的呼び出し</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Calling a command, so that it will read arguments.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC288">20.4 コマンドループからの情報</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Variables set by the command loop for you to examine.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC289">20.5 入力イベント</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">What input looks like when you read it.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC304">20.6 入力の読み取り</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How to read input events from the keyboard or mouse.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC309">20.7 特殊イベント</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Events processed immediately and individually.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC310">20.8 時間待ちと入力待ち</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Waiting for user input or elapsed time.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC311">20.9 中断</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How <KBD>C-g</KBD> works.  How to catch or defer quitting.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC312">20.10 前置コマンド引数</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How the commands to set prefix args work.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC313">20.11 再帰編集</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Entering a recursive edit,
                          and why you usually shouldn't.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC314">20.12 コマンドを禁止する</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How the command loop handles disabled commands.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC315">20.13 コマンド履歴</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How the command history is set up, and how accessed.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC316">20.14 キーボードマクロ</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How keyboard macros are implemented.</TD></TR>
</TABLE></BLOCKQUOTE></noscript>
<P>

<A NAME="Command Overview"></A>
<HR SIZE="6">
<br><A NAME="SEC282"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC281"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC283"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Command Overview"></A>
<H2> 20.1 コマンドループの概要 </H2>
<!--docid::SEC282::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Command%20Overview">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Command%20Overview</a>"<br>
"texi/elisp21/コマンドループの概要"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%B3%A5%DE%A5%F3%A5%C9%A5%EB%A1%BC%A5%D7%A4%CE%B3%B5%CD%D7">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

コマンドループがまず始めに行うことはキー列、
つまり、コマンドへ変換されるイベント列を読むことです。
これには関数<CODE>read-key-sequence</CODE>を呼び出します。
読者のLispコードでもこの関数を呼び出せます（see 節 <A HREF="elisp_21.html#SEC305">20.6.1 キー列の入力</A>）。
Lispプログラムでは、<CODE>read-event</CODE>（see 節 <A HREF="elisp_21.html#SEC306">20.6.2 単一イベントの読み取り</A>）で
低レベルの入力を行ったり、
<CODE>discard-input</CODE>（see 節 <A HREF="elisp_21.html#SEC308">20.6.4 その他のイベント入力機能</A>）で
処理待ち中の入力を破棄できます。
<P>

キー列は現在活性なキーマップを介してコマンドに変換されます。
この処理方法についてはSee 節 <A HREF="elisp_22.html#SEC324">21.7 キー探索</A>。
この結果は、キーボードマクロであるか、
対話的に呼び出し可能な関数であるはずです。
キーが<KBD>M-x</KBD>であると、別のコマンドの名前を読み取り、
そのコマンドを呼び出します。
これはコマンド<CODE>execute-extended-command</CODE>（see 節 <A HREF="elisp_21.html#SEC287">20.3 対話的呼び出し</A>）で
処理されます。
<P>

コマンドを実行するには、まず、その引数を読む必要があります。
これは、<CODE>command-execute</CODE>（see 節 <A HREF="elisp_21.html#SEC287">20.3 対話的呼び出し</A>）を呼び出して
行います。
Lispで書かれたコマンドでは、
<CODE>interactive</CODE>指定が引数の読み方を指示します。
前置引数（see 節 <A HREF="elisp_21.html#SEC312">20.10 前置コマンド引数</A>）を使ったり、
プロンプトを表示してミニバッファ（see 節 <A HREF="elisp_20.html#SEC265">19. ミニバッファ</A>）から読みます。
たとえば、コマンド<CODE>find-file</CODE>には、
ミニバッファからファイル名を読むことを指示した
<CODE>interactive</CODE>指定があります。
コマンドの関数本体ではミニバッファを使いません。
このコマンドをLispコードから関数として呼び出す場合、
通常のLisp関数の引数としてファイル名文字列を指定する必要があります。
<P>

コマンドが文字列やベクトル（つまり、キーボードマクロ）である場合、
<CODE>execute-kbd-macro</CODE>を用いてそれらを実行します。
読者自身がこの関数を呼び出してもかまいません（see 節 <A HREF="elisp_21.html#SEC316">20.14 キーボードマクロ</A>）。
<P>

動作中のコマンドの実行を止めるには、<KBD>C-g</KBD>を打ちます。
この文字は<EM>中断</EM>（quitting）を引き起こします（see 節 <A HREF="elisp_21.html#SEC311">20.9 中断</A>）。
<P>

<A NAME="IDX1079"></A>
<DL>
<DT><U>Variable:</U> <B>pre-command-hook</B>
<DD>エディタコマンドループは、各コマンドのまえにこのノーマルフックを実行する。
その際、<CODE>this-command</CODE>にはこれから実行するコマンドが保持され、
<CODE>last-command</CODE>には直前のコマンドがある。
see 節 <A HREF="elisp_23.html#SEC362">22.6 フック</A>。
</DL>
<P>

<A NAME="IDX1080"></A>
<DL>
<DT><U>Variable:</U> <B>post-command-hook</B>
<DD>エディタコマンドループは、
（中断やエラーのために完了しなかったコマンドを含めて）
各コマンドのあとにこのノーマルフックを実行する。
初めてコマンドループに入ったときにも実行する。
その際、<CODE>this-command</CODE>には実行し終えたばかりのコマンドがあり、
<CODE>last-command</CODE>にはその前のコマンドがある。
see 節 <A HREF="elisp_23.html#SEC362">22.6 フック</A>。
</DL>
<P>

<CODE>pre-command-hook</CODE>や<CODE>post-command-hook</CODE>の実行中は、
中断を禁止します。
これらのフックの1つを実行中にエラーが起きると、
エラーの無限ループを防ぐために、
フックの実行を終了しフック変数を<CODE>nil</CODE>にします。
<P>

<A NAME="Defining Commands"></A>
<HR SIZE="6">
<br><A NAME="SEC283"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC282"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC284"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Defining Commands"></A>
<H2> 20.2 コマンドの定義 </H2>
<!--docid::SEC283::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Defining%20Commands">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Defining%20Commands</a>"<br>
"texi/elisp21/コマンドの定義"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%B3%A5%DE%A5%F3%A5%C9%A4%CE%C4%EA%B5%C1">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1081"></A>
<A NAME="IDX1082"></A>
<A NAME="IDX1083"></A>
<A NAME="IDX1084"></A>
<P>

Lisp関数の本体に、スペシャルフォーム<CODE>interactive</CODE>を呼び出す
フォームがトップレベルにあると、Lisp関数はコマンドになります。
このフォームは実際に呼び出されてもなにもしませんが、
このフォームがあることで、対話的に呼び出せることを表します。
その引数が、対話的呼び出しにおける引数の読み方を制御します。
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC284">20.2.1 <CODE>interactive</CODE>の使い方</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">General rules for <CODE>interactive</CODE>.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC285">20.2.2 <CODE>interactive</CODE>のコード文字</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">The standard letter-codes for reading arguments
                             in various ways.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC286">20.2.3 <CODE>interactive</CODE>の使用例</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Examples of how to read interactive arguments.</TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Using Interactive"></A>
<HR SIZE="6">
<br><A NAME="SEC284"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC283"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC285"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Using Interactive"></A>
<H3> 20.2.1 <CODE>interactive</CODE>の使い方 </H3>
<!--docid::SEC284::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Using%20Interactive">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Using%20Interactive</a>"<br>
"texi/elisp21/<CODE>interactive</CODE>の使い方"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%3CCODE%3Einteractive%3C%2FCODE%3E%A4%CE%BB%C8%A4%A4%CA%FD">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

本節では、Lisp関数を対話的に呼び出し可能なコマンドにするフォーム
<CODE>interactive</CODE>の書き方について述べます。
<P>

<A NAME="IDX1085"></A>
<DL>
<DT><U>Special Form:</U> <B>interactive</B> <I>arg-descriptor</I>
<DD><A NAME="IDX1086"></A>
このスペシャルフォームは、これを含む関数がコマンドであり、
（<KBD>M-x</KBD>や当該関数にバインドしたキー列を入力することで）
対話的に呼び出せることを宣言する。
引数<VAR>arg-descriptor</VAR>は、コマンドを対話的に呼び出したときに
コマンドに対する引数の計算方法を宣言する。
<P>

他の関数と同様に、コマンドはLispプログラムからも呼び出せるが、
その場合、呼び出し側が引数を渡し、<VAR>arg-descriptor</VAR>にはなんの効果もない。
<P>

フォーム<CODE>interactive</CODE>が効果を発揮するのは、
コマンドループ（実際にはサブルーティン<CODE>call-interactively</CODE>）が
関数を呼び出すまえに関数定義を走査してこのフォームを探すからである。
関数が呼び出されると、フォーム<CODE>interactive</CODE>を含めて
その本体のフォームが実行されるが、そのとき、
<CODE>interactive</CODE>は引数を評価せずに単に<CODE>nil</CODE>を返す。
</DL>
<P>

引数<VAR>arg-descriptor</VAR>には3つの可能性があります。
<P>

<UL>
<LI>
省略するか<CODE>nil</CODE>。
この場合、コマンドは引数なしで呼ばれる。
コマンドが1つ以上の引数を必要とする場合、これはただちにエラーになる。
<P>

<LI>
文字列ではないLisp式。
この場合、それはフォームであり、
コマンドに渡す引数リストを得るために評価される。
<A NAME="IDX1087"></A>
<P>

この式が（ミニバッファを使うことを含めて）キーボード入力を読む場合には、
入力を読むまえのポイントの整数値やマークは、
入力を読んだあとでは正しくない可能性があることに留意すること。
カレントバッファがサブプロセスの出力を受け取る可能性があるからである。
コマンドが入力を待っているあいだにサブプロセスの出力が到着すると、
ポイントやマークを再配置する可能性がある。
<P>

しては<EM>いけない</EM>ことの例を示す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(interactive
 (list (region-beginning) (region-end)
       (read-string "Foo: " nil 'my-history)))
</FONT></pre></td></tr></table><P>

キーボード入力を読み終えてからポイントやマークを調べることで、
問題を回避する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(interactive
 (let ((string (read-string "Foo: " nil 'my-history)))
   (list (region-beginning) (region-end) string)))
</FONT></pre></td></tr></table><P>

<LI>
<A NAME="IDX1088"></A>
文字列。
この場合、その内容は、コード文字とそれに続く
（コード文字によっては使ったり無視する）プロンプトから成ること。
プロンプトは、文字列の終りか改行で終る。
簡単な例を示す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(interactive "bFrobnicate buffer: ")
</FONT></pre></td></tr></table><P>

コード文字`<SAMP>b</SAMP>'は、補完を用いて既存のバッファ名を読むことを指示する。
バッファ名は、コマンドに渡される唯一の引数である。
文字列の残りはプロンプトである。
<P>

文字列内に改行文字があると、それはプロンプトを終える。
その部分で文字列が終らないときには、
文字列の残りの部分には、別の引数を指定するコード文字やプロンプトがある。
このようにして、何個の引数でも指定できる。
<P>

プロンプトの文字列では、プロンプト内の（第1引数から始まる）
まえの引数値を含めるために`<SAMP>%</SAMP>'を使える。
これは<CODE>format</CODE>（see 節 <A HREF="elisp_5.html#SEC78">4.7 文字列の書式付け</A>）を用いて行う。
たとえば、既存バッファの名前を読み、
続けてそのバッファに与える新たな名前を読むにはつぎのようにする。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(interactive "bBuffer to rename: \nsRename buffer %s to: ")
</FONT></pre></td></tr></table><P>

<A NAME="IDX1089"></A>
<A NAME="IDX1090"></A>
文字列の最初の文字が`<SAMP>*</SAMP>'である場合、
バッファが読み出し専用であるとエラーを通知する。
<P>

<A NAME="IDX1091"></A>
文字列の最初の文字が`<SAMP>&#64;</SAMP>'であり、
コマンドを起動したキー列にマウスイベントが含まれる場合、
コマンドを実行するまえに
それらのイベントの最初のものに関連したウィンドウを選択する。
<P>

`<SAMP>*</SAMP>'と`<SAMP>&#64;</SAMP>'は同時に使え、その順序は関係ない。
引数の実際の読み取りはプロンプトの
（`<SAMP>*</SAMP>'でも`<SAMP>&#64;</SAMP>'でもない最初の文字で始まる）残りの部分で制御される。
</UL>
<P>

<A NAME="Interactive Codes"></A>
<HR SIZE="6">
<br><A NAME="SEC285"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC284"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC286"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Interactive Codes"></A>
<H3> 20.2.2 <CODE>interactive</CODE>のコード文字 </H3>
<!--docid::SEC285::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Interactive%20Codes">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Interactive%20Codes</a>"<br>
"texi/elisp21/<CODE>interactive</CODE>のコード文字"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%3CCODE%3Einteractive%3C%2FCODE%3E%A4%CE%A5%B3%A1%BC%A5%C9%CA%B8%BB%FA">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1092"></A>
<A NAME="IDX1093"></A>
<A NAME="IDX1094"></A>
<A NAME="IDX1095"></A>
<P>

以下に述べるコード文字の説明では、
つぎに定義するいくつかのキーワードを含みます。
<P>

<DL COMPACT>
<DT><B>「補完」</B>
<DD><A NAME="IDX1096"></A>
補完を使える。
<CODE>completing-read</CODE>を使って引数を読むため、
<KBD>TAB</KBD>、<KBD>SPC</KBD>、<KBD>RET</KBD>は名前を補完する
（see 節 <A HREF="elisp_20.html#SEC270">19.5 補完</A>）。
<KBD>?</KBD>は補完候補のリストを表示する。
<P>

<DT><B>「既存」</B>
<DD>既存オブジェクトの名前を必要とする。
不正な名前は受け付けない。
現在の入力が正しくないとミニバッファから抜けるコマンドは動作しない。
<P>

<DT><B>「デフォルト」</B>
<DD><A NAME="IDX1097"></A>
ミニバッファにユーザーがなにもテキストを入力しないときに
使われるなんらかのデフォルト値。
デフォルトはコード文字に依存する。
<P>

<DT><B>「入出力なし」</B>
<DD>このコード文字は、入力をまったく読まずに引数を計算する。
したがって、プロンプト文字列を使わず、
読者が指定したプロンプト文字列は無視する。
<P>

コード文字はプロンプト文字列を使わないが、
この文字が文字列の最後の文字でない場合には改行を続けること。
<P>

<DT><B>「プロンプト」</B>
<DD>コード文字の直後にプロンプトが続く。
プロンプトは文字列の終りか改行で終る。
<P>

<DT><B>「スペシャル」</B>
<DD>このコード文字は、対話指定文字列の先頭でのみ意味を持ち、
プロンプトや改行を必要としない。
これは1つの孤立した文字である。
</DL>
<P>

<A NAME="IDX1098"></A>
以下に、<CODE>interactive</CODE>に使うコード文字を説明します。
<P>

<DL COMPACT>
<DT>`<SAMP>*</SAMP>'
<DD>カレントバッファが読み出し専用であるとエラーを通知する。
「スペシャル」。
<P>

<DT>`<SAMP>&#64;</SAMP>'
<DD>このコマンドを起動したキー列の最初のマウスイベントが表すウィンドウを選択する。
「スペシャル」。
<P>

<DT>`<SAMP>a</SAMP>'
<DD>関数名（つまり、<CODE>fboundp</CODE>を満たすシンボル）。
「既存」、「補完」、「プロンプト」。
<P>

<DT>`<SAMP>b</SAMP>'
<DD>既存バッファの名前。
デフォルトでは、カレントバッファ（see 節 <A HREF="elisp_27.html#SEC403">26. バッファ <EM>(2003/10/30)</EM></A>）の名前を使う。
「既存」、「補完」、「デフォルト」、「プロンプト」。
<P>

<DT>`<SAMP>B</SAMP>'
<DD>バッファ名。
バッファが既存である必要はない。
デフォルトでは、カレントバッファ以外の最近使ったバッファの名前を使う。
「補完」、「デフォルト」、「プロンプト」。
<P>

<DT>`<SAMP>c</SAMP>'
<DD>文字。
カーソルはエコー領域には移動しない。
「プロンプト」。
<P>

<DT>`<SAMP>C</SAMP>'
<DD>コマンド名（つまり、<CODE>commandp</CODE>を満たすシンボル）。
「既存」、「補完」、「プロンプト」。
<P>

<DT>`<SAMP>d</SAMP>'
<DD><A NAME="IDX1099"></A>
整数としてのポイント位置（see 節 <A HREF="elisp_30.html#SEC463">29.1 ポイント</A>）。
「入出力なし」。
<P>

<DT>`<SAMP>D</SAMP>'
<DD>ディレクトリ名。
デフォルトは、カレントバッファのカレントデフォルトディレクトリ
<CODE>default-directory</CODE>（see 節 <A HREF="elisp_40.html#SEC645">39.3 オペレーティングシステム環境</A>）。
「既存」、「補完」、「デフォルト」、「プロンプト」。
<P>

<DT>`<SAMP>e</SAMP>'
<DD>コマンドを起動したキー列の最初やつぎのマウスイベント。
より正確には、`<SAMP>e</SAMP>'はリストであるイベントを取得するので、
読者はリスト内のデータを調べられる。
see 節 <A HREF="elisp_21.html#SEC289">20.5 入力イベント</A>。
「入出力なし」。
<P>

1つのコマンドの対話指定で複数回`<SAMP>e</SAMP>'を使える。
コマンドを起動したキー列が<VAR>n</VAR>個のリストであるイベントである場合、
<VAR>n</VAR>番目の`<SAMP>e</SAMP>'は、<VAR>n</VAR>番目のそのようなイベントを与える。
`<SAMP>e</SAMP>'では、
ファンクションキーやASCII文字などのリストでないイベントは数えない。
<P>

<DT>`<SAMP>f</SAMP>'
<DD>既存ファイルの名前（see 節 <A HREF="elisp_25.html#SEC383">24.8 ファイル名</A>）。
デフォルトディレクトリは<CODE>default-directory</CODE>。
「既存」、「補完」、「デフォルト」、「プロンプト」。
<P>

<DT>`<SAMP>F</SAMP>'
<DD>ファイル名。
ファイルが既存である必要はない。
「補完」、「デフォルト」、「プロンプト」。
<P>

<DT>`<SAMP>i</SAMP>'
<DD>無関係な引数。
このコードは、引数の値につねに<CODE>nil</CODE>を与える。
「入出力なし」。
<P>

<DT>`<SAMP>k</SAMP>'
<DD>キー列（see 節 <A HREF="elisp_22.html#SEC318">21.1 キーマップの用語</A>）。
現在のキーマップにおいてコマンドがみつかる（あるいは未定義コマンド）まで
イベントを読み続ける。
キー列引数は、文字列かベクトルとして表現される。
カーソルはエコー領域には移動しない。
「プロンプト」。
<P>

この種の入力は、<CODE>describe-key</CODE>や<CODE>global-set-key</CODE>などの
コマンドで使われる。
<P>

<DT>`<SAMP>K</SAMP>'
<DD>キー列であり、読者がその定義を変更することを意図している。
これは`<SAMP>k</SAMP>'と同様に動作するが、
キー列の最後の入力イベントに対しては、
未定義キーを定義済みのものに変換するために（必要なときに）普通使われる
変換処理を抑制する。
<P>

<DT>`<SAMP>m</SAMP>'
<DD><A NAME="IDX1100"></A>
整数としてのマーク位置。
「入出力なし」。
<P>

<DT>`<SAMP>M</SAMP>'
<DD>カレントバッファの入力方式を用いてミニバッファで読んだ任意のテキスト。
文字列として返す
（see <a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=emacs21&node=Input%20Methods">GNU Emacs マニュアル</a>）。
「プロンプト」。
<P>

<DT>`<SAMP>n</SAMP>'
<DD>ミニバッファで読んだ数。
入力が数でないと、ユーザーに再入力を促す。
もし前置引数があってもそれは使わない。
「プロンプト」。
<P>

<DT>`<SAMP>N</SAMP>'
<DD><A NAME="IDX1101"></A>
数値前置引数。
前置引数がなければ、<KBD>n</KBD>で数を読む。
数を必要とする。
see 節 <A HREF="elisp_21.html#SEC312">20.10 前置コマンド引数</A>。
「プロンプト」。
<P>

<DT>`<SAMP>p</SAMP>'
<DD><A NAME="IDX1102"></A>
数値前置引数。
（この`<SAMP>p</SAMP>'は小文字。）
「入出力なし」。
<P>

<DT>`<SAMP>P</SAMP>'
<DD>生の前置引数。
（この`<SAMP>P</SAMP>'は大文字。）
「入出力なし」。
<P>

<DT>`<SAMP>r</SAMP>'
<DD><A NAME="IDX1103"></A>
2つの数値引数としてのポイントとマーク。
小さいほうが先にくる。
これは、1つではなく2つの連続した引数を指定する唯一のコード文字。
「入出力なし」。
<P>

<DT>`<SAMP>s</SAMP>'
<DD>ミニバッファで読んだ任意のテキスト。
文字列として返す（see 節 <A HREF="elisp_20.html#SEC267">19.2 ミニバッファでのテキスト文字列の読み取り</A>）。
<KBD>C-j</KBD>か<KBD>RET</KBD>で入力を終える。
（これらの文字を入力に含めるには<KBD>C-q</KBD>を使う。）
「プロンプト」。
<P>

<DT>`<SAMP>S</SAMP>'
<DD>ミニバッファで読んだ名前をインターンしたシンボル。
白文字で入力を終える。
（文字列に白文字を含めるには<KBD>C-q</KBD>を使う。）
（丸括弧や角括弧などの）通常はシンボルを終える他の文字は、
ここではシンボルを終端しない。
「プロンプト」。
<P>

<DT>`<SAMP>v</SAMP>'
<DD>ユーザーオプションと宣言された変数
（つまり、述語<CODE>user-variable-p</CODE>を満たす）。
see 節 <A HREF="elisp_20.html#SEC274">19.5.4 高レベルの補完関数</A>。
「既存」、「補完」、「プロンプト」。
<P>

<DT>`<SAMP>x</SAMP>'
<DD>入力構文で表されたLispオブジェクト。
<KBD>C-j</KBD>か<KBD>RET</KBD>で終える。
オブジェクトは評価しない。
see 節 <A HREF="elisp_20.html#SEC268">19.3 ミニバッファでのLispオブジェクトの読み取り</A>。
「プロンプト」。
<P>

<DT>`<SAMP>X</SAMP>'
<DD><A NAME="IDX1104"></A>
<KBD>x</KBD>のようにLispフォームを読むが、評価しその値がコマンドの引数になる。
「プロンプト」。
<P>

<DT>`<SAMP>z</SAMP>'
<DD>コーディングシステム名（シンボル）。
ユーザーの入力が空であると、引数の値は<CODE>nil</CODE>。
see 節 <A HREF="elisp_33.html#SEC538">32.10 コーディングシステム</A>。
「補完」、「既存」、「プロンプト」。
<P>

<DT>`<SAMP>Z</SAMP>'
<DD>このコマンドに前置引数を指定した場合にのみ、
コーディングシステム名（シンボル）。
前置引数がないと、`<SAMP>Z</SAMP>'は引数の値に<CODE>nil</CODE>を与える。
「補完」、「既存」、「プロンプト」。
</DL>
<P>

<A NAME="Interactive Examples"></A>
<HR SIZE="6">
<br><A NAME="SEC286"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC285"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC287"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Interactive Examples"></A>
<H3> 20.2.3 <CODE>interactive</CODE>の使用例 </H3>
<!--docid::SEC286::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Interactive%20Examples">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Interactive%20Examples</a>"<br>
"texi/elisp21/<CODE>interactive</CODE>の使用例"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%3CCODE%3Einteractive%3C%2FCODE%3E%A4%CE%BB%C8%CD%D1%CE%E3">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1105"></A>
<A NAME="IDX1106"></A>
<P>

ここでは<CODE>interactive</CODE>の例を示します。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun foo1 ()              ; <CODE>foo1</CODE>は引数なし
    (interactive)           ; 2単語分先へ進める
    (forward-word 2))
     => foo1

(defun foo2 (n)             ; <CODE>foo2</CODE>は1引数
    (interactive "p")       ; 数値前置引数
    (forward-word (* 2 n)))
     => foo2

(defun foo3 (n)             ; <CODE>foo3</CODE>は1引数
    (interactive "nCount:") ; ミニバッファで読む
    (forward-word (* 2 n)))
     => foo3

(defun three-b (b1 b2 b3)
  "Select three existing buffers.
Put them into three windows, selecting the last one."
    (interactive "bBuffer1:\nbBuffer2:\nbBuffer3:")
    (delete-other-windows)
    (split-window (selected-window) 8)
    (switch-to-buffer b1)
    (other-window 1)
    (split-window (selected-window) 8)
    (switch-to-buffer b2)
    (other-window 1)
    (switch-to-buffer b3))
     => three-b
(three-b "*scratch*" "declarations.texi" "*mail*")
     => nil
</pre></td></tr></table><P>

<A NAME="Interactive Call"></A>
<HR SIZE="6">
<br><A NAME="SEC287"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC286"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC288"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Interactive Call"></A>
<H2> 20.3 対話的呼び出し </H2>
<!--docid::SEC287::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Interactive%20Call">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Interactive%20Call</a>"<br>
"texi/elisp21/対話的呼び出し"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%C2%D0%CF%C3%C5%AA%B8%C6%A4%D3%BD%D0%A4%B7">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1107"></A>
<P>

コマンドループでは、キー列をコマンドへ変換し終えると、
関数<CODE>command-execute</CODE>を用いてそのコマンドを起動します。
コマンドが関数であれば、<CODE>command-execute</CODE>は引数を読み取り、
コマンドを呼び出す<CODE>call-interactively</CODE>を呼びます。
読者自身がこれらの関数を呼び出してもかまいません。
<P>

<A NAME="IDX1108"></A>
<DL>
<DT><U>Function:</U> <B>commandp</B> <I>object</I>
<DD><VAR>object</VAR>が対話的呼び出しに適していれば、
つまり、<VAR>object</VAR>がコマンドであれば<CODE>t</CODE>を返す。
さもなければ<CODE>nil</CODE>を返す。
<P>

対話的呼び出しが可能なオブジェクトには、
（キーボードマクロとして扱われる）文字列やベクトル、
トップレベルで<CODE>interactive</CODE>を呼び出しているラムダ式、
そのようなラムダ式をコンパイルしたバイトコード関数オブジェクト、
対話的（<CODE>autoload</CODE>の4番目の引数が<CODE>nil</CODE>以外）
と宣言された自動ロードオブジェクト、
一部の基本関数が含まれる。
<P>

シンボルの関数定義が<CODE>commandp</CODE>を満たせば、
シンボルも<CODE>commandp</CODE>を満たす。
<P>

キーやキーマップはコマンドではない。
それらはコマンドを探すために使われる（see 節 <A HREF="elisp_22.html#SEC317">21. キーマップ</A>）。
<P>

<CODE>commandp</CODE>の実用的な使用例については、
<A HREF="elisp_24.html#SEC365">23.2 説明文字列の参照</A>の<CODE>documentation</CODE>を参照。
</DL>
<P>

<A NAME="IDX1109"></A>
<DL>
<DT><U>Function:</U> <B>call-interactively</B> <I>command &#38;optional record-flag keys</I>
<DD>この関数は、対話的呼び出し可能な関数<VAR>command</VAR>を
その対話指定に従って引数を読み取り呼び出す。
<VAR>command</VAR>が関数でなかったり、
対話的に呼び出せない（つまり、コマンドでない）場合には、
エラーを通知する。
キーボードマクロ（文字列やベクトル）はコマンドとみなすが、
それらは関数でないため、この関数はキーボードマクロを受け付けない。
<P>

<A NAME="IDX1110"></A>
<VAR>record-flag</VAR>が<CODE>nil</CODE>以外であると、
コマンドとその引数を無条件にリスト<CODE>command-history</CODE>に追加する。
さもなければ、引数を読むために
コマンドがミニバッファを使った場合にのみ追加する。
see 節 <A HREF="elisp_21.html#SEC315">20.13 コマンド履歴</A>。
<P>

もし引数<VAR>keys</VAR>を指定すると、コマンドがそれを起動したイベントを
問い合わせたときに与えるイベント列を指定する。
</DL>
<P>

<A NAME="IDX1111"></A>
<DL>
<DT><U>Function:</U> <B>command-execute</B> <I>command &#38;optional record-flag keys</I>
<DD><A NAME="IDX1112"></A>
この関数は<VAR>command</VAR>を実行する。
引数<VAR>command</VAR>は<CODE>commandp</CODE>を満たすこと。
つまり、対話的呼び出し可能な関数かキーボードマクロであること。
<P>

<CODE>command</CODE>が文字列やベクトルであると、
<CODE>execute-kbd-macro</CODE>で実行される。
関数であると、省略可能な<VAR>record-flag</VAR>とともに関数を
<CODE>call-interactively</CODE>に渡す。
<P>

シンボルは、その関数定義を使って処理する。
<CODE>autoload</CODE>で定義されたシンボルは、
対話的呼び出し可能な関数と宣言されていればコマンドとみなす。
そのような定義では、指定されたライブラリをロードしてから
シンボルの定義を再検査して処理する。
<P>

もし引数<VAR>keys</VAR>を指定すると、コマンドがそれを起動したイベントを
問い合わせたときに与えるイベント列を指定する。
</DL>
<P>

<A NAME="IDX1113"></A>
<DL>
<DT><U>コマンド:</U> <B>execute-extended-command</B> <I>prefix-argument</I>
<DD><A NAME="IDX1114"></A>
この関数は<CODE>completing-read</CODE>（see 節 <A HREF="elisp_20.html#SEC270">19.5 補完</A>）を使って
ミニバッファでコマンド名を読む。
そして<CODE>command-execute</CODE>を使って指定されたコマンドを実行する。
コマンドが返した値が<CODE>execute-extended-command</CODE>の値になる。
<P>

<A NAME="IDX1115"></A>
コマンドが前置引数を必要とする場合、<VAR>prefix-argument</VAR>の値を受け取る。
<CODE>execute-extended-command</CODE>が対話的に呼ばれた場合、
現在の生の前置引数が<VAR>prefix-argument</VAR>として使われ、
それが実行するコマンドへ渡される。
<P>

<A NAME="IDX1116"></A>
<CODE>execute-extended-command</CODE>は通常<KBD>M-x</KBD>に定義付けられ、
そのため、プロンプトとして文字列`<SAMP>M-x </SAMP>'を使う。
（<CODE>execute-extended-command</CODE>を起動するために使われた
イベントをプロンプトにするべきであるが、
それを実装するのは手間がかかる。）
もし前置引数を指定すると、その内容もプロンプトの一部になる。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(execute-extended-command 1)
---------- Buffer: Minibuffer ----------
1 M-x forward-word RET
---------- Buffer: Minibuffer ----------
     => t
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1117"></A>
<DL>
<DT><U>Function:</U> <B>interactive-p</B>
<DD>この関数は、これ（<CODE>interactive-p</CODE>の呼び出し）を含んだ関数が
<CODE>call-interactively</CODE>で対話的に呼び出されると<CODE>t</CODE>を返す。
（Lispから<CODE>call-interactively</CODE>が呼び出されても、
エディタコマンドループが直接呼び出しても違いはない。）
これを含んだ関数がLispの評価（あるいは<CODE>apply</CODE>や<CODE>funcall</CODE>）で
呼び出された場合は、対話的呼び出しではない。
</DL>
<P>

<CODE>interactive-p</CODE>のもっとも一般的な用途は、
情報メッセージを表示するかどうか決めることです。
特別な例外として、キーボードマクロを実行中にはいつでも、
<CODE>interactive-p</CODE>は<CODE>nil</CODE>を返します。
これは情報メッセージを省いてマクロの実行を速くするためです。
<P>

つぎのように使います。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun foo ()
  (interactive)
  (when (interactive-p)
    (message "foo")))
     => foo

(defun bar ()
  (interactive)
  (setq foobar (list (foo) (interactive-p))))
     => bar

;; <KBD>M-x foo</KBD>と打つ
     -| foo

;; <KBD>M-x bar</KBD>と打つ
;; これはなにも表示しない

foobar
     => (nil t)
</pre></td></tr></table><P>

この種のことを行う別の方法は、コマンドを
対話的呼び出しでは<CODE>nil</CODE>以外の値になる引数<CODE>print-message</CODE>を
取るようにし、その引数が<CODE>nil</CODE>以外になるような<CODE>interactive</CODE>指定を
使うことです。
つぎのようにします。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun foo (&#38;optional print-message)
  (interactive "p")
  (when print-message
    (message "foo")))
</pre></td></tr></table><P>

`<SAMP>p</SAMP>'で与えられる数値前置引数はけっして<CODE>nil</CODE>になりません。
<P>

<A NAME="Command Loop Info"></A>
<HR SIZE="6">
<br><A NAME="SEC288"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC287"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC289"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Command Loop Info"></A>
<H2> 20.4 コマンドループからの情報 </H2>
<!--docid::SEC288::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Command%20Loop%20Info">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Command%20Loop%20Info</a>"<br>
"texi/elisp21/コマンドループからの情報"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%B3%A5%DE%A5%F3%A5%C9%A5%EB%A1%BC%A5%D7%A4%AB%A4%E9%A4%CE%BE%F0%CA%F3">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

エディタコマンドループは、自身や実行中のコマンドのために
状態記録を数個のLisp変数に設定します。
<P>

<A NAME="IDX1118"></A>
<DL>
<DT><U>Variable:</U> <B>last-command</B>
<DD>この変数は、コマンドループが（現在のコマンドの）まえに実行したコマンドの
名前を記録する。
通常、この値は関数定義を持つシンボルであるが、保証はしない。
<P>

コマンドが後続のコマンドに対する前置引数を指定する場合を除いて、
コマンドからコマンドループへ戻ると<CODE>this-command</CODE>から値をコピーする。
<P>

この変数は現在の端末に対してつねにローカルであり、
バッファに対してローカルにはならない。
see 節 <A HREF="elisp_29.html#SEC436">28.2 複数ディスプレイ</A>。
</DL>
<P>

<A NAME="IDX1119"></A>
<A NAME="IDX1120"></A>
<DL>
<DT><U>Variable:</U> <B>real-last-command</B>
<DD><CODE>last-command</CODE>と同様にEmacsがこの変数に設定するが、
Lispプログラムではけっして変更しない。
</DL>
<P>

<A NAME="IDX1121"></A>
<DL>
<DT><U>Variable:</U> <B>this-command</B>
<DD><A NAME="IDX1122"></A>
この変数は、エディタコマンドループが
いま実行しているコマンドの名前を記録する。
<CODE>last-command</CODE>と同様に、通常は関数定義を持つシンボルである。
<P>

コマンドループは、コマンドを実行する直前にこの変数に設定し、
コマンドが終了すると（コマンドが後続のコマンドに対する
前置引数を指定する場合を除いて）
この値を<CODE>last-command</CODE>にコピーする。
<P>

<A NAME="IDX1123"></A>
後続のコマンドに対するフラグとして
実行中にこの変数に設定するコマンドもある。
特に、テキストをキルする関数群は<CODE>this-command</CODE>に<CODE>kill-region</CODE>を
設定して、直後に続くキルコマンドでは
キルしたテキストをまえのキルに追加するようにする。
</DL>
<P>

特定のコマンドがエラーを起こした場合に
直前のコマンドとは認識されたくない場合には、
読者はそのコマンドがそれを防ぐように書く必要があります。
1つの方法は、以下に示すように、
コマンドの始めで<CODE>this-command</CODE>に<CODE>t</CODE>を設定し、
コマンドの終りで<CODE>this-command</CODE>に正しい値を戻します。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun foo (args<small>...</small>)
  (interactive <small>...</small>)
  (let ((old-this-command this-command))
    (setq this-command t)
    <small>...</small>do the work<small>...</small>
    (setq this-command old-this-command)))
</pre></td></tr></table><P>

<CODE>let</CODE>で<CODE>this-command</CODE>を束縛しません。
というのは、エラーがあると<CODE>let</CODE>は古い値を復元するからです。
これこそがここでは避けたい<CODE>let</CODE>の機能です。
<P>

<A NAME="IDX1124"></A>
<DL>
<DT><U>Function:</U> <B>this-command-keys</B>
<DD>この関数は、現在のコマンドに対して直前のコマンドが生成した前置引数を含めて、
現在のコマンドを起動したキー列を含んだ文字列かベクトルを返す。
すべてのイベントが文字であれば、値は文字列である。
see 節 <A HREF="elisp_21.html#SEC289">20.5 入力イベント</A>。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(this-command-keys)
;; <KBD>C-u C-x C-e</KBD>を使ってこの式を評価する
     => "^U^X^E"
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1125"></A>
<DL>
<DT><U>Function:</U> <B>this-command-keys-vector</B>
<DD><CODE>this-command-keys</CODE>と同様だが、つねにベクトルでイベントを返すため、
文字列に入力イベントを保持する際の複雑さを扱う必要がない
（see 節 <A HREF="elisp_21.html#SEC303">20.5.14 キーボードイベントを文字列で保持する</A>）。
</DL>
<P>

<A NAME="IDX1126"></A>
<DL>
<DT><U>Variable:</U> <B>last-nonmenu-event</B>
<DD>この変数は、マウスメニューによるイベントを考慮せずに、
キー列として読んだ最後の入力イベントを保持する。
<P>

この変数の1つの用途は、
メニューをポップアップする位置を<CODE>x-popup-menu</CODE>に指示することである。
<CODE>y-or-n-p</CODE>（see 節 <A HREF="elisp_20.html#SEC277">19.6 Yes/Noの問い合わせ</A>）も内部的に使っている。
</DL>
<P>

<A NAME="IDX1127"></A>
<DL>
<DT><U>Variable:</U> <B>last-command-event</B>
<DD><A NAME="IDX1128"></A>
<DT><U>Variable:</U> <B>last-command-char</B>
<DD>この変数には、コマンドの一部としてコマンドループが
読んだ最後の入力イベントが設定される。
この変数の主な用途は、どの文字を挿入すべきかを決定するために
<CODE>self-insert-command</CODE>が使うことである。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>last-command-event
;; <KBD>C-u C-x C-e</KBD>を使ってこの式を評価する
     => 5
</pre></td></tr></table><P>

<KBD>C-e</KBD>のASCIIコードは5なので、値は5である。
<P>

Emacs 18版との互換性のために別名<CODE>last-command-char</CODE>がある。
</DL>
<P>

<A NAME="IDX1129"></A>
<DL>
<DT><U>Variable:</U> <B>last-event-frame</B>
<DD>この変数は、最後の入力イベントを振り向けたフレームを記録する。
通常これは、イベントが生成されたときに選択されていたフレームであるが、
そのフレームが入力フォーカスを別のフレームに振り向けていると、
この値はイベントを振り向けた先のフレームである。
see 節 <A HREF="elisp_29.html#SEC447">28.9 入力フォーカス</A>。
</DL>
<P>

<A NAME="Input Events"></A>
<HR SIZE="6">
<br><A NAME="SEC289"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC288"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC290"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Input Events"></A>
<H2> 20.5 入力イベント </H2>
<!--docid::SEC289::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Input%20Events">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Input%20Events</a>"<br>
"texi/elisp21/入力イベント"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%C6%FE%CE%CF%A5%A4%A5%D9%A5%F3%A5%C8">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1130"></A>
<A NAME="IDX1131"></A>
<P>

Emacsのコマンドループは、キーボードやマウスのユーザーの操作を表す
<EM>入力イベント</EM>（input event）列を読みます。
キーボード操作に対するイベントは、文字かシンボルです。
マウスイベントはつねにリストです。
本節では、入力イベントの表現方法やその意味を詳しく説明します。
<P>

<A NAME="IDX1132"></A>
<DL>
<DT><U>Function:</U> <B>eventp</B> <I>object</I>
<DD>この関数は、<VAR>object</VAR>が入力イベントであるかイベント型であると
<CODE>nil</CODE>以外を返す。
<P>

任意のシンボルがイベントやイベント型として使われることに注意。
<CODE>eventp</CODE>は、Lispのプログラムコードがシンボルを
イベントとして使うかどうか区別できない。
そのかわりに、シンボルが、Emacsの現在のセッションにおいて入力として読まれた
イベントに使われたことがあるかどうかを区別する。
シンボルがそのように使われたことがなければ、
<CODE>eventp</CODE>は<CODE>nil</CODE>を返す。
</DL>
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC290">20.5.1 キーボードイベント</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Ordinary characters--keys with symbols on them.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC291">20.5.2 ファンクションキー</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Function keys--keys with names, not symbols.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC292">20.5.3 マウスイベント</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Overview of mouse events.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC293">20.5.4 クリックイベント</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Pushing and releasing a mouse button.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC294">20.5.5 ドラッグイベント</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Moving the mouse before releasing the button.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC295">20.5.6 ボタン押し下げイベント</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">A button was pushed and not yet released.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC296">20.5.7 繰り返しイベント</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Double and triple click (or drag, or down).</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC297">20.5.8 モーションイベント</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Just moving the mouse, not pushing a button.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC298">20.5.9 フォーカスイベント</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Moving the mouse between frames.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC299">20.5.10 ウィンドウシステムのその他のイベント</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Other events window systems can generate.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC300">20.5.11 イベントの例</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Examples of the lists for mouse events.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC301">20.5.12 イベントの分類</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Finding the modifier keys in an event symbol.
				Event types.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC302">20.5.13 イベントの参照</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Functions to extract info from events.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC303">20.5.14 キーボードイベントを文字列で保持する</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Special considerations for putting
				  keyboard character events in a string.</TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Keyboard Events"></A>
<HR SIZE="6">
<br><A NAME="SEC290"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC289"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC291"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Keyboard Events"></A>
<H3> 20.5.1 キーボードイベント </H3>
<!--docid::SEC290::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Keyboard%20Events">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Keyboard%20Events</a>"<br>
"texi/elisp21/キーボードイベント"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%AD%A1%BC%A5%DC%A1%BC%A5%C9%A5%A4%A5%D9%A5%F3%A5%C8">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

キーボードからは2種類の入力があります。
普通のキーとファンクションキーです。
普通のキーは文字に対応します。
それらが生成するイベントは、Lispでは文字として表現されます。
文字イベントのイベント型は文字自身（整数）です。
<A HREF="elisp_21.html#SEC301">20.5.12 イベントの分類</A>を参照してください。
<P>

<A NAME="IDX1133"></A>
<A NAME="IDX1134"></A>
入力文字イベントは、0から524287までの<EM>基本コード</EM>（basic code）と
以下の<EM>修飾ビット</EM>（modifier bit）の任意の組み合わせです。
<P>

<DL COMPACT>
<DT>meta
<DD>文字コードのビット
2**27
は、メタキーを押し下げながら文字を打ったことを表す。
<P>

<DT>control
<DD>文字コードのビット
2**26
は非ASCII文字のコントロール文字を表す。
<P>

<KBD>C-a</KBD>などのASCIIコントロール文字には
独自の特別な基本コードがあるため、
Emacsはそれを表すための特別なビットを必要としない。
つまり、<KBD>C-a</KBD>のコードは単に1である。
<P>

しかし、コントロールキーを使った<KBD>%</KBD>などの
ASCIIにないコントロールとの組み合わせを打った場合、
得られる数値は<KBD>%</KBD>のコードに
2**26
を加えたものである
（端末で非ASCIIのコントロール文字を扱えるとして）。
<P>

<DT>shift
<DD>文字コードのビット
2**25
は、シフトキーを押し下げながら
ASCIIコントロール文字を打ったことを表す。
<P>

英文字では、基本コードそのものが大文字か小文字かを表す。
数字文字と区切り文字では、
シフトキーは異なる基本コードのまったく異なる文字を選ぶ。
可能な限りASCII文字集合ですませるために、
これらの文字に対しては、Emacsはビット
2**25
を使わない。
<P>

しかし、ASCIIでは<KBD>C-A</KBD>と<KBD>C-a</KBD>を区別できないため、
Emacsは、<KBD>C-A</KBD>ではビット
2**25
を使うが、<KBD>C-a</KBD>ではこのビットを使わない。
<P>

<DT>hyper
<DD>文字コードのビット
2**24
は、ハイパーキーを押し下げながら文字を打ったことを表す。
<P>

<DT>super
<DD>文字コードのビット
2**23
は、スーパーキーを押し下げながら文字を打ったことを表す。
<P>

<DT>alt
<DD>文字コードのビット
2**22
は、アルトキーを押し下げながら文字を打ったことを表す。
（<KBD>ALT</KBD>とラベルされたキーが実際にはメタキーである端末も存在する。）
</DL>
<P>

読者のプログラム内では、
特定の修飾ビットの値を明示することは避けるのが最良です。
文字の修飾ビットを検査するには、
関数<CODE>event-modifiers</CODE>（see 節 <A HREF="elisp_21.html#SEC301">20.5.12 イベントの分類</A>）を使います。
キーバインディングを作るときには、
（`<SAMP>\C-</SAMP>'、`<SAMP>\M-</SAMP>'などの）修飾ビットを伴う文字の
入力表現を使います。
<CODE>define-key</CODE>でキーバインディングを作るときには、
文字の指定には<CODE>(control hyper ?x)</CODE>のようなリストを使います
（see 節 <A HREF="elisp_22.html#SEC326">21.9 キーバインディングの変更</A>）。
関数<CODE>event-convert-list</CODE>は、そのようなリストを
イベント型に変換します（see 節 <A HREF="elisp_21.html#SEC301">20.5.12 イベントの分類</A>）。
<P>

<A NAME="Function Keys"></A>
<HR SIZE="6">
<br><A NAME="SEC291"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC290"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC292"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Function Keys"></A>
<H3> 20.5.2 ファンクションキー </H3>
<!--docid::SEC291::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Function%20Keys">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Function%20Keys</a>"<br>
"texi/elisp21/ファンクションキー"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A1%A5%F3%A5%AF%A5%B7%A5%E7%A5%F3%A5%AD%A1%BC">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

<A NAME="IDX1135"></A>
ほとんどのキーボードには、<EM>ファンクションキー</EM>（function key）、
つまり、文字ではない名前や記号のキーがあります。
Emacs Lispでは、ファンクションキーはシンボルで表現されます。
シンボルの（小文字の）名前がファンクションキーのラベルです。
たとえば、<KBD>F1</KBD>というラベルのキーを押すと、
入力ストリームにはシンボル<CODE>f1</CODE>が置かれます。
<P>

ファンクションキーイベントのイベント型は、イベントシンボルそれ自身です。
See 節 <A HREF="elisp_21.html#SEC301">20.5.12 イベントの分類</A>。
<P>

ファンクションキーに対するシンボル命名慣習の特例を以下に示します。
<P>

<DL COMPACT>
<DT><CODE>backspace</CODE>, <CODE>tab</CODE>, <CODE>newline</CODE>, <CODE>return</CODE>, <CODE>delete</CODE>
<DD>これらのキーは、ほとんどのキーボードにある特別なキーを持つ
一般的なASCIIコントロール文字に対応する。
<P>

ASCIIでは、<KBD>C-i</KBD>と<KBD>TAB</KBD>は同じ文字である。
これらを区別できる端末では、前者を整数9、後者をシンボル<CODE>tab</CODE>と
表現することで、EmacsはLispプログラムに区別を伝える。
<P>

ほとんどの場面では、これら2つを区別しても有用ではない。
そのため、通常、<CODE>function-key-map</CODE>（see 節 <A HREF="elisp_40.html#SEC652">39.8.2 入力イベントの変換</A>）は、
<CODE>tab</CODE>を9に対応付けるようには設定してある。
したがって、文字コード9（文字<KBD>C-i</KBD>）に対するキーバインディングは
<CODE>tab</CODE>にも適用される。
この種の他のシンボルについても同様である。
関数<CODE>read-char</CODE>も同様にこれらのイベントを文字に変換する。
<P>

ASCIIでは、<KBD>BS</KBD>は実際には<KBD>C-h</KBD>である。
しかし、<CODE>backspace</CODE>は文字コード127（<KBD>DEL</KBD>）に変換され、
文字コード8（<KBD>BS</KBD>）には変換されない。
ほとんどのユーザーはこれを好む。
<P>

<DT><CODE>left</CODE>, <CODE>up</CODE>, <CODE>right</CODE>, <CODE>down</CODE>
<DD>カーソル矢印キー
<DT><CODE>kp-add</CODE>, <CODE>kp-decimal</CODE>, <CODE>kp-divide</CODE>, <small>...</small>
<DD>（普通のキーボードの右側にある）キーパッドのキー。
<DT><CODE>kp-0</CODE>, <CODE>kp-1</CODE>, <small>...</small>
<DD>キーパッドの数字キー。
<DT><CODE>kp-f1</CODE>, <CODE>kp-f2</CODE>, <CODE>kp-f3</CODE>, <CODE>kp-f4</CODE>
<DD>キーパッドのPFキー
<DT><CODE>kp-home</CODE>, <CODE>kp-left</CODE>, <CODE>kp-up</CODE>, <CODE>kp-right</CODE>, <CODE>kp-down</CODE>
<DD>キーパッドの矢印キー。
Emacsは、通常、これらを対応するキーパッドのものではない
<CODE>home</CODE>、<CODE>left</CODE>、<small>...</small>のキーに変換する。
<DT><CODE>kp-prior</CODE>, <CODE>kp-next</CODE>, <CODE>kp-end</CODE>, <CODE>kp-begin</CODE>, <CODE>kp-insert</CODE>, <CODE>kp-delete</CODE>
<DD>普通のキーに対応するキーパッドのキー。
Emacsは、通常、同じ名前のキーパッドのものではないキーに変換する。
</DL>
<P>

ファンクションキーにも<KBD>ALT</KBD>、<KBD>CTRL</KBD>、<KBD>HYPER</KBD>、
<KBD>META</KBD>、<KBD>SHIFT</KBD>、<KBD>SUPER</KBD>の修飾キーを使えます。
それらを表現するには、シンボル名に接頭辞を付けます。
<P>

<DL COMPACT>
<DT>`<SAMP>A-</SAMP>'
<DD>アルト修飾。
<DT>`<SAMP>C-</SAMP>'
<DD>コントロール修飾。
<DT>`<SAMP>H-</SAMP>'
<DD>ハイパー修飾。
<DT>`<SAMP>M-</SAMP>'
<DD>メタ修飾。
<DT>`<SAMP>S-</SAMP>'
<DD>シフト修飾。
<DT>`<SAMP>s-</SAMP>'
<DD>スーパー修飾。
</DL>
<P>

したがって、<KBD>META</KBD>を押し下げた<KBD>F3</KBD>キーのシンボルは<CODE>M-f3</CODE>です。
複数の接頭辞を使うときには、アルファベット順に書くことを勧めますが、
キーバインディングの探索関数や修飾関数の引数では関係ありません。
<P>

<A NAME="Mouse Events"></A>
<HR SIZE="6">
<br><A NAME="SEC292"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC291"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC293"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Mouse Events"></A>
<H3> 20.5.3 マウスイベント </H3>
<!--docid::SEC292::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Mouse%20Events">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Mouse%20Events</a>"<br>
"texi/elisp21/マウスイベント"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%DE%A5%A6%A5%B9%A5%A4%A5%D9%A5%F3%A5%C8">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

Emacsでは4種類のマウスイベント、つまり、クリックイベント、ドラッグイベント、
ボタン押し下げイベント、モーションイベントを扱えます。
すべてのマウスイベントは、リストで表現します。
リストのCARはイベント型であり、
どの修飾キーとともにどのマウスボタンを使ったかを表します。
イベント型では、ダブル（連続2回）／トリプル（連続3回）の
押し下げも区別できます（see 節 <A HREF="elisp_21.html#SEC296">20.5.7 繰り返しイベント</A>）。
リストの残りの要素は、位置情報と時間情報です。
<P>

キーの探索では、イベント型のみが意味を持ちます。
型が同じであれば、異なるイベントでも同じコマンドを実行します。
コマンドでは、対話指定コード`<SAMP>e</SAMP>'を用いてイベントの完全な値を参照できます。
See 節 <A HREF="elisp_21.html#SEC285">20.2.2 <CODE>interactive</CODE>のコード文字</A>。
<P>

マウスイベントで始まるキー列は、カレントバッファのキーマップではなく、
マウスが入っているウィンドウのバッファのキーマップを用いて読まれます。
つまり、あるウィンドウ内でクリックしても、
当該ウィンドウやバッファを選択するとは限らず、
その動作はキー列のコマンドバインディングで完全に制御されます。
<P>

<A NAME="Click Events"></A>
<HR SIZE="6">
<br><A NAME="SEC293"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC292"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC294"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Click Events"></A>
<H3> 20.5.4 クリックイベント </H3>
<!--docid::SEC293::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Click%20Events">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Click%20Events</a>"<br>
"texi/elisp21/クリックイベント"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%AF%A5%EA%A5%C3%A5%AF%A5%A4%A5%D9%A5%F3%A5%C8">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1136"></A>
<A NAME="IDX1137"></A>
<P>

ユーザーがマウスのボタンを同じ場所で押し下げてから離すと、
<EM>クリック</EM>（click）イベントが生成されます。
マウスクリックイベントはつぎの形式です。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(<VAR>event-type</VAR>
 (<VAR>window</VAR> <VAR>buffer-pos</VAR> (<VAR>x</VAR> . <VAR>y</VAR>) <VAR>timestamp</VAR>)
 <VAR>click-count</VAR>)
</pre></td></tr></table><P>

通常の各要素の意味はつぎのとおりです。
<P>

<DL COMPACT>
<DT><VAR>event-type</VAR>
<DD>どのマウスボタンが使われたかを表すシンボル。
ボタンを左から右へ番号を付けて、
シンボル<CODE>mouse-1</CODE>、<CODE>mouse-2</CODE>、<small>...</small>の1つである。
<P>

ファンクションキーの場合と同様に、
アルト、コントロール、ハイパー、メタ、シフト、スーパーの
修飾キーを表す接頭辞`<SAMP>A-</SAMP>'、`<SAMP>C-</SAMP>'、`<SAMP>H-</SAMP>'、`<SAMP>M-</SAMP>'、
`<SAMP>S-</SAMP>'、`<SAMP>s-</SAMP>'も使える。
<P>

このシンボルはイベントのイベント型としての役割も果たす。
キーバインディングはイベント型でイベントを指定する。
したがって、<CODE>mouse-1</CODE>に対するキーバインディングは、
イベント型<VAR>event-type</VAR>が<CODE>mouse-1</CODE>であるすべてのイベントに適用される。
<P>

<DT><VAR>window</VAR>
<DD>クリックを行ったウィンドウ。
<P>

<DT><VAR>x</VAR>, <VAR>y</VAR>
<DD>ウィンドウ<VAR>window</VAR>の左上端を<CODE>(0 . 0)</CODE>とした
クリック位置のピクセル単位の座標。
<P>

<DT><VAR>buffer-pos</VAR>
<DD>クリックした文字のバッファ内位置。
<P>

<DT><VAR>timestamp</VAR>
<DD>イベントが発生したときのミリ秒単位の時刻。
（この値は、Emacs Lispの整数の範囲では約5時間で一周するので、
時間的に近傍のイベントを関連付ける場合にのみ有用である。）
<P>

<DT><VAR>click-count</VAR>
<DD>同じマウスボタンを素早く押し下げた繰り返し回数。
see 節 <A HREF="elisp_21.html#SEC296">20.5.7 繰り返しイベント</A>。
</DL>
<P>

モード行やスクロールバーなどのスクリーンの特別な部分で発生したイベントでは、
<VAR>buffer-pos</VAR>、<VAR>x</VAR>と<VAR>y</VAR>の意味は少々異なります。
<P>

スクロールバーの内側でのクリックでは、
<VAR>buffer-pos</VAR>はシンボル<CODE>vertical-scroll-bar</CODE>か
<CODE>horizontal-scroll-bar</CODE>であり、
<CODE>(<VAR>x</VAR> . <VAR>y</VAR>)</CODE>は<CODE>(<VAR>portion</VAR> . <VAR>whole</VAR>)</CODE>に
置き換えられます。
ここで、<VAR>portion</VAR>はスクロールバーの先頭や左端からのクリック位置、
<VAR>whole</VAR>はスクロールバー全体の長さです。
<P>

モード行やウィンドウ<VAR>window</VAR>を右隣のものと区切る
縦方向の区切り行の内側では、
<VAR>buffer-pos</VAR>はシンボル<CODE>mode-line</CODE>か<CODE>vertical-line</CODE>です。
モード行では、<VAR>y</VAR>は意味のあるデータではありません。
縦方向の区切り行では、<VAR>x</VAR>は意味のあるデータではありません。
<P>

1つの特別な場面では、
<VAR>buffer-pos</VAR>は単一のシンボルではなく（上に述べた1つの）シンボルを
含んだリストになります。
イベントに対する仮想的なプレフィックスキーを入力ストリームに挿入すると
このようになります。
See 節 <A HREF="elisp_21.html#SEC305">20.6.1 キー列の入力</A>。
<P>

<A NAME="Drag Events"></A>
<HR SIZE="6">
<br><A NAME="SEC294"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC293"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC295"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Drag Events"></A>
<H3> 20.5.5 ドラッグイベント </H3>
<!--docid::SEC294::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Drag%20Events">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Drag%20Events</a>"<br>
"texi/elisp21/ドラッグイベント"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%C9%A5%E9%A5%C3%A5%B0%A5%A4%A5%D9%A5%F3%A5%C8">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1138"></A>
<A NAME="IDX1139"></A>
<P>

Emacsには、ドラッグイベントがあります。
ユーザーがマウスボタンを押し下げてから、
ボタンを離すまえに別の文字位置へマウスを動かすと
<EM>ドラッグ</EM>（drag）イベントが発生します。
マウスのすべてのイベントのように、Lispではドラッグイベントは
リストとして表現されます。
つぎのように、リストは開始マウス位置と終了位置を記録しています。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(<VAR>event-type</VAR>
 (<VAR>window1</VAR> <VAR>buffer-pos1</VAR> (<VAR>x1</VAR> . <VAR>y1</VAR>) <VAR>timestamp1</VAR>)
 (<VAR>window2</VAR> <VAR>buffer-pos2</VAR> (<VAR>x2</VAR> . <VAR>y2</VAR>) <VAR>timestamp2</VAR>)
 <VAR>click-count</VAR>)
</pre></td></tr></table><P>

ドラッグイベントでは、シンボル<VAR>event-type</VAR>の名前には
接頭辞`<SAMP>drag-</SAMP>'が付きます。
たとえば、ボタン2を押し下げてマウスをドラッグすると
イベント<CODE>drag-mouse-2</CODE>が生成されます。
イベントの2番目と3番目の要素は、ドラッグの開始位置と終了位置を与えます。
なお、データにはクリックイベントと同じ意味があります（see 節 <A HREF="elisp_21.html#SEC293">20.5.4 クリックイベント</A>）。
ドラッグイベントかどうかを区別せずに、
マウスの任意のイベントの2番目の要素は同じ方法で参照できます。
<P>

接頭辞`<SAMP>drag-</SAMP>'は、
`<SAMP>C-</SAMP>'や`<SAMP>M-</SAMP>'のような修飾キー接頭辞に続きます。
<P>

<CODE>read-key-sequence</CODE>が、
キーバインディングを持たないドラッグイベントを受け取り、かつ、
それに対応するクリックイベントにはバインディングがある場合、
ドラッグイベントの開始位置をクリック位置とするクリックイベントに変換します。
つまり、望まなければ、読者はクリックイベントとドラッグイベントを区別する
必要がありません。
<P>

<A NAME="Button-Down Events"></A>
<HR SIZE="6">
<br><A NAME="SEC295"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC294"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC296"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Button-Down Events"></A>
<H3> 20.5.6 ボタン押し下げイベント </H3>
<!--docid::SEC295::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Button-Down%20Events">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Button-Down%20Events</a>"<br>
"texi/elisp21/ボタン押し下げイベント"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%DC%A5%BF%A5%F3%B2%A1%A4%B7%B2%BC%A4%B2%A5%A4%A5%D9%A5%F3%A5%C8">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1140"></A>
<P>

クリックイベントとドラッグイベントは、
ユーザーがマウスボタンを離したときに発生します。
ボタンを離すまではクリックとドラッグを区別する方法がないため、
ボタンを離すまで発生しえません。
<P>

ボタンを押し下げたらただちに動作を始めたい場合には、
読者は<EM>ボタン押し下げ</EM>（button-down）イベントを処理する必要があります。
<A NAME="DOCF8" HREF="elisp_fot.html#FOOT8">(8)</A>
ボタンを押し下げるとただちに発生します。
それらは、シンボル<VAR>event-type</VAR>の名前に
接頭辞`<SAMP>down-</SAMP>'があることを除けば、
クリックイベント（see 節 <A HREF="elisp_21.html#SEC293">20.5.4 クリックイベント</A>）とまったく同じリストで表現されます。
接頭辞`<SAMP>down-</SAMP>'は、`<SAMP>C-</SAMP>'や`<SAMP>M-</SAMP>'のような修飾キー接頭辞に続きます。
<P>

関数<CODE>read-key-sequence</CODE>は、
コマンドバインディングを持たないボタン押し下げイベントを無視します。
したがって、Emacsのコマンドループもそれらを無視します。
つまり、読者がボタン押し下げイベントでなにかをしたいのでなければ、
読者はボタン押し下げイベントを定義する必要はありません。
ボタン押し下げイベントを定義する理由は、
ボタンが離されるまで（モーションイベントを読んで）マウスの動きを
追跡するためです。
See 節 <A HREF="elisp_21.html#SEC297">20.5.8 モーションイベント</A>。
<P>

<A NAME="Repeat Events"></A>
<HR SIZE="6">
<br><A NAME="SEC296"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC295"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC297"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Repeat Events"></A>
<H3> 20.5.7 繰り返しイベント </H3>
<!--docid::SEC296::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Repeat%20Events">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Repeat%20Events</a>"<br>
"texi/elisp21/繰り返しイベント"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%B7%AB%A4%EA%CA%D6%A4%B7%A5%A4%A5%D9%A5%F3%A5%C8">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1141"></A>
<A NAME="IDX1142"></A>
<A NAME="IDX1143"></A>
<P>

マウスを動かさずに同一のマウスボタンを素早く連続して押し下げると、
Emacsは2回目以降の押し下げに対して
特別な<EM>繰り返し</EM>（repeat）マウスイベントを生成します。
<P>

もっとも一般的な繰り返しイベントは<EM>ダブルクリック</EM>（double-click）
イベントです。
ボタンを2回クリックすると、Emcasはダブルクリックイベントを生成します。
（他のすべてのクリックイベントのように）読者がボタンを離したときに
イベントが生成されます。
<P>

ダブルクリックイベントのイベント型には、接頭辞`<SAMP>double-</SAMP>'が含まれます。
したがって、<KBD>meta</KBD>を押し下げて2番目のボタンをダブルクリックすると、
Lispプログラムには<CODE>M-double-mouse-2</CODE>が送られます。
ダブルクリックイベントにバインディングがなければ、
対応する普通のクリックイベントを用いて実行します。
したがって、実際に利用したくない限りは、
読者はダブルクリック機能に注意する必要はありません。
<P>

ユーザーがダブルクリックすると、Emacsはまず普通のクリックイベントを生成し、
つぎにダブルクリックイベントを生成します。
したがって、ダブルクリックイベントのコマンドバインディングでは、
すでに普通のクリックコマンドが動作済みであると仮定して設計する必要があります。
普通のクリックの結果をもとに望みのダブルクリックの結果を得るようにします。
<P>

普通のクリックの意味にダブルクリックの意味を
『追加』するようにすると便利です。
ダブルクリックのユーザーインターフェイスはこのようにすることを勧めます。
<P>

ボタンをクリックして、ふたたびボタンを押し下げてそのままマウスを動かすと、
最終的にボタンを離した時点で、<EM>ダブルドラッグ</EM>（double-drag）イベントが
生成されます。
そのイベント型には`<SAMP>drag</SAMP>'のかわりに`<SAMP>double-drag</SAMP>'が含まれます。
ダブルドラッグイベントにバインディングがなければ、
Emacsは普通のドラッグイベントとしてバインディングを探します。
<P>

ダブルクリックイベントやダブルドラッグイベントを生成するまえに、
ユーザーがボタンを2回目に押し下げたとき、
Emacsは<EM>ダブルダウン</EM>（double-down）イベントを生成します。
このイベント型には`<SAMP>down</SAMP>'のかわりに`<SAMP>double-down</SAMP>'が含まれます。
ダブルダウンイベントにバインディングがなければ、
Emacsは普通のボタン押し下げイベントとしてバインディングを探します。
どちらでもバインディングがみつからなければ、ダブルダウンイベントは無視します。
<P>

まとめると、ボタンをクリックしてただちに再度ボタンを押し下げると、
Emacsは、はじめのクリックに対してボタン押し下げイベントと
クリックイベントを生成し、
再度ボタンを押し下げるとダブルダウンイベントを生成し、
最後にダブルクリックイベントかダブルドラッグイベントを生成します。
<P>

ボタンを2回クリックしてから再度押し下げる操作を素早く行うと、
Emacsは、<EM>トリプルダウン</EM>（triple-down）イベントに続けて
<EM>トリプルクリック</EM>（triple-click）イベントか
<EM>トリプルドラッグ</EM>（triple-drag）イベントを生成します。
これらのイベント型には`<SAMP>double</SAMP>'のかわりに`<SAMP>triple</SAMP>'が含まれます。
トリプルのイベントにバインディングがなければ、
Emacsは対応するダブルのイベントを使います。
<P>

ボタンを3回以上クリックしてから再度押し下げると、
3回目以降の押し下げに対するイベントはすべてトリプルのイベントです。
Emacsは、クアドラプル（4回）、クインタプル（5回）、…などの
イベントは生成しません。
しかし、イベントリストを調べれば、ボタンを何回押したか正確にわかります。
<P>

<A NAME="IDX1144"></A>
<DL>
<DT><U>Function:</U> <B>event-click-count</B> <I>event</I>
<DD>この関数は、イベント<VAR>event</VAR>においてボタンが連続して押された回数を返す。
<VAR>event</VAR>が、ダブルダウンイベント、ダブルクリックイベント、
ダブルドラッグイベントであると、値は2である。
<VAR>event</VAR>がトリプルのイベントであると、値は3かそれ以上である。
<VAR>event</VAR>が（繰り返しイベントではない）普通のマウスイベントであると、
値は1である。
</DL>
<P>

<A NAME="IDX1145"></A>
<DL>
<DT><U>Variable:</U> <B>double-click-time</B>
<DD>繰り返しイベントが生成されるためには、
同じスクリーン位置において連続してマウスボタンを押し下げ、しかも、
各押し下げの間隔は<CODE>double-click-time</CODE>の値未満（ミリ秒）である必要がある。
<CODE>double-click-time</CODE>に<CODE>nil</CODE>を設定すると、
連続したクリックの検出を禁止する。
<CODE>t</CODE>を設定すると時間制限をなくし、
Emacsは連続したクリックの検出を位置だけで行う。
</DL>
<P>

<A NAME="Motion Events"></A>
<HR SIZE="6">
<br><A NAME="SEC297"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC296"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC298"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Motion Events"></A>
<H3> 20.5.8 モーションイベント </H3>
<!--docid::SEC297::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Motion%20Events">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Motion%20Events</a>"<br>
"texi/elisp21/モーションイベント"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%E2%A1%BC%A5%B7%A5%E7%A5%F3%A5%A4%A5%D9%A5%F3%A5%C8">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1146"></A>
<A NAME="IDX1147"></A>
<P>

Emacsは、ボタン操作を伴わないマウスの移動を表す
<EM>マウスモーション</EM>（mouse motion）イベントを生成することがあります。
マウスモーションイベントはつぎのようなリストで表現されます。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(mouse-movement (<VAR>window</VAR> <VAR>buffer-pos</VAR> (<VAR>x</VAR> . <VAR>y</VAR>) <VAR>timestamp</VAR>))
</pre></td></tr></table><P>

リストの2番目の要素は、クリックイベント（see 節 <A HREF="elisp_21.html#SEC293">20.5.4 クリックイベント</A>）と同様に、
マウスの現在位置を表します。
<P>

スペシャルフォーム<CODE>track-mouse</CODE>により、
その本体の内側ではモーションイベントの生成を可能にできます。
フォーム<CODE>track-mouse</CODE>の外側では、
Emacsはマウスの移動のみに対するイベントを生成しないので、
それらのイベントは現れません。
See 節 <A HREF="elisp_29.html#SEC451">28.13 マウスの追跡</A>。
<P>

<A NAME="Focus Events"></A>
<HR SIZE="6">
<br><A NAME="SEC298"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC297"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC299"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Focus Events"></A>
<H3> 20.5.9 フォーカスイベント </H3>
<!--docid::SEC298::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Focus%20Events">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Focus%20Events</a>"<br>
"texi/elisp21/フォーカスイベント"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A9%A1%BC%A5%AB%A5%B9%A5%A4%A5%D9%A5%F3%A5%C8">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1148"></A>
<P>

ウィンドウシステムは、どのウィンドウにキーボード入力を与えるかを
ユーザーが制御するための一般的な方法を提供します。
ウィンドウを選ぶことを<EM>フォーカス</EM>（focus）と呼びます。
ユーザーがEmacsのフレームを切り替える操作を行うと、
<EM>フォーカスイベント</EM>（focus event）が生成されます。
グローバルキーマップにあるフォーカスイベントの普通の定義は、
Emcasの新たなフレームを選択するようになっていて、
これはユーザーが期待することです。
See 節 <A HREF="elisp_29.html#SEC447">28.9 入力フォーカス</A>。
<P>

Lispでは、フォーカスイベントはつぎのようなリストで表現されます。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(switch-frame <VAR>new-frame</VAR>)
</pre></td></tr></table><P>

ここで、<VAR>new-frame</VAR>は切り替え先のフレームです。
<P>

Xのほとんどのウィンドウマネージャは、
マウスをウィンドウへ入れるだけで当該ウィンドウにフォーカスが設定される
ようになっています。
フレームにマウスが入るとカーソルの形状を変更するので、
Emacsでもそのようにします。
しかし、Lispプログラムにとっては、
なんらかの入力が到着するまではフォーカスの変更について知る必要がありません。
そのため、ユーザーが実際にキーボードのキーを打つか
新たなフレームでマウスボタンを押し下げたときだけ、
Emacsはフォーカスイベントを生成します。
フレーム間でマウスを動かしただけでは、フォーカスイベントは生成されません。
<P>

キー列の途中にフォーカスイベントが現れると、キー列を乱します。
そのため、Emacsはキー列の途中にはフォーカスイベントを生成しません。
ユーザーがキー列の途中で、つまり、
プレフィックスキーのあとでフォーカスを変更すると、
複数イベントのキー列のまえかうしろにフォーカスイベントを移動し、
途中には現れないようにEmacsはイベントの順序を並び替えます。
<P>

<A NAME="Misc Events"></A>
<HR SIZE="6">
<br><A NAME="SEC299"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC298"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC300"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Misc Events"></A>
<H3> 20.5.10 ウィンドウシステムのその他のイベント </H3>
<!--docid::SEC299::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Misc%20Events">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Misc%20Events</a>"<br>
"texi/elisp21/ウィンドウシステムのその他のイベント"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%A6%A5%A3%A5%F3%A5%C9%A5%A6%A5%B7%A5%B9%A5%C6%A5%E0%A4%CE%A4%BD%A4%CE%C2%BE%A4%CE%A5%A4%A5%D9%A5%F3%A5%C8">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

ウィンドウシステム内で起きたことを表す他のイベントもあります。
<P>

<DL COMPACT>
<A NAME="IDX1149"></A>
<A NAME="IDX1150"></A>
<DT><CODE>(delete-frame (<VAR>frame</VAR>))</CODE>
<DD>この種のイベントは、
Emacsのフレームであるウィンドウを削除するコマンドを
ユーザーがウィンドウマネージャに与えたことを表す。
<P>

イベント<CODE>delete-frame</CODE>の標準定義はフレーム<VAR>frame</VAR>の削除である。
<P>

<A NAME="IDX1151"></A>
<A NAME="IDX1152"></A>
<DT><CODE>(iconify-frame (<VAR>frame</VAR>))</CODE>
<DD>この種のイベントは、
ウィンドウマネージャを用いてユーザーがフレーム<VAR>frame</VAR>を
アイコン化したことを表す。
これに対する標準定義は<CODE>ignore</CODE>である。
というのは、フレームはすでにアイコンになっているので、
Emacsが行うことはなにもないからである。
このイベント型の目的は、
必要ならばその種のイベントを読者が追跡できるようにしておくことである。
<P>

<A NAME="IDX1153"></A>
<A NAME="IDX1154"></A>
<DT><CODE>(make-frame-visible (<VAR>frame</VAR>))</CODE>
<DD>この種のイベントは、
ウィンドウマネージャを用いてユーザーがアイコン化したフレーム<VAR>frame</VAR>を
開いたことを表す。
これに対する標準定義は<CODE>ignore</CODE>である。
というのは、フレームはすでに見えるようになっているので、
Emacsが行うことはなにもないからである。
<P>

<A NAME="IDX1155"></A>
<A NAME="IDX1156"></A>
<DT><CODE>(mouse-wheel <VAR>position</VAR> <VAR>delta</VAR>)</CODE>
<DD>この種のイベントは、
（MSインテリマウスなどの）マウスのホイールを動かすと生成される。
その典型的な効果はスクロールやズーミングである。
<P>

要素<VAR>delta</VAR>はホイールの回転方向と回転量である。
その絶対値はホイールを回すごとに増加する数である。
負の<VAR>delta</VAR>は、逆転、つまり、ユーザーへ近付く方向への回転を表し、
正の<VAR>delta</VAR>は、順転、つまり、ユーザーから遠ざかる方向への回転を表す。
<P>

要素<VAR>position</VAR>はイベントの発生位置を表し、
マウスクリックイベントで使われる形式と同じである。
<P>

この種のイベントは、ある種のシステムでのみ生成される。
<P>

<A NAME="IDX1157"></A>
<A NAME="IDX1158"></A>
<DT><CODE>(drag-n-drop <VAR>position</VAR> <VAR>files</VAR>)</CODE>
<DD>この種のイベントは、
Emacsの外側のアプリケーションで一群のファイルを選択し、
それらをEmacsのフレームにドラッグ＆ドロップしたときに生成される。
<P>

要素<VAR>position</VAR>はイベントの発生位置を表し、
マウスクリックイベントで使われる形式と同じであり、
要素<VAR>files</VAR>はドラッグ＆ドロップされたファイル名のリストである。
このイベントを扱う通常の処理は、それらのファイルを訪問することである。
<P>

現状では、この種のイベントは、ある種のシステムでのみ生成される。
</DL>
<P>

これらのイベントがキー列の途中、つまり、
プレフィックスキーのうしろに現れると、
複数イベントのキー列のまえかうしろに当該イベントを移動し、
途中には現れないようにEmacsはイベントの順序を並び替えます。
<P>

<A NAME="Event Examples"></A>
<HR SIZE="6">
<br><A NAME="SEC300"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC299"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC301"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Event Examples"></A>
<H3> 20.5.11 イベントの例 </H3>
<!--docid::SEC300::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Event%20Examples">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Event%20Examples</a>"<br>
"texi/elisp21/イベントの例"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%A4%A5%D9%A5%F3%A5%C8%A4%CE%CE%E3">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

ユーザーが同じ場所でマウスの左ボタンを押し下げてから離すと、
つぎのようなイベント列が生成されます。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(down-mouse-1 (#&#60;window 18 on NEWS&#62; 2613 (0 . 38) -864320))
(mouse-1      (#&#60;window 18 on NEWS&#62; 2613 (0 . 38) -864180))
</FONT></pre></td></tr></table><P>

コントロールキーを押し下げた状態で、
ユーザーがマウスの2番目のボタンを押し下げ、
マウスをつぎの行へドラッグすると、つぎのような2つのイベントが生成されます。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(C-down-mouse-2 (#&#60;window 18 on NEWS&#62; 3440 (0 . 27) -731219))
(C-drag-mouse-2 (#&#60;window 18 on NEWS&#62; 3440 (0 . 27) -731219)
                (#&#60;window 18 on NEWS&#62; 3510 (0 . 28) -729648))
</FONT></pre></td></tr></table><P>

メタキーとシフトキーを押し下げた状態で、
ユーザーがマウスの2番目のボタンをウィンドウのモード行で押し下げ、
マウスを別のウィンドウへドラッグすると、
つぎのような2つのイベントが生成されます。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(M-S-down-mouse-2 (#&#60;window 18 on NEWS&#62; mode-line (33 . 31) -457844))
(M-S-drag-mouse-2 (#&#60;window 18 on NEWS&#62; mode-line (33 . 31) -457844)
                  (#&#60;window 20 on carlton-sanskrit.tex&#62; 161 (33 . 3)
                   -453816))
</FONT></pre></td></tr></table><P>

<A NAME="Classifying Events"></A>
<HR SIZE="6">
<br><A NAME="SEC301"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC300"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC302"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Classifying Events"></A>
<H3> 20.5.12 イベントの分類 </H3>
<!--docid::SEC301::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Classifying%20Events">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Classifying%20Events</a>"<br>
"texi/elisp21/イベントの分類"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%A4%A5%D9%A5%F3%A5%C8%A4%CE%CA%AC%CE%E0">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1159"></A>
<P>

各イベントには<EM>イベント型</EM>（event type）があって、
キーバインディング処理のためにイベントを分類します。
キーボードイベントでは、イベント型はイベントの値に等しいです。
したがって、文字に対するイベント型は文字であり、
ファンクションキーに対するイベント型はシンボルそのものです。
リストであるイベントでは、イベント型はリストのCARにあるシンボルです。
したがって、イベント型はつねにシンボルか文字です。
<P>

イベント型が同じであるイベントは、キーバインディングに関する限り同じです。
つまり、それらは同じコマンドを実行します。
しかし、これは、それらが必ずしも同じことを行うという意味ではありません。
イベント全体を調べてなにを行うかを決定するコマンドもあります。
たとえば、マウスイベントの生起位置を使って、
バッファのどの部分を処理するかを決めるコマンドもあります。
<P>

イベントをおおまかに分類すると有用な場合もあります。
たとえば、他の修飾キーやマウスボタンには関係なしに、
<KBD>META</KBD>キーが使われているイベントかどうか調べたいことがあるでしょう。
<P>

関数<CODE>event-modifiers</CODE>や<CODE>event-basic-type</CODE>は、
そのような情報を便利に与えるためのものです。
<P>

<A NAME="IDX1160"></A>
<DL>
<DT><U>Function:</U> <B>event-modifiers</B> <I>event</I>
<DD>この関数は、<VAR>event</VAR>にある修飾子のリストを返す。
修飾子はシンボルであり、<CODE>shift</CODE>、<CODE>control</CODE>、
<CODE>meta</CODE>、<CODE>alt</CODE>、<CODE>hyper</CODE>、<CODE>super</CODE>である。
さらに、マウスイベントシンボルの修飾子リストには、
必ず、<CODE>click</CODE>、<CODE>drag</CODE>、<CODE>down</CODE>の1つが含まれる。
<P>

引数<VAR>event</VAR>は、イベントオブジェクト全体であるか、単なるイベント型である。
<P>

例を示す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(event-modifiers ?a)
     => nil
(event-modifiers ?\C-a)
     => (control)
(event-modifiers ?\C-%)
     => (control)
(event-modifiers ?\C-\S-a)
     => (control shift)
(event-modifiers 'f5)
     => nil
(event-modifiers 's-f5)
     => (super)
(event-modifiers 'M-S-f5)
     => (meta shift)
(event-modifiers 'mouse-1)
     => (click)
(event-modifiers 'down-mouse-1)
     => (down)
</pre></td></tr></table><P>

クリックイベントに対する修飾子リストには<CODE>click</CODE>が明示的に含まれるが、
イベントシンボルの名前自体には`<SAMP>click</SAMP>'は含まれない。
</DL>
<P>

<A NAME="IDX1161"></A>
<DL>
<DT><U>Function:</U> <B>event-basic-type</B> <I>event</I>
<DD>この関数は、<VAR>event</VAR>にあるキーやマウスボタンを返す。
たとえばつぎのとおり。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(event-basic-type ?a)
     => 97
(event-basic-type ?A)
     => 97
(event-basic-type ?\C-a)
     => 97
(event-basic-type ?\C-\S-a)
     => 97
(event-basic-type 'f5)
     => f5
(event-basic-type 's-f5)
     => f5
(event-basic-type 'M-S-f5)
     => f5
(event-basic-type 'down-mouse-1)
     => mouse-1
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1162"></A>
<DL>
<DT><U>Function:</U> <B>mouse-movement-p</B> <I>object</I>
<DD>この関数は、<VAR>object</VAR>がマウス移動のイベントならば<CODE>nil</CODE>以外を返す。
</DL>
<P>

<A NAME="IDX1163"></A>
<DL>
<DT><U>Function:</U> <B>event-convert-list</B> <I>list</I>
<DD>この関数は、修飾子名と基本イベント型のリストを
それらが示すイベント型に変換する。
たとえばつぎのとおり。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(event-convert-list '(control ?a))
     => 1
(event-convert-list '(control meta ?a))
     => -134217727
(event-convert-list '(control super f1))
     => C-s-f1
</pre></td></tr></table></DL>
<P>

<A NAME="Accessing Events"></A>
<HR SIZE="6">
<br><A NAME="SEC302"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC301"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC303"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Accessing Events"></A>
<H3> 20.5.13 イベントの参照 </H3>
<!--docid::SEC302::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Accessing%20Events">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Accessing%20Events</a>"<br>
"texi/elisp21/イベントの参照"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%A4%A5%D9%A5%F3%A5%C8%A4%CE%BB%B2%BE%C8">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

本節では、マウスボタンイベントやモーションイベント内のデータを
参照するための便利な関数について述べます。
<P>

つぎの2つの関数は、以下の形式のリストであるマウスボタンイベントの
開始位置や終了位置を返します。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(<VAR>window</VAR> <VAR>buffer-position</VAR> (<VAR>x</VAR> . <VAR>y</VAR>) <VAR>timestamp</VAR>)
</pre></td></tr></table><P>

<A NAME="IDX1164"></A>
<DL>
<DT><U>Function:</U> <B>event-start</B> <I>event</I>
<DD>イベント<VAR>event</VAR>の開始位置を返す。
<P>

<VAR>event</VAR>がクリックイベントやボタン押し下げイベントであると、
イベントの位置を返す。
<VAR>event</VAR>がドラッグイベントであると、ドラッグの開始位置を返す。
</DL>
<P>

<A NAME="IDX1165"></A>
<DL>
<DT><U>Function:</U> <B>event-end</B> <I>event</I>
<DD>イベント<VAR>event</VAR>の終了位置を返す。
<P>

<VAR>event</VAR>がドラッグイベントであると、
ユーザーがマウスボタンを離したときの位置を返す。
<VAR>event</VAR>がクリックイベントかボタン押し下げイベントであると、
実際の値は開始位置であり、
その種のイベントにある唯一の位置情報である。
</DL>
<P>

つぎの5つの関数は、上に述べた位置情報のリストを引数として、
そのさまざまな部分を返す。
<P>

<A NAME="IDX1166"></A>
<DL>
<DT><U>Function:</U> <B>posn-window</B> <I>position</I>
<DD><VAR>position</VAR>内のウィンドウを返す。
</DL>
<P>

<A NAME="IDX1167"></A>
<DL>
<DT><U>Function:</U> <B>posn-point</B> <I>position</I>
<DD><VAR>position</VAR>のバッファ内位置を返す。
これは整数である。
</DL>
<P>

<A NAME="IDX1168"></A>
<DL>
<DT><U>Function:</U> <B>posn-x-y</B> <I>position</I>
<DD><VAR>position</VAR>内のピクセル単位のxy座標を
コンスセル<CODE>(<VAR>x</VAR> . <VAR>y</VAR>)</CODE>として返す。
</DL>
<P>

<A NAME="IDX1169"></A>
<DL>
<DT><U>Function:</U> <B>posn-col-row</B> <I>position</I>
<DD><VAR>position</VAR>の（文字単位の）行（row）とコラム（col）の座標を
コンスセル<CODE>(<VAR>col</VAR> . <VAR>row</VAR>)</CODE>として返す。
これらは実際には<VAR>position</VAR>内の<VAR>x</VAR>と<VAR>y</VAR>の値から計算される。
</DL>
<P>

<A NAME="IDX1170"></A>
<DL>
<DT><U>Function:</U> <B>posn-timestamp</B> <I>position</I>
<DD><VAR>position</VAR>内の時刻情報を返す。
</DL>
<P>

つぎの関数はスクロールバーでのイベントを解読するのに便利です。
<P>

<A NAME="IDX1171"></A>
<DL>
<DT><U>Function:</U> <B>scroll-bar-event-ratio</B> <I>event</I>
<DD>スクロールバー内でのイベントから、スクロールバーに対する縦方向の位置を返す。
その値は2つの整数を含むコンスセル<CODE>(<VAR>portion</VAR> . <VAR>whole</VAR>)</CODE>であり、
その比は位置の割合を表す。
</DL>
<P>

<A NAME="IDX1172"></A>
<DL>
<DT><U>Function:</U> <B>scroll-bar-scale</B> <I>ratio total</I>
<DD>この関数は（実質的には）<VAR>ratio</VAR>に<VAR>total</VAR>を掛け、
結果を整数に丸める。
引数<VAR>ratio</VAR>は数ではなく<CODE>(<VAR>num</VAR> . <VAR>denom</VAR>)</CODE>であり、
典型的には<CODE>scroll-bar-event-ratio</CODE>が返す値である。
<P>

この関数はスクロールバー内での位置を
バッファ内での位置へ換算するのに便利である。
つぎのように行う。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(+ (point-min)
   (scroll-bar-scale
      (posn-x-y (event-start event))
      (- (point-max) (point-min))))
</pre></td></tr></table><P>

スクロールバー内でのイベントには、
xy座標のかわりに比を表す2つの整数があることに注意。
</DL>
<P>

<A NAME="Strings of Events"></A>
<HR SIZE="6">
<br><A NAME="SEC303"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC302"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC304"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Strings of Events"></A>
<H3> 20.5.14 キーボードイベントを文字列で保持する </H3>
<!--docid::SEC303::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Strings%20of%20Events">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Strings%20of%20Events</a>"<br>
"texi/elisp21/キーボードイベントを文字列で保持する"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%AD%A1%BC%A5%DC%A1%BC%A5%C9%A5%A4%A5%D9%A5%F3%A5%C8%A4%F2%CA%B8%BB%FA%CE%F3%A4%C7%CA%DD%BB%FD%A4%B9%A4%EB">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

文字列が使われるほとんどの場面では、
文字列にはテキスト文字、つまり、
バッファやファイルにある文字と同じ種類のものが入っていると考えています。
文字列にはキーボード文字が入っているとみなして使うLispプログラムもあります。
たとえば、文字列には、キー列やキーボードマクロの定義が入っているのです。
しかし、キーボード文字を文字列に保持するのは複雑であり、
それは歴史的な互換性を保つためにするのであり、
また、つねに可能とは限りません。
<P>

新しいプログラムでは、キーボードイベントを文字列に保持しないで、
このような複雑さを避けるように推奨します。
つぎのようにします。
<P>

<UL>
<LI>
キー列に対しては、それらを<CODE>lookup-key</CODE>や<CODE>define-key</CODE>に対する
引数以外にも使うつもりならば、文字列のかわりにベクトルを使う。
たとえば、<CODE>read-key-sequence</CODE>のかわりに<CODE>read-key-sequence-vector</CODE>を
<CODE>this-command-keys</CODE>のかわりに<CODE>this-command-keys-vector</CODE>を使う。
<P>

<LI>
メタ文字を含むキー列は、
それらを<CODE>define-key</CODE>に直接渡す場合であっても、ベクトルで書く。
<P>

<LI>
文字列である可能性があるキー列の内容を調べるときには、
<CODE>listify-key-sequence</CODE>（see 節 <A HREF="elisp_21.html#SEC308">20.6.4 その他のイベント入力機能</A>）を使って、
それをリストに変換しておく。
</UL>
<P>

複雑さの原因は、キーボード入力に含まれる修飾ビットにあります。
メタ修飾子以外の修飾ビットを文字列に入れることは不可能であり、
メタ修飾子は特別な場合として唯一許されているのです。
<P>

初期のGNU Emacsでは、メタ文字を128から255の範囲のコードで表現していました。
その当時、基本文字コードは0から127でしたから、
キーボード文字のすべてのコードは文字列に収まったのです。
多くのLispプログラムでメタ文字を表すために文字列定数内で`<SAMP>\M-</SAMP>'を使い、
特に、<CODE>define-key</CODE>や類似の関数に対する引数に使われ、
キー列やイベント列はつねに文字列で表現されていました。
<P>

127を超える大きな基本文字コードと追加の修飾ビットを扱えるようにしたとき、
メタ文字の表現方法を変更せざるをえませんでした。
現在、メタ修飾子を表す文字内のビットは
2**27
であり、そのような数を文字列に入れることはできません。
<P>

文字列定数で`<SAMP>\M-</SAMP>'を使っているプログラムを扱えるように、
文字列にメタ文字を入れるための特別な規則があります。
以下は、文字列を入力文字の列として解釈するための規則です。
<P>

<UL>
<LI>
キーボード文字の値が0から127の範囲にあれば、
無変更で文字列に入れる。
<P>

<LI>
コードが
2**27
から
2**27+127,
の範囲にあるこれらの文字のメタ変種は文字列に入れられるが、
それらの数値を変更する必要がある。
ビット
2**27
のかわりに
2**7
ビットに変更し、
128から255の範囲の値にする。
ユニバイト文字列だけにこれらのコードを入れられる。
<P>

<LI>
256以上の非ASCII文字はマルチバイト文字列だけに入れられる。
<P>

<LI>
その他のキーボード文字イベントは文字列に収められない。
これには、128から255の範囲のキーボードイベントも含む。
</UL>
<P>

キーボード入力文字の文字列を作る<CODE>read-key-sequence</CODE>などの関数は
つぎの規則に従います。
つまり、文字列に収まらないイベントであるときには、
文字列のかわりにベクトルを作ります。
<P>

読者が文字列で`<SAMP>\M-</SAMP>'の入力構文を使うと、
それらは128から255の範囲のコードになります。
対応するキーボードイベントを文字列に保存するように変更したときに得られる
コードと同じです。
したがって、文字列内のメタイベントは、それらがどのように文字列に
収められたかに関わらず、整合性のある動作をします。
<P>

しかし、本節のはじめに述べた推奨方法に従ってこれらのことがらを避けるほうが、
ほとんどのプログラムはよりよく動作するでしょう。
<P>

<A NAME="Reading Input"></A>
<HR SIZE="6">
<br><A NAME="SEC304"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC303"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC305"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Reading Input"></A>
<H2> 20.6 入力の読み取り </H2>
<!--docid::SEC304::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Reading%20Input">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Reading%20Input</a>"<br>
"texi/elisp21/入力の読み取り"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%C6%FE%CE%CF%A4%CE%C6%C9%A4%DF%BC%E8%A4%EA">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

エディタコマンドループは、
関数<CODE>read-key-sequence</CODE>を使ってキー列を読み取ります。
なお、関数<CODE>read-key-sequence</CODE>は関数<CODE>read-event</CODE>を使います。
これらやイベント入力を扱う他の関数は、Lispプログラムからも使えます。
<A HREF="elisp_38.html#SEC606">37.7 一時的な表示</A>の<CODE>momentary-string-display</CODE>、
および、<A HREF="elisp_21.html#SEC310">20.8 時間待ちと入力待ち</A>の<CODE>sit-for</CODE>を参照してください。
端末の入力モードの制御や端末入力のデバッグに関する関数や変数については、
See 節 <A HREF="elisp_40.html#SEC650">39.8 端末入力</A>。
入力イベントを読むときにそれらを変換したり修正する機能については、
See 節 <A HREF="elisp_40.html#SEC652">39.8.2 入力イベントの変換</A>。
<P>

上位レベルの入力機能については、<A HREF="elisp_20.html#SEC265">19. ミニバッファ</A>を参照してください。
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC305">20.6.1 キー列の入力</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How to read one key sequence.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC306">20.6.2 単一イベントの読み取り</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How to read just one event.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC307">20.6.3 クォートした文字の入力</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Asking the user to specify a character.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_21.html#SEC308">20.6.4 その他のイベント入力機能</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How to reread or throw away input events.</TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Key Sequence Input"></A>
<HR SIZE="6">
<br><A NAME="SEC305"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC304"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC306"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Key Sequence Input"></A>
<H3> 20.6.1 キー列の入力 </H3>
<!--docid::SEC305::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Key%20Sequence%20Input">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Key%20Sequence%20Input</a>"<br>
"texi/elisp21/キー列の入力"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%AD%A1%BC%CE%F3%A4%CE%C6%FE%CE%CF">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1173"></A>
<P>

コマンドループは、<CODE>read-key-sequence</CODE>を呼ぶことで
キー列の入力を読み取ります。
Lispプログラムからこの関数を呼び出してもよく、
たとえば、<CODE>describe-key</CODE>は、
説明対象とするキーを読むためにこの関数を使います。
<P>

<A NAME="IDX1174"></A>
<DL>
<DT><U>Function:</U> <B>read-key-sequence</B> <I>prompt</I>
<DD><A NAME="IDX1175"></A>
この関数は、キー列を読み取り文字列かベクトルとして返す。
完全なキー列を収集し終えるまで、
つまり、現在活性なキーマップにおいて、非プレフィックスコマンドを
指定するのに十分になるまで、イベントを読み続ける。
<P>

イベントがすべて文字であり、かつ、それらが文字列に収まるならば、
<CODE>read-key-sequence</CODE>は文字列（see 節 <A HREF="elisp_21.html#SEC303">20.5.14 キーボードイベントを文字列で保持する</A>）を返す。
さもなければ、ベクトルを返す。
ベクトルならば、任意の種類のイベント、つまり、
文字、シンボル、リストを保持できるからである。
文字列やベクトルの要素は、キー列のイベントである。
<P>

引数<VAR>prompt</VAR>は、プロンプトとしてエコー領域に表示する文字列であるか、
あるいは、プロンプトを表示しないことを意味する<CODE>nil</CODE>である。
<P>

以下の例では、プロンプト`<SAMP>?</SAMP>'がエコー領域に表示され、
ユーザーは<KBD>C-x C-f</KBD>と打つ。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(read-key-sequence "?")

---------- Echo Area ----------
?<KBD>C-x C-f</KBD>
---------- Echo Area ----------

     => "^X^F"
</pre></td></tr></table><P>

関数<CODE>read-key-sequence</CODE>は中断を抑止する。
この関数が動作中に<KBD>C-g</KBD>を打っても、他の文字と同様に扱い、
<CODE>quit-flag</CODE>を設定しない。
see 節 <A HREF="elisp_21.html#SEC311">20.9 中断</A>。
</DL>
<P>

<A NAME="IDX1176"></A>
<DL>
<DT><U>Function:</U> <B>read-key-sequence-vector</B> <I>prompt</I>
<DD>これは<CODE>read-key-sequence</CODE>と同様であるが、
つねにベクトルとしてキー列を返し、文字列としてはけっして返さない。
see 節 <A HREF="elisp_21.html#SEC303">20.5.14 キーボードイベントを文字列で保持する</A>。
</DL>
<P>

<A NAME="IDX1177"></A>
<A NAME="IDX1178"></A>
入力文字が大文字であって、それらにキーバインディングがないとき、
対応する小文字にキーバインディングがあれば、
<CODE>read-key-sequence</CODE>は文字を小文字に変換します。
<CODE>lookup-key</CODE>はこのような変換を行わないことに注意してください。
<P>

関数<CODE>read-key-sequence</CODE>は、ある種のマウスイベントも変換します。
バインディングのないドラッグイベントをクリックイベントに変換したり、
バインディングのないボタン押し下げイベントを完全に無視します。
さらに、フォーカスイベントとその他のウィンドウイベントを並び替えて、
それらが他のイベントのキー列の途中に現れないようにします。
<P>

マウスイベントが、モード行やスクロールバーなどのウィンドウの特別な部分で
生起しても、特別なイベント型はなく、マウスボタンや修飾キーの
組み合わせを普通どおりに表したシンボルです。
ウィンドウのどの部分かに関する情報は、
イベント内の別の部分、つまり、座標に入っています。
しかし、<CODE>read-key-sequence</CODE>は、その情報を
シンボル<CODE>mode-line</CODE>、<CODE>vertical-line</CODE>、<CODE>horizontal-scroll-bar</CODE>、
<CODE>vertical-scroll-bar</CODE>を用いた仮想的な『プレフィックスキー』に変換します。
ウィンドウの特別な部分におけるマウスクリックの意味は、
これらの仮想的なプレフィックスキーを用いてキー列を定義することで
定義できます。
<P>

たとえば、<CODE>read-key-sequence</CODE>を呼び出してから、
ウィンドウのモード行でクリックすると、
つぎのような2つのイベントを得ます。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(read-key-sequence "Click on the mode line: ")
     => [mode-line
         (mouse-1
          (#&#60;window 6 on NEWS&#62; mode-line
           (40 . 63) 5959987))]
</pre></td></tr></table><P>

<A NAME="IDX1179"></A>
<DL>
<DT><U>Variable:</U> <B>num-input-keys</B>
<DD>この変数の値は、現在のEmacsセッションにおいて、
これまでに処理されたキー列の個数である。
これには、端末から読み取ったキー列、および、
実行したキーボードマクロから読み取ったキー列が含まれる。
</DL>
<P>

<A NAME="IDX1180"></A>
<DL>
<DT><U>Variable:</U> <B>num-nonmacro-input-events</B>
<DD><A NAME="IDX1181"></A>
この変数は、端末からこれまでに受け取った入力イベントの総個数を保持する。
キーボードマクロで生成されたものは含まない。
</DL>
<P>

<A NAME="Reading One Event"></A>
<HR SIZE="6">
<br><A NAME="SEC306"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC305"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC307"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Reading One Event"></A>
<H3> 20.6.2 単一イベントの読み取り </H3>
<!--docid::SEC306::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Reading%20One%20Event">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Reading%20One%20Event</a>"<br>
"texi/elisp21/単一イベントの読み取り"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%C3%B1%B0%EC%A5%A4%A5%D9%A5%F3%A5%C8%A4%CE%C6%C9%A4%DF%BC%E8%A4%EA">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

コマンド入力用の最低レベルの関数は、単一イベントを読み取る関数です。
<P>

<A NAME="IDX1182"></A>
<DL>
<DT><U>Function:</U> <B>read-event</B> <I>&#38;optional prompt suppress-input-method</I>
<DD>この関数は、必要ならばイベントの到着を待って、
コマンド入力のつぎのイベントを読み取って返す。
イベントは、ユーザーか（実行中の）キーボードマクロから直接得る。
<P>

<VAR>prompt</VAR>が<CODE>nil</CODE>以外であると、
これはプロンプトとしてエコー領域に表示される文字列であること。
さもなければ、<CODE>read-event</CODE>は
入力待ちであることを示すメッセージを表示せずに、
そのかわりに、現在のコマンドを実行するに至ったイベントや
現在のコマンドが読み取ったイベントをプロンプトとして表示する。
see 節 <A HREF="elisp_38.html#SEC602">37.3 エコー領域</A>。
<P>

<VAR>suppress-input-method</VAR>が<CODE>nil</CODE>以外であると、
このイベントの読み取りに関しては現在の入力方式を使わない。
入力方式の処理をせずにイベントを読みたいときには、
つねにこのようにすること。
<CODE>input-method-function</CODE>を束縛してはならない（下記参照）。
<P>

変数<CODE>cursor-in-echo-area</CODE>が<CODE>nil</CODE>以外であると、
<CODE>read-event</CODE>は、エコー領域に表示されたメッセージの末尾に
カーソルを一時的に移動する。
さもなければ、<CODE>read-event</CODE>はカーソルを移動しない。
<P>

<CODE>read-event</CODE>がヘルプ文字と定義されたイベントを受け取ると、
それを返さずに<CODE>read-event</CODE>がイベントを直接処理してしまう場合がある。
see 節 <A HREF="elisp_24.html#SEC368">23.5 ヘルプ機能</A>。
<EM>特殊イベント</EM>（special event）と呼ばれる他のイベントも
<CODE>read-event</CODE>が直接処理する（see 節 <A HREF="elisp_21.html#SEC309">20.7 特殊イベント</A>）。
<P>

<CODE>read-event</CODE>を呼んで右矢印のファンクションキーを押すとつぎのようになる。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(read-event)
     => right
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1183"></A>
<DL>
<DT><U>Function:</U> <B>read-char</B>
<DD>この関数はコマンド入力の文字を読み取りそれを返す。
文字を得るまで、文字以外のイベントはすべて破棄する。
<P>

最初の例では、ユーザーは文字<KBD>1</KBD>（ASCIIコード49）を打つ。
2番目の例は、<CODE>eval-expression</CODE>を使って
ミニバッファから<CODE>read-char</CODE>を呼び出すキーボードマクロの定義である。
<CODE>read-char</CODE>はキーボードマクロの直後の文字、つまり、<KBD>1</KBD>を読む。
そして、<CODE>eval-expression</CODE>はその戻り値をエコー領域に表示する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(read-char)
     => 49

;; これを評価するために読者は<KBD>M-:</KBD>を使うと仮定する
(symbol-function 'foo)
     => "^[:(read-char)^M1"
(execute-kbd-macro 'foo)
     -| 49
     => nil
</pre></td></tr></table></DL>
<P>

<CODE>read-event</CODE>は、あれば現在の入力方式も起動します。
<CODE>input-method-function</CODE>が<CODE>nil</CODE>以外であれば、
それは関数であるはずです。
<CODE>read-event</CODE>が修飾ビットのない（<KBD>SPC</KBD>を含む）印字文字を読み取ると、
引数としてイベントを渡してその関数を呼び出します。
<P>

<A NAME="IDX1184"></A>
<DL>
<DT><U>Variable:</U> <B>input-method-function</B>
<DD>これが<CODE>nil</CODE>以外であると、その値は現在の入力方式関数を指定する。
<P>

<STRONG>注意：</STRONG><CODE> </CODE>
この変数を<CODE>let</CODE>で束縛しないこと。
この変数はしばしばバッファローカルであり、
入力を読む周囲で束縛すると（読者がこれをもっとも束縛<EM>しそうな</EM>ところ）、
Emacsが入力を待っているときにバッファが非同期に切り替わると、
誤ったバッファに値を復元してしまうことがある。
</DL>
<P>

入力方式関数は、入力として使われるイベントのリストを返すべきです。
（リストが<CODE>nil</CODE>であると入力がなかったことを意味し、
<CODE>read-event</CODE>は別のイベントを待つ。）
これらのイベントは、
<CODE>unread-command-events</CODE>内のイベントよりまえに処理されます。
入力方式関数が返したイベントは、それらが修飾ビットがない印字文字であっても、
入力方式関数に再度渡されることはありません。
<P>

入力方式関数が<CODE>read-event</CODE>や<CODE>read-key-sequence</CODE>を呼び出すときには、
<CODE>input-method-function</CODE>を<CODE>nil</CODE>に束縛して
再帰呼び出しを防ぐべきです。
<P>

キー列の2番目以降のイベントを読むときには、入力方式関数を呼び出しません。
したがって、それらの文字は、入力方式処理の対象ではありません。
入力方式の処理では、
<CODE>overriding-local-map</CODE>と<CODE>overriding-terminal-local-map</CODE>の値を
検査するのがよいです。
これらの変数のいずれかが<CODE>nil</CODE>以外であるときには、
入力方式ではその引数をリストに入れ、
それ以上処理せずにそのリストを返すべきです。
<P>

<A NAME="Quoted Character Input"></A>
<HR SIZE="6">
<br><A NAME="SEC307"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC306"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC308"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Quoted Character Input"></A>
<H3> 20.6.3 クォートした文字の入力 </H3>
<!--docid::SEC307::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Quoted%20Character%20Input">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Quoted%20Character%20Input</a>"<br>
"texi/elisp21/クォートした文字の入力"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%AF%A5%A9%A1%BC%A5%C8%A4%B7%A4%BF%CA%B8%BB%FA%A4%CE%C6%FE%CE%CF">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1185"></A>
<P>

ユーザーに文字入力を促して、コントロール文字やメタ文字を
文字そのものや文字の8進数コードで手軽に入力できるようにするには、
関数<CODE>read-quoted-char</CODE>を使います。
コマンド<CODE>quoted-insert</CODE>は、この関数を使っています。
<P>

<A NAME="IDX1186"></A>
<DL>
<DT><U>Function:</U> <B>read-quoted-char</B> <I>&#38;optional prompt</I>
<DD><A NAME="IDX1187"></A>
<A NAME="IDX1188"></A>
<A NAME="IDX1189"></A>
この関数は<CODE>read-char</CODE>に似ているが、
最初に読んだ文字が8進数字文字（0-7）であると、
任意個数の8進数字文字を読み取り（8進数字文字以外が現れると止める）、
その数値の文字コードが表す文字を返す。
<P>

最初の文字を読むと中断を抑制するので、
ユーザーは<KBD>C-g</KBD>を入力できる。
see 節 <A HREF="elisp_21.html#SEC311">20.9 中断</A>。
<P>

<VAR>prompt</VAR>を与えると、それはユーザーへのプロンプトを表す文字列を指定する。
プロンプト文字列はつねにエコー領域に表示され、あとに`<SAMP>-</SAMP>'が続く。
<P>

つぎの例では、ユーザーは8進数177（10進数では127）を打つ。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(read-quoted-char "What character")

---------- Echo Area ----------
What character-<KBD>177</KBD>
---------- Echo Area ----------

     => 127
</pre></td></tr></table></DL>
<P>

<A NAME="Event Input Misc"></A>
<HR SIZE="6">
<br><A NAME="SEC308"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC307"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC309"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Event Input Misc"></A>
<H3> 20.6.4 その他のイベント入力機能 </H3>
<!--docid::SEC308::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Event%20Input%20Misc">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Event%20Input%20Misc</a>"<br>
"texi/elisp21/その他のイベント入力機能"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A4%BD%A4%CE%C2%BE%A4%CE%A5%A4%A5%D9%A5%F3%A5%C8%C6%FE%CE%CF%B5%A1%C7%BD">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

本節では、イベントを処理せずに『まえもって覗き見』する方法、
処理待ちの入力の有無の検査方法、処理待ちの入力の破棄方法について述べます。
関数<CODE>read-passwd</CODE>も参照してください（see 節 <A HREF="elisp_20.html#SEC279">19.8 パスワードの読み取り</A>）。
<P>

<A NAME="IDX1190"></A>
<DL>
<DT><U>Variable:</U> <B>unread-command-events</B>
<DD><A NAME="IDX1191"></A>
<A NAME="IDX1192"></A>
この変数は、コマンド入力として読まれることを
待っているイベントのリストを保持する。
イベントはリストに現れる順に使われ、使われると1つ1つ取り除かれる。
<P>

関数でイベントを読んだあとにそれを使わない場面があるため、
この変数が必要になる。
この変数にイベントを保存すると、
コマンドループやコマンド入力を読む関数によって通常どおり処理される。
<P>

<A NAME="IDX1193"></A>
たとえば、数値前置引数を実現する関数は、任意個数の数字文字を読み取る。
数字文字でないイベントをみつけたら、そのイベントを読み戻して、
コマンドループが通常どおりに読めるようにする必要がある。
同様に、インクリメンタルサーチでは、この機能を使って
探索においては意味を持たないイベントを読み戻す。
なぜなら、そのようなイベントは探索を終了させ、
通常どおり実行される必要があるからである。
<P>

<CODE>unread-command-events</CODE>に入れられるように
キー列からイベントを確実に簡単に取り出す方法は
<CODE>listify-key-sequence</CODE>を使うことである（see 節 <A HREF="elisp_21.html#SEC303">20.5.14 キーボードイベントを文字列で保持する</A>）。
<P>

もっとも最近に読み戻したイベントが最初に再度読まれるように、
普通はこのリストの先頭にイベントを追加する。
</DL>
<P>

<A NAME="IDX1194"></A>
<DL>
<DT><U>Function:</U> <B>listify-key-sequence</B> <I>key</I>
<DD>この関数は、文字列やベクトルである<VAR>key</VAR>を個々のイベントのリストに変換する。
この結果は<CODE>unread-command-events</CODE>に入れられる。
</DL>
<P>

<A NAME="IDX1195"></A>
<DL>
<DT><U>Variable:</U> <B>unread-command-char</B>
<DD>この変数は、コマンド入力として読まれる文字を保持する。
値「-1」は、『空』を意味する。
<P>

この変数はほとんど廃れており、
かわりに<CODE>unread-command-events</CODE>を使うべきである。
Emacs 18版以前向けに書かれたプログラムを扱うためだけに存在する。
</DL>
<P>

<A NAME="IDX1196"></A>
<DL>
<DT><U>Function:</U> <B>input-pending-p</B>
<DD><A NAME="IDX1197"></A>
この関数は、現在、コマンド入力があるかどうかを調べる。
ただちに返るが、入力があれば値<CODE>t</CODE>を、
さもなければ<CODE>nil</CODE>を返す。
入力がないのに<CODE>t</CODE>を返すことが稀にある。
</DL>
<P>

<A NAME="IDX1198"></A>
<DL>
<DT><U>Variable:</U> <B>last-input-event</B>
<DD><A NAME="IDX1199"></A>
<DT><U>Variable:</U> <B>last-input-char</B>
<DD>この変数は、コマンドの一部として、あるいは、Lispプログラムが明示的に
読み取った最後の端末入力イベントを記録する。
<P>

以下の例で、Lispプログラムは文字<KBD>1</KBD>（ASCIIコード49）を読む。
それが<CODE>last-input-event</CODE>の値になるが、
（この式を評価するコマンドは<KBD>C-x C-e</KBD>と仮定するので）
<CODE>last-command-event</CODE>の値は<KBD>C-e</KBD>のままである。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(progn (print (read-char))
       (print last-command-event)
       last-input-event)
     -| 49
     -| 5
     => 49
</pre></td></tr></table><P>

Emacs 18版との互換性のために、別名<CODE>last-input-char</CODE>が存在する。
</DL>
<P>

<A NAME="IDX1200"></A>
<DL>
<DT><U>Function:</U> <B>discard-input</B>
<DD><A NAME="IDX1201"></A>
<A NAME="IDX1202"></A>
この関数は端末入力バッファの内容を廃棄し、
定義中のキーボードマクロを取り消す。
これは<CODE>nil</CODE>を返す。
<P>

以下の例で、フォームを評価しはじめてから、ユーザーは何文字か打つ。
<CODE>sleep-for</CODE>が待機を終えると、
<CODE>discard-input</CODE>は待機中に打たれた文字をすべて破棄する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(progn (sleep-for 2)
       (discard-input))
     => nil
</pre></td></tr></table></DL>
<P>

<A NAME="Special Events"></A>
<HR SIZE="6">
<br><A NAME="SEC309"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC308"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC310"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Special Events"></A>
<H2> 20.7 特殊イベント </H2>
<!--docid::SEC309::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Special%20Events">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Special%20Events</a>"<br>
"texi/elisp21/特殊イベント"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%C6%C3%BC%EC%A5%A4%A5%D9%A5%F3%A5%C8">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

<A NAME="IDX1203"></A>
特殊イベントは、読まれるとただちに非常に低レベルで処理されます。
関数<CODE>read-event</CODE>はこれらのイベントをそれ自身で処理してしまい、
それらを返すことはありません。
<P>

このように処理されるイベントは表示されることはなく、
キー列に組み込まれることもなく、
<CODE>last-command-event</CODE>や<CODE>(this-command-keys)</CODE>の値に
現れることもありません。
特殊イベントが数値引数を破棄することはなく、
<CODE>unread-command-events</CODE>で読み戻すことはできません。
特殊イベントがキーボードマクロに現れることはなく、
読者がキーボードマクロを定義しているときに、
特殊イベントがキーボードマクロに記録されることはありません。
<P>

しかし、それらのイベントは、
読まれた直後には<CODE>last-input-event</CODE>に現れますから、
これからイベントの定義で実際のイベントを見ることができます。
<P>

<CODE>iconify-frame</CODE>、<CODE>make-frame-visible</CODE>、<CODE>delete-frame</CODE>の
イベント型は、通常このように処理されます。
特殊イベントをどのように処理するか、
どのイベントが特殊イベントであるかを定義する
キーマップは変数<CODE>special-event-map</CODE>にあります（see 節 <A HREF="elisp_22.html#SEC323">21.6 活性なキーマップ</A>）。
<P>

<A NAME="Waiting"></A>
<HR SIZE="6">
<br><A NAME="SEC310"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC309"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC311"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Waiting"></A>
<H2> 20.8 時間待ちと入力待ち </H2>
<!--docid::SEC310::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Waiting">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Waiting</a>"<br>
"texi/elisp21/時間待ちと入力待ち"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%BB%FE%B4%D6%C2%D4%A4%C1%A4%C8%C6%FE%CE%CF%C2%D4%A4%C1">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1204"></A>
<A NAME="IDX1205"></A>
<P>

待機関数は、指定時間経過するか入力がくるまで待つように設計してあります。
たとえば、ユーザーに表示を眺める時間を与えるために
計算途中で休止したいでしょう。
<CODE>sit-for</CODE>は、休止してスクリーンを更新し、
入力がくるとただちに戻ります。
一方、<CODE>sleep-for</CODE>はスクリーンを更新せずに休止します。
<P>

<A NAME="IDX1206"></A>
<DL>
<DT><U>Function:</U> <B>sit-for</B> <I>seconds &#38;optional millisec nodisp</I>
<DD>この関数は（処理待ちのユーザーからの入力がなければ）再表示を行い、
<VAR>seconds</VAR>秒休止するか、入力がくるまで待つ。
入力がこずに（<A HREF="elisp_21.html#SEC308">20.6.4 その他のイベント入力機能</A>の<CODE>input-pending-p</CODE>を参照）
指定時間だけ休止した場合は、戻り値は<CODE>t</CODE>である。
さもなければ、戻り値は<CODE>nil</CODE>である。
<P>

引数<VAR>seconds</VAR>は整数である必要はない。
それが浮動小数点数であると、<CODE>sit-for</CODE>は秒の小数も待つ。
秒単位しか扱えないシステムもあり、
そのようなシステムでは<VAR>seconds</VAR>を秒に切り下げる。
<P>

省略可能な引数<VAR>millisec</VAR>は、ミリ秒単位の追加待ち時間を指定する。
これは<VAR>seconds</VAR>で指定した時間に加えられる。
秒未満を扱えないシステムでは、
<VAR>millisec</VAR>に0以外を指定するとエラーになる。
<P>

<A NAME="IDX1207"></A>
入力がくると再表示をつねに取り止め、
再表示開始まえに入力がくると、いっさい再表示しない。
したがって、処理待ちの入力があると、再表示を強制する方法はない。
しかし、処理待ちの入力がなければ、<CODE>(sit-for 0)</CODE>で再表示を強制できる。
<P>

<VAR>nodisp</VAR>が<CODE>nil</CODE>以外であると、
<CODE>sit-for</CODE>は再表示はしないが、
入力がくるとただちに（あるいは指定時間だけ経過すると）戻る。
<P>

フレームをアイコンにしたりアイコンにしたフレームを開くと
イベントが生成されるため、<CODE>sit-for</CODE>は戻る。
see 節 <A HREF="elisp_21.html#SEC299">20.5.10 ウィンドウシステムのその他のイベント</A>。
<P>

<CODE>sit-for</CODE>の普通の目的は、
読者が表示したテキストを読む時間をユーザーに与えることである。
</DL>
<P>

<A NAME="IDX1208"></A>
<DL>
<DT><U>Function:</U> <B>sleep-for</B> <I>seconds &#38;optional millisec</I>
<DD>この関数は表示を更新せずに単に<VAR>seconds</VAR>秒だけ休止する。
入力にはいっさい注意を払わない。
<CODE>nil</CODE>を返す。
<P>

引数<VAR>seconds</VAR>は整数である必要はない。
それが浮動小数点数であると、<CODE>sleep-for</CODE>は秒の小数も待つ。
秒単位しか扱えないシステムもあり、
そのようなシステムでは<VAR>seconds</VAR>を秒に切り下げる。
<P>

省略可能な引数<VAR>millisec</VAR>は、ミリ秒単位の追加待ち時間を指定する。
これは<VAR>seconds</VAR>で指定した時間に加えられる。
秒未満を扱えないシステムでは、
<VAR>millisec</VAR>に0以外を指定するとエラーになる。
<P>

遅延を保証したい場合に<CODE>sleep-for</CODE>を使う。
</DL>
<P>

現在時刻を取得する関数についてはSee 節 <A HREF="elisp_40.html#SEC647">39.5 時刻</A>。
<P>

<A NAME="Quitting"></A>
<HR SIZE="6">
<br><A NAME="SEC311"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC310"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC312"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Quitting"></A>
<H2> 20.9 中断 </H2>
<!--docid::SEC311::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Quitting">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Quitting</a>"<br>
"texi/elisp21/中断"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%C3%E6%C3%C7">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1209"></A>
<A NAME="IDX1210"></A>
<P>

Lisp関数が動作中に<KBD>C-g</KBD>を打つと、
Emacsがなにを行っていても<EM>中断</EM>を引き起こします。
つまり、もっとも内側の活性なコマンドループに制御が戻ります。
<P>

コマンドループがキーボード入力を待っているときに<KBD>C-g</KBD>を打っても、
中断を引き起こさずに、普通の入力文字として動作します。
もっとも単純な場合、<KBD>C-g</KBD>はコマンド<CODE>keyboard-quit</CODE>を実行しますが、
その効果は中断を引き起こすことですから、読者には区別できないはずです。
しかし、プレフィックスキーに続けて<KBD>C-g</KBD>を打つと、
それらは組み合わされて未定義キーになります。
その効果は、前置引数を含めてプレフィックスキーを取り消します。
<P>

ミニバッファでは、<KBD>C-g</KBD>には別の定義があって、
ミニバッファを強制終了させます。
つまり、ミニバッファから抜け出て中断します。
（単に中断したのでは、ミニバッファ<EM>内で</EM>
コマンドループに戻るだけである。）
コマンドループで入力を読んでいるときに<KBD>C-g</KBD>で直接中断しない理由は、
このようにミニバッファでその意味を再定義できるようにするためです。
ミニバッファでは、プレフィックスキーに続く<KBD>C-g</KBD>は再定義してなく、
プレフィックスキーと前置引数を取り消すという通常の効果を持ちます。
<KBD>C-g</KBD>がつねに直接中断するのでは、このようにすることさえ不可能です。
<P>

<KBD>C-g</KBD>が直接に中断するときには、
変数<CODE>quit-flag</CODE>に<CODE>t</CODE>を設定します。
Emacsはこの変数を適切なときに検査し<CODE>nil</CODE>でないと中断します。
したがって、<CODE>quit-flag</CODE>に<CODE>nil</CODE>以外を設定すると
中断を引き起こします。
<P>

Cのコードのレベルでは、どこでも中断できるわけではありません。
<CODE>quit-flag</CODE>を検査している特別な箇所だけです。
このようにするのは、それ以外の箇所で中断すると
Emacsの内部状態に矛盾をきたす可能性があるからです。
中断は安全な場所まで延期されるので、
中断によってEmcasがクラッシュすることはありません。
<P>

<CODE>read-key-sequence</CODE>や<CODE>read-quoted-char</CODE>などのある種の関数は、
入力を待っている場合であっても中断を完全に抑制します。
中断するかわりに、<KBD>C-g</KBD>は入力として働きます。
<CODE>read-key-sequence</CODE>の場合、コマンドループにおいて
<KBD>C-g</KBD>の特別なふるまいをもたらします。
<CODE>read-quoted-char</CODE>の場合、
<KBD>C-q</KBD>で<KBD>C-g</KBD>をクォートできるようになります。
<P>

変数<CODE>inhibit-quit</CODE>に<CODE>nil</CODE>以外の値を束縛することで
Lisp関数のある部分において中断を抑制できます。
そうすると、<KBD>C-g</KBD>はそれでもいつもどおり
<CODE>quit-flag</CODE>を<CODE>t</CODE>にしますが、
その通常の結果である中断は抑制されます。
最終的にフォーム<CODE>let</CODE>の終りで束縛が解除されるなどして
<CODE>inhibit-quit</CODE>が再度<CODE>nil</CODE>になります。
その時点でも<CODE>quit-flag</CODE>が<CODE>nil</CODE>以外であると
要求した中断がただちに起こります。
このふるまいは、プログラムの『臨界領域』では
中断が起こらないことを保証する理想的なものです。
<P>

<A NAME="IDX1211"></A>
（<CODE>read-quoted-char</CODE>などの）ある種の関数では、
<KBD>C-g</KBD>は特別に処理され中断を引き起こしません。
<CODE>inhibit-quit</CODE>に<CODE>t</CODE>を束縛して入力を読み取り、
<CODE>inhibit-quit</CODE>が再度<CODE>nil</CODE>になるまえに
<CODE>quit-flag</CODE>を<CODE>nil</CODE>にすることでそのようにします。
これを<CODE>read-quoted-char</CODE>の定義の以下の抜粋で示しましょう。
最初の入力文字のあとで通常の中断を許す方法も示しています。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun read-quoted-char (&#38;optional prompt)
  "<small>...</small><VAR>documentation</VAR><small>...</small>"
  (let ((message-log-max nil) done (first t) (code 0) char)
    (while (not done)
      (let ((inhibit-quit first)
            <small>...</small>)
	(and prompt (message "%s-" prompt))
	(setq char (read-event))
	(if inhibit-quit (setq quit-flag nil)))
      <small>...</small>変数<CODE>code</CODE>に設定する<small>...</small>)
    code))
</pre></td></tr></table><P>

<A NAME="IDX1212"></A>
<DL>
<DT><U>Variable:</U> <B>quit-flag</B>
<DD><CODE>inhibit-quit</CODE>が<CODE>nil</CODE>であれば、
この変数が<CODE>nil</CODE>以外であるとEmacsはただちに中断する。
<KBD>C-g</KBD>は、<CODE>inhibit-quit</CODE>に関わらず、
通常、<CODE>quit-flag</CODE>に<CODE>nil</CODE>以外を設定する。
</DL>
<P>

<A NAME="IDX1213"></A>
<DL>
<DT><U>Variable:</U> <B>inhibit-quit</B>
<DD>この変数は、<CODE>quit-flag</CODE>が<CODE>nil</CODE>以外の値に設定されたときに
Emacsが中断すべきかどうかを決定する。
<CODE>inhibit-quit</CODE>が<CODE>nil</CODE>以外であると、
<CODE>quit-flag</CODE>に特別な意味はない。
</DL>
<P>

<A NAME="IDX1214"></A>
<DL>
<DT><U>コマンド:</U> <B>keyboard-quit</B>
<DD>この関数は<CODE>(signal 'quit nil)</CODE>で<CODE>quit</CODE>条件を通知する。
これは中断と同じことを行う。
（<A HREF="elisp_10.html#SEC130">9.5.3 エラー</A>の<CODE>signal</CODE>を参照。）
</DL>
<P>

中断として使う<KBD>C-g</KBD>以外の特殊文字を使えます。
<A HREF="elisp_40.html#SEC650">39.8 端末入力</A>の関数<CODE>set-input-mode</CODE>を参照してください。
 
<A NAME="Prefix Command Arguments"></A>
<HR SIZE="6">
<br><A NAME="SEC312"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC311"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC313"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Prefix Command Arguments"></A>
<H2> 20.10 前置コマンド引数 </H2>
<!--docid::SEC312::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Prefix%20Command%20Arguments">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Prefix%20Command%20Arguments</a>"<br>
"texi/elisp21/前置コマンド引数"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%C1%B0%C3%D6%A5%B3%A5%DE%A5%F3%A5%C9%B0%FA%BF%F4">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1215"></A>
<A NAME="IDX1216"></A>
<A NAME="IDX1217"></A>
<P>

Emacsのほとんどのコマンドは、<EM>前置引数</EM>（prefix argument）、
つまりコマンド自身のまえに指定された数を利用できます。
（前置引数とプレフィックスキーを混同しないこと。）
前置引数はつねに値で表現され、
<CODE>nil</CODE>であると現在は前置引数がないことを表します。
各コマンドは、前置引数を使ってもよいし、無視してもかまいません。
<P>

前置引数には2つの表現方法があります。
<EM>生</EM>（raw）と<EM>数値</EM>（numeric）です。
エディタコマンドループでは、内部的には生の表現を使い、
その情報を保持するLisp変数もそのようにしますが、
コマンドではどちらの表現を要求してもかまいません。
<P>

生の前置引数の値にはつぎの可能性があります。
<P>

<UL>
<LI>
前置引数がないことを意味する<CODE>nil</CODE>。
その数値としての値は1であるが、
多くのコマンドでは<CODE>nil</CODE>と整数1を区別する。
<P>

<LI>
それ自身が表す整数。
<P>

<LI>
整数を要素とする1要素のリスト。
この形式の前置引数は、数字文字なしの1個以上の<KBD>C-u</KBD>の結果である。
リスト内の数値は整数であるが、そのようなリストと整数のみを区別する
コマンドもある。
<P>

<LI>
シンボル<CODE>-</CODE>。
数字文字なしに<KBD>M--</KBD>や<KBD>C-u -</KBD>を打ったことを表す。
これに等価な数値は-1であるが、
整数-1とシンボル<CODE>-</CODE>を区別するコマンドもある。
</UL>
<P>

いろいろな前置引数でつぎの関数を呼び出す例を示します。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun display-prefix (arg)
  "Display the value of the raw prefix arg."
  (interactive "P")
  (message "%s" arg))
</pre></td></tr></table><P>

以下は、生の前置引数で<CODE>display-prefix</CODE>を呼び出した結果です。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>        M-x display-prefix  -| nil

C-u     M-x display-prefix  -| (4)

C-u C-u M-x display-prefix  -| (16)

C-u 3   M-x display-prefix  -| 3

M-3     M-x display-prefix  -| 3      ; （<CODE>C-u 3</CODE>と同じ）

C-u -   M-x display-prefix  -| -      

M--     M-x display-prefix  -| -      ; （<CODE>C-u -</CODE>と同じ）

C-u - 7 M-x display-prefix  -| -7     

M-- 7   M-x display-prefix  -| -7     ; （<CODE>C-u -7</CODE>と同じ）
</pre></td></tr></table><P>

Emacsは、前置引数を保持するために2つの変数、
<CODE>prefix-arg</CODE>と<CODE>current-prefix-arg</CODE>を使います。
他のコマンド向けに前置引数を設定する<CODE>universal-argument</CODE>などの
コマンドは、前置引数を<CODE>prefix-arg</CODE>に保持します。
対照的に、<CODE>current-prefix-arg</CODE>には
現在のコマンドに対して前置引数を運ぶ役割があり、
この変数に設定しても以後のコマンドに対する前置引数には
なんの効果もありません。
<P>

通常、コマンドは、<CODE>interactive</CODE>宣言により、
「生」か「数値」のいずれの表現の前置引数を使うか指定します。
（See 節 <A HREF="elisp_21.html#SEC284">20.2.1 <CODE>interactive</CODE>の使い方</A>。）
あるいは、変数<CODE>current-prefix-arg</CODE>にある前置引数の値を
関数から直接見てもかまいませんが、
これは見通しのよい方法ではありません。
<P>

<A NAME="IDX1218"></A>
<DL>
<DT><U>Function:</U> <B>prefix-numeric-value</B> <I>arg</I>
<DD>この関数は、有効な生の前置引数の値<VAR>arg</VAR>からそれに等価な数値を返す。
引数は、シンボル、数、リストのいずれかである。
それが<CODE>nil</CODE>であると、戻り値は1である。
<CODE>-</CODE>であると、戻り値は-1である。
数であると、その数を返す。
リストであると、リストの（数であるはずの）CARを返す。
</DL>
<P>

<A NAME="IDX1219"></A>
<DL>
<DT><U>Variable:</U> <B>current-prefix-arg</B>
<DD>この変数は、<EM>現在の</EM>コマンドに対する生の前置引数を保持する。
コマンドが直接この変数を調べてもよいが、
前置引数を参照する普通の方法は<CODE>(interactive "P")</CODE>を使うことである。
</DL>
<P>

<A NAME="IDX1220"></A>
<DL>
<DT><U>Variable:</U> <B>prefix-arg</B>
<DD>この変数の値は、<EM>つぎの</EM>編集コマンド向けの生の前置引数である。
後続のコマンド向けの前置引数を指定する<CODE>universal-argument</CODE>などの
コマンドは、この変数に設定することで動作する。
</DL>
<P>

<A NAME="IDX1221"></A>
<A NAME="IDX1222"></A>
<DL>
<DT><U>Variable:</U> <B>last-prefix-arg</B>
<DD>まえのコマンドで使われた生の前置引数の値。
</DL>
<P>

つぎのコマンドは、後続のコマンド向けの前置引数を設定するためのものです。
それ以外の目的には呼ばないでください。
<P>

<A NAME="IDX1223"></A>
<DL>
<DT><U>コマンド:</U> <B>universal-argument</B>
<DD>このコマンドは入力を読み取り、後続のコマンド向けの前置引数を指定する。
なにをしているか理解していない限り、読者自身でこのコマンドを呼ばないこと。
</DL>
<P>

<A NAME="IDX1224"></A>
<DL>
<DT><U>コマンド:</U> <B>digit-argument</B> <I>arg</I>
<DD>このコマンドは、後続のコマンド向けの前置引数に追加する。
引数<VAR>arg</VAR>は、このコマンドが呼び出されるまえの生の前置引数であり、
前置引数を更新する計算に使われる。
なにをしているか理解していない限り、読者自身でこのコマンドを呼ばないこと。
</DL>
<P>

<A NAME="IDX1225"></A>
<DL>
<DT><U>コマンド:</U> <B>negative-argument</B> <I>arg</I>
<DD>このコマンドは、後続のコマンド向けの数値前置引数に追加する。
引数<VAR>arg</VAR>は、このコマンドが呼び出されるまえの生の前置引数であり、
その値の符号を変えて新たな前置引数とする。
なにをしているか理解していない限り、読者自身でこのコマンドを呼ばないこと。
</DL>
<P>

<A NAME="Recursive Editing"></A>
<HR SIZE="6">
<br><A NAME="SEC313"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC312"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC314"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Recursive Editing"></A>
<H2> 20.11 再帰編集 </H2>
<!--docid::SEC313::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Recursive%20Editing">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Recursive%20Editing</a>"<br>
"texi/elisp21/再帰編集"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%BA%C6%B5%A2%CA%D4%BD%B8">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1226"></A>
<A NAME="IDX1227"></A>
<A NAME="IDX1228"></A>
<P>

Emacsが動作を始めると、Emacsのコマンドループに自動的に入ります。
このトップレベルのコマンドループからはけっして抜けることはなく、
Emacsが動いている限り動作し続けます。
Lispプログラムからコマンドループを起動することもできます。
そうすると、活性なコマンドループが複数作られることになるので、
それを<EM>再帰編集</EM>（recursive editing）と呼びます。
再帰編集レベルには、それを起動したコマンドを一時休止させ、
当該コマンドを再開するまでユーザーにどんな編集でも許す効果があります。
<P>

再帰編集中に利用可能なコマンドは、トップレベルのコマンドループと
同じものでありキーマップで定義されます。
再帰編集を抜けるための数個の特別なコマンドがあり、
完了すると再帰編集レベルから抜ける別のコマンドもあります。
（再帰編集を抜けるコマンドはつねに利用可能であるが、
再帰編集中でないとなにも行わない。）
<P>

再帰編集を含むすべてのコマンドループでは、
コマンドループから実行したコマンドのエラーによって
コマンドループから抜け出さないように汎用目的のエラーハンドラを設定します。
<P>

<A NAME="IDX1229"></A>
ミニバッファでの入力は、特別な種類の再帰編集です。
これには、ミニバッファやミニバッファ用ウィンドウを表示するなどの特別な
処理がありますが、読者が考えるよりは少ないのです。
ミニバッファでは特別なふるまいをするキーもありますが、
それらはミニバッファのローカルマップによるものです。
ウィンドウを切り替えると、Emacsの普通のコマンドを使えます。
<P>

<A NAME="IDX1230"></A>
<A NAME="IDX1231"></A>
<A NAME="IDX1232"></A>
<A NAME="IDX1233"></A>
<A NAME="IDX1234"></A>
再帰編集レベルを起動するには、関数<CODE>recursive-edit</CODE>を呼び出します。
この関数にはコマンドループが含まれています。
さらに、<CODE>exit</CODE>を伴った<CODE>catch</CODE>の呼び出しもあり、
これにより、<CODE>exit</CODE>へ投げることで
再帰編集レベルから抜け出せるようになっています
（see 節 <A HREF="elisp_10.html#SEC128">9.5.1 明示的な非ローカル脱出：<CODE> </CODE><CODE>catch</CODE>と<CODE>throw</CODE></A>）。
<CODE>t</CODE>以外の値を投げると、<CODE>recursive-edit</CODE>は、
呼び出し側の関数へ普通に戻ります。
コマンド<KBD>C-M-c</KBD>（<CODE>exit-recursive-edit</CODE>）は、これを行います。
値<CODE>t</CODE>を投げると<CODE>recursive-edit</CODE>に中断を引き起こし、
1つ上のレベルのコマンドループへ制御を戻します。
これを<EM>強制終了</EM>（aborting）と呼び、
<KBD>C-]</KBD>（<CODE>abort-recursive-edit</CODE>）で行えます。
<P>

ミニバッファを使う場合を除いて、ほとんどのアプリケーションでは
再帰編集を使うべきではありません。
カレントバッファのメジャーモードを
一時的な特別なメジャーモードに変更するほうが、
一般にはユーザーにとってより便利です。
ただし、当該メジャーモードには、
まえのモードに戻るコマンドを用意しておきます。
（rmailのコマンド<KBD>e</KBD>は、この方式を使っている。）
あるいは、『再帰的に』編集する別のテキストをユーザーに与えたい場合には、
特別なモードの新たなバッファを作成してそれを選択します。
当該モードには、処理を終えてまえのバッファに戻るコマンドを
定義しておきます。
（rmailのコマンド<KBD>m</KBD>は、このようにする。）
<P>

再帰編集はデバッグに便利です。
ブレークポイントの一種として関数定義に
<CODE>debug</CODE>の呼び出しを挿入しておくと、
その箇所に達したときにいろいろと調べられます。
<CODE>debug</CODE>は再帰編集を起動しますが、デバッガとしての機能も提供します。
<P>

<CODE>query-replace</CODE>で<KBD>C-r</KBD>を打ったり、
<KBD>C-x q</KBD>（<CODE>kbd-macro-query</CODE>）を使ったときにも
再帰編集レベルが使われます。
<P>

<A NAME="IDX1235"></A>
<DL>
<DT><U>Function:</U> <B>recursive-edit</B>
<DD><A NAME="IDX1236"></A>
この関数はエディタコマンドループを起動する。
Emacsの初期化過程で自動的に呼び出され、ユーザーが編集できるようにする。
Lispプログラムから呼ばれると、再帰編集レベルに入る。
<P>

以下の例では、関数<CODE>simple-rec</CODE>は、まず1単語分ポイントを進め、
エコー領域にメッセージを表示して再帰編集に入る。
そうすると、ユーザーは望むことはなんでもできるようになり、
（再帰編集を）抜けるために<KBD>C-M-c</KBD>を打つと、
<CODE>simple-rec</CODE>の実行を継続する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defun simple-rec ()
  (forward-word 1)
  (message "Recursive edit in progress")
  (recursive-edit)
  (forward-word 1))
     => simple-rec
(simple-rec)
     => nil
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1237"></A>
<DL>
<DT><U>コマンド:</U> <B>exit-recursive-edit</B>
<DD>この関数は、（ミニバッファでの入力を含む）もっとも内側の再帰編集から抜ける。
その関数定義は実質的には<CODE>(throw 'exit nil)</CODE>である。
</DL>
<P>

<A NAME="IDX1238"></A>
<DL>
<DT><U>コマンド:</U> <B>abort-recursive-edit</B>
<DD>この関数は、再帰編集から抜けたあとで<CODE>quit</CODE>を通知することで、
（ミニバッファでの入力を含む）もっとも内側の再帰編集を
要請したコマンドを強制終了する。
その関数定義は実質的には<CODE>(throw 'exit t)</CODE>である。
see 節 <A HREF="elisp_21.html#SEC311">20.9 中断</A>。
</DL>
<P>

<A NAME="IDX1239"></A>
<DL>
<DT><U>コマンド:</U> <B>top-level</B>
<DD>この関数は、すべての再帰編集を抜ける。
すべての計算を抜け出てメインのコマンドループへ直接戻るため、値は返さない。
</DL>
<P>

<A NAME="IDX1240"></A>
<DL>
<DT><U>Function:</U> <B>recursion-depth</B>
<DD>この関数は再帰編集の現在の深さを返す。
活性な再帰編集がなければ0を返す。
</DL>
<P>

<A NAME="Disabling Commands"></A>
<HR SIZE="6">
<br><A NAME="SEC314"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC313"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC315"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Disabling Commands"></A>
<H2> 20.12 コマンドを禁止する </H2>
<!--docid::SEC314::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Disabling%20Commands">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Disabling%20Commands</a>"<br>
"texi/elisp21/コマンドを禁止する"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%B3%A5%DE%A5%F3%A5%C9%A4%F2%B6%D8%BB%DF%A4%B9%A4%EB">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1241"></A>
<P>

<EM>コマンドを禁止する</EM>とは、
コマンドを実行するまえにユーザーの確認を必要とするように
コマンドに印を付けることです。
コマンドを禁止するのは、
初心者に混乱をもたらす可能性のあるコマンドに対してや、
コマンドの誤用を防ぐためです。
<P>

<A NAME="IDX1242"></A>
コマンドを禁止する低レベルの機構は、
コマンドのLispシンボルに<CODE>nil</CODE>以外の属性<CODE>disabled</CODE>を入れることです。
これらの属性は、通常、ユーザーの`<TT>.emacs</TT>'ファイルにて
つぎのようなLisp式で設定します。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(put 'upcase-region 'disabled t)
</pre></td></tr></table><P>

数個のコマンドにはデフォルトでこれらの属性がありますから、
`<TT>.emacs</TT>'ファイルで属性を取り除きます。
<P>

属性<CODE>disabled</CODE>の値は文字列であり、
コマンドを禁止したことを表すメッセージです。
たとえばつぎのとおりです。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(put 'delete-region 'disabled
     "Text deleted this way cannot be yanked back!\n")
</pre></td></tr></table><P>

禁止したコマンドを対話的に起動するとどうなるかについて
詳しくはSee <a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=emacs21&node=Disabling">GNU Emacs マニュアル</a>。
コマンドを禁止しても、Lispプログラムから関数として呼び出すことには
なんの影響もありません。
<P>

<A NAME="IDX1243"></A>
<DL>
<DT><U>コマンド:</U> <B>enable-command</B> <I>command</I>
<DD>これ以降、特別な確認なしに<VAR>command</VAR>を実行可能にする。
さらに（ユーザーが了承すれば）ユーザーの`<TT>.emacs</TT>'ファイルを変更して、
将来のセッションでもそのようにする。
</DL>
<P>

<A NAME="IDX1244"></A>
<DL>
<DT><U>コマンド:</U> <B>disable-command</B> <I>command</I>
<DD>これ以降、<VAR>command</VAR>の実行には特別な確認を必要とするようにする。
さらに（ユーザーが了承すれば）ユーザーの`<TT>.emacs</TT>'ファイルを変更して、
将来のセッションでもそのようにする。
</DL>
<P>

<A NAME="IDX1245"></A>
<DL>
<DT><U>Variable:</U> <B>disabled-command-hook</B>
<DD>禁止したコマンドをユーザーが対話的に起動したとき、
禁止したコマンドのかわりにこのノーマルフックを実行する。
フック関数では、<CODE>this-command-keys</CODE>を使って
コマンドを実行するためにユーザーがなにを入力したかを調べ、
コマンドそのものを探し出せる。
see 節 <A HREF="elisp_23.html#SEC362">22.6 フック</A>。
<P>

デフォルトでは、<CODE>disabled-command-hook</CODE>には、
ユーザーに処理を進めるかどうかを問い合わせる関数が入っている。
</DL>
<P>

<A NAME="Command History"></A>
<HR SIZE="6">
<br><A NAME="SEC315"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC314"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC316"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Command History"></A>
<H2> 20.13 コマンド履歴 </H2>
<!--docid::SEC315::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Command%20History">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Command%20History</a>"<br>
"texi/elisp21/コマンド履歴"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%B3%A5%DE%A5%F3%A5%C9%CD%FA%CE%F2">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1246"></A>
<A NAME="IDX1247"></A>
<A NAME="IDX1248"></A>
<P>

コマンドループでは、実行した複雑なコマンドの履歴を管理していて、
それらのコマンドを簡単に繰り返せるようにしています。
<EM>複雑なコマンド</EM>とは、ミニバッファを使って引数を読むコマンドです。
これには、任意の<KBD>M-x</KBD>コマンド、任意の<KBD>M-:</KBD>コマンド、
ミニバッファから引数を読み取る<CODE>interactive</CODE>指定を持つ任意のコマンドが
含まれます。
コマンド自身の実行中に明示的にミニバッファを使っても、
複雑なコマンドとはみなしません。
<P>

<A NAME="IDX1249"></A>
<DL>
<DT><U>Variable:</U> <B>command-history</B>
<DD>この変数の値は、最近使った複雑なコマンドのリストであり、
各要素は評価すべきフォームを表す。
編集セッション中は、すべての複雑なコマンドを集積するが、
（変数<CODE>history-length</CODE>で指定される）最大サイズに達すると
新しい要素を追加するたびに古い要素を削除する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>command-history
=> ((switch-to-buffer "chistory.texi")
    (describe-key "^X^[")
    (visit-tags-table "~/emacs/src/")
    (find-tag "repeat-complex-command"))
</pre></td></tr></table></DL>
<P>

この履歴リストは、実際にはミニバッファ履歴（see 節 <A HREF="elisp_20.html#SEC269">19.4 ミニバッファの履歴</A>）
の特別な場合です。
要素は文字列ではなく式なのです。
<P>

まえのコマンドを編集したり取り出すための専用コマンドがたくさんあります。
コマンド<CODE>repeat-complex-command</CODE>と<CODE>list-command-history</CODE>は、
ユーザーマニュアル
（see <a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=emacs21&node=Repetition">GNU Emacs マニュアル</a>）に説明してあります。
ミニバッファ内では、通常のミニバッファ履歴コマンドを使えます。
<P>

<A NAME="Keyboard Macros"></A>
<HR SIZE="6">
<br><A NAME="SEC316"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC315"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC317"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Keyboard Macros"></A>
<H2> 20.14 キーボードマクロ </H2>
<!--docid::SEC316::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Keyboard%20Macros">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Keyboard%20Macros</a>"<br>
"texi/elisp21/キーボードマクロ"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%AD%A1%BC%A5%DC%A1%BC%A5%C9%A5%DE%A5%AF%A5%ED">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1250"></A>
<P>

<EM>キーボードマクロ</EM>は、
コマンドとみなせる入力イベントのまとまった列であり、
キーの定義から構成されます。
Lispにおけるキーボードマクロの表現は、
イベントを含んだ文字列やベクトルです。
キーボードマクロとLispマクロ（see 節 <A HREF="elisp_13.html#SEC171">12. マクロ</A>）を混同しないでください。
<P>

<A NAME="IDX1251"></A>
<DL>
<DT><U>Function:</U> <B>execute-kbd-macro</B> <I>kbdmacro &#38;optional count</I>
<DD>この関数はキーボードマクロ<VAR>kbdmacro</VAR>をイベント列として実行する。
<VAR>kbdmacro</VAR>が文字列かベクトルであると、
その中のイベントをユーザーが入力した場合とまったく同様に実行する。
列は単一のキーイベントである必要は<EM>ない</EM>。
通常、キーボードマクロの定義は、複数のキー列を連結したものである。
<P>

<VAR>kbdmacro</VAR>がシンボルであると、
<VAR>kbdmacro</VAR>のかわりにその関数定義を用いる。
それがさらに別のシンボルであると、この処理を繰り返す。
最終的な結果は、文字列かベクトルであること。
結果がシンボルでも文字列でもベクトルでもないと、
エラーを通知する。
<P>

引数<VAR>count</VAR>は繰り返し回数であり、
<VAR>kbdmacro</VAR>をその回数だけ実行する。
<VAR>count</VAR>を省略するか<CODE>nil</CODE>であると、<VAR>kbdmacro</VAR>を1回実行する。
<VAR>count</VAR>が0であると、
<VAR>kbdmacro</VAR>の実行をエラーに出会うか探索に失敗するまで繰り返す。
<P>

<CODE>execute-kbd-macro</CODE>を使った例についてはsee 節 <A HREF="elisp_21.html#SEC306">20.6.2 単一イベントの読み取り</A>。
</DL>
<P>

<A NAME="IDX1252"></A>
<DL>
<DT><U>Variable:</U> <B>executing-macro</B>
<DD>この変数は、現在実行中のキーボードマクロの定義である
文字列やベクトルを保持する。
これが<CODE>nil</CODE>であると、現在実行中のマクロはない。
コマンドでこの変数を検査することで、
マクロ実行で起動されたときのふるまいを変更できる。
読者自身はこの変数に設定しないこと。
</DL>
<P>

<A NAME="IDX1253"></A>
<DL>
<DT><U>Variable:</U> <B>defining-kbd-macro</B>
<DD>この変数は、キーボードマクロを定義中かどうかを表す。
コマンドでこの変数を検査することで、マクロ定義中のふるまいを変更できる。
コマンド<CODE>start-kbd-macro</CODE>と<CODE>end-kbd-macro</CODE>がこの変数に設定する。
読者自身は設定しないこと。
<P>

この変数は現在の端末に対してつねにローカルであり、
バッファに対してローカルにはならない。
see 節 <A HREF="elisp_29.html#SEC436">28.2 複数ディスプレイ</A>。
</DL>
<P>

<A NAME="IDX1254"></A>
<DL>
<DT><U>Variable:</U> <B>last-kbd-macro</B>
<DD>この変数は、もっとも最近に定義されたキーボードマクロの定義である。
その値は、文字列かベクトル、あるいは、<CODE>nil</CODE>である。
<P>

この変数は現在の端末に対してつねにローカルであり、
バッファに対してローカルにはならない。
see 節 <A HREF="elisp_29.html#SEC436">28.2 複数ディスプレイ</A>。
</DL>
<P>

<A NAME="Keymaps"></A>
<HR SIZE="6">
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<a name="bottom"> </a>
<script type="text/javascript" src="style2.js"></script>
<div class="footer">
    <br>
    このページはMeadow (Emacs) の紹介ページです <br>
このWebページの各文書は自由にリンク・複製・再配布・改変していただいて構いません．
<br>ただし，複製・再配布・改変の場合は Meadow Memo のURLを記載しておいて下さい．<br>
<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=about%20link">Medow memoへのリンクについて</a>．<br>

間違い，要望等があれば<a href="mailto:akihisa@mail.ne.jp">akihisa@mail.ne.jp</a> か下記でどうぞ<br>

<br>

<FORM METHOD="post" ACTION="http://www.bookshelf.jp/cgi-bin/wwwmail.cgi" >
お名前：<INPUT TYPE="text" NAME="name" SIZE="30" MAXLENGTH="40" VALUE="ななしさん"><br>
メールアドレス：<INPUT TYPE="text" NAME="EMAIL" SIZE="25" MAXLENGTH="60" VALUE="secret@mail.adr"><br>
<input type="hidden" name="HPAGE" value="">
つっこみ：<br><TEXTAREA NAME="MESSAGE" ROWS="5" COLS="50">
</TEXTAREA><br><br>
<INPUT TYPE="submit" VALUE="送信">
<INPUT TYPE="reset" VALUE="クリア">
</FORM>

<br><A HREF="http://www.bookshelf.jp/cgi-bin/xct.cgi">ページ別カウンタ</a>
<br> Since 2002/12/13 <br>
</div>

</BODY>

</HTML>
