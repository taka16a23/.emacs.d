<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML lang="ja">
<!-- Created on October, 1  2005 by texi2html 1.64 -->
<!-- 
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Olaf Bachmann <obachman@mathematik.uni-kl.de>
Send bugs and suggestions to <texi2html@mathematik.uni-kl.de>
 
-->
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html;CHARSET=euc-jp">
<META NAME="keywords" CONTENT="meadow,mule,emacs,lisp,elisp,gnus,setting,設定,unix,cygwin">
<META http-equiv="Content-Script-Type" content="text/javascript">
<META NAME="description" CONTENT="Meadowの設定を紹介するページです">
<TITLE>GNU Emacs Lispリファレンスマニュアル:  メジャーモードとマイナモード</TITLE>

<META NAME="description" CONTENT="GNU Emacs Lispリファレンスマニュアル:  メジャーモードとマイナモード">
<META NAME="keywords" CONTENT="GNU Emacs Lispリファレンスマニュアル:  メジャーモードとマイナモード">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META NAME="Generator" CONTENT="texi2html 1.64">

<LINK REL="contents" HREF="elisp_toc.html#SEC_Contents">
<LINK REL="index" HREF="elisp_48.html#SEC681">
<LINK REL="next" HREF="elisp_24.html#SEC363">
<LINK REL="prev" HREF="elisp_22.html#SEC317">

<META http-equiv="Content-Style-Type" content="text/css">
<!-- 鶯と龜 ←日本語EUC誤判別対策用らしい; -->
<link rel="StyleSheet" href="../../../../soft/css/midnight.css" type="text/css" id="css1">
<script type="text/javascript" src="style1.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../soft/css/meadowmemo.css">

</HEAD>
<BODY LANG="ja" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">
<!--Infoseek Analyzer start-->
<script LANGUAGE="javascript">PgNo=6;</script>
<script src="http://js1.infoseek.co.jp/bin/57/00170.js"></script>
<noscript><a href="http://ax1.www.infoseek.co.jp/bin/go?0017057f" target="_blank">
<img src="http://ax1.www.infoseek.co.jp/bin/logo?0017057f" border=0></a></noscript>
<!--Infoseek Analyzer end-->
<a name="top"> </a>

<br><A NAME="SEC339"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC338"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC340"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC317"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_24.html#SEC363"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Modes"></A>
<H1> 22. メジャーモードとマイナモード </H1>
<!--docid::SEC339::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Modes">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Modes</a>"<br>
"texi/elisp21/メジャーモードとマイナモード"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%E1%A5%B8%A5%E3%A1%BC%A5%E2%A1%BC%A5%C9%A4%C8%A5%DE%A5%A4%A5%CA%A5%E2%A1%BC%A5%C9">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1380"></A>
<P>

<EM>モード</EM>（mode）とは、Emacsをカスタマイズする定義の集まりであり、
読者は編集中にそれをオン／オフできます。
モードには2種類あります。
<EM>メジャーモード</EM>（major mode）は、互いに排他的で、
特定種類のテキストの編集に使います。
<EM>マイナモード</EM>（minor mode）は、
ユーザーがそれぞれを独立にオンにできる機能を提供します。
<P>

本章では、メジャーモードやマイナモードの書き方、
それらをモード行に表示する方法、
ユーザーが指定したフックをモードがどのように実行するかについて述べます。
キーマップや構文テーブルなどの関連事項については、
<A HREF="elisp_22.html#SEC317">21. キーマップ</A>や<A HREF="elisp_35.html#SEC564">34. 構文テーブル</A>を参照してください。
<P>

<div class="menuindex"><SCRIPT language=JavaScript src="index22.js"></SCRIPT></div><noscript><BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC340">22.1 メジャーモード</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Defining major modes.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC346">22.2 マイナモード</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Defining minor modes.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC350">22.3 モード行の書式</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Customizing the text that appears in the mode line.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC354">22.4 iメニュー</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How a mode can provide a menu
                         of definitions in the buffer.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC355">22.5 フォントロック（font-lock）モード</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How modes can highlight text according to syntax.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC362">22.6 フック</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How to use hooks; how to write code that provides hooks.</TD></TR>
</TABLE></BLOCKQUOTE></noscript>
<P>

<A NAME="Major Modes"></A>
<HR SIZE="6">
<br><A NAME="SEC340"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC339"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC341"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Major Modes"></A>
<H2> 22.1 メジャーモード </H2>
<!--docid::SEC340::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Major%20Modes">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Major%20Modes</a>"<br>
"texi/elisp21/メジャーモード"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%E1%A5%B8%A5%E3%A1%BC%A5%E2%A1%BC%A5%C9">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1381"></A>
<A NAME="IDX1382"></A>
<P>

メジャーモードは、特定種類のテキストの編集向けにEmacsを特化します。
各バッファには、ある時点では1つのメジャーモードしかありません。
<P>

もっとも特化されていないメジャーモードは、
<EM>基本（fundamental）モード</EM>です。
このモードには、モードに固有な定義や変数の設定がありません。
そのため、Emacsの各コマンドはデフォルトのふるまいをし、
各オプションもデフォルトの状態です。
他のすべてのメジャーモードでは、さまざまなキーやオプションを再定義します。
たとえば、lisp対話モードでは、
<KBD>C-j</KBD>（<CODE>eval-print-last-sexp</CODE>）や
<KBD>TAB</KBD>（<CODE>lisp-indent-line</CODE>）など他のキーに対しても
特別なキーバインディングがあります。
<P>

読者の特別な編集作業を補佐するために一群の編集コマンドを書く必要がある場合、
新たなメジャーモードを作ることは一般にはよいことです。
実際、メジャーモードを書くことは
（マイナモードを書くことはしばしば難しくなるが、
それに対比すれば）簡単です。
<P>

新たなモードが既存のモードに類似していても、
既存のモードを2つの目的を果たすように修正するのは
賢いことではありません。
そのようにすると、使い難く保守し難くなるからです。
そのかわりに、既存のメジャーモードの定義をコピーし名前変えてから、
コピーを変更します。
あるいは、<EM>派生モード</EM> （derived mode）
（see 節 <A HREF="elisp_23.html#SEC345">22.1.5 派生モードの定義</A>）を定義します。
たとえば、`<TT>emacs/lisp/rmailedit.el</TT>'にあるrmail編集モードは、
テキスト（text）モードに非常によく似たメジャーモードですが、
追加コマンドが3つあります。
そのような定義がテキスト（text）モードとの違いになるのですが、
rmail編集モードはテキスト（text）モードから派生したものです。
<P>

rmail編集モードは、バッファのメジャーモードを一時的に変更して
バッファを別の方法（rmailのコマンドではなく
Emacsの普通のコマンド）で編集できるようにする例題です。
そのような場合、一時的なメジャーモードには、普通、
バッファの通常のモード（この場合にはrmailモード）に戻る
コマンドがあります。
読者は、再帰編集の中で一時的に再定義し、
ユーザーが再帰編集を抜けるともとに戻す方法に魅了されるかもしれません。
しかし、これを複数のバッファで行うと、
再帰編集はもっとも最近に入った再帰からまず抜けるので、
ユーザーの選択に制約を課すことになり悪い方法です。
別のメジャーモードを使えばこのような制約を回避できます。
See 節 <A HREF="elisp_21.html#SEC313">20.11 再帰編集</A>。
<P>

標準のGNU Emacs Lispのライブラリのディレクトリには、
`<TT>text-mode.el</TT>'、`<TT>texinfo.el</TT>'、`<TT>lisp-mode.el</TT>'、
`<TT>c-mode.el</TT>'、`<TT>rmail.el</TT>'などのファイルに
いくつかのメジャーモードのコードが収めてあります。
モードの書き方を理解するためにこれらのライブラリを調べられます。
テキスト（text）モードは、基本（fundamental）モードについで、
もっとも単純なメジャーモードです。
rmailモードは複雑な特化されたモードです。
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC341">22.1.1 メジャーモードの慣習</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Coding conventions for keymaps, etc.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC342">22.1.2 メジャーモードの例</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Text mode and Lisp modes.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC343">22.1.3 メジャーモードの選択方法</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How Emacs chooses the major mode automatically.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC344">22.1.4 メジャーモードに関するヘルプ</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Finding out how to use a mode.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC345">22.1.5 派生モードの定義</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Defining a new major mode based on another major 
                              mode.</TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Major Mode Conventions"></A>
<HR SIZE="6">
<br><A NAME="SEC341"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC340"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC342"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Major Mode Conventions"></A>
<H3> 22.1.1 メジャーモードの慣習 </H3>
<!--docid::SEC341::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Major%20Mode%20Conventions">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Major%20Mode%20Conventions</a>"<br>
"texi/elisp21/メジャーモードの慣習"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%E1%A5%B8%A5%E3%A1%BC%A5%E2%A1%BC%A5%C9%A4%CE%B4%B7%BD%AC">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

既存のメジャーモードのコードでは、
ローカルキーマップや構文テーブルの初期化、グローバルな名前、フックなどの
さまざまなコーディング上の慣習を踏襲しています。
読者が新たなメジャーモードを定義するときには、
これらの慣習に従ってください。
<P>

<UL>
<LI>
カレントバッファにおいて新しいモードに切り替える
引数なしのコマンドを定義し、その名前は`<SAMP>-mode</SAMP>'で終ること。
このコマンドが、キーマップ、構文テーブル、
既存バッファにバッファローカルな変数を設定するが、
バッファの内容は変更しないこと。
<P>

<LI>
このモードで使える特別なコマンドに関して記述した
このコマンドに対する説明文字列を書く。
読者のモードで<KBD>C-h m</KBD>（<CODE>describe-mode</CODE>）を使うと、
この説明文字列を表示する。
<P>

説明文字列では、`<SAMP>\[<VAR>command</VAR>]</SAMP>'、`<SAMP>\{<VAR>keymap</VAR>}</SAMP>'、
`<SAMP>\&#60;<VAR>keymap</VAR>&#62;</SAMP>'の特別な書き方を使え、
これらはユーザー独自のキーバインディングに自動的に置き換えられる。
see 節 <A HREF="elisp_24.html#SEC366">23.3 説明文内のキーバインディングの置換</A>。
<P>

<LI>
メジャーモードコマンドは、
<CODE>kill-all-local-variables</CODE>の呼び出しから始めること。
それ以前に有効であったメジャーモードのバッファローカルな変数に
対処するためである。
<P>

<LI>
メジャーモードコマンドは、
変数<CODE>major-mode</CODE>にメジャーモードコマンドのシンボルを設定すること。
これにより、<CODE>describe-mode</CODE>が表示すべき説明文を捜し出す。
<P>

<LI>
メジャーモードコマンドは、
変数<CODE>mode-name</CODE>にモードの『愛称』を文字列として設定すること。
この文字列がモード行に現れる。
<P>

<LI>
<A NAME="IDX1383"></A>
<A NAME="IDX1384"></A>
すべてのグローバルな名前は同一の名前空間にあるので、
モードの構成要素であるすべてのグローバル変数、定数、関数は、
メジャーモード名（名前が長ければ、その省略）で始まること。
see 節 <A HREF="elisp_42.html#SEC662">B.1 Emacs Lispのコーディングの慣習</A>。
<P>

<LI>
<A NAME="IDX1385"></A>
<A NAME="IDX1386"></A>
メジャーモードには、通常、それ独自のキーマップがあるはずで、
当該モードのすべてのバッファでローカルキーマップとして使われる。
メジャーモードコマンドは、<CODE>use-local-map</CODE>を呼び出して、
そのローカルキーマップを設定すること。
詳しくは、see 節 <A HREF="elisp_22.html#SEC323">21.6 活性なキーマップ</A>。
<P>

このキーマップは、<CODE><VAR>modename</VAR>-mode-map</CODE>という名前の
グローバル変数に恒久的に保持すること。
通常、モードを定義するライブラリでこの変数に設定する。
<P>

モードのキーマップ変数に設定するコードの書き方に関する助言については
see 節 <A HREF="elisp_11.html#SEC142">10.6 変数を堅牢に定義するためのヒント</A>。
<P>

<LI>
メジャーモードのキーマップでバインドされたキー列は、
通常、<KBD>C-c</KBD>で始まり、コントロール文字、数字文字、<KBD>{</KBD>、
<KBD>}</KBD>、<KBD>&#60;</KBD>、<KBD>&#62;</KBD>、<KBD>:</KBD>、<KBD>;</KBD>のいずれかが続くようにする。
その他の句読点文字はマイナモード向けに予約されている。
また、通常の英文字はユーザー向けに予約されている。
<P>

メジャーモードにおいては、そのモードによく適合した形で
『同じ仕事』を行うコマンドであるならば、
標準的な意味を持つキー列に当該コマンドを再バインドしても合理的である。
たとえば、プログラム言語編集用のメジャーモードでは、
<KBD>C-M-a</KBD>を当該言語にうまく適合した方法で
『関数の先頭へ移動する』コマンドに再定義する。
<P>

テキスト挿入を許さないdiredやrmailなどのメジャーモードでは、
英文字や他の印字文字を編集コマンドとして再定義するのも合理的である。
diredもrmailもこうしている。
<P>

<LI>
<A NAME="IDX1387"></A>
<A NAME="IDX1388"></A>
モードでは、独自の構文テーブルを用意するか、
他の関連するモードと構文テーブルを共有する。
独自の構文テーブルを用意する場合には、
<CODE><VAR>modename</VAR>-mode-syntax-table</CODE>という名前の変数に保持すること。
see 節 <A HREF="elisp_35.html#SEC564">34. 構文テーブル</A>。
<P>

<LI>
コメントを書ける言語を扱うモードでは、
コメントの構文を定義する変数に設定すること。
see <a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=emacs21&node=Options%20for%20Comments">GNU Emacs マニュアル</a>。
<P>

<LI>
<A NAME="IDX1389"></A>
<A NAME="IDX1390"></A>
モードでは、独自の略語表を用意するか、
他の関連するモードと略語表を共有する。
独自の略語表を用意する場合には、
<CODE><VAR>modename</VAR>-mode-abbrev-table</CODE>という名前の変数に保持すること。
see 節 <A HREF="elisp_36.html#SEC578">35.2 略語表 <EM>(2003/10/30)</EM></A>。
<P>

<LI>
モードでは、
バッファローカルな変数<CODE>font-lock-defaults</CODE>
（see 節 <A HREF="elisp_23.html#SEC355">22.5 フォントロック（font-lock）モード</A>）に設定して、
フォントロック（font-lock）モードに対して強調表示の方法を指定すること。
<P>

<LI>
モードでは、
バッファローカルな変数<CODE>imenu-generic-expression</CODE>か
<CODE>imenu-create-index-function</CODE>（see 節 <A HREF="elisp_23.html#SEC354">22.4 iメニュー</A>）に設定して、
iメニューがどのようにバッファ内の定義や節を探すべきかを指定すること。
<P>

<LI>
モードに関連する変数の設定には<CODE>defvar</CODE>か<CODE>defcustom</CODE>を使い、
それらに値が設定されている場合には再初期化しないようにする。
（再初期化するとユーザーのカスタマイズを廃棄してしまう。）
<P>

<LI>
<A NAME="IDX1391"></A>
<A NAME="IDX1392"></A>
Emacsのカスタマイズ変数に対するバッファローカルな束縛は、
メジャーモードコマンドにおいて
<CODE>make-variable-buffer-local</CODE>ではなく
<CODE>make-local-variable</CODE>で行う。
前者の関数は、すべてのバッファにおいてそれ以降に設定される当該変数を
バッファローカルにしてしまい、
このモードを使わないバッファにも影響する。
モードにそのような大局的な効果があるのは望ましくない。
see 節 <A HREF="elisp_11.html#SEC150">10.10 バッファローカルな変数</A>。
<P>

単一のLispパッケージ内のみにおいて使われる変数に対しては、
必要ならば、<CODE>make-variable-buffer-local</CODE>を使ってもよい。
<P>

<LI>
<A NAME="IDX1393"></A>
<A NAME="IDX1394"></A>
各メジャーモードには、
<CODE><VAR>modename</VAR>-mode-hook</CODE>という名前の
<EM>モードフック</EM>（mode hook）があること。
モードコマンドは、最後に<CODE>run-hooks</CODE>を用いてフックを実行すること。
see 節 <A HREF="elisp_23.html#SEC362">22.6 フック</A>。
<P>

<LI>
メジャーモードコマンドは、より基本的なモードのフックを実行してもよい。
たとえば、<CODE>indented-text-mode</CODE>は、
<CODE>indented-text-mode-hook</CODE>に加えて<CODE>text-mode-hook</CODE>も実行する。
自前のフックを実行する直前（つまり設定が終ったあと）
にこれらの他のフックを実行するか、より初期の段階で実行してもよい。
<P>

<LI>
ユーザーがバッファをこのモードから別のメジャーモードに切り替えたときに
特別なことを行う必要がある場合、
このモードでは、<CODE>change-major-mode-hook</CODE>（see 節 <A HREF="elisp_11.html#SEC152">10.10.2 バッファローカルな束縛の作成と削除</A>）
のバッファローカルな値を設定しておく。
<P>

<LI>
このモードが特別に準備したテキストに対してのみ有効な場合には、
メジャーモードコマンドのシンボルには、
つぎのように属性<CODE>mode-class</CODE>に値<CODE>special</CODE>を設定しておくこと。
<P>

<A NAME="IDX1395"></A>
<A NAME="IDX1396"></A>
<A NAME="IDX1397"></A>
<TABLE><tr><td>&nbsp;</td><td class=example><pre>(put 'funny-mode 'mode-class 'special)
</pre></td></tr></table><P>

これは、カレントバッファがfunnyモードのときに新たなバッファを
作成しても、新しいバッファではfunnyモードを継承しないようにEmacsに指示する。
dired、rmail、バッファ一覧などのモードではこの機能を使っている。
<P>

<LI>
新しいモードを識別可能な特定の名前のファイルに対するデフォルトにしたい
場合には、そのような名前のファイルに対して当該モードを選択するための
要素を<CODE>auto-mode-alist</CODE>に追加する。
モードコマンドを自動ロードと定義する場合、
<CODE>autoload</CODE>を呼び出している同じファイルに
そのような要素を追加しておくこと。
そうでなければ、モード定義を収めたファイルに当該要素を入れるだけで十分である。
see 節 <A HREF="elisp_23.html#SEC343">22.1.3 メジャーモードの選択方法</A>。
<P>

<LI>
<A NAME="IDX1398"></A>
<A NAME="IDX1399"></A>
説明文には、ユーザーが個人のファイル`<TT>.emacs</TT>'に書けるように、
<CODE>autoload</CODE>の例、
<CODE>auto-mode-alist</CODE>への追加方法の例を記載すること。
<P>

<LI>
<A NAME="IDX1400"></A>
<A NAME="IDX1401"></A>
モードを定義するファイルのトップレベルのフォームは、
それらを複数回評価しても不利な結果にならないように書いておくこと。
読者が当該ファイルを複数回ロードしなくても、誰かがやるかもしれない。
</UL>
<P>

<A NAME="Example Major Modes"></A>
<HR SIZE="6">
<br><A NAME="SEC342"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC341"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC343"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Example Major Modes"></A>
<H3> 22.1.2 メジャーモードの例 </H3>
<!--docid::SEC342::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Example%20Major%20Modes">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Example%20Major%20Modes</a>"<br>
"texi/elisp21/メジャーモードの例"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%E1%A5%B8%A5%E3%A1%BC%A5%E2%A1%BC%A5%C9%A4%CE%CE%E3">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

基本（fundamental）モードを除くと、
テキスト（text）モードはもっとも単純なモードです。
上に述べた慣習の例示として、`<TT>text-mode.el</TT>'の抜粋をあげておきます。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>;; モード固有の構文テーブルを作る
(defvar text-mode-syntax-table nil 
  "Syntax table used while in text mode.")

(if text-mode-syntax-table
    ()              ; 構文テーブルが既存ならば変更しない
  (setq text-mode-syntax-table (make-syntax-table))
  (modify-syntax-entry ?\" ".   " text-mode-syntax-table)
  (modify-syntax-entry ?\\ ".   " text-mode-syntax-table)
  (modify-syntax-entry ?' "w   " text-mode-syntax-table))

(defvar text-mode-abbrev-table nil
  "Abbrev table used while in text mode.")
(define-abbrev-table 'text-mode-abbrev-table ())

(defvar text-mode-map nil)   ; モード固有のキーマップを作る

(if text-mode-map
    ()              ; キーマップが既存ならば変更しない
  (setq text-mode-map (make-sparse-keymap))
  (define-key text-mode-map "\t" 'indent-relative)
  (define-key text-mode-map "\es" 'center-line)
  (define-key text-mode-map "\eS" 'center-paragraph))
</FONT></pre></td></tr></table><P>

つぎは、テキスト（text）モードのメジャーモード関数の完全な定義です。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(defun text-mode ()
  "Major mode for editing text intended for humans to read<small>....</small>
 Special commands: \\{text-mode-map}
Turning on text-mode runs the hook `text-mode-hook'."
  (interactive)
  (kill-all-local-variables)
  (use-local-map text-mode-map)
  (setq local-abbrev-table text-mode-abbrev-table)
  (set-syntax-table text-mode-syntax-table)
  (make-local-variable 'paragraph-start)
  (setq paragraph-start (concat "[ \t]*$\\|" page-delimiter))
  (make-local-variable 'paragraph-separate)
  (setq paragraph-separate paragraph-start)
  (setq mode-name "Text")
  (setq major-mode 'text-mode)
  (run-hooks 'text-mode-hook))      ; 最後に、フックによるモードの
                                    ;   カスタマイズをユーザーに許す
</FONT></pre></td></tr></table><P>

<A NAME="IDX1402"></A>
3つのlispモード（lispモード、emacs-lispモード、lisp対話モード）には、
テキスト（text）モードより多くの機能があり、
それに応じてコードもより複雑です。
これらのモードの書き方を例示する
`<TT>lisp-mode.el</TT>'からの抜粋をあげておきます。
<P>

<A NAME="IDX1403"></A>
<A NAME="IDX1404"></A>
<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>;; モード固有の構文テーブルを作成する
(defvar lisp-mode-syntax-table nil "")  
(defvar emacs-lisp-mode-syntax-table nil "")
(defvar lisp-mode-abbrev-table nil "")

(if (not emacs-lisp-mode-syntax-table) ; 構文テーブルが既存ならば
                                       ;   変更しない
    (let ((i 0))
      (setq emacs-lisp-mode-syntax-table (make-syntax-table))

      ;; 0までの文字に、単語構成文字ではないが
      ;; シンボル名構成文字であるクラスを設定する
      ;; (文字0は、ASCII文字集合では<CODE>48</CODE>)
      (while (&#60; i ?0) 
        (modify-syntax-entry i "_   " emacs-lisp-mode-syntax-table)
        (setq i (1+ i)))
      <small>...</small>
      ;; 他の文字の構文を設定する
      (modify-syntax-entry ?  "    " emacs-lisp-mode-syntax-table)
      (modify-syntax-entry ?\t "    " emacs-lisp-mode-syntax-table)
      <small>...</small>
      (modify-syntax-entry ?\( "()  " emacs-lisp-mode-syntax-table)
      (modify-syntax-entry ?\) ")(  " emacs-lisp-mode-syntax-table)
      <small>...</small>))
;; lispモード向けの略語表を作る
(define-abbrev-table 'lisp-mode-abbrev-table ())
</FONT></pre></td></tr></table><P>

3つのlispモードは多くのコードを共有しています。
つぎの関数はさまざまな変数に設定します。
lispモードの各メジャーモード関数が呼び出します。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(defun lisp-mode-variables (lisp-syntax)
  (cond (lisp-syntax
	  (set-syntax-table lisp-mode-syntax-table)))
  (setq local-abbrev-table lisp-mode-abbrev-table)
  <small>...</small>
</FONT></pre></td></tr></table><P>

<CODE>forward-paragraph</CODE>などの関数は、
変数<CODE>paragraph-start</CODE>の値を使います。
Lispのコードは普通のテキストとは異なるので、
Lispを扱えるように変数<CODE>paragraph-start</CODE>を特別に設定する必要があります。
また、Lispではコメントの字下げは特殊な形なので、
各lispモードには独自のモード固有の<CODE>comment-indent-function</CODE>が必要です。
これらの変数に設定するコードが、
<CODE>lisp-mode-variables</CODE>の残りの部分です。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>  (make-local-variable 'paragraph-start)
  (setq paragraph-start (concat page-delimiter "\\|$" ))
  (make-local-variable 'paragraph-separate)
  (setq paragraph-separate paragraph-start)
  <small>...</small>
  (make-local-variable 'comment-indent-function)
  (setq comment-indent-function 'lisp-comment-indent))
</FONT></pre></td></tr></table><P>

各lispモードでは、キーマップが多少異なります。
たとえば、lispモードでは<KBD>C-c C-z</KBD>を<CODE>run-lisp</CODE>にバインドしますが、
他のlispモードではそうしません。
つぎのコードは、共通するコマンドを設定します。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(defvar shared-lisp-mode-map ()
  "Keymap for commands shared by all sorts of Lisp modes.")

(if shared-lisp-mode-map
    ()
   (setq shared-lisp-mode-map (make-sparse-keymap))
   (define-key shared-lisp-mode-map "\e\C-q" 'indent-sexp)
   (define-key shared-lisp-mode-map "\177"
               'backward-delete-char-untabify))
</FONT></pre></td></tr></table><P>

つぎはlispモード向けのキーマップを設定するコードです。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(defvar lisp-mode-map ()
  "Keymap for ordinary Lisp mode<small>....</small>")

(if lisp-mode-map
    ()
  (setq lisp-mode-map (make-sparse-keymap))
  (set-keymap-parent lisp-mode-map shared-lisp-mode-map)
  (define-key lisp-mode-map "\e\C-x" 'lisp-eval-defun)
  (define-key lisp-mode-map "\C-c\C-z" 'run-lisp))
</FONT></pre></td></tr></table><P>

最後に、emacs-lispモードのメジャーモード関数の完全な定義を示します。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(defun lisp-mode ()
  "Major mode for editing Lisp code for Lisps other than GNU Emacs Lisp.
Commands:
Delete converts tabs to spaces as it moves back.
Blank lines separate paragraphs.  Semicolons start comments.
\\{lisp-mode-map}
Note that `run-lisp' may be used either to start an inferior Lisp job
or to switch back to an existing one.

Entry to this mode calls the value of `lisp-mode-hook'
if that value is non-nil."
  (interactive)
  (kill-all-local-variables)
  (use-local-map lisp-mode-map)          ; モードのキーマップを選択する
  (setq major-mode 'lisp-mode)           ; これにより<CODE>describe-mode</CODE>は
                                         ; 説明文を探し出せる
  (setq mode-name "Lisp")                ; モード行に表示される
  (lisp-mode-variables t)                ; さまざまな変数を定義する
  (setq imenu-case-fold-search t)
  (set-syntax-table lisp-mode-syntax-table)
  (run-hooks 'lisp-mode-hook))           ; フックによるモードの
                                         ; カスタマイズをユーザーに許す
</FONT></pre></td></tr></table><P>

<A NAME="Auto Major Mode"></A>
<HR SIZE="6">
<br><A NAME="SEC343"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC342"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC344"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Auto Major Mode"></A>
<H3> 22.1.3 メジャーモードの選択方法 </H3>
<!--docid::SEC343::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Auto%20Major%20Mode">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Auto%20Major%20Mode</a>"<br>
"texi/elisp21/メジャーモードの選択方法"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%E1%A5%B8%A5%E3%A1%BC%A5%E2%A1%BC%A5%C9%A4%CE%C1%AA%C2%F2%CA%FD%CB%A1">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

Emacsは、ファイル名やファイル自体の情報をもとに、
当該ファイルを訪問するときの新しいバッファに対する
メジャーモードを自動的に選択します。
また、ファイル内のテキストで指定されたローカル変数も処理します。
<P>

<A NAME="IDX1405"></A>
<DL>
<DT><U>コマンド:</U> <B>fundamental-mode</B>
<DD>基本（fundamental）モードは、特化してないメジャーモードである。
他のメジャーモードは、実質的には、このモードとの対比で定義されている。
つまり、基本（fundamental）モードから始めて、
それらのメジャーモードではなにを変更するかを定義している。
関数<CODE>fundamental-mode</CODE>はフックを実行<EM>しない</EM>ため、
読者はカスタマイズできない。
（Emacsの基本（fundamental）モードのふるまいを変えたければ、
Emacsの<EM>大局的な</EM>状態を変える必要がある。）
</DL>
<P>

<A NAME="IDX1406"></A>
<DL>
<DT><U>コマンド:</U> <B>normal-mode</B> <I>&#38;optional find-file</I>
<DD>この関数は、カレントバッファに対して
適切なメジャーモードとバッファローカルな変数を確立する。
この関数はまず<CODE>set-auto-mode</CODE>を呼び出し、
続いて、ファイルのローカル変数を必要に応じて解析、束縛、評価するために
<CODE>hack-local-variables</CODE>を実行する。
<P>

<CODE>normal-mode</CODE>に対する引数<VAR>find-file</VAR>が<CODE>nil</CODE>以外であると、
<CODE>normal-mode</CODE>は<CODE>find-file</CODE>から呼び出されたと仮定する。
その場合、ファイルの末尾や`<SAMP>-*-</SAMP>'の形式の行にある
ローカル変数リストを処理することもある。
変数<CODE>enable-local-variables</CODE>は、この処理を行うかどうかを制御する。
ファイル内でのローカル変数リストの構文については、
See <a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=emacs21&node=File%20Variables">GNU Emacs マニュアル</a>。
<P>

読者が対話的に<CODE>normal-mode</CODE>を実行すると
引数<VAR>find-file</VAR>は通常<CODE>nil</CODE>である。
その場合、<CODE>normal-mode</CODE>は、ローカル変数リストを無条件に処理する。
<P>

<A NAME="IDX1407"></A>
<CODE>normal-mode</CODE>は、メジャーモード関数を呼び出す周りでは
<CODE>condition-case</CODE>を使うので、エラーを補足して
`<SAMP>File mode specification error</SAMP>'にもとのエラーメッセージを続けて
エラーを報告する。
</DL>
<P>

<A NAME="IDX1408"></A>
<DL>
<DT><U>User Option:</U> <B>enable-local-variables</B>
<DD>この変数は、訪問したファイル内のローカル変数リストを処理するかどうかを
制御する。
値<CODE>t</CODE>は、ローカル変数リストを無条件に処理することを意味する。
<CODE>nil</CODE>は、それらを無視することを意味する。
それ以外の値であると、各ファイルごとにユーザーに問い合わせる。
デフォルト値は<CODE>t</CODE>である。
</DL>
<P>

<A NAME="IDX1409"></A>
<DL>
<DT><U>Variable:</U> <B>ignored-local-variables</B>
<DD>この変数は、ファイルのローカル変数リストで設定してはならない
変数のリストを保持する。
それらの変数に対して指定した値は無視される。
</DL>
<P>

このリストに加えて、
属性<CODE>risky-local-variable</CODE>が<CODE>nil</CODE>以外の値である変数も無視されます。
<P>

<A NAME="IDX1410"></A>
<DL>
<DT><U>User Option:</U> <B>enable-local-eval</B>
<DD>この変数は、訪問したファイル内のローカル変数リストの`<SAMP>Eval:</SAMP>'を
処理するかどうかを制御する。
値<CODE>t</CODE>は、それらを無条件に処理することを意味する。
<CODE>nil</CODE>は、それらを無視することを意味する。
それ以外の値であると、各ファイルごとにユーザーに問い合わせる。
デフォルト値は<CODE>maybe</CODE>である。
</DL>
<P>

<A NAME="IDX1411"></A>
<DL>
<DT><U>Function:</U> <B>set-auto-mode</B>
<DD><A NAME="IDX1412"></A>
<A NAME="IDX1413"></A>
この関数は、カレントバッファに対して適切なメジャーモードを選択する。
`<SAMP>-*-</SAMP>'行の値、
（<CODE>auto-mode-alist</CODE>を使って）訪問したファイルの名前、
（<CODE>interpreter-mode-alist</CODE>を使って）`<SAMP>#!</SAMP>'行、
ファイルのローカル変数リストをもとに決定する。
しかし、この関数はファイルの末尾付近にある
ローカル変数`<SAMP>mode:</SAMP>'は調べないが、
関数<CODE>hack-local-variables</CODE>は調べる。
See <a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=emacs21&node=Choosing%20Modes">GNU Emacs マニュアル</a>。
</DL>
<P>

<A NAME="IDX1414"></A>
<DL>
<DT><U>User Option:</U> <B>default-major-mode</B>
<DD>この変数は、新たなバッファに対するデフォルトのメジャーモードを保持する。
標準値は<CODE>fundamental-mode</CODE>である。
<P>

<CODE>default-major-mode</CODE>の値が<CODE>nil</CODE>であると、
Emacsは（以前の）カレントバッファのメジャーモードを
新たなバッファのメジャーモードとする。
しかし、メジャーモードコマンドのシンボルの属性<CODE>mode-class</CODE>の
値が<CODE>special</CODE>であると、新たなバッファのメジャーモードにはせず、
かわりに基本（fundamental）モードを使う。
この属性を持つモードは、
特別に準備したテキストに対してのみ有用であるdiredやrmailなどである。
</DL>
<P>

<A NAME="IDX1415"></A>
<DL>
<DT><U>Function:</U> <B>set-buffer-major-mode</B> <I>buffer</I>
<DD>この関数はバッファ<VAR>buffer</VAR>のメジャーモードを
<CODE>default-major-mode</CODE>の値とする。
この変数が<CODE>nil</CODE>であると、
（適切ならば）カレントバッファのメジャーモードを使う。
<P>

バッファを作成する低レベルの基本関数ではこの関数を使わないが、
<CODE>switch-to-buffer</CODE>や<CODE>find-file-noselect</CODE>などの
中レベルのコマンドではバッファを作成するときにこのコマンドを使う。
</DL>
<P>

<A NAME="IDX1416"></A>
<DL>
<DT><U>Variable:</U> <B>initial-major-mode</B>
<DD><A NAME="IDX1417"></A>
この変数の値は、最初のバッファ`<SAMP>*scratch*</SAMP>'のメジャーモードを決定する。
値は、メジャーモードコマンドのシンボルであること。
デフォルト値は、<CODE>lisp-interaction-mode</CODE>である。
</DL>
<P>

<A NAME="IDX1418"></A>
<DL>
<DT><U>Variable:</U> <B>auto-mode-alist</B>
<DD>この変数は、ファイル名のパターン（正規表現、see 節 <A HREF="elisp_34.html#SEC551">33.2 正規表現</A>）と
対応するメジャーモードの連想リストを保持する。
通常、ファイル名パターンでは`<SAMP>.el</SAMP>'や`<SAMP>.c</SAMP>'などの接尾辞を調べるが、
そうでなくてもよい。
連想リストの通常の要素は
<CODE>(<VAR>regexp</VAR> . <VAR>mode-function</VAR>)</CODE>の形である。
<P>

たとえばつぎのとおり。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(("\\`/tmp/fol/" . text-mode)
 ("\\.texinfo\\'" . texinfo-mode)
 ("\\.texi\\'" . texinfo-mode)
 ("\\.el\\'" . emacs-lisp-mode)
 ("\\.c\\'" . c-mode) 
 ("\\.h\\'" . c-mode)
 <small>...</small>)
</FONT></pre></td></tr></table><P>

展開したファイル名（see 節 <A HREF="elisp_25.html#SEC387">24.8.4 ファイル名を展開する関数</A>）が<VAR>regexp</VAR>に一致する
ファイルを訪問すると、
<CODE>set-auto-mode</CODE>は対応する<VAR>mode-function</VAR>を呼び出す。
この機能により、Emacsはほとんどのファイルに対して
適切なメジャーモードを選択する。
<P>

<CODE>auto-mode-alist</CODE>の要素が<CODE>(<VAR>regexp</VAR> <VAR>function</VAR> t)</CODE>の
形であると、<VAR>function</VAR>を呼び出したあとで、
Emacsはファイル名のそれまで一致しなかった部分について<CODE>auto-mode-alist</CODE>を
再度探索する。
この機能は解凍パッケージには有用である。
<CODE>("\\.gz\\'" <VAR>function</VAR> t)</CODE>の形の要素で、
ファイルを解凍し、`<SAMP>.gz</SAMP>'を除いたファイル名に従って
解凍済みファイルを適切なモードにできる。
<P>

<CODE>auto-mode-alist</CODE>にいくつかのパターン対を追加する方法を示す。
（この種の式を読者のファイル`<TT>.emacs</TT>'に使える。）
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(setq auto-mode-alist
  (append 
   ;; ドットで始まる（ディレクトリ名付きの）ファイル名
   '(("/\\.[^/]*\\'" . fundamental-mode)  
     ;; ドットのないファイル名
     ("[^\\./]*\\'" . fundamental-mode)   
     ;; `<SAMP>.C</SAMP>'で終るファイル名
     ("\\.C\\'" . c++-mode))
   auto-mode-alist))
</FONT></pre></td></tr></table></DL>
<P>

<A NAME="IDX1419"></A>
<DL>
<DT><U>Variable:</U> <B>interpreter-mode-alist</B>
<DD>この変数は、`<SAMP>#!</SAMP>'行でコマンドインタープリタを指定している
スクリプトに対して用いるメジャーモードを指定する。
この値は、<CODE>(<VAR>interpreter</VAR> . <VAR>mode</VAR>)</CODE>の形の要素から成る
リストであること。
たとえば、デフォルトには<CODE>("perl" . perl-mode)</CODE>の要素がある。
各要素は、ファイルが指定するインタープリタが<VAR>interpreter</VAR>に
一致したらモード<VAR>mode</VAR>を使うことを意味する。
<VAR>interpreter</VAR>の値は、実際には正規表現である。
<P>

<CODE>auto-mode-alist</CODE>が使用すべきメジャーモードが
指定しなかった場合にのみこの変数を使う。
</DL>
<P>

<A NAME="IDX1420"></A>
<DL>
<DT><U>Function:</U> <B>hack-local-variables</B> <I>&#38;optional force</I>
<DD>この関数は、カレントバッファの内容に指定されたローカル変数を
必要に応じて、解析、束縛、評価する。
<P>

<CODE>normal-mode</CODE>で述べた<CODE>enable-local-variables</CODE>の処理は、
実際にはここで行う。
引数<VAR>force</VAR>は、通常、
<CODE>normal-mode</CODE>に与えられた引数<VAR>find-file</VAR>からくる。
</DL>
<P>

<A NAME="Mode Help"></A>
<HR SIZE="6">
<br><A NAME="SEC344"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC343"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC345"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Mode Help"></A>
<H3> 22.1.4 メジャーモードに関するヘルプ </H3>
<!--docid::SEC344::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Mode%20Help">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Mode%20Help</a>"<br>
"texi/elisp21/メジャーモードに関するヘルプ"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%E1%A5%B8%A5%E3%A1%BC%A5%E2%A1%BC%A5%C9%A4%CB%B4%D8%A4%B9%A4%EB%A5%D8%A5%EB%A5%D7">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1421"></A>
<A NAME="IDX1422"></A>
<A NAME="IDX1423"></A>
<A NAME="IDX1424"></A>
<A NAME="IDX1425"></A>
<P>

関数<CODE>describe-mode</CODE>は、メジャーモードに関する情報を
得るために使います。
通常、<KBD>C-h m</KBD>で呼び出されます。
関数<CODE>describe-mode</CODE>は<CODE>major-mode</CODE>の値を使いますが、
そのために各メジャーモード関数が
変数<CODE>major-mode</CODE>に設定する必要があるのです。
<P>

<A NAME="IDX1426"></A>
<DL>
<DT><U>コマンド:</U> <B>describe-mode</B>
<DD>この関数は、現在のメジャーモードの説明文を表示する。
<P>

関数<CODE>describe-mode</CODE>は、<CODE>major-mode</CODE>の値を引数として
関数<CODE>documentation</CODE>を呼び出す。
そうして、メジャーモード関数の説明文字列を表示する。
（see 節 <A HREF="elisp_24.html#SEC365">23.2 説明文字列の参照</A>。）
</DL>
<P>

<A NAME="IDX1427"></A>
<DL>
<DT><U>Variable:</U> <B>major-mode</B>
<DD>この変数は、カレントバッファのメジャーモードに対するシンボルを保持する。
このシンボルは、当該メジャーモードに切り替えるためのコマンドを
関数定義として持つこと。
関数<CODE>describe-mode</CODE>は、
メジャーモードの説明文として当該関数の説明文字列を使う。
</DL>
<P>

<A NAME="Derived Modes"></A>
<HR SIZE="6">
<br><A NAME="SEC345"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC344"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC346"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Derived Modes"></A>
<H3> 22.1.5 派生モードの定義 </H3>
<!--docid::SEC345::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Derived%20Modes">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Derived%20Modes</a>"<br>
"texi/elisp21/派生モードの定義"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%C7%C9%C0%B8%A5%E2%A1%BC%A5%C9%A4%CE%C4%EA%B5%C1">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

既存のメジャーモードを用いて新たなメジャーモードを定義できると便利です。
これを行う簡単な方法は<CODE>define-derived-mode</CODE>を使うことです。
<P>

<A NAME="IDX1428"></A>
<DL>
<DT><U>Macro:</U> <B>define-derived-mode</B> <I>variant parent name docstring body<small>...</small></I>
<DD>これは、<VAR>name</VAR>をモード名を表す文字列として使って
<VAR>variant</VAR>をメジャーモードコマンドとして定義する。
<P>

新たなコマンド<VAR>variant</VAR>は、関数<VAR>parent</VAR>を呼び出してから
親モードの特定の機能を無効にするように定義される。
<P>

<UL>
<LI>
新たなモードは、<CODE><VAR>variant</VAR>-map</CODE>という名前の
独自のキーマップを持つ。
<CODE>define-derived-mode</CODE>は、
このキーマップが定義済みでなければ、
<CODE><VAR>parent</VAR>-map</CODE>から継承するようにこのキーマップを初期化する。
<P>

<LI>
新たなモードでは、変数に<CODE><VAR>variant</VAR>-syntax-table</CODE>に
独自の構文テーブルを保持する。
この変数が定義済みでなければ、
<CODE><VAR>parent</VAR>-syntax-table</CODE>をコピーしてこの変数を初期化する。
<P>

<LI>
新たなモードでは、変数に<CODE><VAR>variant</VAR>-abbrev-table</CODE>に
独自の略語表を保持する。
この変数が定義済みでなければ、
<CODE><VAR>parent</VAR>-abbrev-table</CODE>をコピーしてこの変数を初期化する。
<P>

<LI>
新たなモードには独自のモードフック<CODE><VAR>variant</VAR>-hook</CODE>があり、
通常どおり最後にこれを実行する。
（新たなモードでは、<VAR>parent</VAR>を呼び出すことの一部として
<VAR>parent</VAR>のモードフックも実行する。）
</UL>
<P>

さらに、<VAR>body</VAR>で<VAR>parent</VAR>の他の部分を無効にする方法を指定できる。
コマンド<VAR>variant</VAR>は、<CODE><VAR>variant</VAR>-hook</CODE>を呼び出す直前、
通常の無効化処理を終えてから<VAR>body</VAR>のフォームを評価する。
<P>

引数<VAR>docstring</VAR>は、新たなモードに対する説明文字列を指定する。
<VAR>docstring</VAR>を省略すると、
<CODE>define-derived-mode</CODE>は説明文字列を生成する。
<P>

仮想的な例を示す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(define-derived-mode hypertext-mode
  text-mode "Hypertext"
  "Major mode for hypertext.
\\{hypertext-mode-map}"
  (setq case-fold-search nil))

(define-key hypertext-mode-map
  [down-mouse-3] 'do-hyper-link)
</pre></td></tr></table></DL>
<P>

<A NAME="Minor Modes"></A>
<HR SIZE="6">
<br><A NAME="SEC346"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC345"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC347"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Minor Modes"></A>
<H2> 22.2 マイナモード </H2>
<!--docid::SEC346::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Minor%20Modes">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Minor%20Modes</a>"<br>
"texi/elisp21/マイナモード"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%DE%A5%A4%A5%CA%A5%E2%A1%BC%A5%C9">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1429"></A>
<P>

<EM>マイナモード</EM>（minor mode）は、メジャーモードの選択とは独立に
ユーザーがオン／オフできる機能を提供します。
マイナモードは、個別にも組み合わせてもオンにできます。
マイナモードは、長すぎますが『汎用的に使えるオプション機能のモード』と
命名したようがよいかもしれません。
<P>

マイナモードは、普通、1つのメジャーモードを変更するだけではありません。
たとえば、自動詰め込みモード（auto-fillモード）は、
テキスト挿入を許す任意のメジャーモードで使えます。
汎用的であるためには、マイナモードは
メジャーモードが行うこととは実質的に独立である必要があります。
<P>

マイナモードは、メジャーモードに比べて、実装するのがしばしば困難です。
1つの理由は、任意の順でマイナモードをオン／オフできるようにする
必要があるからです。
マイナモードは、メジャーモードや他のオンになっているマイナモードとは
無関係にその望みの効果を発揮できる必要があります。
<P>

しばしば、マイナモードを実装するうえでもっとも大きな問題は、
Emacsの残りの部分に対して必要なフックを探すことです。
マイナモードキーマップにより、従来に比べて簡単になります。
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC347">22.2.1 マイナモードを書くための慣習</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Tips for writing a minor mode.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC348">22.2.2 キーマップとマイナモード</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How a minor mode can have its own keymap.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC349">22.2.3 Easy-Mmode</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">A convenient facility for defining minor modes.</TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Minor Mode Conventions"></A>
<HR SIZE="6">
<br><A NAME="SEC347"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC346"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC348"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Minor Mode Conventions"></A>
<H3> 22.2.1 マイナモードを書くための慣習 </H3>
<!--docid::SEC347::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Minor%20Mode%20Conventions">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Minor%20Mode%20Conventions</a>"<br>
"texi/elisp21/マイナモードを書くための慣習"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%DE%A5%A4%A5%CA%A5%E2%A1%BC%A5%C9%A4%F2%BD%F1%A4%AF%A4%BF%A4%E1%A4%CE%B4%B7%BD%AC">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1430"></A>
<A NAME="IDX1431"></A>
<P>

メジャーモードに対するのと同じように、
マイナモードを書くうえでの慣習があります。
メジャーモードの慣習には、マイナモードにも適用されるものがあります。
つまり、モードを初期化する関数の名前、
グローバルシンボルの名前、キーマップやその他のテーブルや表の使い方です。
<P>

それらに加えて、マイナモードに固有な慣習もあります。
<P>

<UL>
<LI>
<A NAME="IDX1432"></A>
マイナモードを制御する変数の名前は`<SAMP>-mode</SAMP>'で終ること。
これを<EM>モード変数</EM>（mode variable）と呼ぶ。
マイナモードコマンドは、この変数を
（オフにするには<CODE>nil</CODE>、オンにするにはそれ以外に）設定
すること。
<P>

可能ならば、変数に設定すると
自動的にモードがオン／オフされるようにモードを実装する。
そうすると、マイナモードコマンドは、
変数に設定する以外にはなにもしないでよくなる。
<P>

この変数は、モード行にマイナモード名を表示するために
<CODE>minor-mode-alist</CODE>でも使われる。
マイナモードキーマップを活性にしたり非活性にしたりもする。
各コマンドやフックもこの変数の値を検査する。
<P>

各バッファごとに別々にマイナモードをオンにしたい場合には、
この変数をバッファローカルにする。
<P>

<LI>
モード変数と同じ名前のコマンドを定義する。
その仕事は、当該変数に設定することでモードをオン／オフすることである。
<P>

当該コマンドは、省略可能な引数を1つ受け取ること。
引数が<CODE>nil</CODE>であればモードをトグル
（オンであればオフに、オフであればオンに）する。
さもなければ、引数が、正整数、<CODE>nil</CODE>以外のシンボル、
<CODE>-</CODE>、あるいは、CARがそのような整数やシンボルであるようなリストの
場合にはモードをオンにする。
それ以外ではモードをオフにする。
<P>

<CODE>transient-mark-mode</CODE>の定義から引用した例を示す。
モードのふるまいをオン／オフする変数としての
<CODE>transient-mark-mode</CODE>の使い方、
および、生の前置引数に基づいたマイナモードの
オン／オフ／トグルの仕方を示す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(setq transient-mark-mode
      (if (null arg) (not transient-mark-mode)
        (&#62; (prefix-numeric-value arg) 0)))
</FONT></pre></td></tr></table><P>

<LI>
モード行にマイナモードを表示したい場合には、
各マイナモードについて要素を<CODE>minor-mode-alist</CODE>に追加する
（see 節 <A HREF="elisp_23.html#SEC352">22.3.2 モード行に使われる変数</A>）。
この要素はつぎの形のリストであること。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(<VAR>mode-variable</VAR> <VAR>string</VAR>)
</FONT></pre></td></tr></table><P>

ここで、<VAR>mode-variable</VAR>はマイナモードのオン／オフを制御する変数であり、
<VAR>string</VAR>はモード行でモードを表す短い空白で始まる文字列である。
同時に複数のモードを表示できるように、これらの文字列は短いこと。
<P>

<CODE>minor-mode-alist</CODE>に要素を追加するときには、
重複を防ぐために既存の要素を検査する<CODE>assq</CODE>を使うこと。
たとえばつぎのとおり。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(or (assq 'leif-mode minor-mode-alist)
    (setq minor-mode-alist
          (cons '(leif-mode " Leif") minor-mode-alist)))
</FONT></pre></td></tr></table></UL>
<P>

このリストに要素を1回だけ追加するならば<CODE>add-to-list</CODE>も使えます
（see 節 <A HREF="elisp_11.html#SEC144">10.8 変数値の変更</A>）。
<P>

<A NAME="Keymaps and Minor Modes"></A>
<HR SIZE="6">
<br><A NAME="SEC348"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC347"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC349"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Keymaps and Minor Modes"></A>
<H3> 22.2.2 キーマップとマイナモード </H3>
<!--docid::SEC348::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Keymaps%20and%20Minor%20Modes">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Keymaps%20and%20Minor%20Modes</a>"<br>
"texi/elisp21/キーマップとマイナモード"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%AD%A1%BC%A5%DE%A5%C3%A5%D7%A4%C8%A5%DE%A5%A4%A5%CA%A5%E2%A1%BC%A5%C9">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

各マイナモードは、モードがオンのときに活性になる独自のキーマップを持てます。
マイナモード向けのキーマップを設定するには、
<CODE>minor-mode-map-alist</CODE>に要素を追加します。
See 節 <A HREF="elisp_22.html#SEC323">21.6 活性なキーマップ</A>。
<P>

<A NAME="IDX1433"></A>
マイナモードキーマップの1つの用途は、
ある種の自己挿入文字のふるまいを変更して、
自己挿入に加えてなにかを行わせるようにすることです。
一般に、<CODE>self-insert-command</CODE>をカスタマイズする機構は
（略語モードや自動詰め込みモード向けに設計された）特別な場合に限られるので、
このようなことを行う唯一の方法です。
（標準の<CODE>self-insert-command</CODE>の定義を読者独自の定義で置き換えないこと。
エディタコマンドループはこの関数を特別扱いしている。）
<P>

マイナモードでバインドしているキー列は、<KBD>C-c</KBD>で始まり、
<KBD>{</KBD>、<KBD>}</KBD>、<KBD>&#60;</KBD>、<KBD>&#62;</KBD>、<KBD>:</KBD>、<KBD>;</KBD><EM>以外</EM>の
句読点文字の1つが続くようにします。
（除外した句読点文字はメジャーモード向けに予約されている。）
<P>

<A NAME="Easy-Mmode"></A>
<HR SIZE="6">
<br><A NAME="SEC349"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC348"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC350"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Easy-Mmode"></A>
<H3> 22.2.3 Easy-Mmode </H3>
<!--docid::SEC349::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Easy-Mmode">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Easy-Mmode</a>"<br>
"texi/elisp21/Easy-Mmode"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2FEasy%2DMmode">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

パッケージeasy-mmodeは、マイナモードを実装する便利な方法を提供します。
これを使うと、単純なマイナモードを1つの自己完結した定義に指定できます。
<P>

<A NAME="IDX1434"></A>
<DL>
<DT><U>Macro:</U> <B>easy-mmode-define-minor-mode</B> <I>mode doc &#38;optional init-value mode-indicator keymap</I>
<DD><A NAME="IDX1435"></A>
このマクロは、<VAR>mode</VAR>（シンボル）という名前の新しいマイナモードを定義する。
<P>

このマクロは、マイナモードをトグルする
<VAR>mode</VAR>という名前のコマンドを定義し、
その説明文字列を<VAR>doc</VAR>とする。
<P>

また、<VAR>mode</VAR>という名前の変数も定義する。
この変数はモードのオン／オフにしたがって<CODE>t</CODE>/<CODE>nil</CODE>に設定される。
この変数は<VAR>init-value</VAR>に初期化される。
<P>

文字列<VAR>mode-indicator</VAR>は、モードがオンのときにモード行に
表示される文字列である。
それが<CODE>nil</CODE>であるとモード行にはモードを表示しない。
<P>

省略可能な引数<VAR>keymap</VAR>は、マイナモードのキーマップを指定する。
これは、値がキーマップであるような変数の名前か、
つぎの形のバインディングを指定した連想リストであること。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(<VAR>key-sequence</VAR> . <VAR>definition</VAR>)
</pre></td></tr></table></DL>
<P>

<CODE>easy-mmode-define-minor-mode</CODE>を使った例を示します。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(easy-mmode-define-minor-mode hungry-mode
  "Toggle Hungry mode.
With no argument, this command toggles the mode. 
Non-null prefix argument turns on the mode.
Null prefix argument turns off the mode.

When Hungry mode is enabled, the control delete key
gobbles all preceding whitespace except the last.
See the command \\[hungry-electric-delete]."
 ;; 初期値
 nil
 ;; モード行への表示
 " Hungry"
 ;; マイナモードのバインディング
 '(("\C-\^?" . hungry-electric-delete)
   ("\C-\M-\^?"
    . (lambda () 
        (interactive)
        (hungry-electric-delete t)))))
</FONT></pre></td></tr></table><P>

これは、『hungryモード』という名前のマイナモードを定義します。
モードをトグルするコマンドの名前は<CODE>hungry-mode</CODE>、
モードのオン／オフを表す変数の名前は<CODE>hungry-mode</CODE>、
モードがオンのときに活性なキーマップを保持する
変数の名前は<CODE>hungry-mode-map</CODE>です。
<KBD>C-<KBD>DEL</KBD></KBD>と<KBD>C-M-<KBD>DEL</KBD></KBD>に対するキーバインディングで
キーマップを初期化します。
<P>

<A NAME="Mode Line Format"></A>
<HR SIZE="6">
<br><A NAME="SEC350"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC349"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC351"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Mode Line Format"></A>
<H2> 22.3 モード行の書式 </H2>
<!--docid::SEC350::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Mode%20Line%20Format">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Mode%20Line%20Format</a>"<br>
"texi/elisp21/モード行の書式"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%E2%A1%BC%A5%C9%B9%D4%A4%CE%BD%F1%BC%B0">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1436"></A>
<P>

Emacsの（ミニバッファ専用ウィンドウを除く）各ウィンドウにはモード行があって、
ウィンドウに表示しているバッファに関する状態情報を表示しています。
モード行には、バッファ名、対応するファイル、再帰編集の深さ、
メジャーモードとマイナモードなどのバッファに関する情報が含まれます。
<P>

本節では、モード行の内容の制御方法について述べます。
モード行に表示される情報のほとんどは
オンになっているメジャーモードとマイナモードに関係するので、
本章に含めます。
<P>

<CODE>mode-line-format</CODE>は、カレントバッファのモード行に表示する
雛型を保持しているバッファローカルな変数です。
同一バッファに対するすべてのウィンドウは同じ<CODE>mode-line-format</CODE>を使い、
それらのモード行は（スクロールの割合や行やコラム位置を除いて）
同じように表示されます。
<P>

ウィンドウのモード行は、通常、ウィンドウに別のバッファを表示したときや、
バッファの変更状態が<CODE>nil</CODE>から<CODE>t</CODE>へあるいはその逆の変化をしたときに
更新されます。
<CODE>mode-line-format</CODE>（see 節 <A HREF="elisp_23.html#SEC352">22.3.2 モード行に使われる変数</A>）が参照する
変数を修正したり、テキストの表示方法に影響するその他の変数やデータ構造
（see 節 <A HREF="elisp_38.html#SEC599">37. Emacsの画面表示</A>）を変更したときには、新しい情報を表示したり
新たな方法で表示するためにモード行の更新を強制できます。
<P>

<A NAME="IDX1437"></A>
<DL>
<DT><U>Function:</U> <B>force-mode-line-update</B>
<DD>カレントバッファのモード行の更新を強制する。
</DL>
<P>

モード行は、通常、反転表示されます。
<A HREF="elisp_38.html#SEC617">37.12 反転表示</A>の<CODE>mode-line-inverse-video</CODE>を参照してください。
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC351">22.3.1 モード行のデータ構造</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">The data structure that controls the mode line.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC352">22.3.2 モード行に使われる変数</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Variables used in that data structure.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC353">22.3.3 モード行の<CODE>%</CODE>記法</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Putting information into a mode line.</TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Mode Line Data"></A>
<HR SIZE="6">
<br><A NAME="SEC351"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC350"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC352"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Mode Line Data"></A>
<H3> 22.3.1 モード行のデータ構造 </H3>
<!--docid::SEC351::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Mode%20Line%20Data">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Mode%20Line%20Data</a>"<br>
"texi/elisp21/モード行のデータ構造"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%E2%A1%BC%A5%C9%B9%D4%A4%CE%A5%C7%A1%BC%A5%BF%B9%BD%C2%A4">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1438"></A>
<P>

モード行の内容は、バッファローカルな変数<CODE>mode-line-format</CODE>に
保持されたリスト、文字列、シンボル、数から成るデータ構造で制御されます。
このデータ構造を<EM>モード行構成</EM>（mode line construct）と呼びます。
これは単純なモード行構成から再帰的に構築します。
同じデータ構造はフレームタイトル（see 節 <A HREF="elisp_29.html#SEC442">28.4 フレームタイトル</A>）を
構築するためにも使われます。
<P>

<A NAME="IDX1439"></A>
<DL>
<DT><U>Variable:</U> <B>mode-line-format</B>
<DD>この変数の値は、モード行全体の書式に責任を持つモード行構成である。
この変数の値は、モード行のテキストを作るためにどの変数を使うか、
それらはモード行のどこに現れるかを制御する。
</DL>
<P>

モード行構成は、定まったテキストの文字列のように単純でもかまいませんが、
普通は、テキストを作るための別の変数の使い方を指定します。
それらの変数の多くはそれ自身、それらの値として
モード行構成を持つように定義されています。
<P>

<CODE>mode-line-format</CODE>のデフォルト値は、
<CODE>mode-name</CODE>や<CODE>minor-mode-alist</CODE>などの変数の値を使います。
多くの目的には、<CODE>mode-line-format</CODE>が参照するいくつかの変数を
変えるだけで十分です。
<P>

モード行構成は、リスト、シンボル、文字列のいずれかです。
その値がリストであれば、その各要素はリスト、シンボル、文字列のいずれかです。
<P>

<DL COMPACT>
<A NAME="IDX1440"></A>
<A NAME="IDX1441"></A>
<DT><CODE><VAR>string</VAR></CODE>
<DD>モード行構成としての文字列は、
<EM><CODE>%</CODE>記法</EM>を除いて、モード行にそのまま表示される。
`<SAMP>%</SAMP>'のうしろの10進数は、右側に空白を埋める
（つまりデータは左端に揃えられる）ときのフィールド幅を指定する。
see 節 <A HREF="elisp_23.html#SEC353">22.3.3 モード行の<CODE>%</CODE>記法</A>。
<P>

<DT><CODE><VAR>symbol</VAR></CODE>
<DD>モード行構成としてのシンボルは、その値を表す。
<VAR>symbol</VAR>の値は、<VAR>symbol</VAR>のかわりにモード行構成として使われる。
しかし、<CODE>t</CODE>や<CODE>nil</CODE>のシンボル、および、シンボルの値が空のものは
無視する。
<P>

例外が1つある：<CODE> </CODE>
<VAR>symbol</VAR>の値が文字列であると、<CODE>%</CODE>記法を処理せずに
文字列をそのまま表示する。
<P>

<DT><CODE>(<VAR>string</VAR> <VAR>rest</VAR><small>...</small>) or (<VAR>list</VAR> <VAR>rest</VAR><small>...</small>)</CODE>
<DD>最初の要素が文字列かリストであるリストは、
すべての要素を再帰的に処理し、結果を連結することを意味する。
これはもっとも多用されるモード行構成の形である。
<P>

<DT><CODE>(<VAR>symbol</VAR> <VAR>then</VAR> <VAR>else</VAR>)</CODE>
<DD>最初の要素がシンボルであるリストは条件節であり、
その意味は<VAR>symbol</VAR>の値に依存する。
その値が<CODE>nil</CODE>以外であると、
2番目の要素<VAR>then</VAR>をモード行構成として再帰的に処理する。
<VAR>symbol</VAR>の値が<CODE>nil</CODE>であると、
3番目の要素<VAR>else</VAR>をモード行構成として再帰的に処理する。
<VAR>else</VAR>は省略してもよいが、その場合、
<VAR>symbol</VAR>の値が<CODE>nil</CODE>であるところの要素はモード行に表示されない。
<P>

<DT><CODE>(<VAR>width</VAR> <VAR>rest</VAR><small>...</small>)</CODE>
<DD>最初の要素が整数であるリストは、
<VAR>rest</VAR>の結果の切り詰めや引き伸しを指定する。
残りの要素<VAR>rest</VAR>はモード行構成として再帰的に処理され連結される。
（<VAR>width</VAR>が正であれば）結果の右端に空白を追加したり、
（<VAR>width</VAR>が負であれば）結果を（-<VAR>width</VAR>幅に）
右端から切り詰める。
<P>

たとえば、ウィンドウの上端より上にバッファの何割があるかを表示するには、
<CODE>(-3 "%p")</CODE>のようなリストを使う。
</DL>
<P>

読者が<CODE>mode-line-format</CODE>自体を変更するときには、
新しい値では、デフォルト値（see 節 <A HREF="elisp_23.html#SEC352">22.3.2 モード行に使われる変数</A>）に現れる
ものと同じ変数を使い、それらの値をコピーして使ったり、
別の書式で情報を表示したりしないでください。
こうしておけば、それらの変数に対する変更を介した
ユーザーや（<CODE>display-time</CODE>やメジャーモードなどの）Lispプログラムが行った
カスタマイズが効果を発揮できます。
<P>

<A NAME="IDX1442"></A>
<A NAME="IDX1443"></A>
ホスト名やデフォルトディレクトリを含んだ
<CODE>shell-mode</CODE>に有用な<CODE>mode-line-format</CODE>の例を示します。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(setq mode-line-format
  (list "-"
   'mode-line-mule-info
   'mode-line-modified
   'mode-line-frame-identification
   "%b--" 
   ;; リストを作るときに評価されることに注意
   ;; 単なる文字列のモード行構成を作る
   (getenv "HOST")
   ":" 
   'default-directory
   "   "
   'global-mode-string
   "   %[("
   'mode-name 
   'mode-line-process  
   'minor-mode-alist 
   "%n" 
   ")%]--"
   '(which-func-mode ("" which-func-format "--"))
   '(line-number-mode "L%l--")
   '(column-number-mode "C%c--")
   '(-3 . "%p")
   "-%-"))
</pre></td></tr></table><P>

（変数<CODE>line-number-mode</CODE>、<CODE>column-number-mode</CODE>、
<CODE>which-func-mode</CODE>は特定のマイナモードをオンにする。
通常どおり、これらの変数の名前はマイナモードコマンドの名前でもある。）
<P>

<A NAME="Mode Line Variables"></A>
<HR SIZE="6">
<br><A NAME="SEC352"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC351"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC353"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Mode Line Variables"></A>
<H3> 22.3.2 モード行に使われる変数 </H3>
<!--docid::SEC352::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Mode%20Line%20Variables">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Mode%20Line%20Variables</a>"<br>
"texi/elisp21/モード行に使われる変数"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%E2%A1%BC%A5%C9%B9%D4%A4%CB%BB%C8%A4%EF%A4%EC%A4%EB%CA%D1%BF%F4">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

本節では、<CODE>mode-line-format</CODE>の標準値でモード行のテキストに
含められる変数について述べます。
これらの変数に関しては、本来特別なことはありません。
別の変数を使うように<CODE>mode-line-format</CODE>を変更すれば、
別の変数でもモード行において同じ効果を発揮します。
<P>

<A NAME="IDX1444"></A>
<DL>
<DT><U>Variable:</U> <B>mode-line-mule-info</B>
<DD><A NAME="IDX1445"></A>
この変数は、言語環境、バッファのコーディングシステム、
現在の入力方式に関する情報を表示するモード行構成の値を保持する。
see 節 <A HREF="elisp_33.html#SEC528">32. 非ASCII文字</A>。
</DL>
<P>

<A NAME="IDX1446"></A>
<DL>
<DT><U>Variable:</U> <B>mode-line-modified</B>
<DD>この変数は、カレントバッファが変更されたかどうかを表示する
モード行構成の値を保持する。
<P>

<CODE>mode-line-modified</CODE>のデフォルト値は<CODE>("%1*%1+")</CODE>である。
これは、バッファが変更されていると`<SAMP>**</SAMP>'を、
未変更ならば`<SAMP>--</SAMP>'を、読み出し専用ならば`<SAMP>%%</SAMP>'を、
読み出し専用でしかも変更されていれば`<SAMP>%*</SAMP>'を
モード行に表示することを意味する。
<P>

この変数を変更してもモード行の更新を強制しない。
</DL>
<P>

<A NAME="IDX1447"></A>
<DL>
<DT><U>Variable:</U> <B>mode-line-frame-identification</B>
<DD><A NAME="IDX1448"></A>
この変数はカレントフレームを識別する。
複数のフレームを表示できるウィンドウシステムを使用している場合には
デフォルト値は<CODE>" "</CODE>であり、
ある時点で1つのフレームしか表示できない普通の端末を使用している場合には
<CODE>"-%F "</CODE>である。
</DL>
<P>

<A NAME="IDX1449"></A>
<DL>
<DT><U>Variable:</U> <B>mode-line-buffer-identification</B>
<DD>この変数はウィンドウに表示しているバッファを識別する。
デフォルト値は<CODE>("%12b")</CODE>であり、
空白で埋めて最低12コラムでバッファ名を表示する。
</DL>
<P>

<A NAME="IDX1450"></A>
<DL>
<DT><U>Variable:</U> <B>global-mode-string</B>
<DD>この変数は、デフォルトでモード行のバッファ名の直後に現れる
モード行指定を保持する。
コマンド<CODE>display-time</CODE>は、
<CODE>global-mode-string</CODE>が時刻と負荷情報を含んだ
変数<CODE>display-time-string</CODE>を参照するように設定する。
<P>

`<SAMP>%M</SAMP>'記法は<CODE>global-mode-string</CODE>の値を使うが、
この変数は<CODE>mode-line-format</CODE>でモード行に含まれるため
`<SAMP>%M</SAMP>'は廃れた記法である。
</DL>
<P>

<A NAME="IDX1451"></A>
<DL>
<DT><U>Variable:</U> <B>mode-name</B>
<DD>このバッファローカルな変数は、
カレントバッファのメジャーモードの『愛称』を保持する。
各メジャーモードは、モード行にモード名が現れるようにこの変数に設定すること。
</DL>
<P>

<A NAME="IDX1452"></A>
<DL>
<DT><U>Variable:</U> <B>minor-mode-alist</B>
<DD>この変数は、モード行にマイナモードがオンであることを表示する方法を
指定する要素からなる連想リストを保持する。
<CODE>minor-mode-alist</CODE>の各要素は、2要素リストであること。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(<VAR>minor-mode-variable</VAR> <VAR>mode-line-string</VAR>)
</pre></td></tr></table><P>

より一般的には、<VAR>mode-line-string</VAR>はどのようなモード行指定でもよい。
それは、<VAR>minor-mode-variable</VAR>の値が<CODE>nil</CODE>以外のときに
モード行に現れ、さもなければ現れない。
これらの文字列は、繋がらないように空白で始まること。
慣習的には、特定モードに対する<VAR>minor-mode-variable</VAR>は、
当該マイナモードがオンであると<CODE>nil</CODE>以外に設定される。
<P>

<CODE>minor-mode-alist</CODE>のデフォルト値はつぎのとおり。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>minor-mode-alist
=> ((vc-mode vc-mode)
    (abbrev-mode " Abbrev") 
    (overwrite-mode overwrite-mode) 
    (auto-fill-function " Fill")         
    (defining-kbd-macro " Def")
    (isearch-mode isearch-mode))
</pre></td></tr></table><P>

<CODE>minor-mode-alist</CODE>自体はバッファローカルではない。
マイナモードが各バッファごとにオンにできる場合には、
連想リストに指定した対応する各変数はバッファローカルであること。
</DL>
<P>

<A NAME="IDX1453"></A>
<DL>
<DT><U>Variable:</U> <B>mode-line-process</B>
<DD>このバッファローカルな変数は、
サブプロセスとの通信用に使われているモードの処理状態に関する
モード行の情報を保持する。
メジャーモード名の直後に空白で区切らずに表示される。
たとえば、バッファ`<SAMP>*shell*</SAMP>'におけるこの変数の値は<CODE>(":%s")</CODE>であり、
シェルがその状態をメジャーモードとともに`<SAMP>(Shell: run)</SAMP>'のように
表示できる。
通常、この変数は<CODE>nil</CODE>である。
</DL>
<P>

<A NAME="IDX1454"></A>
<DL>
<DT><U>Variable:</U> <B>default-mode-line-format</B>
<DD>この変数は、<CODE>mode-line-format</CODE>を変更していないバッファの
デフォルトの<CODE>mode-line-format</CODE>の値を保持する。
これは<CODE>(default-value 'mode-line-format)</CODE>と同じである。
<P>

<CODE>default-mode-line-format</CODE>のデフォルト値はつぎのリストである。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>("-"
 mode-line-mule-info
 mode-line-modified
 mode-line-frame-identification
 mode-line-buffer-identification
 "   "
 global-mode-string
 "   %[("
 mode-name 
 mode-line-process
 minor-mode-alist 
 "%n" 
 ")%]--"
 (which-func-mode ("" which-func-format "--"))
 (line-number-mode "L%l--")
 (column-number-mode "C%c--")
 (-3 . "%p")
 "-%-")
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1455"></A>
<DL>
<DT><U>Variable:</U> <B>vc-mode</B>
<DD>各バッファにおいてバッファローカルな変数<CODE>vc-mode</CODE>は、
バッファで訪問したファイルが版管理されているか、
そうならばその方式を記録している。
版管理されていない場合はその値は<CODE>nil</CODE>、
さもなければモード行に表示される文字列である。
</DL>
<P>

<A NAME="%-Constructs"></A>
<HR SIZE="6">
<br><A NAME="SEC353"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC352"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC354"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="%-Constructs"></A>
<H3> 22.3.3 モード行の<CODE>%</CODE>記法 </H3>
<!--docid::SEC353::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=%-Constructs">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=%-Constructs</a>"<br>
"texi/elisp21/モード行の<CODE>%</CODE>記法"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%E2%A1%BC%A5%C9%B9%D4%A4%CE%3CCODE%3E%25%3C%2FCODE%3E%B5%AD%CB%A1">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

以下は、認識される<CODE>%</CODE>記法とその意味の表です。
`<SAMP>%%</SAMP>'以外の記法では、
最大表示文字数を指定する10進数を`<SAMP>%</SAMP>'のあとに追加できます。
<P>

<DL COMPACT>
<DT><CODE>%b</CODE>
<DD>関数<CODE>buffer-name</CODE>で得られたカレントバッファ名。
see 節 <A HREF="elisp_27.html#SEC406">26.3 バッファ名 <EM>(2003/10/30)</EM></A>。
<P>

<DT><CODE>%f</CODE>
<DD>関数<CODE>buffer-file-name</CODE>で得られた訪問したファイルの名前。
see 節 <A HREF="elisp_27.html#SEC407">26.4 バッファファイル名 <EM>(2003/10/30)</EM></A>。
<P>

<DT><CODE>%F</CODE>
<DD>選択しているフレームのタイトル（ウィンドウシステム上のみ）か名前。
see 節 <A HREF="elisp_29.html#SEC440">28.3.3 ウィンドウフレームのパラメータ</A>。
<P>

<DT><CODE>%c</CODE>
<DD>ポイントの現在のコラム番号。
<P>

<DT><CODE>%l</CODE>
<DD>ポイントの現在の行番号。
<P>

<DT><CODE>%*</CODE>
<DD>バッファが読み出し専用であれば`<SAMP>%</SAMP>'（<CODE>buffer-read-only</CODE>を参照）、<BR>
バッファが変更されていれば`<SAMP>*</SAMP>'（<CODE>buffer-modified-p</CODE>を参照）、<BR>
さもなければ`<SAMP>-</SAMP>'。
see 節 <A HREF="elisp_27.html#SEC408">26.5 バッファの変更 <EM>(2003/10/30)</EM></A>。
<P>

<DT><CODE>%+</CODE>
<DD>バッファが変更されていれば`<SAMP>*</SAMP>'（<CODE>buffer-modified-p</CODE>を参照）、<BR>
バッファが読み出し専用であれば`<SAMP>%</SAMP>'（<CODE>buffer-read-only</CODE>を参照）、<BR>
さもなければ`<SAMP>-</SAMP>'。
`<SAMP>%*</SAMP>'との違いは、変更された読み出し専用バッファに対してのみである。
see 節 <A HREF="elisp_27.html#SEC408">26.5 バッファの変更 <EM>(2003/10/30)</EM></A>。
<P>

<DT><CODE>%&#38;</CODE>
<DD>バッファが変更されていれば`<SAMP>*</SAMP>'、さもなければ`<SAMP>-</SAMP>'である。
<P>

<DT><CODE>%s</CODE>
<DD><CODE>process-status</CODE>で得たカレントバッファに属するサブプロセスの状態。
see 節 <A HREF="elisp_37.html#SEC589">36.6 プロセス情報</A>。
<P>

<DT><CODE>%t</CODE>
<DD>訪問したファイルがテキストファイルであるかバイナリファイルであるかを表す。
（特定のオペレーティングシステムでのみ意味を持つ。）
<P>

<DT><CODE>%p</CODE>
<DD>ウィンドウの<STRONG>上端</STRONG>の上にあるバッファのテキストの割合、
あるいは、`<SAMP>Top</SAMP>'、`<SAMP>Bottom</SAMP>'、`<SAMP>All</SAMP>'のいずれかである。
<P>

<DT><CODE>%P</CODE>
<DD>ウィンドウの<STRONG>下端</STRONG>の上にあるバッファのテキスト
（ウィンドウに見えてるテキストと上端の上にあるテキスト）の割合に
バッファの先頭が見えていれば`<SAMP>Top</SAMP>'を加えたもの、
あるいは、`<SAMP>Bottom</SAMP>'、`<SAMP>All</SAMP>'のいずれかである。
<P>

<DT><CODE>%n</CODE>
<DD>ナロイングしていると`<SAMP>Narrow</SAMP>'、さもなければなにもなし。
（<A HREF="elisp_30.html#SEC473">29.4 ナロイング</A>の<CODE>narrow-to-region</CODE>を参照）。
<P>

<DT><CODE>%[</CODE>
<DD>（ミニバッファのレベルを除く）再帰編集レベルの深さを表す。
各編集レベルごとに1つの`<SAMP>[</SAMP>'。
see 節 <A HREF="elisp_21.html#SEC313">20.11 再帰編集</A>。
<P>

<DT><CODE>%]</CODE>
<DD>（ミニバッファのレベルを除く）各再帰編集レベルごとに1つの`<SAMP>]</SAMP>'。
<P>

<DT><CODE>%%</CODE>
<DD>文字`<SAMP>%</SAMP>'。
<CODE>%</CODE>記法を許す文字列に`<SAMP>%</SAMP>'をそのまま含めるための方法である。
<P>

<DT><CODE>%-</CODE>
<DD>モード行の残り部分を埋めるに十分な個数のダッシュ。
</DL>
<P>

つぎの2つの<CODE>%</CODE>記法はまだ使えますが、
変数<CODE>mode-name</CODE>や<CODE>global-mode-string</CODE>を
使って同じ効果を得られるのでこれらは廃れた記法です。
<P>

<DL COMPACT>
<DT><CODE>%m</CODE>
<DD><CODE>mode-name</CODE>の値。
<P>

<DT><CODE>%M</CODE>
<DD><CODE>global-mode-string</CODE>の値。
現在、<CODE>display-time</CODE>は<CODE>global-mode-string</CODE>の値を変更する。
</DL>
<P>

<A NAME="Imenu"></A>
<HR SIZE="6">
<br><A NAME="SEC354"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC353"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC355"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Imenu"></A>
<H2> 22.4 iメニュー </H2>
<!--docid::SEC354::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Imenu">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Imenu</a>"<br>
"texi/elisp21/iメニュー"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2Fi%A5%E1%A5%CB%A5%E5%A1%BC">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

<A NAME="IDX1456"></A>
<EM>iメニュー</EM>（Imenu）とは、ユーザーが
バッファ内の定義や節の一覧からその1つを選ぶと
バッファ内の当該箇所へ直接移動できる機能です。
iメニューは、
バッファ内の定義や部分の名前や位置を表すバッファインデックスを
構築しておくことで動作し、
当該箇所へ移動するためにユーザーがそれらの1つを選べるようにします。
本節ではメジャーモードに対するiメニューをカスタマイズする方法を説明します。
<P>

普通のもっとも単純な方法は、
変数<CODE>imenu-generic-expression</CODE>に設定することです。
<P>

<A NAME="IDX1457"></A>
<DL>
<DT><U>Variable:</U> <B>imenu-generic-expression</B>
<DD>この変数が<CODE>nil</CODE>以外であると、
iメニュー向けの定義を探すための正規表現を指定する。
もっとも単純な場合、要素はつぎのような形である。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(<VAR>menu-title</VAR> <VAR>regexp</VAR> <VAR>subexp</VAR>)
</pre></td></tr></table><P>

ここで、<VAR>menu-title</VAR>が<CODE>nil</CODE>以外であると、
この要素に一致したものはバッファインデックスのサブメニューに置くことを
意味する。
<VAR>menu-title</VAR>自体はサブメニューの名前を指定する。
<VAR>menu-title</VAR>が<CODE>nil</CODE>であると、
この要素に一致したものはバッファインデックスのメニューに直接置かれる。
<P>

リストの2番目の要素<VAR>regexp</VAR>は正規表現
（see 節 <A HREF="elisp_34.html#SEC551">33.2 正規表現</A>）であり、
これに一致した箇所がバッファインデックスに現れる定義になる。
3番目の要素<VAR>subexp</VAR>は、
定義の名前に一致する<VAR>regexp</VAR>の部分式である。
<P>

要素はつぎの形でもよい。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(<VAR>menu-title</VAR> <VAR>regexp</VAR> <VAR>index</VAR> <VAR>function</VAR> <VAR>arguments</VAR><small>...</small>)
</pre></td></tr></table><P>

この要素に一致するものは、バッファインデックスの特別な項目になり、
ユーザーが当該項目を選ぶと、
<VAR>item-name</VAR>、バッファ位置、<VAR>arguments</VAR>を引数として
<VAR>function</VAR>を呼び出す。
<P>

emacs-lispモード向けには、<VAR>pattern</VAR>はつぎのようになる。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>((nil "^\\s-*(def\\(un\\|subst\\|macro\\|advice\\)\
\\s-+\\([-A-Za-z0-9+]+\\)" 2)
 ("*Vars*" "^\\s-*(def\\(var\\|const\\)\
\\s-+\\([-A-Za-z0-9+]+\\)" 2)
 ("*Types*"
  "^\\s-*\
(def\\(type\\|struct\\|class\\|ine-condition\\)\
\\s-+\\([-A-Za-z0-9+]+\\)" 2))
</pre></td></tr></table><P>

この変数に設定すると、
カレントバッファにおいてバッファローカルな変数になる。
</DL>
<P>

<A NAME="IDX1458"></A>
<DL>
<DT><U>Variable:</U> <B>imenu-case-fold-search</B>
<DD>この変数は、<VAR>imenu-generic-expression</VAR>との一致に際して
大文字小文字を区別するかどうかを制御する。
デフォルトは<CODE>t</CODE>であり、大文字小文字を区別せずに一致をとる。
<P>

この変数に設定すると、
カレントバッファにおいてバッファローカルな変数になる。
</DL>
<P>

<A NAME="IDX1459"></A>
<DL>
<DT><U>Variable:</U> <B>imenu-syntax-alist</B>
<DD>この変数は、<CODE>imenu-generic-expression</CODE>を処理中に
カレントバッファの構文テーブルに優先する
構文テーブルの変更部分の連想リストである。
各要素はつぎの形であること。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(<VAR>characters</VAR> . <VAR>syntax-description</VAR>)
</pre></td></tr></table><P>

CARの<VAR>characters</VAR>は、文字か文字列である。
それらの文字は、指定した構文<VAR>syntax-description</VAR>であることを意味する。
これは<CODE>modify-syntax-entry</CODE>（see 節 <A HREF="elisp_35.html#SEC569">34.3 構文テーブル向け関数</A>）に
渡される。
<P>

この機能は典型的には、
通常のシンボル構成文字を単語構成文字として扱い、
<CODE>imenu-generic-expression</CODE>を単純化し一致処理を速くする。
たとえば、fortranモードではつぎのように使っている。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>  (setq imenu-syntax-alist '(("_$" . "w")))
</pre></td></tr></table><P>

こうすると、<CODE>imenu-generic-expression</CODE>のパターンでは、
`<SAMP>\\(\\sw\\|\\s_\\)+</SAMP>'のかわりに`<SAMP>\\sw+</SAMP>'を使える。
この技法は、名前の先頭文字の集合を名前の残りの文字の集合よりも
小さく制限する必要があるモードで使うには不便であることに注意してほしい。
<P>

この変数に設定すると、
カレントバッファにおいてバッファローカルな変数になる。
</DL>
<P>

メジャーモードのiメニューをカスタマイズする別の方法は、
変数<CODE>imenu-prev-index-position-function</CODE>や
<CODE>imenu-extract-index-name-function</CODE>に設定することです。
<P>

<A NAME="IDX1460"></A>
<DL>
<DT><U>Variable:</U> <B>imenu-prev-index-position-function</B>
<DD>この変数が<CODE>nil</CODE>以外であると、その値は、
バッファインデックスに置くつぎの定義を
ファイルで後向きに探すための関数であること。
<P>

その関数は、バッファインデックスの項目に対応する箇所にポイントを置くこと。
項目がみつからなければ<CODE>nil</CODE>を返すこと。
<P>

この変数に設定すると、
カレントバッファにおいてバッファローカルな変数になる。
</DL>
<P>

<A NAME="IDX1461"></A>
<DL>
<DT><U>Variable:</U> <B>imenu-extract-index-name-function</B>
<DD>この関数が<CODE>nil</CODE>以外であると、その値は、
ポイントが変数<CODE>imenu-prev-index-position-function</CODE>が返した
定義の部分にあると仮定して、当該定義の名前を返す関数であること。
<P>

この変数に設定すると、
カレントバッファにおいてバッファローカルな変数になる。
</DL>
<P>

メジャーモードのiメニューをカスタマイズする最後の方法は、
変数<CODE>imenu-create-index-function</CODE>に設定することです。
<P>

<A NAME="IDX1462"></A>
<DL>
<DT><U>Variable:</U> <B>imenu-create-index-function</B>
<DD>この関数は、バッファインデックスの作成に使う関数を指定する。
その関数は引数なしで、カレントバッファに対するインデックスを返すこと。
<CODE>save-excursion</CODE>の内側から呼ばれるので、
その関数がポイントをどこに置こうと関係ない。
<P>

デフォルト値は、インデックスの連想リストを生成するために
<CODE>imenu-generic-expression</CODE>を使う関数である。
読者が別の関数を指定すれば、<CODE>imenu-generic-expression</CODE>は使われない。
<P>

この変数に設定すると、
カレントバッファにおいてバッファローカルな変数になる。
</DL>
<P>

<A NAME="IDX1463"></A>
<DL>
<DT><U>Variable:</U> <B>imenu-index-alist</B>
<DD>この変数は、カレントバッファに対するインデックスの連想リストを保持する。
この変数に設定すると、
カレントバッファにおいてバッファローカルな変数になる。
<P>

連想リストの単純な要素は<CODE>(<VAR>index-name</VAR> . <VAR>index-position</VAR>)</CODE>
のような形である。
このような単純な要素を選ぶと、
バッファ内で<VAR>index-position</VAR>へ移動する効果がある。
<P>

特別な要素は<CODE>(<VAR>index-name</VAR> <VAR>position</VAR>
<VAR>function</VAR> <VAR>arguments</VAR><small>...</small>)</CODE>のような形である。
このような特別な要素を選ぶと、
つぎのようなフォームを実行する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(funcall <VAR>function</VAR> <VAR>index-name</VAR> <VAR>position</VAR> <VAR>arguments</VAR><small>...</small>)
</pre></td></tr></table><P>

入れ子になった部分連想リストの要素は
<CODE>(<VAR>index-name</VAR>  <VAR>sub-alist</VAR>)</CODE>のような形である。
</DL>
<P>

<A NAME="Font Lock Mode"></A>
<HR SIZE="6">
<br><A NAME="SEC355"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC354"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC356"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Font Lock Mode"></A>
<H2> 22.5 フォントロック（font-lock）モード </H2>
<!--docid::SEC355::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Font%20Lock%20Mode">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Font%20Lock%20Mode</a>"<br>
"texi/elisp21/フォントロック（font-lock）モード"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A9%A5%F3%A5%C8%A5%ED%A5%C3%A5%AF%A1%CAfont%2Dlock%A1%CB%A5%E2%A1%BC%A5%C9">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1464"></A>
<P>

<EM>フォントロック（font-lock）モード</EM>とは、
バッファ内の特定部分に対して、それらの構文上の役割に応じた
属性<CODE>face</CODE>を自動的に付加する機能のことです。
バッファを解析する方法はメジャーモードに依存しますが、
ほとんどのメジャーモードでは、
どの文脈でどのフェイスを使うかを指示する条件を定義します。
本節では、特定の言語向けに、いいかえれば、
特定のメジャーモード向けに
フォントロックをカスタマイズする方法を説明します。
<P>

フォントロック（font-lock）モードは、強調表示すべきテキストを
2つの方法で、つまり、構文テーブルに基づいた構文解析、あるいは、
（通常、正規表現による）探索で探します。
構文解析による処理を最初に行ってコメントや文字列定数を探し、
<CODE>font-lock-comment-face</CODE>や<CODE>font-lock-string-face</CODE>
（see 節 <A HREF="elisp_23.html#SEC360">22.5.5 フォントロックのフェイス</A>）を使ってそれらを強調表示します。
探索による処理がこれに続きます。
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC356">22.5.1 フォントロック（font-lock）の基本</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC357">22.5.2 探索に基づくフォント選択</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC358">22.5.3 その他のフォントロック変数</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC359">22.5.4 フォントロックのレベル</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC360">22.5.5 フォントロックのフェイス</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_23.html#SEC361">22.5.6 構文的なフォントロック</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Font Lock Basics"></A>
<HR SIZE="6">
<br><A NAME="SEC356"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC355"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC357"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Font Lock Basics"></A>
<H3> 22.5.1 フォントロック（font-lock）の基本 </H3>
<!--docid::SEC356::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Font%20Lock%20Basics">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Font%20Lock%20Basics</a>"<br>
"texi/elisp21/フォントロック（font-lock）の基本"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A9%A5%F3%A5%C8%A5%ED%A5%C3%A5%AF%A1%CAfont%2Dlock%A1%CB%A4%CE%B4%F0%CB%DC">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

フォントロック（font-lock）モードがテキストを強調表示する方法を
制御する変数がいくつかあります。
しかし、メジャーモードでこれらの変数を直接に設定するべきではありません。
そのかわりに、バッファローカルな
変数<CODE>font-lock-defaults</CODE>に設定すべきです。
フォントロック（font-lock）モードがオンになると、
この変数に設定された値を使って他のすべての変数に設定します。
<P>

<A NAME="IDX1465"></A>
<DL>
<DT><U>Variable:</U> <B>font-lock-defaults</B>
<DD>この変数はメジャーモードがバッファローカルな変数として設定し、
当該モードにおいてテキストをどのように表示するかを指定する。
値はつぎの形であること。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(<VAR>keywords</VAR> <VAR>keywords-only</VAR> <VAR>case-fold</VAR>
 <VAR>syntax-alist</VAR> <VAR>syntax-begin</VAR> <VAR>other-vars</VAR><small>...</small>)
</pre></td></tr></table><P>

最初の要素<VAR>keywords</VAR>は、
間接的に<CODE>font-lock-keywords</CODE>の値を指定する。
要素<VAR>keywords</VAR>がシンボルであると、
その変数としての値が<CODE>font-lock-keywords</CODE>に使われる。
あるいは、要素<VAR>keywords</VAR>がそのようなシンボルのリストであると、
各シンボルが1つのレベルの表示方法を指定する。
最初のシンボルはレベル1の表示方法、
2番目のシンボルはレベル2の表示方法といった具合である。
<P>

2番目の要素<VAR>keywords-only</VAR>は、
変数<CODE>font-lock-keywords-only</CODE>の値を指定する。
これが<CODE>nil</CODE>以外であると（文字列やコメントの）構文による処理を行わない。
<P>

3番目の要素<VAR>case-fold</VAR>は、
<CODE>font-lock-case-fold-search</CODE>の値を指定する。
これが<CODE>nil</CODE>以外であると、フォントロック（font-lock）モードは
<CODE>font-lock-keywords</CODE>で指定された探索で
大文字小文字を区別しない。
<P>

4番目の要素<VAR>syntax-alist</VAR>が<CODE>nil</CODE>以外である場合、
それは<CODE>(<VAR>char-or-string</VAR> . <VAR>string</VAR>)</CODE>の形の
コンスセルのリストであること。
これらは表示方法を選ぶための構文テーブルの設定に使われる
（see 節 <A HREF="elisp_35.html#SEC569">34.3 構文テーブル向け関数</A>）。
得られた構文テーブルは<CODE>font-lock-syntax-table</CODE>に保持される。
<P>

5番目の要素<VAR>syntax-begin</VAR>は、
<CODE>font-lock-beginning-of-syntax-function</CODE>の値を指定する
（下記参照）。
<P>

<VAR>other-vars</VAR>以降の要素は、
<CODE>(<VAR>variable</VAR> . <VAR>value</VAR>)</CODE>という形である。
この種の要素は、表示方法の選択に影響する
その他の変数に設定するために使われる。
</DL>
<P>

<A NAME="Search-based Fontification"></A>
<HR SIZE="6">
<br><A NAME="SEC357"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC356"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC358"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Search-based Fontification"></A>
<H3> 22.5.2 探索に基づくフォント選択 </H3>
<!--docid::SEC357::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Search-based%20Fontification">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Search-based%20Fontification</a>"<br>
"texi/elisp21/探索に基づくフォント選択"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%C3%B5%BA%F7%A4%CB%B4%F0%A4%C5%A4%AF%A5%D5%A5%A9%A5%F3%A5%C8%C1%AA%C2%F2">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

フォントロック（font-lock）モードのカスタマイズにおいて
もっとも重要な変数は<CODE>font-lock-keywords</CODE>です。
探索に基づく表示方法の選択における探索条件を指定します。
<P>

<A NAME="IDX1466"></A>
<DL>
<DT><U>Variable:</U> <B>font-lock-keywords</B>
<DD>この変数の値は、強調表示するべきキーワードのリストである。
このリストに正規表現を書く場合には注意すること。
貧弱な書き方をしたパターンであると、動作を劇的に遅くする！
</DL>
<P>

<CODE>font-lock-keywords</CODE>の各要素は、
特定のテキストの探し方と
当該テキストをどのように強調表示するか指定します。
フォントロック（font-lock）モードは、
<CODE>font-lock-keywords</CODE>の要素を1つ1つ処理し、
各要素において、それに一致するものすべてを探して処理します。
通常、すでに表示方法を選択済みのテキスト部分については、
それ以降の要素に一致しても表示方法を変えません。
しかし、<VAR>highlighter</VAR>の要素<VAR>override</VAR>を使って、
異なるふるまいを指定できます。
<P>

<CODE>font-lock-keywords</CODE>の各要素はつぎのいずれかの形です。
<P>

<DL COMPACT>
<DT><CODE><VAR>regexp</VAR></CODE>
<DD>正規表現<VAR>regexp</VAR>に一致したものはすべて
<CODE>font-lock-keyword-face</CODE>を使って強調表示する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>;; 孤立した`<SAMP>foo</SAMP>'の出現は
;; <CODE>font-lock-keyword-face</CODE>で強調表示する。
"\\<foo\\>"
</pre></td></tr></table><P>

関数<CODE>regexp-opt</CODE>（see 節 <A HREF="elisp_34.html#SEC552">33.2.1 正規表現の構文</A>）は、
異なる複数個のキーワードに一致する最適な正規表現を
計算するのに有用である。
<P>

<DT><CODE><VAR>function</VAR></CODE>
<DD>関数<VAR>function</VAR>を呼び出してテキストを探し、
それが探し出したものを<CODE>font-lock-keyword-face</CODE>を使って強調表示する。
<P>

<VAR>function</VAR>は、探索限界を引数として呼び出される。
みつかれば<CODE>nil</CODE>以外を返すとともに
みつけた部分を表すマッチデータを設定する。
<P>

<DT><CODE>(<VAR>matcher</VAR> . <VAR>match</VAR>)</CODE>
<DD>この種の要素では、<VAR>matcher</VAR>は、上に述べた正規表現か関数を表す。
CDRの<VAR>match</VAR>は、（<VAR>matcher</VAR>に一致した部分全体のかわりに）
強調表示すべき<VAR>matcher</VAR>の部分式を指定する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>;; `<SAMP>fubar</SAMP>'の各出現の`<SAMP>bar</SAMP>'を
;; <CODE>font-lock-keyword-face</CODE>で強調表示
("fu\\(bar\\)" . 1)
</pre></td></tr></table><P>

正規表現<VAR>matcher</VAR>を作るために<CODE>regexp-opt</CODE>を使った場合、
<VAR>match</VAR>の値を計算するには
<CODE>regexp-opt-depth</CODE>（see 節 <A HREF="elisp_34.html#SEC552">33.2.1 正規表現の構文</A>）を使える。
<P>

<DT><CODE>(<VAR>matcher</VAR> . <VAR>facename</VAR>)</CODE>
<DD>この種の要素では、<VAR>facename</VAR>は、
強調表示に使うフェイス名を指定する値を表す式である。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>;; `<SAMP>fubar</SAMP>'の出現は、<CODE>fubar-face</CODE>の値で
;; 表されたフェイスを使って強調表示
("fubar" . fubar-face)
</pre></td></tr></table><P>

<DT><CODE>(<VAR>matcher</VAR> . <VAR>highlighter</VAR>)</CODE>
<DD>この種の要素では、<VAR>highlighter</VAR>は、
<VAR>matcher</VAR>に一致した部分の強調表示方法を指定するリストである。
つぎの形であること。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(<VAR>subexp</VAR> <VAR>facename</VAR> <VAR>override</VAR> <VAR>laxmatch</VAR>)
</pre></td></tr></table><P>

CARの<VAR>subexp</VAR>は、
強調表示すべき一致部分の部分式を指定する整数
（0は一致部分全体を意味する）である。
2番目の要素<VAR>facename</VAR>は、上に述べたようにフェイスを指定する。
<P>

<VAR>highlighter</VAR>の最後の2つの要素、
<VAR>override</VAR>と<VAR>laxmatch</VAR>はフラグである。
<VAR>override</VAR>が<CODE>t</CODE>であると、当該要素は、
<CODE>font-lock-keywords</CODE>のまえの要素で決定済みの
表示方法に優先することを表す。
<CODE>keep</CODE>であると、他の要素では表示方法が決定していない
各文字の表示方法を表す。
<CODE>prepend</CODE>であると、
属性<CODE>face</CODE>の先頭にフェイス<VAR>facename</VAR>を追加する。
<CODE>append</CODE>であると、
属性<CODE>face</CODE>の末尾にフェイス<VAR>facename</VAR>を追加する。
<P>

<VAR>laxmatch</VAR>が<CODE>nil</CODE>以外であると、
<VAR>matcher</VAR>で一致したものの中に<VAR>subexp</VAR>番目の部分式が
なくてもエラーとしないことを意味する。
<P>

この種の要素とその動作の例を示す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>;; `<SAMP>foo</SAMP>'や`<SAMP>bar</SAMP>'の出現の表示方法がすでに決まっていても
;; <CODE>foo-bar-face</CODE>で強調表示する
;; <CODE>foo-bar-face</CODE>の値はフェイスであること
("foo\\|bar" 0 foo-bar-face t)

;; 関数<CODE>fubar-match</CODE>がみつけた各出現内の最初の部分式を
;; <CODE>fubar-face</CODE>の値が表すフェイスで強調表示する
(fubar-match 1 fubar-face)
</FONT></pre></td></tr></table><P>

<DT><CODE>(<VAR>matcher</VAR> <VAR>highlighters</VAR><small>...</small>)</CODE>
<DD>この種の要素は、1つの<VAR>matcher</VAR>に対して
複数のリスト<VAR>highlighter</VAR>を指定する。
これが有用であるためには、
各<VAR>highlighter</VAR>で<VAR>subexp</VAR>の値が異なること。
つまり、それぞれを<VAR>matcher</VAR>の異なる部分式に適用できること。
<P>

<DT><CODE>(eval . <VAR>form</VAR>)</CODE>
<DD><VAR>form</VAR>は、バッファにおいて<CODE>font-lock-keywords</CODE>のこの値が
始めて使われたときに評価すべき式である。
その値は、この表にあげた形の1つであること。
</DL>
<P>

<STRONG>警告：</STRONG><CODE> </CODE>
<CODE>font-lock-keywords</CODE>の要素は、
行をまたがって一致するように設計しないこと。
そのような処理は信頼性がない。
<CODE>font-lock-fontify-buffer</CODE>は、行にまたがるパターンを正しく扱えるが、
読者がバッファを編集したときの更新処理では、
一度に1行ずつ処理するために正しく扱えない。
<P>

<A NAME="Other Font Lock Variables"></A>
<HR SIZE="6">
<br><A NAME="SEC358"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC357"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC359"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Other Font Lock Variables"></A>
<H3> 22.5.3 その他のフォントロック変数 </H3>
<!--docid::SEC358::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Other%20Font%20Lock%20Variables">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Other%20Font%20Lock%20Variables</a>"<br>
"texi/elisp21/その他のフォントロック変数"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A4%BD%A4%CE%C2%BE%A4%CE%A5%D5%A5%A9%A5%F3%A5%C8%A5%ED%A5%C3%A5%AF%CA%D1%BF%F4">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

本節では、<CODE>font-lock-defaults</CODE>を用いてメジャーモードで
設定できる他の変数について述べます。
<P>

<A NAME="IDX1467"></A>
<DL>
<DT><U>Variable:</U> <B>font-lock-keywords-only</B>
<DD><CODE>nil</CODE>以外であると、フォントロック（font-lock）モードは、
構文に基づいてコメントや文字列を強調表示すべきでないことを意味する。
<CODE>font-lock-keywords</CODE>に基づく強調表示のみを行う。
</DL>
<P>

<A NAME="IDX1468"></A>
<DL>
<DT><U>Variable:</U> <B>font-lock-keywords-case-fold-search</B>
<DD><CODE>nil</CODE>以外であると、<CODE>font-lock-keywords</CODE>の
正規表現探索では大文字小文字を区別しないことを意味する。
</DL>
<P>

<A NAME="IDX1469"></A>
<DL>
<DT><U>Variable:</U> <B>font-lock-syntax-table</B>
<DD>この変数は、コメントや文字列の表示方法に用いる
構文テーブルを指定する。
</DL>
<P>

<A NAME="IDX1470"></A>
<DL>
<DT><U>Variable:</U> <B>font-lock-beginning-of-syntax-function</B>
<DD>この変数が<CODE>nil</CODE>以外であると、
ポイントを構文上の『トップレベル』で文字列やコメントの外側に
後方移動する関数であること。
フォントロック（font-lock）モードは、
構文に基づく処理において正しい結果を得るために
必要に応じてこの関数を使う。
<P>

関数は引数なしで呼び出される。
ポイントを構文ブロックの先頭に置くこと。
典型的な値は、
<CODE>beginning-of-line</CODE>（行頭は構文ブロックの外側である）、
あるいは、
プログラム向けのモードでは<CODE>beginning-of-defun</CODE>、
テキスト向けのモードでは<CODE>backward-paragraph</CODE>
（モード固有の関数は構文ブロックの外側にポイントを移動する）である。
<P>

値が<CODE>nil</CODE>であると、バッファの先頭を構文ブロックの外側の位置として使う。
これは誤りではないが、動作を遅くする。
</DL>
<P>

<A NAME="IDX1471"></A>
<DL>
<DT><U>Variable:</U> <B>font-lock-mark-block-function</B>
<DD>この変数が<CODE>nil</CODE>以外であると、
コマンド<KBD>M-g M-g</KBD>（<CODE>font-lock-fontify-block</CODE>）による
再表示のためにテキストの括られた範囲を選ぶために
引数なしで呼ばれ関数であること。
<P>

関数は、選んだ範囲にリージョンを設定すること。
正しい結果を得られるように大きめのテキスト範囲を選ぶのがよいが、
再表示処理が遅くならないように大きすぎないこと。
典型的な値は、プログラム向けモードでは<CODE>mark-defun</CODE>、
テキスト向けモードでは<CODE>mark-paragraph</CODE>である。
</DL>
<P>

<A NAME="Levels of Font Lock"></A>
<HR SIZE="6">
<br><A NAME="SEC359"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC358"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC360"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Levels of Font Lock"></A>
<H3> 22.5.4 フォントロックのレベル </H3>
<!--docid::SEC359::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Levels%20of%20Font%20Lock">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Levels%20of%20Font%20Lock</a>"<br>
"texi/elisp21/フォントロックのレベル"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A9%A5%F3%A5%C8%A5%ED%A5%C3%A5%AF%A4%CE%A5%EC%A5%D9%A5%EB">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

多くのメジャーモードでは、3段階の表示方法を提供します。
<CODE>font-lock-defaults</CODE>の<VAR>keywords</VAR>に
シンボルのリストを使って複数レベルを定義できます。
各シンボルは1つのレベルの表示方法を指定します。
どのレベルを選ぶかはユーザーの責任です。
指定したレベルのシンボルの値は<CODE>font-lock-keywords</CODE>の初期化に使われます。
<P>

表示方法のレベルを定義する際の慣習をあげておきます。
<P>

<UL>
<LI>
レベル1：<CODE> </CODE>
関数宣言、（includeやimportなどの）ファイル指定、文字列、
コメントを強調表示する。
速さが肝心であり、重要な構文やトップレベルの構成要素のみを強調表示する。
<P>

<LI>
レベル2：<CODE> </CODE>
レベル1に加えて、キーワードのようにふるまう型名を含む
当該言語のすべてのキーワード、名前付き定数。
（構文的な、あるいは、意味的な）すべてのキーワードを
適切に強調表示するのが目的。
<P>

<LI>
レベル3：<CODE> </CODE>
レベル2に加えて、
関数や変数宣言で定義されたシンボル、適切なすべての組み込み関数の名前。
</UL>
<P>

<A NAME="Faces for Font Lock"></A>
<HR SIZE="6">
<br><A NAME="SEC360"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC359"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC361"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Faces for Font Lock"></A>
<H3> 22.5.5 フォントロックのフェイス </H3>
<!--docid::SEC360::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Faces%20for%20Font%20Lock">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Faces%20for%20Font%20Lock</a>"<br>
"texi/elisp21/フォントロックのフェイス"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A9%A5%F3%A5%C8%A5%ED%A5%C3%A5%AF%A4%CE%A5%D5%A5%A7%A5%A4%A5%B9">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

フォントロック（font-lock）モードでは任意のフェイスを使えますが、
フォントロック（font-lock）モード向けに特別に定義さたフェイスがあります。
これらのシンボルのおのおのは、フェイス名でもあり、
シンボル自身をデフォルト値とする変数でもあります。
つまり、<CODE>font-lock-comment-face</CODE>のデフォルト値は、
<CODE>font-lock-comment-face</CODE>です。
これは、
フェイス名を値に持つような式を書く<CODE>font-lock-keywords</CODE>などの場面で、
<CODE>font-lock-comment-face</CODE>と書けることを意味します。
<P>

<DL COMPACT>
<DT><CODE>font-lock-comment-face</CODE>
<DD><A NAME="IDX1472"></A>
（典型的には）コメントに使われる。
<P>

<DT><CODE>font-lock-string-face</CODE>
<DD><A NAME="IDX1473"></A>
（典型的には）文字列に使われる。
<P>

<DT><CODE>font-lock-keyword-face</CODE>
<DD><A NAME="IDX1474"></A>
（典型的には）キーワード、つまり、
Cの<CODE>for</CODE>や<CODE>if</CODE>のように構文的に重要な名前に使われる。
<P>

<DT><CODE>font-lock-builtin-face</CODE>
<DD><A NAME="IDX1475"></A>
（典型的には）組み込み関数の名前に使われる。
<P>

<DT><CODE>font-lock-function-name-face</CODE>
<DD><A NAME="IDX1476"></A>
（典型的には）関数定義／宣言内において、
定義／宣言されている関数の名前に使われる。
<P>

<DT><CODE>font-lock-variable-name-face</CODE>
<DD><A NAME="IDX1477"></A>
（典型的には）変数定義／宣言内において、
定義／宣言されている変数の名前に使われる。
<P>

<DT><CODE>font-lock-type-face</CODE>
<DD><A NAME="IDX1478"></A>
（典型的には）ユーザー定義のデータ型の名前が定義／参照される場所において、
それらの名前に使われる。
<P>

<DT><CODE>font-lock-constant-face</CODE>
<DD><A NAME="IDX1479"></A>
（典型的には）定数の名前に使われる。
<P>

<DT><CODE>font-lock-warning-face</CODE>
<DD><A NAME="IDX1480"></A>
（典型的には）独特な構文や別のテキストの意味を大きく変えるようなものに
使われる。
たとえば、Emacs Lispの`<SAMP>;;;###autoload</SAMP>'や
Cの<CODE>#error</CODE>指定に使われる。
</DL>
<P>

<A NAME="Syntactic Font Lock"></A>
<HR SIZE="6">
<br><A NAME="SEC361"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC360"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC362"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Syntactic Font Lock"></A>
<H3> 22.5.6 構文的なフォントロック </H3>
<!--docid::SEC361::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Syntactic%20Font%20Lock">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Syntactic%20Font%20Lock</a>"<br>
"texi/elisp21/構文的なフォントロック"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%B9%BD%CA%B8%C5%AA%A4%CA%A5%D5%A5%A9%A5%F3%A5%C8%A5%ED%A5%C3%A5%AF">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

フォントロック（font-lock）モードは、
属性<CODE>syntax-table</CODE>を自動更新するためにも使えます。
1つの構文テーブルだけでは十分でないような言語において有用です。
<P>

<A NAME="IDX1481"></A>
<DL>
<DT><U>Variable:</U> <B>font-lock-syntactic-keywords</B>
<DD>この変数は構文的なフォントロックをオンにし制御する。
その値はつぎの形の要素からなるリストであること。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(<VAR>matcher</VAR> <VAR>subexp</VAR> <VAR>syntax</VAR> <VAR>override</VAR> <VAR>laxmatch</VAR>)
</pre></td></tr></table><P>

この要素の各部分には、つぎの<CODE>font-lock-keywords</CODE>の対応する種類の要素と
同じ意味がある。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(<VAR>matcher</VAR> <VAR>subexp</VAR> <VAR>facename</VAR> <VAR>override</VAR> <VAR>laxmatch</VAR>)
</pre></td></tr></table><P>

しかし、属性<CODE>face</CODE>に使う値<VAR>facename</VAR>を指定するかわりに、
属性<CODE>syntax-table</CODE>に使う値<VAR>syntax</VAR>を指定する。
ここで、<VAR>syntax</VAR>は、構文テーブルを値とする変数、
<CODE>(<VAR>syntax-code</VAR> . <VAR>matching-char</VAR>)</CODE>の形の構文テーブルの項目、
あるいは、この2種類のどちらかを値とする式である。
</DL>
<P>

<A NAME="Hooks"></A>
<HR SIZE="6">
<br><A NAME="SEC362"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC361"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_24.html#SEC363"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Hooks"></A>
<H2> 22.6 フック </H2>
<!--docid::SEC362::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Hooks">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Hooks</a>"<br>
"texi/elisp21/フック"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%C3%A5%AF">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1482"></A>
<P>

<EM>フック</EM>（hook）とは、既存のプログラムから特定の場面で
呼び出される（1つか一連の）関数を収めた変数です。
Emacsは、カスタマイズのためにフックを用意しています。
ほとんどの場合、フックはファイル`<TT>.emacs</TT>'で設定しますが、
Lispプログラムが行ってもかまいません。
標準のフック関数一覧については、See 節 <A HREF="elisp_47.html#SEC680">G. 標準のフック</A>。
<P>

<A NAME="IDX1483"></A>
Emacsの多くのフックは<EM>ノーマルフック</EM>（normal hook）です。
これらの変数は、引数なしで呼び出される関数のリストを保持しています。
フック名が`<SAMP>-hook</SAMP>'で終っていると、ノーマルフックを意味します。
読者がそれらを単一の方法で使えるように、
可能な限りノーマルフックにするように心掛けています。
<P>

各メジャーモード関数は、
その初期化の最終段階で<EM>モードフック</EM>（mode hook）と呼ばれる
ノーマルフックを実行すると期待されます。
これにより、モードがすでに設定したバッファローカルな変数を上書きすることで、
ユーザーがモードのふるまいをカスタマイズしやすくしています。
しかし、フックは別の場面でも使われています。
たとえば、フック<CODE>suspend-hook</CODE>は、
Emacsが自身を一時休止する直前に実行されます。
（see 節 <A HREF="elisp_40.html#SEC644">39.2.2 Emacsの休止</A>）。
<P>

ノーマルフックにフック関数を追加する推奨方法は、
<CODE>add-hook</CODE>（下記参照）を呼ぶことです。
フック関数は、<CODE>funcall</CODE>（see 節 <A HREF="elisp_12.html#SEC157">11.1 関数とはなにか</A>）が
受け付けるならばどんな種類の関数でもかまいません。
ほとんどのノーマルフック変数は最初は空ですが、
<CODE>add-hook</CODE>はその扱い方を知っています。
<P>

<A NAME="IDX1484"></A>
フック変数の名前が`<SAMP>-hook</SAMP>'で終らない場合、
それが<EM>アブノーマルフック</EM>（abnormal hook）であることを表します。
読者は、そのようなフックの正しい使い方を説明書で調べるべきです。
<P>

変数名が`<SAMP>-functions</SAMP>'や`<SAMP>-hooks</SAMP>'で終っていると、
その値は関数のリストですが、
それらの関数を引数ありで呼び出したり、
関数の戻り値をどこかで使うという意味でアブノーマル（異常）なのです。
リストに関数を追加するには<CODE>add-hook</CODE>を使えますが、
関数を書くときには注意する必要があります。
（これらの変数のうち、実際にはノーマルフックであるものもある。
ノーマルフックには`<SAMP>-hook</SAMP>'を使うという慣習を
確立するまえに命名したものである。）
<P>

変数名が`<SAMP>-function</SAMP>'で終っていると、
その値は、関数のリストではなく、1つの関数です。
<P>

lisp対話モードで自動詰め込み（auto-fill）モードをオンにするために
モードフックを使った例を示します。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(add-hook 'lisp-interaction-mode-hook 'turn-on-auto-fill)
</pre></td></tr></table><P>

適当な時期に、Emacsは関数<CODE>run-hooks</CODE>を使って
特定のフックを実行します。
この関数は、<CODE>add-hook</CODE>で追加されたフック関数を呼び出します。
<P>

<A NAME="IDX1485"></A>
<DL>
<DT><U>Function:</U> <B>run-hooks</B> <I>&#38;rest hookvar</I>
<DD>この関数は複数個のフック変数名を引数にとり、各フックを順に実行する。
各引数<VAR>hookvar</VAR>は、フック変数のシンボルであること。
これらの引数は、指定された順に処理される。
<P>

フック変数が<CODE>nil</CODE>以外の値であると、
その値は、関数か関数のリストである。
値が関数（ラムダ式や関数定義を持つシンボル）であると、それを呼び出す。
値がリストであると、順番にその要素を呼び出す。
フック関数は、引数なしで呼び出される。
現在、フック変数に1つの関数を入れることは廃れかけている。
つねに関数のリストを使うべきである。
<P>

例として、<CODE>emacs-lisp-mode</CODE>がそのモードフックをどのように
実行するかを示す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(run-hooks 'emacs-lisp-mode-hook)
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1486"></A>
<DL>
<DT><U>Function:</U> <B>run-hook-with-args</B> <I>hook &#38;rest args</I>
<DD>この関数は、フック関数に引数を渡すアブノーマルフックを実行する方法である。
各フック関数に引数<VAR>args</VAR>を渡して呼び出す。
</DL>
<P>

<A NAME="IDX1487"></A>
<DL>
<DT><U>Function:</U> <B>run-hook-with-args-until-failure</B> <I>hook &#38;rest args</I>
<DD>この関数は、フック関数に引数を渡すアブノーマルフックを実行するが、
フック関数が失敗するとただちに止める方法である。
フック関数が<CODE>nil</CODE>を返すまで、
各フック関数に引数<VAR>args</VAR>を渡して呼び出す。
<CODE>nil</CODE>が返ってくると<CODE>nil</CODE>で戻る。
さもなければ、<CODE>nil</CODE>以外の値を返す。
</DL>
<P>

<A NAME="IDX1488"></A>
<DL>
<DT><U>Function:</U> <B>run-hook-with-args-until-success</B> <I>hook &#38;rest args</I>
<DD>この関数は、フック関数に引数を渡すアブノーマルフックを実行するが、
フック関数が成功するとただちに止める方法である。
フック関数が<CODE>nil</CODE>以外を返すまで、
各フック関数に引数<VAR>args</VAR>を渡して呼び出す。
<CODE>nil</CODE>以外が返ってくると
最後に呼び出したフック関数の戻り値を返す。
</DL>
<P>

<A NAME="IDX1489"></A>
<DL>
<DT><U>Function:</U> <B>add-hook</B> <I>hook function &#38;optional append local</I>
<DD>この関数はフック変数<VAR>hook</VAR>に関数<VAR>function</VAR>を追加する
手軽な方法である。
引数<VAR>function</VAR>は、正しい個数の引数をとる任意の正しいLisp関数であること。
たとえば、
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(add-hook 'text-mode-hook 'my-text-hook-function)
</pre></td></tr></table><P>

は、<CODE>text-mode-hook</CODE>というフックに
<CODE>my-text-hook-function</CODE>を追加する。
<P>

<CODE>add-hook</CODE>は、ノーマルフックに加えてアブノーマルフックにも使える。
<P>

フック関数は実行順序に依存しないように設計するのが最良である。
実行順序に依存すると『トラブルを呼び込む』ようなものである。
しかし、順序は予測できる。
通常、<VAR>function</VAR>はフックリストの先頭に置かれるので、
（ほかに<CODE>add-hook</CODE>の呼び出しがなければ）最初に実行される。
省略可能な引数<VAR>append</VAR>が<CODE>nil</CODE>以外であると、
新たなフック関数はフックリストの末尾に置かれ、
最後に実行される。
<P>

<VAR>local</VAR>が<CODE>nil</CODE>以外であると、
新たなフック関数をカレントバッファにバッファローカルにすることを意味する。
これを行うまえに、（<CODE>make-local-variable</CODE><STRONG>ではなく</STRONG>）
<CODE>make-local-hook</CODE>を呼んで
フック自身をバッファローカルにしておく必要がある。
フック自身がバッファローカルでないと、<VAR>local</VAR>の値は意味を持たない。
フック関数はつねにグローバルである。
</DL>
<P>

<A NAME="IDX1490"></A>
<DL>
<DT><U>Function:</U> <B>remove-hook</B> <I>hook function &#38;optional local</I>
<DD>この関数は、フック変数<VAR>hook</VAR>から<VAR>function</VAR>を取り除く。
<P>

<VAR>local</VAR>が<CODE>nil</CODE>以外であると、
グローバルなフックリストではなくバッファローカルなフックリストから
<VAR>function</VAR>を削除することを指定する。
フック変数自身がバッファローカルでないと、<VAR>local</VAR>の値は意味を持たない。
</DL>
<P>

<A NAME="IDX1491"></A>
<DL>
<DT><U>Function:</U> <B>make-local-hook</B> <I>hook</I>
<DD>この関数は、フック変数<CODE>hook</CODE>をカレントバッファにバッファローカルにする。
フック変数がバッファローカルであると、
バッファローカルなフック関数とグローバルなフック関数を持つことができ、
<CODE>run-hooks</CODE>はそれらすべてを実行する。
<P>

この関数は、バッファローカルな値の要素を<CODE>t</CODE>にすることで動作する。
これは、バッファローカルな値に加えてフック変数のデフォルト値にある
フック関数を使うことを表すフラグである。
<CODE>run-hooks</CODE>はこのフラグを理解し、
<CODE>make-local-hook</CODE>はすべてのノーマルフックを処理できる。
アブノーマルフックに関しては、
<CODE>t</CODE>の意味を理解するように更新したものだけが処理できる。
<P>

フック変数に対して<CODE>make-local-variable</CODE>を直接使わないこと。
それだけでは不十分である。
</DL>
<A NAME="Documentation"></A>
<HR SIZE="6">
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<a name="bottom"> </a>
<script type="text/javascript" src="style2.js"></script>
<div class="footer">
    <br>
    このページはMeadow (Emacs) の紹介ページです <br>
このWebページの各文書は自由にリンク・複製・再配布・改変していただいて構いません．
<br>ただし，複製・再配布・改変の場合は Meadow Memo のURLを記載しておいて下さい．<br>
<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=about%20link">Medow memoへのリンクについて</a>．<br>

間違い，要望等があれば<a href="mailto:akihisa@mail.ne.jp">akihisa@mail.ne.jp</a> か下記でどうぞ<br>

<br>

<FORM METHOD="post" ACTION="http://www.bookshelf.jp/cgi-bin/wwwmail.cgi" >
お名前：<INPUT TYPE="text" NAME="name" SIZE="30" MAXLENGTH="40" VALUE="ななしさん"><br>
メールアドレス：<INPUT TYPE="text" NAME="EMAIL" SIZE="25" MAXLENGTH="60" VALUE="secret@mail.adr"><br>
<input type="hidden" name="HPAGE" value="">
つっこみ：<br><TEXTAREA NAME="MESSAGE" ROWS="5" COLS="50">
</TEXTAREA><br><br>
<INPUT TYPE="submit" VALUE="送信">
<INPUT TYPE="reset" VALUE="クリア">
</FORM>

<br><A HREF="http://www.bookshelf.jp/cgi-bin/xct.cgi">ページ別カウンタ</a>
<br> Since 2002/12/13 <br>
</div>

</BODY>

</HTML>
