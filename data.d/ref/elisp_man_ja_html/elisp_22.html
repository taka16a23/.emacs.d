<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML lang="ja">
<!-- Created on October, 1  2005 by texi2html 1.64 -->
<!-- 
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Olaf Bachmann <obachman@mathematik.uni-kl.de>
Send bugs and suggestions to <texi2html@mathematik.uni-kl.de>
 
-->
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html;CHARSET=euc-jp">
<META NAME="keywords" CONTENT="meadow,mule,emacs,lisp,elisp,gnus,setting,設定,unix,cygwin">
<META http-equiv="Content-Script-Type" content="text/javascript">
<META NAME="description" CONTENT="Meadowの設定を紹介するページです">
<TITLE>GNU Emacs Lispリファレンスマニュアル:  キーマップ</TITLE>

<META NAME="description" CONTENT="GNU Emacs Lispリファレンスマニュアル:  キーマップ">
<META NAME="keywords" CONTENT="GNU Emacs Lispリファレンスマニュアル:  キーマップ">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META NAME="Generator" CONTENT="texi2html 1.64">

<LINK REL="contents" HREF="elisp_toc.html#SEC_Contents">
<LINK REL="index" HREF="elisp_48.html#SEC681">
<LINK REL="next" HREF="elisp_23.html#SEC339">
<LINK REL="prev" HREF="elisp_21.html#SEC281">

<META http-equiv="Content-Style-Type" content="text/css">
<!-- 鶯と龜 ←日本語EUC誤判別対策用らしい; -->
<link rel="StyleSheet" href="../../../../soft/css/midnight.css" type="text/css" id="css1">
<script type="text/javascript" src="style1.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../soft/css/meadowmemo.css">

</HEAD>
<BODY LANG="ja" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">
<!--Infoseek Analyzer start-->
<script LANGUAGE="javascript">PgNo=6;</script>
<script src="http://js1.infoseek.co.jp/bin/57/00170.js"></script>
<noscript><a href="http://ax1.www.infoseek.co.jp/bin/go?0017057f" target="_blank">
<img src="http://ax1.www.infoseek.co.jp/bin/logo?0017057f" border=0></a></noscript>
<!--Infoseek Analyzer end-->
<a name="top"> </a>

<br><A NAME="SEC317"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC316"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC318"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_21.html#SEC281"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC339"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Keymaps"></A>
<H1> 21. キーマップ </H1>
<!--docid::SEC317::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Keymaps">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Keymaps</a>"<br>
"texi/elisp21/キーマップ"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%AD%A1%BC%A5%DE%A5%C3%A5%D7">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1255"></A>
<P>

入力イベントとコマンドとのバインディング（対応）は、
<EM>キーマップ</EM>（keymap）と呼ばれるデータ構造に記録されています。
キーマップの各バインディング（あるいは<EM>バインド</EM>（bind））は、
個々のイベント型を別のキーマップかコマンドに対応付けます。
イベント型のバインディングがキーマップであると、
後続の入力イベントを探すためにそのキーマップを使います。
コマンドがみつかるまで、これを繰り返します。
この処理全体を<EM>キー探索</EM>（key lookup）と呼びます。
<P>

<div class="menuindex"><SCRIPT language=JavaScript src="index21.js"></SCRIPT></div><noscript><BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_22.html#SEC318">21.1 キーマップの用語</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Definitions of terms pertaining to keymaps.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_22.html#SEC319">21.2 キーマップの形式</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">What a keymap looks like as a Lisp object.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_22.html#SEC320">21.3 キーマップの作成</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Functions to create and copy keymaps.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_22.html#SEC321">21.4 継承とキーマップ</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How one keymap can inherit the bindings
				   of another keymap.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_22.html#SEC322">21.5 プレフィックスキー</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Defining a key with a keymap as its definition.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_22.html#SEC323">21.6 活性なキーマップ</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Each buffer has a local keymap
                                   to override the standard (global) bindings.
				   A minor mode can also override them.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_22.html#SEC324">21.7 キー探索</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How extracting elements from keymaps works.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_22.html#SEC325">21.8 キー探索関数</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How to request key lookup.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_22.html#SEC326">21.9 キーバインディングの変更</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Redefining a key in a keymap.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_22.html#SEC327">21.10 キーをバインドするためのコマンド</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Interactive interfaces for redefining keys.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_22.html#SEC328">21.11 キーマップの走査</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Looking through all keymaps, for printing help.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_22.html#SEC329">21.12 メニューキーマップ</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Defining a menu as a keymap.</TD></TR>
</TABLE></BLOCKQUOTE></noscript>
<P>

<A NAME="Keymap Terminology"></A>
<HR SIZE="6">
<br><A NAME="SEC318"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC317"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC319"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Keymap Terminology"></A>
<H2> 21.1 キーマップの用語 </H2>
<!--docid::SEC318::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Keymap%20Terminology">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Keymap%20Terminology</a>"<br>
"texi/elisp21/キーマップの用語"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%AD%A1%BC%A5%DE%A5%C3%A5%D7%A4%CE%CD%D1%B8%EC">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1256"></A>
<A NAME="IDX1257"></A>
<A NAME="IDX1258"></A>
<A NAME="IDX1259"></A>
<A NAME="IDX1260"></A>
<A NAME="IDX1261"></A>
<P>

<EM>キーマップ</EM>（keymap）は、イベント型を定義に対応させる表です。
（この定義は任意のLispオブジェクトであるが、
コマンドループによる実行においては、特定の型のみが意味を持つ）。
与えられたイベント（あるいはイベント型）とキーマップから、
Emacsはイベントの定義を得ることができます。
イベントは、文字、ファンクションキー、マウス操作です
（see 節 <A HREF="elisp_21.html#SEC289">20.5 入力イベント</A>）。
<P>

ある単位を構成する入力イベントの列を<EM>キー列</EM>（key sequence）、
あるいは、略して<EM>キー</EM>（key）と呼びます。
単一イベントから成る列はつねにキー列であり、複数イベント列もキー列です。
<P>

キーマップは、任意のキー列に対するバインディング、
つまり、定義を決定します。
キー列が単一イベントから成るとき、
そのバインディングはキーマップ内の当該イベントの定義です。
複数のイベントから成るキー列のバインディングは、
繰り返し処理で探します。
つまり、最初のイベントのバインディングを探すと、
それはキーマップであるはずです。
続いて、そのキーマップから2番目のイベントのバインディングを探します。
これをキー列のすべてのイベントを使い尽くすまで行います
<P>

キー列のバインディングがキーマップであると、
そのキー列を<EM>プレフィックスキー</EM>（prefix key）と呼びます。
さもなければ、（追加できるイベントがないので）
<EM>完全なキー</EM>（complete key）と呼びます。
バインディングが<CODE>nil</CODE>であると、キーは<EM>未定義</EM>であるといいます。
プレフィックスキーの例は、<KBD>C-c</KBD>、<KBD>C-x</KBD>、<KBD>C-x 4</KBD>です。
定義されている完全なキーの例は、<KBD>X</KBD>、<KBD>RET</KBD>、<KBD>C-x 4 C-f</KBD>です。
未定義な完全なキーの例は、<KBD>C-x C-g</KBD>と<KBD>C-c 3</KBD>です。
詳しくは、See 節 <A HREF="elisp_22.html#SEC322">21.5 プレフィックスキー</A>。
<P>

キー列のバインディングを探す際の規則では、
（最後のイベントのまえまでにみつかる）途中のバインディングは
すべてキーマップであると仮定します。
これが満たされないと、イベントの列があるまとまりを構成せず、
1つのキー列になりません。
いいかえれば、有効なキー列の末尾からいくつかのイベントを取りさると、
つねにプレフィックスキーになる必要があります。
たとえば、<KBD>C-f C-n</KBD>はキー列ではありません。
<KBD>C-f</KBD>はプレフィックスキーではないので、
<KBD>C-f</KBD>で始まる列はキー列ではありません。
<P>

複数イベントから成るキー列の候補は、
プレフィックスキーのバインディングに依存します。
したがって、キーマップが異なればそれらは異なり、
バインディングを変更するとそれらは変わります。
しかし、単一イベントから成る列は、プレフィックスに依存しないので、
つねにキー列です。
<P>

ある時点には、複数個の主キーマップが活性です。
つまり、キーバインディングの探索に使われます。
それらは、
すべてのバッファが共有する<EM>グローバルマップ</EM>（global map）、
特定のメジャーモードに関連付けられた<EM>ローカルマップ</EM>（local keymap）、
現在オンにしてあるマイナモードに属する
<EM>マイナモードキーマップ</EM>（minor mode keymaps）です。
（すべてのマイナモードにキーマップがあるわけではない。）
ローカルキーマップのバインディングは、
対応するグローバルなバインディングを隠します（つまり優先する）。
マイナモードキーマップは、ローカルとグローバルの両方のキーマップを隠します。
詳しくはSee 節 <A HREF="elisp_22.html#SEC323">21.6 活性なキーマップ</A>。
<P>

<A NAME="Format of Keymaps"></A>
<HR SIZE="6">
<br><A NAME="SEC319"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC318"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC320"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Format of Keymaps"></A>
<H2> 21.2 キーマップの形式 </H2>
<!--docid::SEC319::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Format%20of%20Keymaps">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Format%20of%20Keymaps</a>"<br>
"texi/elisp21/キーマップの形式"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%AD%A1%BC%A5%DE%A5%C3%A5%D7%A4%CE%B7%C1%BC%B0">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1262"></A>
<A NAME="IDX1263"></A>
<A NAME="IDX1264"></A>
<P>

キーマップは、そのCARがシンボル<CODE>keymap</CODE>であるリストです。
リストの残りの要素がキーマップのキーバインディングを定義します。
オブジェクトがキーマップであるかどうか検査するには、
関数<CODE>keymapp</CODE>（下記参照）を使います。
<P>

キーマップでは、シンボル<CODE>keymap</CODE>のうしろに、
さまざまな種類の要素が現れます。
<P>

<DL COMPACT>
<DT><CODE>(<VAR>type</VAR> . <VAR>binding</VAR>)</CODE>
<DD>イベント型<VAR>type</VAR>に対する1つのバインディングを指定する。
普通の各バインディングは、文字やシンボルである特定の<EM>イベント型</EM>に
適用される。
see 節 <A HREF="elisp_21.html#SEC301">20.5.12 イベントの分類</A>。
<P>

<DT><CODE>(t . <VAR>binding</VAR>)</CODE>
<DD><A NAME="IDX1265"></A>
<EM>デフォルトのキーバインディング</EM>を指定する。
キーマップの他の要素に一致しない任意のイベントには、
そのバインディングとして指定した<VAR>binding</VAR>を与える。
デフォルトのバインディングにより、
すべてを列挙せずに可能なすべてのイベントにバインドできる。
デフォルトのバインディングを有するキーマップは、
任意の低優先順位のキーマップを隠してしまう。
<P>

<DT><CODE><VAR>vector</VAR></CODE>
<DD>キーマップの要素がベクトルであると、
当該ベクトルをASCII文字全体、つまり、コード0から127に対する
バインディングとみなす。
ベクトルの<VAR>n</VAR>番目の要素は、コード<VAR>n</VAR>の文字に対する
バインディングである。
これは、多くのバインディングを記録するコンパクトな方法である。
このようなベクトルのキーマップを<EM>完全なキーマップ</EM>（full keymap）と呼ぶ。
それ以外のキーマップを<EM>疎なキーマップ</EM>（sparse keymaps）と呼ぶ。
<P>

キーマップにベクトルがあると、ベクトルの要素が<CODE>nil</CODE>であっても
ベクトルが各ASCII文字のバインディングをつねに定義する。
そのような<CODE>nil</CODE>のバインディングは、
ASCII文字に対しては
キーマップのデフォルトのキーバインディングを無効にする。
しかし、ASCII文字以外のイベントに対しては、
デフォルトのバインディングが意味を持つ。
<CODE>nil</CODE>のバインディングが
低優先順位のキーマップを隠すことは<EM>ない</EM>。
つまり、ローカルマップが<CODE>nil</CODE>のバインディングを与えると、
Emacsはグローバルマップのバインディングを使う。
<P>

<DT><CODE><VAR>string</VAR></CODE>
<DD><A NAME="IDX1266"></A>
<A NAME="IDX1267"></A>
バインディングに加えて、
キーマップでは、要素として文字列を持つこともできる。
これを<EM>全面プロンプト文字列</EM>（overall prompt string）と呼び、
キーマップをメニューとして使うことを可能にする。
see 節 <A HREF="elisp_22.html#SEC329">21.12 メニューキーマップ</A>。
</DL>
<P>

<A NAME="IDX1268"></A>
キーマップは、メタ文字に対するバインディングを直接には記録していません。
そのかわりに、キー探索においては、メタ文字は2文字から成る列とみなし、
先頭文字は<KBD>ESC</KBD>（あるいは、<CODE>meta-prefix-char</CODE>の現在値）です。
つまり、キー<KBD>M-a</KBD>は実際には<KBD><KBD>ESC</KBD> a</KBD>と表現され、
そのグローバルなバインディングは
<CODE>esc-map</CODE>の<KBD>a</KBD>でみつかります（see 節 <A HREF="elisp_22.html#SEC322">21.5 プレフィックスキー</A>）。
<P>

Lispモードに対するローカルキーマップの例を示します。
これは疎なキーマップです。
<KBD>DEL</KBD>、<KBD>TAB</KBD>、<KBD>C-c C-l</KBD>、<KBD>M-C-q</KBD>、<KBD>M-C-x</KBD>に対する
バインディングを定義しています。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>lisp-mode-map
=> 
(keymap 
 ;; <KBD>TAB</KBD>
 (9 . lisp-indent-line)                 
 ;; <KBD>DEL</KBD>
 (127 . backward-delete-char-untabify)  
 (3 keymap 
    ;; <KBD>C-c C-l</KBD>
    (12 . run-lisp))                    
 (27 keymap 
     ;; <KBD>M-C-q</KBD>は<KBD><KBD>ESC</KBD> C-q</KBD>とみなされる
     (17 . indent-sexp)                 
     ;; <KBD>M-C-x</KBD>は<KBD><KBD>ESC</KBD> C-x</KBD>とみなされる
     (24 . lisp-send-defun)))           
</pre></td></tr></table><P>

<A NAME="IDX1269"></A>
<DL>
<DT><U>Function:</U> <B>keymapp</B> <I>object</I>
<DD>この関数は、<VAR>object</VAR>がキーマップであれば<CODE>t</CODE>を返し、
さもなければ<CODE>nil</CODE>を返す。
より正確には、この関数は、
そのCARが<CODE>keymap</CODE>であるリストかどうかを検査する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(keymapp '(keymap))
    => t
(keymapp (current-global-map))
    => t
</pre></td></tr></table></DL>
<P>

<A NAME="Creating Keymaps"></A>
<HR SIZE="6">
<br><A NAME="SEC320"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC319"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC321"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Creating Keymaps"></A>
<H2> 21.3 キーマップの作成 </H2>
<!--docid::SEC320::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Creating%20Keymaps">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Creating%20Keymaps</a>"<br>
"texi/elisp21/キーマップの作成"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%AD%A1%BC%A5%DE%A5%C3%A5%D7%A4%CE%BA%EE%C0%AE">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1270"></A>
<P>

ここでは、キーマップを作成するための関数について述べます。
<P>

<A NAME="IDX1271"></A>
<DL>
<DT><U>Function:</U> <B>make-keymap</B> <I>&#38;optional prompt</I>
<DD>この関数は新たに完全なキーマップ
（つまり、すべてのASCII文字に対する定義を収めた
長さ128のベクトル）を作成しそれを返す。
新たなキーマップでは、すべてのASCII文字に対するバインディングは
<CODE>nil</CODE>であり、それ以外の種類のイベントに対するバインディングはない。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(make-keymap)
    => (keymap [nil nil nil <small>...</small> nil nil])
</pre></td></tr></table><P>

<VAR>prompt</VAR>を指定すると、
それはキーマップに対する全面プロンプト文字列になる。
全面プロンプト文字列はメニューキーマップ
（see 節 <A HREF="elisp_22.html#SEC329">21.12 メニューキーマップ</A>）に有用である。
</DL>
<P>

<A NAME="IDX1272"></A>
<DL>
<DT><U>Function:</U> <B>make-sparse-keymap</B> <I>&#38;optional prompt</I>
<DD>この関数は、新たに空の疎なキーマップを作成しそれを返す。
新たなキーマップにはイベントに対するバインディングはいっさいない。
引数<VAR>prompt</VAR>は、<CODE>make-keymap</CODE>の場合同様、
プロンプト文字列を指定する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(make-sparse-keymap)
    => (keymap)
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1273"></A>
<DL>
<DT><U>Function:</U> <B>copy-keymap</B> <I>keymap</I>
<DD>この関数は<VAR>keymap</VAR>のコピーを返す。
<VAR>keymap</VAR>にバインディングとして直接現れる任意のキーマップも
任意のレベルまで再帰的にコピーされる。
しかし、文字に対する定義が、その関数定義がキーマップであるような
シンボルに出会うと再帰的なコピーを行わないため、
同じシンボルが新たなコピーにも現れる。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(setq map (copy-keymap (current-local-map)))
=> (keymap
     ;; (これはメタ文字を意味する)
     (27 keymap         
         (83 . center-paragraph)
         (115 . center-line))
     (9 . tab-to-tab-stop))

(eq map (current-local-map))
    => nil
(equal map (current-local-map))
    => t
</pre></td></tr></table></DL>
<P>

<A NAME="Inheritance and Keymaps"></A>
<HR SIZE="6">
<br><A NAME="SEC321"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC320"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC322"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Inheritance and Keymaps"></A>
<H2> 21.4 継承とキーマップ </H2>
<!--docid::SEC321::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Inheritance%20and%20Keymaps">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Inheritance%20and%20Keymaps</a>"<br>
"texi/elisp21/継承とキーマップ"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%B7%D1%BE%B5%A4%C8%A5%AD%A1%BC%A5%DE%A5%C3%A5%D7">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1274"></A>
<A NAME="IDX1275"></A>
<A NAME="IDX1276"></A>
<A NAME="IDX1277"></A>
<P>

キーマップでは、<EM>親キーマップ</EM>（parent keymap）と呼ぶ別のキーマップの
バインディングを継承できます。
そのようなキーマップはつぎのようになります。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(keymap <VAR>bindings</VAR><small>...</small> . <VAR>parent-keymap</VAR>)
</pre></td></tr></table><P>

このキーマップは、キーを探索する時点において
<VAR>parent-keymap</VAR>が有するすべてのバインディングを継承しますが、
それらには<VAR>bindings</VAR>が追加されたり優先します。
<P>

<CODE>define-key</CODE>や他のキーバインディング関数で<VAR>parent-keymap</VAR>の
バインディングを変更すると、それらの変更は、
<VAR>bindings</VAR>で隠されない限り継承側のキーマップからも見えます。
その逆は真ではありません。
<CODE>define-key</CODE>で継承側のキーマップを修正すると、
それは<VAR>bindings</VAR>に影響するだけで<VAR>parent-keymap</VAR>には影響しません。
<P>

親キーマップを用いたキーマップを作成する正しい方法は、
<CODE>set-keymap-parent</CODE>を使うことです。
親キーマップを用いたキーマップを直接作成するようなコードがある場合には、
<CODE>set-keymap-parent</CODE>を用いるようにプログラムを変更してください。
<P>

<A NAME="IDX1278"></A>
<DL>
<DT><U>Function:</U> <B>keymap-parent</B> <I>keymap</I>
<DD>この関数は、キーマップ<VAR>keymap</VAR>の親キーマップを返す。
<VAR>keymap</VAR>に親がなければ<CODE>keymap-parent</CODE>は<CODE>nil</CODE>を返す。
</DL>
<P>

<A NAME="IDX1279"></A>
<DL>
<DT><U>Function:</U> <B>set-keymap-parent</B> <I>keymap parent</I>
<DD>キーマップ<VAR>keymap</VAR>の親キーマップとして<VAR>parent</VAR>を設定し、
<VAR>parent</VAR>を返す。
<VAR>parent</VAR>が<CODE>nil</CODE>であると、
この関数は<VAR>keymap</VAR>に親キーマップをいっさい与えない。
<P>

<VAR>keymap</VAR>に（プレフィックスキー用のバインディングである）
サブマップがあれば、それらも<VAR>parent</VAR>が指定するプレフィックスキーを
反映する新たな親マップを受け取る。
</DL>
<P>

<CODE>text-mode-map</CODE>からキーマップを継承する方法を示します。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(let ((map (make-sparse-keymap)))
  (set-keymap-parent map text-mode-map)
  map)
</pre></td></tr></table><P>

<A NAME="Prefix Keys"></A>
<HR SIZE="6">
<br><A NAME="SEC322"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC321"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC323"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Prefix Keys"></A>
<H2> 21.5 プレフィックスキー </H2>
<!--docid::SEC322::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Prefix%20Keys">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Prefix%20Keys</a>"<br>
"texi/elisp21/プレフィックスキー"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D7%A5%EC%A5%D5%A5%A3%A5%C3%A5%AF%A5%B9%A5%AD%A1%BC">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1280"></A>
<P>

<EM>プレフィックス</EM>（prefix key）とは、
そのバインディングがキーマップであるキー列のことです。
そのキーマップが、プレフィックスキー以降のキーでなにをするかを定義します。
たとえば、<KBD>C-x</KBD>はプレフィックスキーであり、
変数<CODE>ctl-x-map</CODE>に保持されたキーマップを使います。
このキーマップは、<KBD>C-x</KBD>で始まるキー列に対するバインディングを定義します。
<P>

Emacsの標準プレフィックスキーのなかには、
Lisp変数にも保持されたキーマップを使うものがあります。
<P>

<UL>
<LI>
<A NAME="IDX1281"></A>
<A NAME="IDX1282"></A>
<CODE>esc-map</CODE>は、プレフィックスキー<KBD>ESC</KBD>用のグローバルマップである。
したがって、すべてのメタ文字のグローバルな定義はここにある。
このキーマップは<CODE>ESC-prefix</CODE>の関数定義でもある。
<P>

<LI>
<A NAME="IDX1283"></A>
<CODE>help-map</CODE>は、プレフィックスキー<KBD>C-h</KBD>に対する
グローバルキーマップである。
<P>

<LI>
<A NAME="IDX1284"></A>
<A NAME="IDX1285"></A>
<CODE>mode-specific-map</CODE>は、プレフィックスキー<KBD>C-c</KBD>に対する
グローバルキーマップである。
このキーマップは実際にはグローバルでありモード固有ではないが、
その名前は、<KBD>C-h b</KBD>（<CODE>display-bindings</CODE>）の出力において
<KBD>C-c</KBD>に関する有用な情報を与える。
というのは、このプレフィックスキーの主な用途は、
モード固有のバインディングのためだからである。
<P>

<LI>
<A NAME="IDX1286"></A>
<A NAME="IDX1287"></A>
<A NAME="IDX1288"></A>
<CODE>ctl-x-map</CODE>は、プレフィックスキー<KBD>C-x</KBD>に対して使われる
グローバルキーマップである。
このキーマップは、シンボル<CODE>Control-X-prefix</CODE>の関数セルに現れる。
<P>

<LI>
<A NAME="IDX1289"></A>
<A NAME="IDX1290"></A>
<CODE>mule-keymap</CODE>は、プレフィックスキー<KBD>C-x <KBD>RET</KBD></KBD>に対して使われる
グローバルキーマップである。
<P>

<LI>
<A NAME="IDX1291"></A>
<A NAME="IDX1292"></A>
<CODE>ctl-x-4-map</CODE>は、プレフィックスキー<KBD>C-x 4</KBD>に対して使われる
グローバルキーマップである。
<P>

<LI>
<A NAME="IDX1293"></A>
<A NAME="IDX1294"></A>
<CODE>ctl-x-5-map</CODE>は、プレフィックスキー<KBD>C-x 5</KBD>に対して使われる
グローバルキーマップである。
<P>

<LI>
<A NAME="IDX1295"></A>
<A NAME="IDX1296"></A>
<CODE>2C-mode-map</CODE>は、プレフィックスキー<KBD>C-x 6</KBD>に対して使われる
グローバルキーマップである。
<P>

<LI>
<A NAME="IDX1297"></A>
<A NAME="IDX1298"></A>
<CODE>vc-prefix-map</CODE>は、プレフィックスキー<KBD>C-x v</KBD>に対して使われる
グローバルキーマップである。
<P>

<LI>
<A NAME="IDX1299"></A>
<A NAME="IDX1300"></A>
<CODE>facemenu-keymap</CODE>は、プレフィックスキー<KBD>M-g</KBD>に対して使われる
グローバルキーマップである。
<P>

<LI>
Emacsには、他にも、<KBD>C-x &#64;</KBD>、<KBD>C-x a i</KBD>、<KBD>C-x <KBD>ESC</KBD></KBD>、
<KBD><KBD>ESC</KBD> <KBD>ESC</KBD></KBD>のプレフィックスキーがある。
これらは、特別な名前を持たないキーマップを使う。
</UL>
<P>

プレフィックスキーのキーマップバインディングは、
当該プレフィックスキーに続くイベントを探すために使われます。
（その関数定義がキーマップであるシンボルでもよい。
効果は同じであるが、シンボルはプレフィックスキーに対する名前として働く。）
したがって、<KBD>C-x</KBD>のバインディングは
シンボル<CODE>Control-X-prefix</CODE>であり、
その関数セルがコマンド<KBD>C-x</KBD>用のキーマップを保持している。
（<CODE>ctl-x-map</CODE>の値も同じキーマップである。）
<P>

プレフィックスキーの定義は、任意の活性なキーマップにあってかまいません。
プレフィックスキーとしての<KBD>C-c</KBD>、<KBD>C-x</KBD>、<KBD>C-h</KBD>、<KBD>ESC</KBD>の
定義はグローバルマップにあるので、これらのプレフィックスキーは
つねに利用できます。
メジャーモードやマイナモードでは、
プレフィックスキーの定義をローカルキーマップや
マイナモードキーマップに入れることで、
キーをプレフィックスとして再定義できます。
See 節 <A HREF="elisp_22.html#SEC323">21.6 活性なキーマップ</A>。
<P>

複数の活性なキーマップにおいて、キーがプレフィックスと定義されていると、
さまざまな定義は実質的には併合されます。
マイナモードキーマップで定義されたコマンドが最優先で、
つぎにローカルマップのプレフィックス定義、
そしてグローバルマップのプレフィックス定義が続きます。
<P>

以下の例では、ローカルキーマップにおいて、
<KBD>C-p</KBD>を<KBD>C-x</KBD>に等価なプレフィックスキーにします。
続いて<KBD>C-p C-f</KBD>のバインディングを
<KBD>C-x C-f</KBD>のように関数<CODE>find-file</CODE>にします。
キー列<KBD>C-p 6</KBD>はどの活性なキーマップでもみつかりません。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(use-local-map (make-sparse-keymap))
    => nil
(local-set-key "\C-p" ctl-x-map)
    => nil
(key-binding "\C-p\C-f")
    => find-file

(key-binding "\C-p6")
    => nil
</pre></td></tr></table><P>

<A NAME="IDX1301"></A>
<DL>
<DT><U>Function:</U> <B>define-prefix-command</B> <I>symbol</I>
<DD><A NAME="IDX1302"></A>
<A NAME="IDX1303"></A>
この関数は、<VAR>symbol</VAR>をプレフィックスキーの
バインディングとして使えるように準備する。
つまり、完全なキーマップを作成し、
<VAR>symbol</VAR>の関数定義にそのキーマップを保存する。
以後、<VAR>symbol</VAR>にキー列をバインドすると、
当該キー列をプレフィックスキーに入る。
<P>

この関数は、変数としての<VAR>symbol</VAR>にも値としてキーマップを設定する。
<VAR>symbol</VAR>を返す。
<P>

</DL>
<P>

<A NAME="Active Keymaps"></A>
<HR SIZE="6">
<br><A NAME="SEC323"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC322"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC324"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Active Keymaps"></A>
<H2> 21.6 活性なキーマップ </H2>
<!--docid::SEC323::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Active%20Keymaps">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Active%20Keymaps</a>"<br>
"texi/elisp21/活性なキーマップ"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%B3%E8%C0%AD%A4%CA%A5%AD%A1%BC%A5%DE%A5%C3%A5%D7">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1304"></A>
<A NAME="IDX1305"></A>
<A NAME="IDX1306"></A>
<P>

Emacsには、通常、たくさんのキーマップがあります。
ある時点では、それらの数個が<EM>活性</EM>になっていて、
ユーザー入力の解釈に関与します。
それらは、グローバルキーマップ、カレントバッファのローカルキーマップ、
オンになっているマイナモードのキーマップです。
<P>

<EM>グローバルキーマップ</EM>（global keymap）は、
<KBD>C-f</KBD>のようなカレントバッファに依存せずに
定義されたキーのバインディングを保持します。
変数<CODE>global-map</CODE>はこのキーマップを保持していて、
このキーマップはつねに活性です。
<P>

各バッファには別のキーマップ、つまり、
バッファの<EM>ローカルキーマップ</EM>（local keymap）があり、
キーに対する新しい定義や無効にする定義を保持しています。
カレントバッファのローカルキーマップは、
<CODE>overriding-local-map</CODE>で無効にしない限り、つねに活性です。
テキスト属性により、バッファの特定部分に対する
代替ローカルマップを指定できます。
<A HREF="elisp_32.html#SEC517">31.19.4 特別な意味を持つ属性</A>を参照してください。
<P>

各マイナモードもキーマップを持てます。
その場合、マイナモードがオンであると当該キーマップは活性です。
<P>

変数<CODE>overriding-local-map</CODE>が<CODE>nil</CODE>以外であると、
バッファのローカルキーマップとそのすべてのマイナモードキーマップに
取ってかわるローカルキーマップを指定します。
<P>

キーが入力されるとどのコマンドを実行するかを決定するために、
すべての活性なキーマップを一緒に使います。
Emacsは、キーマップの1つでバインディングがみつかるまで、
優先順位が高いほうからこれらのキーマップを1つ1つ探索します。
1つのキーマップで探索する処理のことを
<EM>キー探索</EM>（key lookup）といいます。
<A HREF="elisp_22.html#SEC324">21.7 キー探索</A>を参照してください。
<P>

通常、Emacsはまず<CODE>minor-mode-map-alist</CODE>で指定される順に
マイナモードキーマップでキーを探します。
キーに対するバインディングがなければ、
Emacsはローカルキーマップで探します。
そこにもバインディングがなければ、
Emacsはグローバルキーマップで探します。
しかし、<CODE>overriding-local-map</CODE>が<CODE>nil</CODE>以外であれば、
Emacsはまずそのキーマップで探してから、
グローバルキーマップで探します。
<P>

<A NAME="IDX1307"></A>
同じメジャーモードを使う各バッファは、通常、同じローカルキーマップを
使うので、キーマップはモードにローカルであると考えることができます。
（たとえば<CODE>local-set-key</CODE>を使って）バッファのローカルキーマップを
修正すると、当該キーマップを共有している別のバッファでも
その修正が見えます。
<P>

Lispモードや他の数個のメジャーモードで使われるローカルキーマップは、
それらのモードがまだ使われていなくても存在します。
そのようなローカルキーマップは、<CODE>lisp-mode-map</CODE>などの変数の値です。
使用頻度の低いほとんどのメジャーモードでは、
セッションで始めてそのモードを使ったときに
ローカルキーマップを作成します。
<P>

ミニバッファにもローカルキーマップがあります。
それにはさまざまな補完コマンドや脱出コマンドが含まれます。
See 節 <A HREF="elisp_20.html#SEC266">19.1 ミニバッファの紹介</A>。
<P>

Emacsには、別の用途のキーマップもあります。
<CODE>read-key-sequence</CODE>でイベントを変換するためのものです。
See 節 <A HREF="elisp_40.html#SEC652">39.8.2 入力イベントの変換</A>。
<P>

標準的なキーマップの一覧についてはSee 節 <A HREF="elisp_46.html#SEC679">F. 標準のキーマップ</A>。
<P>

<A NAME="IDX1308"></A>
<DL>
<DT><U>Variable:</U> <B>global-map</B>
<DD>この変数は、Emacsがキーボード入力をコマンドに対応させるための
デフォルトのグローバルキーマップを保持する。
グローバルキーマップは、通常、このキーマップである。
デフォルトのグローバルキーマップは、
すべての印字文字に<CODE>self-insert-command</CODE>をバインドする
完全なキーマップである。
<P>

グローバルマップのバインディングを修正することは実用的ですが、
この変数には、動作開始時のキーマップ以外の値は設定しないこと。
</DL>
<P>

<A NAME="IDX1309"></A>
<DL>
<DT><U>Function:</U> <B>current-global-map</B>
<DD>この関数は、現在のグローバルキーマップを返す。
<CODE>global-map</CODE>を変更していなければ、
これは<CODE>global-map</CODE>の値と同じである。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(current-global-map)
=> (keymap [set-mark-command beginning-of-line <small>...</small> 
            delete-backward-char])
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1310"></A>
<DL>
<DT><U>Function:</U> <B>current-local-map</B>
<DD>この関数は、カレントバッファのローカルキーマップを返す。
なければ<CODE>nil</CODE>を返す。
つぎの例では、（lisp対話モードを使っている）バッファ`<SAMP>*scratch*</SAMP>'の
キーマップは疎なキーマップであり、
ASCIIコード27の<KBD>ESC</KBD>に対する指定も別の疎なキーマップである。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(current-local-map)
=> (keymap 
    (10 . eval-print-last-sexp) 
    (9 . lisp-indent-line) 
    (127 . backward-delete-char-untabify) 
    (27 keymap 
        (24 . eval-defun) 
        (17 . indent-sexp)))
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1311"></A>
<DL>
<DT><U>Function:</U> <B>current-minor-mode-maps</B>
<DD>この関数は、現在オンになっているマイナモードのキーマップのリストを返す。
</DL>
<P>

<A NAME="IDX1312"></A>
<DL>
<DT><U>Function:</U> <B>use-global-map</B> <I>keymap</I>
<DD>この関数は、キーマップ<VAR>keymap</VAR>を新たな現在のグローバルキーマップとする。
これは<CODE>nil</CODE>を返す。
<P>

グローバルキーマップを変更することは、とうてい普通のことではない。
</DL>
<P>

<A NAME="IDX1313"></A>
<DL>
<DT><U>Function:</U> <B>use-local-map</B> <I>keymap</I>
<DD>この関数は、キーマップ<VAR>keymap</VAR>をカレントバッファの
新たなローカルキーマップとする。
<VAR>keymap</VAR>が<CODE>nil</CODE>であると、
バッファにはローカルキーマップがなくなる。
<CODE>use-local-map</CODE>は<CODE>nil</CODE>を返す。
ほとんどのメジャーモードコマンドは、この関数を使う。
</DL>
<P>

<A NAME="IDX1314"></A>
<DL>
<DT><U>Variable:</U> <B>minor-mode-map-alist</B>
<DD>この変数は、変数の値に応じて活性になっている／いないキーマップを
記述する連想リストである。
その要素はつぎの形である。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(<VAR>variable</VAR> . <VAR>keymap</VAR>)
</pre></td></tr></table><P>

変数<VAR>variable</VAR>の値が<CODE>nil</CODE>以外であれば、
キーマップ<VAR>keymap</VAR>は活性である。
典型的には、<VAR>variable</VAR>はマイナモードをオン／オフする変数である。
see 節 <A HREF="elisp_23.html#SEC348">22.2.2 キーマップとマイナモード</A>。
<P>

<CODE>minor-mode-map-alist</CODE>の要素と<CODE>minor-mode-alist</CODE>の要素とは、
異なる構造であることに注意してほしい。
キーマップは要素のCDRである必要があり、
要素のCADRがキーマップであるようなリストではだめである。
CADRは、（リストの）キーマップであるか、
関数定義がキーマップであるシンボルである。
<P>

複数のマイナモードキーマップが活性な場合、
それらの優先順位は、<CODE>minor-mode-map-alist</CODE>での順番である。
読者は、互いに干渉しないようにマイナモードを設計する必要がある。
正しくできていれば、順序は関係ないはずである。
<P>

マイナモードについて詳しくは<A HREF="elisp_23.html#SEC348">22.2.2 キーマップとマイナモード</A>を参照。
<CODE>minor-mode-key-binding</CODE>（see 節 <A HREF="elisp_22.html#SEC325">21.8 キー探索関数</A>）も参照のこと。
</DL>
<P>

<A NAME="IDX1315"></A>
<DL>
<DT><U>Variable:</U> <B>minor-mode-overriding-map-alist</B>
<DD><A NAME="IDX1316"></A>
この変数は、メジャーモードから特定のマイナモード向けのキーバインディングを
無効にするためのものである。
この連想リストの要素は、<CODE>minor-mode-map-alist</CODE>の要素と同じ形で、
<CODE>(<VAR>variable</VAR> . <VAR>keymap</VAR>)</CODE>である。
<P>

<CODE>minor-mode-overriding-map-alist</CODE>の要素として変数が現れると、
当該要素が指定するキーマップで、
<CODE>minor-mode-map-alist</CODE>内の同じ変数で指定したキーマップを
完全に置き換える。
<P>

<CODE>minor-mode-overriding-map-alist</CODE>は、すべてのバッファにおいて、
自動的にバッファにローカルになる。
</DL>
<P>

<A NAME="IDX1317"></A>
<DL>
<DT><U>Variable:</U> <B>overriding-local-map</B>
<DD><CODE>nil</CODE>以外の値であると、この変数は、
バッファのローカルキーマップ、ならびに、すべてのマイナモードキーマップの
かわりに用いるキーマップを保持する。
このキーマップは、現在のグローバルキーマップを除く、
他のすべての活性なキーマップを無効にする。
</DL>
<P>

<A NAME="IDX1318"></A>
<DL>
<DT><U>Variable:</U> <B>overriding-terminal-local-map</B>
<DD><CODE>nil</CODE>以外であると、この変数は、
<CODE>overriding-local-map</CODE>、および、バッファのローカルキーマップと
すべてのマイナモードキーマップのかわりに用いるキーマップを保持する。
<P>

この変数はつねに現在の端末に対してローカルであり、
バッファに対してローカルにはならない。
see 節 <A HREF="elisp_29.html#SEC436">28.2 複数ディスプレイ</A>。
これはインクリメンタルサーチモードの実装に使われている。
</DL>
<P>

<A NAME="IDX1319"></A>
<DL>
<DT><U>Variable:</U> <B>overriding-local-map-menu-flag</B>
<DD>この変数が<CODE>nil</CODE>以外であれば、
<CODE>overriding-local-map</CODE>や<CODE>overriding-terminal-local-map</CODE>の値は、
メニューバーの表示に影響する。
デフォルト値は<CODE>nil</CODE>であり、
そのため、それらのマップはメニューバーには影響しない。
<P>

これら2つのキーマップ変数は、メニューバーの表示に影響しないときであっても、
メニューバーを用いて入力したキー列の実行には影響することに注意してほしい。
そのため、メニューバーのキー列が到着したら、
そのキー列を探索し実行するまえに、これらの変数をクリアすべきである。
これらの変数を使うモードでは、典型的にはつぎのようにする。
つまり、モードで処理できないイベントは『読み戻し』てモードから抜ける。
</DL>
<P>

<A NAME="IDX1320"></A>
<DL>
<DT><U>Variable:</U> <B>special-event-map</B>
<DD>この変数は特殊イベント用のキーマップを保持する。
イベント型のバインディングがこのキーマップにあれば、
そのイベントは特殊イベントであり、
<CODE>read-event</CODE>が当該イベントのバインディングを直接実行する。
see 節 <A HREF="elisp_21.html#SEC309">20.7 特殊イベント</A>。
</DL>
<P>

<A NAME="Key Lookup"></A>
<HR SIZE="6">
<br><A NAME="SEC324"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC323"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC325"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Key Lookup"></A>
<H2> 21.7 キー探索 </H2>
<!--docid::SEC324::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Key%20Lookup">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Key%20Lookup</a>"<br>
"texi/elisp21/キー探索"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%AD%A1%BC%C3%B5%BA%F7">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1321"></A>
<A NAME="IDX1322"></A>
<P>

<EM>キー探索</EM>（key lookup）とは、
与えられたキーマップからキー列のバインディングを捜し出す処理です。
バインディングを実際に実行することは、キー探索ではありません。
<P>

キー探索では、キー列の各イベントのイベント型のみを使い、
イベントの他の部分は無視します。
実際、キー探索に使われるキー列では、
マウスイベント全体（リスト）ではなく
そのイベント型（シンボル）のみを指定します。
See 節 <A HREF="elisp_21.html#SEC289">20.5 入力イベント</A>。
そのような『キー列』は、<CODE>command-execute</CODE>の動作には不十分ですが、
キーの探索や再バインディングには十分です。
<P>

キー列が複数のイベントから構成される場合、
キー探索ではイベントを順番に処理します。
先頭のイベントのバインディングを探しますが、
それはキーマップであるはずです。
続いて、そのキーマップから2番目のイベントのバインディングを探します。
これをキー列のすべてのイベントを使い尽くすまで行います。
（このように探した最後のイベントに対するバインディングは、
キーマップであたっりそうでないかもしれない。）
つまり、キー探索処理は、
キーマップから単一イベントを探索するという単純な処理として定義できます。
これがどのように行われるかは、
キーマップ内のイベントに対応付けられたオブジェクトの型に依存します。
<P>

キーマップでイベント型を探してみつかった値のことを
<EM>キーマップ項目</EM>（keymap entry）という単語で表します。
（これには、メニューキーバインディングにある
項目文字列や他の追加要素を含まない。
というのは、<CODE>lookup-key</CODE>や他のキー探索関数は、
それらを戻り値として返さないからである。）
キーマップ項目として任意のLispオブジェクトをキーマップに保存できますが、
キー探索においてそのすべてが意味を持つとは限りません。
意味のある種類のキー項目をつぎに示します。
<P>

<DL COMPACT>
<DT><CODE>nil</CODE>
<DD><A NAME="IDX1323"></A>
<A NAME="IDX1324"></A>
<CODE>nil</CODE>は、探索に使ったここまでのイベントが
未定義キーを構成することを意味する。
キーマップにイベント型が記載されてなく、かつ、
デフォルトのバインディングもない場合には、
そのイベント型に対しては、バインディングが<CODE>nil</CODE>であるのと等価。
<P>

<DT><VAR>command</VAR>
<DD><A NAME="IDX1325"></A>
<A NAME="IDX1326"></A>
探索に使ったここまでのイベントは完全なキーを構成し、
そのバインディングはコマンド<VAR>command</VAR>である。
see 節 <A HREF="elisp_12.html#SEC157">11.1 関数とはなにか</A>。
<P>

<DT><VAR>array</VAR>
<DD><A NAME="IDX1327"></A>
<A NAME="IDX1328"></A>
配列（文字列やベクトル）は、キーボードマクロである。
探索に使ったここまでのイベントは完全なキーを構成し、
そのバインディングは配列<VAR>array</VAR>である。
詳しくは<A HREF="elisp_21.html#SEC316">20.14 キーボードマクロ</A>を参照。
<P>

<DT><VAR>keymap</VAR>
<DD><A NAME="IDX1329"></A>
<A NAME="IDX1330"></A>
探索に使ったここまでのイベントはプレフィックスキーを構成する。
キー列のつぎのイベントはこのキーマップ<VAR>keymap</VAR>で探す。
<P>

<DT><VAR>list</VAR>
<DD><A NAME="IDX1331"></A>
<A NAME="IDX1332"></A>
リストの意味は、リストの要素の型に依存する。
<P>

<UL>
<LI>
<VAR>list</VAR>のCARがシンボル<CODE>keymap</CODE>であれば、
そのリストはキーマップであり、キーマップとして扱われる（上記参照）。
<P>

<LI>
<A NAME="IDX1333"></A>
<A NAME="IDX1334"></A>
<VAR>list</VAR>のCARがシンボル<CODE>lambda</CODE>であれば、
そのリストはラムダ式である。
これはコマンドとみなされ、そのように扱われる（上記参照）。
<P>

<LI>
<VAR>list</VAR>のCARがキーマップであり、CDRがイベント型であると、
これは<EM>間接項目</EM>（indirect entry）である。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(<VAR>othermap</VAR> . <VAR>othertype</VAR>)
</pre></td></tr></table><P>

キー探索中に間接項目に出会うと、
<VAR>othertype</VAR>のバインディングを<VAR>othermap</VAR>で探しそれを用いる。
<P>

この機能により、あるキーを別のキーに対する別名として定義できる。
たとえば、CARが<CODE>esc-map</CODE>と呼ばれるキーマップであり
CDRが32（<KBD>SPC</KBD>の文字コード）である項目は、
『<KBD>Meta-<KBD>SPC</KBD></KBD>のグローバルバインディングを
それがなんであれ使う』という意味になる。
</UL>
<P>

<DT><VAR>symbol</VAR>
<DD><A NAME="IDX1335"></A>
<A NAME="IDX1336"></A>
シンボル<VAR>symbol</VAR>のかわりにその関数定義を使う。
それがまたシンボルであると、この処理を何回でも繰り返す。
最終的にこれは、キーマップ、コマンド、キーボードマクロの
いずれかのオブジェクトになるはずである。
キーマップやコマンドであるリストは許されるが、
シンボルを介しては間接項目は使えない。
<P>

キーマップやキーボードマクロ（文字列やベクトル）は正しい関数ではないので、
関数定義としてキーマップ、文字列、ベクトルを持つシンボルは、
正しい関数ではない。
しかし、キーバインディングとしては正しい。
定義がキーボードマクロである場合には、そのシンボルは
<CODE>command-execute</CODE>の引数としても正しい
（see 節 <A HREF="elisp_21.html#SEC287">20.3 対話的呼び出し</A>）。
<P>

<A NAME="IDX1337"></A>
<A NAME="IDX1338"></A>
シンボル<CODE>undefined</CODE>について特記しておく。
これは、キーを未定義として扱うことを意味する。
正確には、キーは定義されており、
そのバインディングはコマンド<CODE>undefined</CODE>である。
しかし、そのコマンドは、未定義キーに対して自動的に行われることと
同じことを行う。
つまり、（<CODE>ding</CODE>を呼び出して）ベルを鳴らすが、
エラーは通知しない。
<P>

<A NAME="IDX1339"></A>
<CODE>undefined</CODE>は、グローバルキーバインディングを無効にして
キーをローカルに『未定義』にするためにローカルキーマップで使われる。
<CODE>nil</CODE>のローカルバインディングでは、
グローバルバインディングを無効にしないため、こうはならない。
<P>

<DT><VAR>その他</VAR>
<DD>その他の型のオブジェクトであると、
探索に使ったここまでのイベントは完全なキーを構成し、
当該オブジェクトがそのバインディングであるが、
当該バインディングはコマンドとしては実行できない。
</DL>
<P>

まとめると、キー項目は、キーマップ、コマンド、キーボードマクロ、
これら3つのいずれかになるシンボル、間接項目、<CODE>nil</CODE>です。
2つの文字をコマンドに、1つを別のキーマップに対応付ける
疎なキーマップの例を示します。
このキーマップは、<CODE>emacs-lisp-mode-map</CODE>の通常の値です。
ここで、それぞれ、9は<KBD>TAB</KBD>、
127は<KBD>DEL</KBD>、27は<KBD>ESC</KBD>、17は<KBD>C-q</KBD>、
24は<KBD>C-x</KBD>の文字コードであることに注意してください。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(keymap (9 . lisp-indent-line)
        (127 . backward-delete-char-untabify)
        (27 keymap (17 . indent-sexp) (24 . eval-defun)))
</pre></td></tr></table><P>

<A NAME="Functions for Key Lookup"></A>
<HR SIZE="6">
<br><A NAME="SEC325"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC324"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC326"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Functions for Key Lookup"></A>
<H2> 21.8 キー探索関数 </H2>
<!--docid::SEC325::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Functions%20for%20Key%20Lookup">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Functions%20for%20Key%20Lookup</a>"<br>
"texi/elisp21/キー探索関数"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%AD%A1%BC%C3%B5%BA%F7%B4%D8%BF%F4">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

ここでは、キー探索に関わる関数や変数について述べます。
<P>

<A NAME="IDX1340"></A>
<DL>
<DT><U>Function:</U> <B>lookup-key</B> <I>keymap key &#38;optional accept-defaults</I>
<DD>この関数はキーマップ<VAR>keymap</VAR>における<VAR>key</VAR>の定義を返す。
本章で述べる他の関数は、<CODE>lookup-key</CODE>を用いてキーを探す。
例を示す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(lookup-key (current-global-map) "\C-x\C-f")
    => find-file
(lookup-key (current-global-map) "\C-x\C-f12345")
    => 2
</pre></td></tr></table><P>

文字列やベクトルである<VAR>key</VAR>が、
<VAR>keymap</VAR>で指定されたプレフィックスキーに対して正しいキー列でなければ、
<VAR>key</VAR>は『長すぎる』のであって、
1つのキー列に収まらない余分なイベントが末尾にある。
その場合、戻り値は数であり、
完全なキーを構成する<VAR>key</VAR>の先頭からのイベント数を表す。
<P>

<VAR>accept-defaults</VAR>が<CODE>nil</CODE>以外であると、
<CODE>lookup-key</CODE>は、<VAR>key</VAR>の特定のイベントに
対するバインディングだけでなく、
デフォルトのバインディングも考慮する。
さもなければ、<CODE>lookup-key</CODE>は、
<VAR>key</VAR>の特定のイベントに対するバインディングだけを報告し、
特に指定しない限りデフォルトのバインディングは無視する。
（それには、<VAR>key</VAR>の要素として<CODE>t</CODE>を与える。
<A HREF="elisp_22.html#SEC319">21.2 キーマップの形式</A>を参照。）
<P>

<VAR>key</VAR>にメタ文字が含まれる場合、
当該文字は暗黙のうちに2文字の列、
つまり、<CODE>meta-prefix-char</CODE>の値と対応する非メタ文字
に置き換えられる。
したがって、つぎの最初の例は、2番目の例に変換して処理される。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(lookup-key (current-global-map) "\M-f")
    => forward-word
(lookup-key (current-global-map) "\ef")
    => forward-word
</pre></td></tr></table><P>

<CODE>read-key-sequence</CODE>と異なり、
この関数は、情報を欠落するようには指定されたイベントを修正しない
（see 節 <A HREF="elisp_21.html#SEC305">20.6.1 キー列の入力</A>）。
特に、文字を小文字に変換したり、
ドラッグイベントをクリックイベントに変換したりはしない。
</DL>
<P>

<A NAME="IDX1341"></A>
<DL>
<DT><U>コマンド:</U> <B>undefined</B>
<DD>キーを未定義にするためにキーマップで使われる。
<CODE>ding</CODE>を呼び出すが、エラーにはならない。
</DL>
<P>

<A NAME="IDX1342"></A>
<DL>
<DT><U>Function:</U> <B>key-binding</B> <I>key &#38;optional accept-defaults</I>
<DD>この関数は、すべての活性なキーマップを試して
<VAR>key</VAR>に対するバインディングを返す。
キーマップで<VAR>key</VAR>が未定義であると結果は<CODE>nil</CODE>。
<P>

引数<VAR>accept-defaults</VAR>は、<CODE>lookup-key</CODE>（上記）と同様に、
デフォルトのバインディングを調べるかどうか制御する。
<P>

<VAR>key</VAR>が文字列でもベクトルでもないとエラーを通知する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(key-binding "\C-x\C-f")
    => find-file
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1343"></A>
<DL>
<DT><U>Function:</U> <B>local-key-binding</B> <I>key &#38;optional accept-defaults</I>
<DD>この関数は、現在のローカルキーマップから
<VAR>key</VAR>に対するバインディングを返す。
未定義ならば<CODE>nil</CODE>を返す。
<P>

引数<VAR>accept-defaults</VAR>は、<CODE>lookup-key</CODE>（上記）と同様に、
デフォルトのバインディングを調べるかどうか制御する。
</DL>
<P>

<A NAME="IDX1344"></A>
<DL>
<DT><U>Function:</U> <B>global-key-binding</B> <I>key &#38;optional accept-defaults</I>
<DD>この関数は、現在のグローバルキーマップから
<VAR>key</VAR>に対するバインディングを返す。
未定義ならば<CODE>nil</CODE>を返す。
<P>

引数<VAR>accept-defaults</VAR>は、<CODE>lookup-key</CODE>（上記）と同様に、
デフォルトのバインディングを調べるかどうか制御する。
</DL>
<P>

<A NAME="IDX1345"></A>
<DL>
<DT><U>Function:</U> <B>minor-mode-key-binding</B> <I>key &#38;optional accept-defaults</I>
<DD>この関数は、すべてのオンになっているマイナモードにおける
<VAR>key</VAR>のバインディングのリストを返す。
より正確には、対<CODE>(<VAR>modename</VAR> . <VAR>binding</VAR>)</CODE>を要素とする
連想リストを返す。
ここで、<VAR>modename</VAR>はマイナモードをオンにする変数であり、
<VAR>binding</VAR>は当該モードにおける<VAR>key</VAR>のバインディングである。
<VAR>key</VAR>にマイナモードでのバインディングがなければ、
値は<CODE>nil</CODE>である。
<P>

最初にみつかったバインディングがプレフィックスの定義
（キーマップかキーマップとしてのシンボル）でなければ、
残りのマイナモードからのバインディングは完全に隠されてしまうので
それらは省略する。
同様に、プレフィックスバインディングに
続く非プレフィックスバインディングも省略する。
<P>

引数<VAR>accept-defaults</VAR>は、<CODE>lookup-key</CODE>（上記）と同様に、
デフォルトのバインディングを調べるかどうか制御する。
</DL>
<P>

<A NAME="IDX1346"></A>
<DL>
<DT><U>Variable:</U> <B>meta-prefix-char</B>
<DD><A NAME="IDX1347"></A>
この変数は、メタプレフィックス文字の文字コードである。
メタ文字をキーマップで探索するために2文字列に変換するときに使われる。
結果が有用であるためには、
この値はプレフィックスイベント（see 節 <A HREF="elisp_22.html#SEC322">21.5 プレフィックスキー</A>）であるべきである。
デフォルト値は27、<KBD>ESC</KBD>のASCIIコードである。
<P>

<CODE>meta-prefix-char</CODE>の値が27である限り、
キー探索では<KBD>M-b</KBD>を<KBD><KBD>ESC</KBD> b</KBD>に変換し、
通常、これはコマンド<CODE>backward-word</CODE>と定義されている。
しかし、<CODE>meta-prefix-char</CODE>に<KBD>C-x</KBD>のコードである24を設定すると、
Emacsは<KBD>M-b</KBD>を<KBD>C-x b</KBD>に変換し、
その標準のバインディングはコマンド<CODE>switch-to-buffer</CODE>である。
これを以下に示す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>meta-prefix-char                    ; デフォルト値
     => 27
(key-binding "\M-b")
     => backward-word
?\C-x                               ; 文字の表示表現
     => 24
(setq meta-prefix-char 24)
     => 24      
(key-binding "\M-b")
    => switch-to-buffer            ; ここで<KBD>M-b</KBD>と打つと
                                    ; <KBD>C-x b</KBD>と打つのと同じ

(setq meta-prefix-char 27)          ; 混乱を避けるために
     => 27                         ; デフォルト値に戻す！
</FONT></pre></td></tr></table></DL>
<P>

<A NAME="Changing Key Bindings"></A>
<HR SIZE="6">
<br><A NAME="SEC326"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC325"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC327"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Changing Key Bindings"></A>
<H2> 21.9 キーバインディングの変更 </H2>
<!--docid::SEC326::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Changing%20Key%20Bindings">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Changing%20Key%20Bindings</a>"<br>
"texi/elisp21/キーバインディングの変更"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%AD%A1%BC%A5%D0%A5%A4%A5%F3%A5%C7%A5%A3%A5%F3%A5%B0%A4%CE%CA%D1%B9%B9">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1348"></A>
<A NAME="IDX1349"></A>
<P>

キーを再バインドするには、キーマップにおける当該項目を変更します。
グローバルキーマップでバインディングを変更すると、
その変更はすべてのバッファで効果を発揮します
（ただし、ローカルキーマップでグローバルバインディングを
隠しているバッファでは直接の効果はない）。
カレントバッファのローカルキーマップで変更すると、
通常、同じメジャーモードを使っているすべてのバッファに影響します。
関数<CODE>global-set-key</CODE>や<CODE>local-set-key</CODE>は、
これらの操作を行うための便利なインターフェイスです
（see 節 <A HREF="elisp_22.html#SEC327">21.10 キーをバインドするためのコマンド</A>）。
より汎用の関数<CODE>define-key</CODE>を使うこともできますが、
変更対象のキーマップを明示する必要があります。
<P>

<A NAME="IDX1350"></A>
<A NAME="IDX1351"></A>
キー列の再バインドを書くときには、
コントロール文字やメタ文字向けの
特別なエスケープシーケンスを使うのがよいです（see 節 <A HREF="elisp_3.html#SEC34">2.3.8 文字列型</A>）。
構文`<SAMP>\C-</SAMP>'は後続の文字がコントロール文字であること、
構文`<SAMP>\M-</SAMP>'は後続の文字がメタ文字であることを意味します。
したがって、文字列<CODE>"\M-x"</CODE>は単一の<KBD>M-x</KBD>を含むと読まれ、
<CODE>"\C-f"</CODE>は単一の<KBD>C-f</KBD>を含むと読まれ、
<CODE>"\M-\C-x"</CODE>や<CODE>"\C-\M-x"</CODE>はいずれも単一の<KBD>C-M-x</KBD>を
含むと読まれます。
同じエスケープシーケンスは、
ベクトルでも使え、文字列が許されない他の場面でも使えます。
たとえば、`<SAMP>[?\C-\H-x home]</SAMP>'です。
See 節 <A HREF="elisp_3.html#SEC27">2.3.3 文字型</A>。
<P>

キーを定義したり探索する関数では、
ベクトルで表したキー列内のイベント型に対して別の構文、
つまり、修飾子名と1つの基本イベント（文字やファンクションキー名）
から成るリストを受け付けます。
たとえば、<CODE>(control ?a)</CODE>は<CODE>?\C-a</CODE>に等価であり、
<CODE>(hyper control left)</CODE>は<CODE>C-H-left</CODE>に等価です。
このようなリストの利点の1つは、
コンパイル済みのファイルに修飾ビットの数値が現れないことです。
<P>

以下の関数では、<VAR>keymap</VAR>がキーマップでなかったり、
<VAR>key</VAR>がキー列を表す文字列やベクトルでないと、エラーを通知します。
リストであるイベントの省略形としてイベント型（シンボル）を使えます。
<P>

<A NAME="IDX1352"></A>
<DL>
<DT><U>Function:</U> <B>define-key</B> <I>keymap key binding</I>
<DD>この関数は、キーマップ<VAR>keymap</VAR>において
キー<VAR>key</VAR>に対するバインディングを設定する。
（<VAR>key</VAR>が複数イベントの場合、
<VAR>keymap</VAR>から辿った別のキーマップが実際には変更される。）
引数<VAR>binding</VAR>は任意のLispオブジェクトであるが、
ある種の型のものだけが意味を持つ。
（意味のある型の一覧については、<A HREF="elisp_22.html#SEC324">21.7 キー探索</A>を参照。）
<CODE>define-key</CODE>が返す値は<VAR>binding</VAR>である。
<P>

<A NAME="IDX1353"></A>
<A NAME="IDX1354"></A>
<VAR>key</VAR>のおのおののプレフィックスはプレフィックスキーである
（キーマップにある）か未定義であること。
さもなければ、エラーを通知する。
<VAR>key</VAR>のプレフィックスに未定義なものがあると、
<CODE>define-key</CODE>は当該プレフィックスをプレフィックスキーと定義し、
<VAR>key</VAR>の残りの部分を指定どおりに定義できるようにする。
<P>

<VAR>keymap</VAR>に<VAR>key</VAR>のバインディングがなければ、
新たなバインディングを<VAR>keymap</VAR>の先頭に追加する。
キーマップ内のバインディングの順序は多くの場合関係ないが、
メニューキーマップでは意味を持つ（see 節 <A HREF="elisp_22.html#SEC329">21.12 メニューキーマップ</A>）。
</DL>
<P>

疎なキーマップを作成し、そこにバインディングを作る例を示します。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(setq map (make-sparse-keymap))
    => (keymap)
(define-key map "\C-f" 'forward-char)
    => forward-char
map
    => (keymap (6 . forward-char))

;; <KBD>C-x</KBD>用の疎なサブマップを作り、
;; そこに<KBD>f</KBD>のバインディングを入れる
(define-key map "\C-xf" 'forward-word)
    => forward-word
map
=> (keymap 
    (24 keymap                ; <KBD>C-x</KBD>
        (102 . forward-word)) ;      <KBD>f</KBD>
    (6 . forward-char))       ; <KBD>C-f</KBD>

;; <KBD>C-p</KBD>を<CODE>ctl-x-map</CODE>にバインドする
(define-key map "\C-p" ctl-x-map)
;; <CODE>ctl-x-map</CODE>
=> [nil <small>...</small> find-file <small>...</small> backward-kill-sentence] 

;; <CODE>ctl-x-map</CODE>で、<KBD>C-f</KBD>を<CODE>foo</CODE>にバインドする
(define-key map "\C-p\C-f" 'foo)
=> 'foo
map
=> (keymap     ; <CODE>foo</CODE>は<CODE>ctl-x-map</CODE>の中にある
    (16 keymap [nil <small>...</small> foo <small>...</small> backward-kill-sentence])
    (24 keymap 
        (102 . forward-word))
    (6 . forward-char))
</FONT></pre></td></tr></table><P>

<KBD>C-p C-f</KBD>に対する新しいバインディングは、
実際には<CODE>ctl-x-map</CODE>の項目を変更していて、
これには、<KBD>C-p C-f</KBD>とデフォルトのグローバルキーマップ内の
<KBD>C-x C-f</KBD>の両方のバインディングを変更する効果がある
ことに注意してください。
<P>

<A NAME="IDX1355"></A>
<DL>
<DT><U>Function:</U> <B>substitute-key-definition</B> <I>olddef newdef keymap &#38;optional oldmap</I>
<DD><A NAME="IDX1356"></A>
この関数は、<VAR>keymap</VAR>内の<VAR>olddef</VAR>にバインドされたキーの
<VAR>olddef</VAR>を<VAR>newdef</VAR>に置き換える。
いいかえると、<VAR>olddef</VAR>に出会うたびにそれを<VAR>newdef</VAR>に置き換える。
関数は<CODE>nil</CODE>を返す。
<P>

たとえば、Emacsの標準のバインディングであると、
つぎの例は<KBD>C-x C-f</KBD>を再定義する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(substitute-key-definition 
 'find-file 'find-file-read-only (current-global-map))
</FONT></pre></td></tr></table><P>

<VAR>oldmap</VAR>が<CODE>nil</CODE>以外であると、
そのバインディングによってどのキーを再バインドするかを決定する。
再バインディングは<VAR>keymap</VAR>で行い、<VAR>oldmap</VAR>ではない。
つまり、別のキーマップ内のバインディングの制御のもとに、
キーマップを変更できる。
たとえば、
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(substitute-key-definition
  'delete-backward-char 'my-funny-delete
  my-map global-map)
</FONT></pre></td></tr></table><P>

では、グローバルには標準の削除コマンドにバインドされているキーに対しては、
<CODE>my-map</CODE>では特別な削除コマンドにする。
<P>

変更前後のキーマップを以下に示す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(setq map '(keymap 
            (?1 . olddef-1) 
            (?2 . olddef-2) 
            (?3 . olddef-1)))
=> (keymap (49 . olddef-1) (50 . olddef-2) (51 . olddef-1))

(substitute-key-definition 'olddef-1 'newdef map)
=> nil
map
=> (keymap (49 . newdef) (50 . olddef-2) (51 . newdef))
</FONT></pre></td></tr></table></DL>
<P>

<A NAME="IDX1357"></A>
<DL>
<DT><U>Function:</U> <B>suppress-keymap</B> <I>keymap &#38;optional nodigits</I>
<DD><A NAME="IDX1358"></A>
この関数は、完全なキーマップ<VAR>keymap</VAR>の内容を変更し、
すべての印字文字を未定義にする。
より正確には、それらにコマンド<CODE>undefined</CODE>をバインドする。
これにより、通常のテキストの挿入を不可能にする。
<CODE>suppress-keymap</CODE>は<CODE>nil</CODE>を返す。
<P>

<VAR>nodigits</VAR>が<CODE>nil</CODE>であると、
<CODE>suppress-keymap</CODE>は、
数字文字では<CODE>digit-argument</CODE>を実行し、
<KBD>-</KBD>では<CODE>negative-argument</CODE>を実行するように定義する。
さもなければ、それらも他の印字文字と同様に未定義にする。
<P>

<A NAME="IDX1359"></A>
<A NAME="IDX1360"></A>
関数<CODE>suppress-keymap</CODE>は、
<CODE>yank</CODE>や<CODE>quoted-insert</CODE>などのコマンドを抑制しないので、
バッファを変更不可能にするわけではない。
バッファの変更を禁止するには、バッファを読み出し専用にする
（see 節 <A HREF="elisp_27.html#SEC410">26.7 読み出し専用バッファ <EM>(2003/10/30)</EM></A>）。
<P>

この関数は<VAR>keymap</VAR>を変更するため、
読者は、通常、新たに作成したキーマップに対して使うであろう。
ある目的で使用中の既存のキーマップを操作すると、
問題を引き起こすことがある。
たとえば、<CODE>global-map</CODE>に適用するとEmacsをほとんど使用不能にしてしまう。
<P>

多くの場合、テキストの挿入が必要なくバッファを読み出し専用で使う
rmailやdiredなどのモードのローカルキーマップの初期化に
<CODE>suppress-keymap</CODE>を使う。
ファイル`<TT>emacs/lisp/dired.el</TT>'から持ってきた例を示す。
これは、diredモード用のローカルキーマップの設定方法である。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(setq dired-mode-map (make-keymap))
(suppress-keymap dired-mode-map)
(define-key dired-mode-map "r" 'dired-rename-file)
(define-key dired-mode-map "\C-d" 'dired-flag-file-deleted)
(define-key dired-mode-map "d" 'dired-flag-file-deleted)
(define-key dired-mode-map "v" 'dired-view-file)
(define-key dired-mode-map "e" 'dired-find-file)
(define-key dired-mode-map "f" 'dired-find-file)
<small>...</small>
</FONT></pre></td></tr></table></DL>
<P>

<A NAME="Key Binding Commands"></A>
<HR SIZE="6">
<br><A NAME="SEC327"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC326"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC328"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Key Binding Commands"></A>
<H2> 21.10 キーをバインドするためのコマンド </H2>
<!--docid::SEC327::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Key%20Binding%20Commands">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Key%20Binding%20Commands</a>"<br>
"texi/elisp21/キーをバインドするためのコマンド"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%AD%A1%BC%A4%F2%A5%D0%A5%A4%A5%F3%A5%C9%A4%B9%A4%EB%A4%BF%A4%E1%A4%CE%A5%B3%A5%DE%A5%F3%A5%C9">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

本節では、キーのバインディングを変更する
便利で対話的なインターフェイスについて述べます。
これらは、<CODE>define-key</CODE>を呼び出して動作します。
<P>

単純なカスタマイズのために
ファイル`<TT>.emacs</TT>'で<CODE>global-set-key</CODE>をしばしば使います。
たとえば、
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(global-set-key "\C-x\C-\\" 'next-line)
</FONT></pre></td></tr></table><P>

や
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(global-set-key [?\C-x ?\C-\\] 'next-line)
</FONT></pre></td></tr></table><P>

や
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(global-set-key [(control ?x) (control ?\\)] 'next-line)
</FONT></pre></td></tr></table><P>

は、1行下がるように<KBD>C-x C-\</KBD>を再定義します。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(global-set-key [M-mouse-1] 'mouse-set-point)
</FONT></pre></td></tr></table><P>

は、メタキーを押し下げながらマウスの第1ボタン（左端）をクリックすると
クリック位置にポイントを設定するように再定義します。
<P>

<A NAME="IDX1361"></A>
<DL>
<DT><U>コマンド:</U> <B>global-set-key</B> <I>key definition</I>
<DD>この関数は、現在のグローバルキーマップにおいて
<VAR>key</VAR>のバインディングを<VAR>definition</VAR>と設定する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(global-set-key <VAR>key</VAR> <VAR>definition</VAR>)
==
(define-key (current-global-map) <VAR>key</VAR> <VAR>definition</VAR>)
</FONT></pre></td></tr></table></DL>
<P>

<A NAME="IDX1362"></A>
<DL>
<DT><U>コマンド:</U> <B>global-unset-key</B> <I>key</I>
<DD><A NAME="IDX1363"></A>
この関数は、現在のグローバルキーマップから
<VAR>key</VAR>のバインディングを削除する。
<P>

この関数の1つの用途は、
<VAR>key</VAR>に非プレフィックスのバインディングがあると再定義できないため、
<VAR>key</VAR>をプレフィックスとして使う長いキーを定義する前準備である。
たとえば、つぎのとおり。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(global-unset-key "\C-l")
    => nil
(global-set-key "\C-l\C-l" 'redraw-display)
    => nil
</FONT></pre></td></tr></table><P>

この関数は単に<CODE>define-key</CODE>を使って実装してある。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(global-unset-key <VAR>key</VAR>)
==
(define-key (current-global-map) <VAR>key</VAR> nil)
</FONT></pre></td></tr></table></DL>
<P>

<A NAME="IDX1364"></A>
<DL>
<DT><U>コマンド:</U> <B>local-set-key</B> <I>key definition</I>
<DD>この関数は、現在のローカルキーマップにおいて
<VAR>key</VAR>のバインディングを<VAR>definition</VAR>と設定する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(local-set-key <VAR>key</VAR> <VAR>definition</VAR>)
==
(define-key (current-local-map) <VAR>key</VAR> <VAR>definition</VAR>)
</FONT></pre></td></tr></table></DL>
<P>

<A NAME="IDX1365"></A>
<DL>
<DT><U>コマンド:</U> <B>local-unset-key</B> <I>key</I>
<DD>この関数は、現在のローカルキーマップから
<VAR>key</VAR>のバインディングを削除する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(local-unset-key <VAR>key</VAR>)
==
(define-key (current-local-map) <VAR>key</VAR> nil)
</FONT></pre></td></tr></table></DL>
<P>

<A NAME="Scanning Keymaps"></A>
<HR SIZE="6">
<br><A NAME="SEC328"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC327"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC329"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Scanning Keymaps"></A>
<H2> 21.11 キーマップの走査 </H2>
<!--docid::SEC328::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Scanning%20Keymaps">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Scanning%20Keymaps</a>"<br>
"texi/elisp21/キーマップの走査"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%AD%A1%BC%A5%DE%A5%C3%A5%D7%A4%CE%C1%F6%BA%BA">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

本節では、ヘルプ情報を表示するために
現在のキーマップをすべて走査する関数について述べます。
<P>

<A NAME="IDX1366"></A>
<DL>
<DT><U>Function:</U> <B>accessible-keymaps</B> <I>keymap &#38;optional prefix</I>
<DD>この関数は、<VAR>keymap</VAR>から（0個以上のプレフィックスキーにより）辿れる
すべてのキーマップのリストを返す。
その値は、<CODE>(<VAR>key</VAR> . <VAR>map</VAR>)</CODE>の形の要素から成る
連想リストである。
ここで、<VAR>key</VAR>はプレフィックスキーであり、
<VAR>keymap</VAR>内でのその定義は<VAR>map</VAR>である。
<P>

連想リスト内での要素の順番は、<VAR>key</VAR>の長さが増える順である。
指定したキーマップ<VAR>keymap</VAR>はプレフィックスのイベントなしに参照できるので、
最初の要素はつねに<CODE>("" . <VAR>keymap</VAR>)</CODE>である。
<P>

<VAR>prefix</VAR>を与える場合、それはプレフィックスキー列であること。
すると、<CODE>accessible-keymaps</CODE>は、
<VAR>prefix</VAR>で始まるプレフィックスに対応したサブマップのみを含める。
それらの要素は、<CODE>(accessible-keymaps)</CODE>の値と同じに見えるが、
違いは、いくつかの要素が省略されることである。
<P>

つぎの例では、返された連想リストにおいては、
`<SAMP>^[</SAMP>'と表示されたキー<KBD>ESC</KBD>はプレフィックスキーであり、
その定義は疎なキーマップ
<CODE>(keymap (83 . center-paragraph) (115 . foo))</CODE>であることを表す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(accessible-keymaps (current-local-map))
=>(("" keymap 
      (27 keymap   ; Note this keymap for <KBD>ESC</KBD> is repeated below.
          (83 . center-paragraph)
          (115 . center-line))
      (9 . tab-to-tab-stop))

   ("^[" keymap 
    (83 . center-paragraph) 
    (115 . foo)))
</FONT></pre></td></tr></table><P>

つぎの例では、<KBD>C-h</KBD>は、
疎なキーマップ<CODE>(keymap (118 . describe-variable)<small>...</small>)</CODE>を
使うプレフィックスキーである。
別のプレフィックス<KBD>C-x 4</KBD>は、
変数<CODE>ctl-x-4-map</CODE>の値でもあるキーマップを使う。
イベント<CODE>mode-line</CODE>は、
ウィンドウの特別な箇所におけるマウス操作を表すための
疑似イベントの1つである。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(accessible-keymaps (current-global-map))
=> (("" keymap [set-mark-command beginning-of-line <small>...</small> 
                   delete-backward-char])
    ("^H" keymap (118 . describe-variable) <small>...</small>
     (8 . help-for-help))
    ("^X" keymap [x-flush-mouse-queue <small>...</small>
     backward-kill-sentence])
    ("^[" keymap [mark-sexp backward-sexp <small>...</small>
     backward-kill-word])
    ("^X4" keymap (15 . display-buffer) <small>...</small>)
    ([mode-line] keymap
     (S-mouse-2 . mouse-split-window-horizontally) <small>...</small>))
</FONT></pre></td></tr></table><P>

実際に表示されるキーマップはこれらだけとは限らない。
</DL>
<P>

<A NAME="IDX1367"></A>
<DL>
<DT><U>Function:</U> <B>where-is-internal</B> <I>command &#38;optional keymap firstonly noindirect</I>
<DD>この関数は、コマンド<CODE>where-is</CODE>
（see <a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=emacs21&node=Help">GNU Emacs マニュアル</a>）が使う
サブルーティンである。
キーマップにおいて<VAR>command</VAR>にバインドされた
（任意長の）キー列のリストを返す。
<P>

引数<VAR>command</VAR>は任意のオブジェクトであり、
キーマップ項目とは<CODE>eq</CODE>で比較する。
<P>

<VAR>keymap</VAR>が<CODE>nil</CODE>であると、
<CODE>overriding-local-map</CODE>を無視
（つまり、その値は<CODE>nil</CODE>とみな）して、
現在活性なキーマップを使う。
<VAR>keymap</VAR>が<CODE>nil</CODE>以外であると、
<VAR>keymap</VAR>とグローバルキーマップから辿れるキーマップを使う。
<P>

通常、<VAR>keymap</VAR>に対する式には<CODE>overriding-local-map</CODE>を使うのが
最良である。
そうすると、<CODE>where-is-internal</CODE>は正確に活性なキーマップを走査する。
グローバルキーマップのみを走査するには、
<VAR>keymap</VAR>として<CODE>(keymap)</CODE>（空のキーマップ）を渡す。
<P>

<VAR>firstonly</VAR>が<CODE>non-ascii</CODE>であると、
戻り値は、可能なキー列のリストではなく、
最初にみつかったキー列を表す1つの文字列である。
<VAR>firstonly</VAR>が<CODE>t</CODE>であると、
値は最初のキー列であるが、
ASCII文字（あるいはASCII文字のメタ変種）のみから成るキー列が
他のキー列より優先される。
<P>

<VAR>noindirect</VAR>が<CODE>nil</CODE>以外であると、
<CODE>where-is-internal</CODE>は間接項目を辿らない。
これにより、間接項目そのものを探すことができる。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(where-is-internal 'describe-function)
    => ("\^hf" "\^hd")
</FONT></pre></td></tr></table></DL>
<P>

<A NAME="IDX1368"></A>
<DL>
<DT><U>コマンド:</U> <B>describe-bindings</B> <I>&#38;optional prefix</I>
<DD>この関数は、現在のすべてのキーバインディングの一覧を作成し、
`<SAMP>*Help*</SAMP>'という名前のバッファに表示する。
テキストはモードごとにまとめられ、
マイナモード、メジャーモード、グローバルバインディングの順である。
<P>

<VAR>prefix</VAR>が<CODE>nil</CODE>以外であると、それはプレフィックスキーであること。
そうすると、<VAR>prefix</VAR>で始まるキーのみの一覧を作る。
<P>

一覧では、メタ文字は、<KBD>ESC</KBD>に続けて対応する非メタ文字で表す。
<P>

連続したASCIIコードの一連の文字が同じ定義である場合には、
それらをまとめて`<SAMP><VAR>firstchar</VAR>..<VAR>lastchar</VAR></SAMP>'と表示する。
この場合、どの文字であるか理解するには、
ASCIIコードを知っている必要がある。
たとえば、デフォルトのグローバルキーマップでは、
`<SAMP><KBD>SPC</KBD>.. ~</SAMP>'の文字が1行に表示される。
<KBD>SPC</KBD>はASCIIコード32、<KBD>~</KBD>はASCIIコード126であり、
そのあいだには普通の印字文字（英文字、数字文字、句読点文字など）が
すべて含まれる。
これらの文字はすべて<CODE>self-insert-command</CODE>にバインドされている。
</DL>
<P>

<A NAME="Menu Keymaps"></A>
<HR SIZE="6">
<br><A NAME="SEC329"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC328"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC330"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Menu Keymaps"></A>
<H2> 21.12 メニューキーマップ </H2>
<!--docid::SEC329::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Menu%20Keymaps">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Menu%20Keymaps</a>"<br>
"texi/elisp21/メニューキーマップ"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%E1%A5%CB%A5%E5%A1%BC%A5%AD%A1%BC%A5%DE%A5%C3%A5%D7">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1369"></A>
<P>

キーマップは、キーボードのキーやマウスボタンに対するバインディングに加えて
メニューも定義できます。
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_22.html#SEC330">21.12.1 メニューの定義</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How to make a keymap that defines a menu.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_22.html#SEC334">21.12.2 メニューとマウス</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How users actuate the menu with the mouse.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_22.html#SEC335">21.12.3 メニューとキーボード</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How they actuate it with the keyboard.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_22.html#SEC336">21.12.4 メニューの例</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Making a simple menu.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_22.html#SEC337">21.12.5 メニューバー</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How to customize the menu bar.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_22.html#SEC338">21.12.6 メニューの修正</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How to add new items to a menu.</TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Defining Menus"></A>
<HR SIZE="6">
<br><A NAME="SEC330"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC329"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC331"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Defining Menus"></A>
<H3> 21.12.1 メニューの定義 </H3>
<!--docid::SEC330::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Defining%20Menus">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Defining%20Menus</a>"<br>
"texi/elisp21/メニューの定義"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%E1%A5%CB%A5%E5%A1%BC%A4%CE%C4%EA%B5%C1">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1370"></A>
<A NAME="IDX1371"></A>
<A NAME="IDX1372"></A>
<P>

キーマップに<EM>全面プロンプト文字列</EM>（overall prompt string）、
つまり、キーマップの要素として文字列が現れれば、
メニューとして使えます。
その文字列でメニューの目的を記述します。
プロンプト文字列を持ったキーマップを作成するもっとも簡単な方法は、
<CODE>make-keymap</CODE>や<CODE>make-sparse-keymap</CODE>（see 節 <A HREF="elisp_22.html#SEC320">21.3 キーマップの作成</A>）を
呼ぶときに、引数として文字列を指定します。
<P>

メニュー上での項目の順番は、
キーマップ内のバインディングの順番と同じです。
<CODE>define-key</CODE>は、新たなバインディングを先頭に追加するので、
順番を気にするのならば、メニューの底の項目から始めて
上の項目へ向かってメニュー項目の定義を入れます。
既存のメニューに項目を追加する場合には、
<CODE>define-key-after</CODE>（see 節 <A HREF="elisp_22.html#SEC338">21.12.6 メニューの修正</A>）を使って
メニュー内での位置を指定できます。
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_22.html#SEC331">21.12.1.1 単純なメニュー項目</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">A simple kind of menu key binding,
                              limited in capabilities.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_22.html#SEC333">21.12.1.3 メニュー項目の別名</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Using command aliases in menu items.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_22.html#SEC332">21.12.1.2 拡張メニュー項目</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">More powerful menu item definitions
                              let you specify keywords to enable
                              various features.</TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Simple Menu Items"></A>
<HR SIZE="6">
<br><A NAME="SEC331"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC330"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC332"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Simple Menu Items"></A>
<H4> 21.12.1.1 単純なメニュー項目 </H4>
<!--docid::SEC331::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Simple%20Menu%20Items">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Simple%20Menu%20Items</a>"<br>
"texi/elisp21/単純なメニュー項目"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%C3%B1%BD%E3%A4%CA%A5%E1%A5%CB%A5%E5%A1%BC%B9%E0%CC%DC">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

メニューキーマップのバインディングを定義する単純で旧式の方法は
つぎのとおりです。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(<VAR>item-string</VAR> . <VAR>real-binding</VAR>)
</pre></td></tr></table><P>

CARの<VAR>item-string</VAR>は、メニューに表示される文字列です。
3単語までの短いものにし、対応するコマンドの動作を記述します。
<P>

つぎのように、ヘルプ文字列となる2つめの文字列も指定できます。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(<VAR>item-string</VAR> <VAR>help-string</VAR> . <VAR>real-binding</VAR>)
</pre></td></tr></table><P>

現状では、Emacsは実際には<VAR>help-string</VAR>を使いません。
<VAR>real-binding</VAR>を取り出すために<VAR>help-string</VAR>を無視する方法を
知っているだけです。
将来、ユーザーの要望に応じてメニュー項目に対する追加説明として
<VAR>help-string</VAR>を使うかもしれません。
<P>

<CODE>define-key</CODE>に関する限り、
<VAR>item-string</VAR>と<VAR>help-string</VAR>は
イベントのバインディングの一部分です。
しかし、<CODE>lookup-key</CODE>は<VAR>real-binding</VAR>のみを返し、
キーの実行には<VAR>real-binding</VAR>のみが使われます。
<P>

<VAR>real-binding</VAR>が<CODE>nil</CODE>であると、
<VAR>item-string</VAR>はメニューに現れますが、それは選択できません。
<P>

<VAR>real-binding</VAR>がシンボルであり、
その属性<CODE>menu-enable</CODE>が<CODE>nil</CODE>以外であると、
当該属性は、メニュー項目を活性にするかどうかを制御する式です。
Emacsは、メニューを表示するためにキーマップを使うたびに、
その式を評価し、式の値が<CODE>nil</CODE>以外である場合に限り、
当該メニュー項目をオンにします。
メニュー項目がオフであると、『薄く』表示し、それは選択できません。
<P>

メニューバーでは、読者がメニューを見るたびにどの項目がオンであるかを
再計算しません。
Xツールキットがあらかじめメニューの木構造全体を必要とするからです。
メニューバーの再計算を強制するには、
<CODE>force-mode-line-update</CODE>を呼び出します。
（see 節 <A HREF="elisp_23.html#SEC350">22.3 モード行の書式</A>）。
<P>

メニュー項目には、同じコマンドを起動する等価なキーボードのキー列が
（あれば）表示されていることに気づいたと思います。
再計算の時間を節約するために、
メニューの表示では、この情報をつぎのように
バインディングの部分リストに隠し持っています。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(<VAR>item-string</VAR> [<VAR>help-string</VAR>] (<VAR>key-binding-data</VAR>) . <VAR>real-binding</VAR>)
</pre></td></tr></table><P>

読者は、メニュー項目にこれらの部分リストを入れないでください。
それらはメニューの表示で自動的に計算されます。
冗長になるので、項目の文字列には、等価なキーボード入力を
含めないでください。
<P>

<A NAME="Extended Menu Items"></A>
<HR SIZE="6">
<br><A NAME="SEC332"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC331"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC333"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Extended Menu Items"></A>
<H4> 21.12.1.2 拡張メニュー項目 </H4>
<!--docid::SEC332::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Extended%20Menu%20Items">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Extended%20Menu%20Items</a>"<br>
"texi/elisp21/拡張メニュー項目"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%B3%C8%C4%A5%A5%E1%A5%CB%A5%E5%A1%BC%B9%E0%CC%DC">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1373"></A>
<P>

拡張形式のメニュー項目は、より柔軟性があり、
単純な形式より見通しがよい代替方法です。
それらは、シンボル<CODE>menu-item</CODE>で始まるリストから成ります。
選択不可の文字列を定義するには、項目をつぎのようにします。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(menu-item <VAR>item-name</VAR>)
</pre></td></tr></table><P>

ここで、文字列<VAR>item-name</VAR>は区切り行を表す複数個のダッシュから成ります。
<P>

選択可能な実際のメニュー項目を定義するには、
拡張形式の項目はつぎのようになります。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(menu-item <VAR>item-name</VAR> <VAR>real-binding</VAR>
    . <VAR>item-property-list</VAR>)
</pre></td></tr></table><P>

ここで、<VAR>item-name</VAR>は、メニュー項目の文字列に評価される式です。
つまり、（項目の）文字列は定数である必要はありません。
3番目の要素<VAR>item-property-list</VAR>は実行すべきコマンドです。
リストの残り<VAR>item-property-list</VAR>は、
他の情報を含んだ属性リストの形式です。
指定できる属性はつぎのとおりです。
<P>

<DL COMPACT>
<DT><CODE>:enable FORM</CODE>
<DD><VAR>form</VAR>の評価結果で、項目をオンにするかどうか決定する
（<CODE>nil</CODE>以外だとオン）。
<P>

<DT><CODE>:visible FORM</CODE>
<DD><VAR>form</VAR>の評価結果で、項目をメニューに含めるかどうか決定する。
（<CODE>nil</CODE>以外だと含める）。
項目を含めない場合、当該項目が定義されていないかのようにメニューを表示する。
<P>

<DT><CODE>:help <VAR>help</VAR></CODE>
<DD>この属性の値<VAR>help</VAR>は、拡張ヘルプ文字列
（現状ではEmacsは使わない）。
<P>

<DT><CODE>:button (<VAR>type</VAR> . <VAR>selected</VAR>)</CODE>
<DD>この属性は、ラジオボタンとトグルボタンを定義する方法を提供する。
CARの<VAR>type</VAR>は、<CODE>:toggle</CODE>か<CODE>:radio</CODE>であり、
どちらであるかを指定する。
CDRの<VAR>selected</VAR>はフォームであること。
その評価結果が、現在ボタンが選択されているかどうかを決定する。
<P>

<EM>トグル</EM>（toggle）は、<VAR>selected</VAR>の値に応じて
『on』か『off』と書かれるメニュー項目である。
コマンド自身では、<VAR>selected</VAR>が<CODE>nil</CODE>ならば
<VAR>selected</VAR>に<CODE>t</CODE>を設定し、
<CODE>t</CODE>ならば<CODE>nil</CODE>を設定すること。
以下は、<CODE>debug-on-error</CODE>が定義されていれば
<CODE>debug-on-error</CODE>をオン／オフするメニュー項目の書き方である。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(menu-item "Debug on Error" toggle-debug-on-error
           :button (:toggle
                    . (and (boundp 'debug-on-error)
                           debug-on-error))
</pre></td></tr></table><P>

これは、変数<CODE>debug-on-error</CODE>をオン／オフするコマンドとして
<CODE>toggle-debug-on-error</CODE>が定義されているので動作する。
<P>

<EM>ラジオボタン</EM>（radio button）はメニュー項目のグループであり、
ある時点ではそれらのうちの1つだけを『選択』できる。
どれを選択しているかを表す変数が必要である。
グループ内の各ラジオボタンに対するフォーム<VAR>selected</VAR>は、
当該変数の値が当該ボタンを選択している値かどうかを検査する。
ボタンをクリックすると、クリックしたボタンが選択されるように
当該変数に設定すること。
<P>

<DT><CODE>:key-sequence <VAR>key-sequence</VAR></CODE>
<DD>この属性は、このメニュー項目が起動するコマンドにバインド
される可能性があるキー列を指定する。
正しいキー列を指定すると、メニュー表示の準備が素早くなる。
<P>

まちがったキー列を指定しても、その効果はない。
メニューに<VAR>key-sequence</VAR>を表示するまえに、
Emacsは<VAR>key-sequence</VAR>がこのメニュー項目に実際に等価かどうか調べる。
<P>

<DT><CODE>:key-sequence nil</CODE>
<DD>この属性は、このメニュー項目に等価なキーバインディングが
普通はないことを示す。
この属性を使うとメニュー表示の準備時間を節約できる。
Emacsはこのメニュー項目に等価なキーボード入力をキーマップで
探す必要がないからである。
<P>

しかし、ユーザーがこの項目の定義に対してキー列を再バインドすると、
Emacsは属性<CODE>:keys</CODE>を無視して等価なキーボード入力を探す。
<P>

<DT><CODE>:keys <VAR>string</VAR></CODE>
<DD>この属性は、このメニュー項目に対する等価なキーボード入力として
表示する文字列<VAR>string</VAR>を指定する。
<VAR>string</VAR>では説明文の`<SAMP>\\[...]</SAMP>'の書き方を使える。
<P>

<DT><CODE>:filter <VAR>filter-fn</VAR></CODE>
<DD>この属性は、動的にメニュー項目を計算する方法を与える。
属性値<VAR>filter-fn</VAR>は1引数の関数であること。
それが呼ばれるとき、引数は<VAR>real-binding</VAR>になる。
関数はかわりに使用するバインディングを返すこと。
</DL>
<P>

<A NAME="Alias Menu Items"></A>
<HR SIZE="6">
<br><A NAME="SEC333"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC332"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC334"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Alias Menu Items"></A>
<H4> 21.12.1.3 メニュー項目の別名 </H4>
<!--docid::SEC333::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Alias%20Menu%20Items">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Alias%20Menu%20Items</a>"<br>
"texi/elisp21/メニュー項目の別名"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%E1%A5%CB%A5%E5%A1%BC%B9%E0%CC%DC%A4%CE%CA%CC%CC%BE">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

『同じ』コマンドを使いながらオン条件が異なるメニュー項目を
作れると便利なことがあります。
現状のEmacsでこれを行う最良の方法は、拡張メニュー項目を使うことです。
この機能がなかった頃には、コマンドの別名を定義し、
それをメニュー項目で使うことで可能でした。
異なるオン条件で<CODE>toggle-read-only</CODE>を
使う2つの別名の作り方を以下に示します。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defalias 'make-read-only 'toggle-read-only)
(put 'make-read-only 'menu-enable '(not buffer-read-only))
(defalias 'make-writable 'toggle-read-only)
(put 'make-writable 'menu-enable 'buffer-read-only)
</pre></td></tr></table><P>

メニューに別名を使うときには、
（典型的にはメニュー以外にはキーバインディングがない）別名ではなく
『本物の』コマンド名に対する等価なキーバインディングを
表示しするのがしばしば有用です。
これを行うには、別名のシンボルには
<CODE>nil</CODE>以外の属性<CODE>menu-alias</CODE>を与えます。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(put 'make-read-only 'menu-alias t)
(put 'make-writable 'menu-alias t)
</pre></td></tr></table><P>

こうすると、<CODE>make-read-only</CODE>と<CODE>make-writable</CODE>のメニュー項目には
<CODE>toggle-read-only</CODE>に対するキーバインディングが表示されます。
<P>

<A NAME="Mouse Menus"></A>
<HR SIZE="6">
<br><A NAME="SEC334"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC333"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC335"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Mouse Menus"></A>
<H3> 21.12.2 メニューとマウス </H3>
<!--docid::SEC334::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Mouse%20Menus">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Mouse%20Menus</a>"<br>
"texi/elisp21/メニューとマウス"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%E1%A5%CB%A5%E5%A1%BC%A4%C8%A5%DE%A5%A6%A5%B9">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

メニューキーマップがメニューを表示するようにする普通の方法は、
メニューキーマップをプレフィックスキーの定義にすることです。
（Lispプログラムから明示的にメニューをポップアップして、
ユーザーの選択を受け取れる。
<A HREF="elisp_29.html#SEC453">28.15 ポップアップメニュー</A>を参照。）
<P>

プレフィックスキーがマウスイベントで終っていると、
Emacsはメニューをポップアップすることでメニューキーマップを扱います。
これで、ユーザーはマウスで選択できるようになります。
ユーザーがメニュー項目をクリックすると、
当該メニュー項目をバインディングとする文字やシンボルが
イベントとして生成されます。
（メニューが複数レベルになっていたりメニューバーから開いたときには、
メニュー項目は一連のイベントを生成する。）
<P>

メニューの開始にはボタン押し下げイベントを使うのがしばしば最良です。
そうすると、ユーザーはボタンを離すことでメニュー項目を選べます。
<P>

明示的に配置すれば、1つのキーマップをメニューペインとして表示できます。
それには、各ペインに対するキーマップを作成し、
つぎに、メニューのメインのキーマップにおいて、
（各ペインの）各キーマップに対するバインディングを作ります。
なお、これらのバインディングには、
`<SAMP>&#64;</SAMP>'で始まる項目文字列を指定します。
項目文字列の残りの部分がペインの名前になります。
この例についてはファイル`<TT>lisp/mouse.el</TT>'を参照してください。
`<SAMP>&#64;</SAMP>'で始まらない項目文字列の他の普通のバインディングは
1つのペインにまとめられ、サブマップに対して明示的に作られた
他のペインとともに表示されます。
<P>

Xツールキットのメニューにはペインはありませんが、
そのかわりに、サブメニューがあります。
項目文字列が`<SAMP>&#64;</SAMP>'で始まるかどうかに関わらず、
入れ子になった各キーマップがサブメニューになります。
Emacsのツールキット版では、項目文字列の先頭の`<SAMP>&#64;</SAMP>'に関して特別なことは、
`<SAMP>&#64;</SAMP>'がメニュー項目に表示されないことです。
<P>

個別のキーマップからも複数ペインやサブメニューを作成できます。
プレフィックスキーの完全な定義は、
さまざまな活性のキーマップ（マイナモード、ローカル、グローバル）が与える
定義を併合することで得られます。
これらのキーマップのうち複数個がメニューであるとき、
そのおのおのが別々のペイン（Xツールキットを使わないEmacs）や
別々のサブメニュー（Xツールキットを使ったEmacs）になります。
See 節 <A HREF="elisp_22.html#SEC323">21.6 活性なキーマップ</A>。
<P>

<A NAME="Keyboard Menus"></A>
<HR SIZE="6">
<br><A NAME="SEC335"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC334"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC336"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Keyboard Menus"></A>
<H3> 21.12.3 メニューとキーボード </H3>
<!--docid::SEC335::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Keyboard%20Menus">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Keyboard%20Menus</a>"<br>
"texi/elisp21/メニューとキーボード"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%E1%A5%CB%A5%E5%A1%BC%A4%C8%A5%AD%A1%BC%A5%DC%A1%BC%A5%C9">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

キーボードイベント（文字や関数）で終るプレフィックスキーに、
メニューキーマップであるような定義があると、
ユーザーはメニュー項目を選ぶためにキーボードを使えます。
<P>

Emacsはメニューの選択項目（バインディングの項目文字列）を
エコー領域に表示します。
それらが1行に収まらなければ、
ユーザーは<KBD>SPC</KBD>を打つことで選択項目のつぎの行を見ることができます。
<KBD>SPC</KBD>を連続して使うと最終的にはメニューの最後に達し、
そうするとメニューの先頭に戻ります。
（変数<CODE>menu-prompt-more-char</CODE>に、このために用いる文字を指定する。
デフォルトは<KBD>SPC</KBD>。）
<P>

ユーザーは、メニューから望みの項目をみつけたら、
対応する文字、つまり、その項目のバインディングを持つ文字を打ちます。
<P>

Emacs類似エディタにおけるこのようなメニューの使い方は、
システムHierarkeyに触発されたからです。
<P>

<A NAME="IDX1374"></A>
<DL>
<DT><U>Variable:</U> <B>menu-prompt-more-char</B>
<DD>この変数は、メニューのつぎの行を見るために使う文字を指定する。
初期値は、<KBD>SPC</KBD>の文字コードの32である。
</DL>
<P>

<A NAME="Menu Example"></A>
<HR SIZE="6">
<br><A NAME="SEC336"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC335"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC337"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Menu Example"></A>
<H3> 21.12.4 メニューの例 </H3>
<!--docid::SEC336::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Menu%20Example">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Menu%20Example</a>"<br>
"texi/elisp21/メニューの例"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%E1%A5%CB%A5%E5%A1%BC%A4%CE%CE%E3">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1375"></A>
<P>

以下に、メニューキーマップの完全な定義の例を示します。
これは、メニューバーのメニュー`<SAMP>Tools</SAMP>'の
サブメニュー`<SAMP>Print</SAMP>'の定義であり、
単純なメニュー項目を使います
（see 節 <A HREF="elisp_22.html#SEC331">21.12.1.1 単純なメニュー項目</A>）。
まず、キーマップを作成し名前を与えます。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defvar menu-bar-print-menu (make-sparse-keymap "Print"))
</pre></td></tr></table><P>

つぎに、メニュー項目を定義します。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(define-key menu-bar-print-menu [ps-print-region]
  '("Postscript Print Region" . ps-print-region-with-faces))
(define-key menu-bar-print-menu [ps-print-buffer]
  '("Postscript Print Buffer" . ps-print-buffer-with-faces))
(define-key menu-bar-print-menu [separator-ps-print]
  '("--"))
(define-key menu-bar-print-menu [print-region]
  '("Print Region" . print-region))
(define-key menu-bar-print-menu [print-buffer]
  '("Print Buffer" . print-buffer))
</pre></td></tr></table><P>

バインディングが『作られる対象』のシンボルに注意してください。
定義されるキー列の角括弧の内側に現れています。
そのシンボルはコマンド名に等しい場合もあればそうでない場合もあります。
これらのシンボルは『ファンクションキー』として扱われますが、
キーボード上の本物のファンクションキーではありません。
それらはメニュー項目の機能には影響ありませんが、
ユーザーがメニューから選ぶとそれらはエコー領域に『表示』され、
<CODE>where-is</CODE>や<CODE>apropos</CODE>の出力にも現れます。
<P>

定義が<CODE>("--")</CODE>であるようなバインディングは区切り行です。
実際のメニュー項目のように、区切りにもキーシンボルがあり、
例では<CODE>separator-ps-print</CODE>です。
1つのメニューに複数の区切りがある場合、
それらはすべて異なるキーシンボルでなければなりません。
<P>

つぎには、メニュー内の2つのコマンドのオン条件を定義するコードです。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(put 'print-region 'menu-enable 'mark-active)
(put 'ps-print-region-with-faces 'menu-enable 'mark-active)
</pre></td></tr></table><P>

つぎは、このメニューを親メニューの項目に現れるようにする方法です。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(define-key menu-bar-tools-menu [print]
  (cons "Print" menu-bar-print-menu))
</pre></td></tr></table><P>

ここで使っているのは、サブメニューのキーマップ、つまり、
変数<CODE>menu-bar-print-menu</CODE>の値であって、
変数そのものではないことに注意してください。
<CODE>menu-bar-print-menu</CODE>はコマンドではないので、
このシンボルを親メニューの項目に使っても意味がありません。
<P>

同じ印刷メニューをマウスクリックに対応付けたければ、
つぎのようにしてできます。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(define-key global-map [C-S-down-mouse-1]
   menu-bar-print-menu)
</pre></td></tr></table><P>

つぎのようにして、<CODE>print-region</CODE>に対して拡張メニュー項目
（see 節 <A HREF="elisp_22.html#SEC332">21.12.1.2 拡張メニュー項目</A>）を使うこともできます。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(define-key menu-bar-print-menu [print-region]
  '(menu-item "Print Region" print-region
              :enable (mark-active)))
</pre></td></tr></table><P>

拡張メニュー項目では、オン条件はメニュー項目自体の内側に指定します。
マークがないときにはメニューからこの項目が消えるようにするには
つぎのようにします。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(define-key menu-bar-print-menu [print-region]
  '(menu-item "Print Region" print-region
              :visible (mark-active)))
</pre></td></tr></table><P>

<A NAME="Menu Bar"></A>
<HR SIZE="6">
<br><A NAME="SEC337"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC336"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC338"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Menu Bar"></A>
<H3> 21.12.5 メニューバー </H3>
<!--docid::SEC337::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Menu%20Bar">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Menu%20Bar</a>"<br>
"texi/elisp21/メニューバー"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%E1%A5%CB%A5%E5%A1%BC%A5%D0%A1%BC">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1376"></A>
<P>

ほとんどのウィンドウシステムでは、
各フレームに<EM>メニューバー</EM>（menu bar）、
つまり、フレームの先頭に水平方向に延びているメニューを恒久的に表示できます。
メニューバーの項目は、すべての活性なキーマップで定義された
疑似『ファンクションキー』<CODE>menu-bar</CODE>のサブコマンドです。
<P>

メニューバーに項目を追加するには、
読者独自の疑似『ファンクションキー』を考え（これを<VAR>key</VAR>とする）、
キー列<CODE>[menu-bar <VAR>key</VAR>]</CODE>に対するバインディングを作ります。
多くの場合、バインディングはメニューキーマップであって、
メニューバーの項目上でボタンを押すと別のメニューへ至るようにします。
<P>

メニューバーに対する同じ疑似ファンクションキーを
複数の活性なキーマップで定義していても、1つの項目だけが表示されます。
ユーザーがメニューバーの当該項目をクリックすると、
当該項目のすべてのサブコマンド、つまり、
グローバルのサブコマンド、ローカルのサブコマンド、
マイナモードのサブコマンドを含む1つの複合メニューが表示されます。
<P>

メニューバーの内容を決定する際には、
通常、変数<CODE>overriding-local-map</CODE>は無視されます。
つまり、<CODE>overriding-local-map</CODE>が<CODE>nil</CODE>であるときに
活性になるキーマップからメニューバーを計算します。
See 節 <A HREF="elisp_22.html#SEC323">21.6 活性なキーマップ</A>。
<P>

フレームにメニューバーを表示するには、
フレームのパラメータ<CODE>menu-bar-lines</CODE>が0より大きい必要があります。
Emacsはメニューバーそのものには1行だけ使います。
読者が2行以上を指定すると、
残りの行はフレームのウィンドウとメニューバーを区切る行になります。
<CODE>menu-bar-lines</CODE>の値には1か2を勧めます。
See 節 <A HREF="elisp_29.html#SEC440">28.3.3 ウィンドウフレームのパラメータ</A>。
<P>

メニューバーの項目の設定例を示します。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(modify-frame-parameters (selected-frame)
                         '((menu-bar-lines . 2)))

;; （プロンプト文字列を持つ）メニューキーマップを作り
;; それをメニューバーの項目の定義にする
(define-key global-map [menu-bar words]
  (cons "Words" (make-sparse-keymap "Words")))

;; このメニュー内のサブコマンドを定義する
(define-key global-map
  [menu-bar words forward]
  '("Forward word" . forward-word))
(define-key global-map
  [menu-bar words backward]
  '("Backward word" . backward-word))
</pre></td></tr></table><P>

グローバルキーマップに作ったメニューバー項目を
ローカルキーマップで取り消すには、
ローカルキーマップの当該疑似ファンクションキーのバインディングを
<CODE>undefined</CODE>で再バインドします。
たとえば、つぎのようにしてdiredはメニューバーの項目`<SAMP>Edit</SAMP>'を抑制します。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(define-key dired-mode-map [menu-bar edit] 'undefined)
</pre></td></tr></table><P>

<CODE>edit</CODE>は、メニューバー項目`<SAMP>Edit</SAMP>'に対して
グローバルキーマップで使う疑似ファンクションキーです。
グローバルなメニューバー項目を抑制する主な理由は、
モード固有の項目向けに場所を確保するためです。
<P>

<A NAME="IDX1377"></A>
<DL>
<DT><U>Variable:</U> <B>menu-bar-final-items</B>
<DD>通常、メニューバーは、グローバルな項目に
ローカルキーマップで定義された項目を続けて表示する。
<P>

この変数は、通常の順ではなくメニューバーの底に表示する項目に
対する疑似ファンクションキーのリストを保持する。
デフォルト値は<CODE>(help-menu)</CODE>であり、
したがって、ローカルのメニュー項目に続いて、
メニュー項目`<SAMP>Help</SAMP>'はメニューバーの最後に通常表示される。
</DL>
<P>

<A NAME="IDX1378"></A>
<DL>
<DT><U>Variable:</U> <B>menu-bar-update-hook</B>
<DD>このノーマルフックは、
ユーザーがメニューバーをクリックするたびに、
サブメニューを表示するまえに実行される。
これを用いて、内容が変化するサブメニューを更新できる。
</DL>
<P>

<A NAME="Modifying Menus"></A>
<HR SIZE="6">
<br><A NAME="SEC338"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_22.html#SEC337"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_23.html#SEC339"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Modifying Menus"></A>
<H3> 21.12.6 メニューの修正 </H3>
<!--docid::SEC338::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Modifying%20Menus">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Modifying%20Menus</a>"<br>
"texi/elisp21/メニューの修正"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%E1%A5%CB%A5%E5%A1%BC%A4%CE%BD%A4%C0%B5">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

既存のメニューに新たな項目を挿入するとき、
メニューの既存の項目の特定の場所に挿入したいでしょう。
<CODE>define-key</CODE>で項目を追加すると、通常、メニューの先頭に入ります。
メニューのそれ以外の場所に挿入するには、
<CODE>define-key-after</CODE>を使います。
<P>

<A NAME="IDX1379"></A>
<DL>
<DT><U>Function:</U> <B>define-key-after</B> <I>map key binding after</I>
<DD><VAR>key</VAR>に対するバインディング<VAR>binding</VAR>を<VAR>map</VAR>内に作る。
ただし、<VAR>map</VAR>内でのバインディングの位置は、
イベント<VAR>after</VAR>に対するバインディングのあとにする。
引数<VAR>key</VAR>は長さ1、つまり、1要素のみのベクトルか文字列であること。
しかし、<VAR>after</VAR>は1つのイベント型、つまり、
シンボルか文字であり列ではないこと。
新たなバインディングは<VAR>after</VAR>に対するバインディングのうしろに入る。
<VAR>after</VAR>が<CODE>t</CODE>であると、新たなバインディングは最後、
つまり、キーマップの末尾に入る。
<P>

例を示す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(define-key-after my-menu [drink]
                  '("Drink" . drink-command) 'eat)
</pre></td></tr></table><P>

これは、疑似ファンクションキー<KBD>DRINK</KBD>に対するバインディングを作り、
<KBD>EAT</KBD>に対するバインディングのあとに入れる。
<P>

shellモードのメニュー`<SAMP>Signals</SAMP>'において、
項目<CODE>break</CODE>のあとに項目`<SAMP>Work</SAMP>'を入れる方法はつぎのとおりである。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(define-key-after
  (lookup-key shell-mode-map [menu-bar signals])
  [work] '("Work" . work-command) 'break)
</pre></td></tr></table></DL>
<A NAME="Modes"></A>
<HR SIZE="6">
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<a name="bottom"> </a>
<script type="text/javascript" src="style2.js"></script>
<div class="footer">
    <br>
    このページはMeadow (Emacs) の紹介ページです <br>
このWebページの各文書は自由にリンク・複製・再配布・改変していただいて構いません．
<br>ただし，複製・再配布・改変の場合は Meadow Memo のURLを記載しておいて下さい．<br>
<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=about%20link">Medow memoへのリンクについて</a>．<br>

間違い，要望等があれば<a href="mailto:akihisa@mail.ne.jp">akihisa@mail.ne.jp</a> か下記でどうぞ<br>

<br>

<FORM METHOD="post" ACTION="http://www.bookshelf.jp/cgi-bin/wwwmail.cgi" >
お名前：<INPUT TYPE="text" NAME="name" SIZE="30" MAXLENGTH="40" VALUE="ななしさん"><br>
メールアドレス：<INPUT TYPE="text" NAME="EMAIL" SIZE="25" MAXLENGTH="60" VALUE="secret@mail.adr"><br>
<input type="hidden" name="HPAGE" value="">
つっこみ：<br><TEXTAREA NAME="MESSAGE" ROWS="5" COLS="50">
</TEXTAREA><br><br>
<INPUT TYPE="submit" VALUE="送信">
<INPUT TYPE="reset" VALUE="クリア">
</FORM>

<br><A HREF="http://www.bookshelf.jp/cgi-bin/xct.cgi">ページ別カウンタ</a>
<br> Since 2002/12/13 <br>
</div>

</BODY>

</HTML>
