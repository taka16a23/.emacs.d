<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML lang="ja">
<!-- Created on October, 1  2005 by texi2html 1.64 -->
<!-- 
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Olaf Bachmann <obachman@mathematik.uni-kl.de>
Send bugs and suggestions to <texi2html@mathematik.uni-kl.de>
 
-->
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html;CHARSET=euc-jp">
<META NAME="keywords" CONTENT="meadow,mule,emacs,lisp,elisp,gnus,setting,設定,unix,cygwin">
<META http-equiv="Content-Script-Type" content="text/javascript">
<META NAME="description" CONTENT="Meadowの設定を紹介するページです">
<TITLE>GNU Emacs Lispリファレンスマニュアル:  ファイル</TITLE>

<META NAME="description" CONTENT="GNU Emacs Lispリファレンスマニュアル:  ファイル">
<META NAME="keywords" CONTENT="GNU Emacs Lispリファレンスマニュアル:  ファイル">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META NAME="Generator" CONTENT="texi2html 1.64">

<LINK REL="contents" HREF="elisp_toc.html#SEC_Contents">
<LINK REL="index" HREF="elisp_48.html#SEC681">
<LINK REL="next" HREF="elisp_26.html#SEC395">
<LINK REL="prev" HREF="elisp_24.html#SEC363">

<META http-equiv="Content-Style-Type" content="text/css">
<!-- 鶯と龜 ←日本語EUC誤判別対策用らしい; -->
<link rel="StyleSheet" href="../../../../soft/css/midnight.css" type="text/css" id="css1">
<script type="text/javascript" src="style1.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../soft/css/meadowmemo.css">

</HEAD>
<BODY LANG="ja" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">
<!--Infoseek Analyzer start-->
<script LANGUAGE="javascript">PgNo=6;</script>
<script src="http://js1.infoseek.co.jp/bin/57/00170.js"></script>
<noscript><a href="http://ax1.www.infoseek.co.jp/bin/go?0017057f" target="_blank">
<img src="http://ax1.www.infoseek.co.jp/bin/logo?0017057f" border=0></a></noscript>
<!--Infoseek Analyzer end-->
<a name="top"> </a>

<br><A NAME="SEC369"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_24.html#SEC368"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC370"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_24.html#SEC363"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_26.html#SEC395"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Files"></A>
<H1> 24. ファイル </H1>
<!--docid::SEC369::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Files">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Files</a>"<br>
"texi/elisp21/ファイル"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A1%A5%A4%A5%EB">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

Emacsでは、ファイルやディレクトリを
探したり、作成したり、眺めたり、保存したり、その他のことをできます。
本章では、Emacs Lispのファイル関連の関数のほとんどについて説明しますが、
他の一部は<A HREF="elisp_27.html#SEC403">26. バッファ <EM>(2003/10/30)</EM></A>で、バックアップや自動保存に関することは
<A HREF="elisp_26.html#SEC395">25. バックアップと自動保存 <EM>(2003/10/30)</EM></A>で説明します。
<P>

ファイル関数の多くは、ファイル名の引数を1つないし複数個取ります。
ファイル名は実際には文字列です。
これらのほとんどの関数では、<CODE>expand-file-name</CODE>を呼び出して
ファイル名引数を展開することで`<TT>~</TT>'や
（`<SAMP>../</SAMP>'を含む）相対ファイル名を正しく処理します。
これらの関数は、`<SAMP>$HOME</SAMP>'などの環境変数置換は認識しません。
See 節 <A HREF="elisp_25.html#SEC387">24.8.4 ファイル名を展開する関数</A>。
<P>

<div class="menuindex"><SCRIPT language=JavaScript src="index24.js"></SCRIPT></div><noscript><BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC370">24.1 ファイルの訪問</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Reading files into Emacs buffers for editing.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC373">24.2 バッファの保存</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Writing changed buffers back into files.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC374">24.3 ファイルの読み込み</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Reading files into buffers without visiting.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC375">24.4 ファイルへの書き出し</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Writing new files from parts of buffers.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC376">24.5 ファイルロック</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Locking and unlocking files, to prevent
                               simultaneous editing by two people.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC377">24.6 ファイルに関する情報</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Testing existence, accessibility, size of files.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC382">24.7 ファイルの名前と属性の変更</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Renaming files, changing protection, etc.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC383">24.8 ファイル名</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Decomposing and expanding file names.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC391">24.9 ディレクトリの内容</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Getting a list of the files in a directory.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC392">24.10 ディレクトリの作成と削除</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Creating and Deleting Directories.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC393">24.11 ファイル名を『マジック』にする</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Defining "magic" special handling
			       for certain file names.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC394">24.12 ファイル書式変換</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Conversion to and from various file formats.</TD></TR>
</TABLE></BLOCKQUOTE></noscript>
<P>

<A NAME="Visiting Files"></A>
<HR SIZE="6">
<br><A NAME="SEC370"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC369"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC371"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Visiting Files"></A>
<H2> 24.1 ファイルの訪問 </H2>
<!--docid::SEC370::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Visiting%20Files">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Visiting%20Files</a>"<br>
"texi/elisp21/ファイルの訪問"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A1%A5%A4%A5%EB%A4%CE%CB%AC%CC%E4">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1533"></A>
<A NAME="IDX1534"></A>
<P>

ファイルを訪問するとは、ファイルをバッファに読み込むことです。
いったんこうすると、バッファはそのファイルを
<EM>訪問している</EM>（visiting）といい、
そのファイルをバッファの『訪問しているファイル』と呼びます。
<P>

ファイルとバッファは2つの異なるものです。
ファイルは、コンピュータ内に（読者が削除しない限り）恒久的に
記録されている情報です。
一方、バッファはEmacs内部にある情報であり、
編集セッションを終了する（あるいはバッファを削除する）と消えてしまいます。
通常、バッファにはファイルからコピーした情報があります。
つまり、バッファはそのファイルを訪問しているのです。
読者は、バッファ内のコピーを編集コマンドで修正するのです。
バッファに対するそのような変更では、ファイルは変更しません。
したがって、変更を恒久的なものにするには、
読者はバッファを<EM>保存</EM>（save）する、つまり、
バッファの変更した内容をファイルにコピーし戻す必要があります。
<P>

ファイルとバッファの区別にも関わらず、
バッファを意味してファイルといったり、その逆のいい方をしばしばします。
もちろん、『同じ名前のファイルにただちに保存するつもりでバッファを
編集している』とはいわずに『ファイルを編集している』といいます。
しばしば、人間は明確に区別する必要はありません。
しかし、コンピュータプログラムを扱ううえでは、
区別を心得ておくことがよいのです。
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC371">24.1.1 ファイルを訪問する関数</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">The usual interface functions for visiting.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC372">24.1.2 訪問するためのサブルーティン</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Lower-level subroutines that they use.</TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Visiting Functions"></A>
<HR SIZE="6">
<br><A NAME="SEC371"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC370"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC372"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Visiting Functions"></A>
<H3> 24.1.1 ファイルを訪問する関数 </H3>
<!--docid::SEC371::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Visiting%20Functions">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Visiting%20Functions</a>"<br>
"texi/elisp21/ファイルを訪問する関数"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A1%A5%A4%A5%EB%A4%F2%CB%AC%CC%E4%A4%B9%A4%EB%B4%D8%BF%F4">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

本節では、ファイルを訪問するために通常使う関数について述べます。
歴史的な理由で、これらの関数は`<SAMP>visit-</SAMP>'でなく`<SAMP>find-</SAMP>'という
名前で始まります。
バッファで訪問したファイルの名前を参照するための関数や変数、ならびに、
訪問したファイルの名前で既存バッファを探すための関数や変数については、
See 節 <A HREF="elisp_27.html#SEC407">26.4 バッファファイル名 <EM>(2003/10/30)</EM></A>。
<P>

Lispプログラムにおいて、ファイルの内容を変更せずにその内容を調べたいときには、
もっとも速い方法は一時的なバッファで<CODE>insert-file-contents</CODE>を
使うことです。
ファイルを訪問する必要はありませんし、それには余計に時間がかかります。
See 節 <A HREF="elisp_25.html#SEC374">24.3 ファイルの読み込み</A>。
<P>

<A NAME="IDX1535"></A>
<DL>
<DT><U>コマンド:</U> <B>find-file</B> <I>filename</I>
<DD>このコマンドはファイル<VAR>filename</VAR>を訪問したバッファを選択する。
そのようなバッファが既存ならば当該バッファを使う。
さもなければ、新たなバッファを作成してファイルを読み込む。
当該バッファを返す。
<P>

関数<CODE>find-file</CODE>の本体は非常に簡単で、つぎのとおりである。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(switch-to-buffer (find-file-noselect filename))
</pre></td></tr></table><P>

（<A HREF="elisp_28.html#SEC423">27.7 ウィンドウへのバッファの表示</A>の<CODE>switch-to-buffer</CODE>を参照。）
<P>

<CODE>find-file</CODE>が対話的に呼び出されると、
ミニバッファで<VAR>filename</VAR>を問い合わせる。
</DL>
<P>

<A NAME="IDX1536"></A>
<DL>
<DT><U>Function:</U> <B>find-file-noselect</B> <I>filename &#38;optional nowarn rawfile</I>
<DD>この関数は、ファイルを訪問するすべての関数の基である。
ファイル<VAR>filename</VAR>を訪問した／するバッファを探し／作成し、
当該バッファを返す。
そのようなバッファが既存ならば当該バッファを使う。
さもなければ、新たなバッファを作成してファイルを読み込む。
必要に応じて、バッファをカレントバッファにしたり
ウィンドウに表示できるが、この関数はそこまでは行わない。
<P>

<CODE>find-file-noselect</CODE>が既存バッファを使うときには、
ファイルの内容が当該バッファに最後に訪問してから、あるいは、
当該バッファを最後に保存してから変更されたかどうかまず確認する。
ファイルが変更されていれば、この関数は変更されたファイルを
再度読み込むかどうかユーザーに問い合わせる。
ユーザーが`<SAMP>yes</SAMP>'と答えると、バッファ内の変更は破棄される。
<P>

省略可能な引数<VAR>nowarn</VAR>が<CODE>nil</CODE>であると、
この関数はさまざまな場面で警告／助言メッセージを表示する。
たとえば、バッファを作成する必要があり、かつ、
指定したファイル<VAR>filename</VAR>がない場合には、
エコー領域にメッセージ`<SAMP>New file</SAMP>'を表示し、バッファは空にしておく。
<P>

関数<CODE>find-file-noselect</CODE>は、
ファイルを読み込み終えると通常<CODE>after-find-file</CODE>を呼び出す
（see 節 <A HREF="elisp_25.html#SEC372">24.1.2 訪問するためのサブルーティン</A>）。
その関数は、バッファのメジャーモードを設定し、ローカル変数を解析し、
訪問したファイルより新しい自動保存ファイルが存在するとユーザーに警告を発し、
<CODE>find-file-hooks</CODE>の関数を実行して処理を終える。
<P>

省略可能な引数<VAR>rawfile</VAR>が<CODE>nil</CODE>以外であると、
<CODE>after-find-file</CODE>を呼び出さず、
失敗しても<CODE>find-file-not-found-hooks</CODE>を実行しない。
さらに、<VAR>rawfile</VAR>の値が<CODE>nil</CODE>以外であると、
コーディングシステムの変換（see 節 <A HREF="elisp_33.html#SEC538">32.10 コーディングシステム</A>）や
書式変換（see 節 <A HREF="elisp_25.html#SEC394">24.12 ファイル書式変換</A>）も行わない。
<P>

関数<CODE>find-file-noselect</CODE>は、
ファイル<VAR>filename</VAR>を訪問したバッファを返す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(find-file-noselect "/etc/fstab")
     => #&#60;buffer fstab&#62;
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1537"></A>
<DL>
<DT><U>コマンド:</U> <B>find-file-other-window</B> <I>filename</I>
<DD>このコマンドは、選択しているウィンドウ以外のウィンドウにおいて、
ファイル<VAR>filename</VAR>を訪問したバッファを選択する。
別の既存ウィンドウを使うか、ウィンドウを分割する。
<A HREF="elisp_28.html#SEC423">27.7 ウィンドウへのバッファの表示</A>を参照。
<P>

このコマンドが対話的に呼び出されると、
<VAR>filename</VAR>を問い合わせる。
</DL>
<P>

<A NAME="IDX1538"></A>
<DL>
<DT><U>コマンド:</U> <B>find-file-read-only</B> <I>filename</I>
<DD>このコマンドは、<CODE>find-file</CODE>のようにファイル<VAR>filename</VAR>を訪問した
バッファを選択するが、当該バッファは読み出し専用となる。
See 節 <A HREF="elisp_27.html#SEC410">26.7 読み出し専用バッファ <EM>(2003/10/30)</EM></A>。
<P>

このコマンドが対話的に呼び出されると、
<VAR>filename</VAR>を問い合わせる。
</DL>
<P>

<A NAME="IDX1539"></A>
<DL>
<DT><U>コマンド:</U> <B>view-file</B> <I>filename</I>
<DD>このコマンドは、閲覧（view）モードで<VAR>filename</VAR>を訪問し、
閲覧（view）モードを抜けるとそれ以前のバッファに戻る。
閲覧（view）モードは、ファイルを素早く眺めるためのコマンドを与えるが
テキストの変更は許さないマイナモードである。
閲覧（view）モードに入ると、ノーマルフック<CODE>view-mode-hook</CODE>を実行する。
see 節 <A HREF="elisp_23.html#SEC362">22.6 フック</A>。
<P>

<CODE>view-file</CODE>が対話的に呼び出されると、
<VAR>filename</VAR>を問い合わせる。
</DL>
<P>

<A NAME="IDX1540"></A>
<DL>
<DT><U>Variable:</U> <B>find-file-hooks</B>
<DD>この変数の値は、ファイルを訪問後に呼び出される関数のリストである。
ファイルにローカル変数指定（があれば）は、
フックを実行するまえに処理される。
フック関数が実行されときには、
ファイルを訪問したバッファはカレントバッファになっている。
<P>

この変数はノーマルフックのように動作するが、
改名すべきではないと考えている。
see 節 <A HREF="elisp_23.html#SEC362">22.6 フック</A>。
</DL>
<P>

<A NAME="IDX1541"></A>
<DL>
<DT><U>Variable:</U> <B>find-file-not-found-hooks</B>
<DD>この変数の値は、<CODE>find-file</CODE>や<CODE>find-file-noselect</CODE>に
存在しないファイルを与えたときに呼び出される関数のリストである。
<CODE>find-file-noselect</CODE>は、ファイルが存在しないことがわかると
ただちにこれらの関数を呼び出す。
<CODE>nil</CODE>以外の値が返されるまで、リストに現れる順に呼び出す。
<CODE>buffer-file-name</CODE>は設定済みである。
<P>

関数の値を使い、しかも、一部の関数だけを呼び出すので、
これはノーマルフックではない。
</DL>
<P>

<A NAME="Subroutines of Visiting"></A>
<HR SIZE="6">
<br><A NAME="SEC372"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC371"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC373"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Subroutines of Visiting"></A>
<H3> 24.1.2 訪問するためのサブルーティン </H3>
<!--docid::SEC372::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Subroutines%20of%20Visiting">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Subroutines%20of%20Visiting</a>"<br>
"texi/elisp21/訪問するためのサブルーティン"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%CB%AC%CC%E4%A4%B9%A4%EB%A4%BF%A4%E1%A4%CE%A5%B5%A5%D6%A5%EB%A1%BC%A5%C6%A5%A3%A5%F3">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

関数<CODE>find-file-noselect</CODE>は、ユーザーのLispコードでも有用な
2つの重要なサブルーティン、<CODE>create-file-buffer</CODE>と
<CODE>after-find-file</CODE>を使います。
本節ではそれらの使い方を説明します。
<P>

<A NAME="IDX1542"></A>
<DL>
<DT><U>Function:</U> <B>create-file-buffer</B> <I>filename</I>
<DD>この関数は、<VAR>filename</VAR>を訪問するのに適するように命名した
バッファを作成しそれを返す。
（ディレクトリを除外した）<VAR>filename</VAR>が使用中の名前でなければ、
それを名前とする。
さもなければ、未使用の名前を得るために`<SAMP>&#60;2&#62;</SAMP>'などの文字列を付加する。
<A HREF="elisp_27.html#SEC412">26.9 バッファの作成 <EM>(2003/10/30)</EM></A>も参照。
<P>

<STRONG>注意：</STRONG><CODE> </CODE>
<CODE>create-file-buffer</CODE>は、
新たなバッファをファイルに対応付け<EM>ない</EM>し、
当該バッファを選択しない。
デフォルトのメジャーモードも使わない。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(create-file-buffer "foo")
     => #&#60;buffer foo&#62;
(create-file-buffer "foo")
     => #&#60;buffer foo&#60;2&#62;&#62;
(create-file-buffer "foo")
     => #&#60;buffer foo&#60;3&#62;&#62;
</pre></td></tr></table><P>

この関数は<CODE>find-file-noselect</CODE>で使われる。
この関数は<CODE>generate-new-buffer</CODE>（see 節 <A HREF="elisp_27.html#SEC412">26.9 バッファの作成 <EM>(2003/10/30)</EM></A>）を使う。
</DL>
<P>

<A NAME="IDX1543"></A>
<DL>
<DT><U>Function:</U> <B>after-find-file</B> <I>&#38;optional error warn</I>
<DD>この関数は、バッファのメジャーモードを設定し、
ローカル変数を解析する（see 節 <A HREF="elisp_23.html#SEC343">22.1.3 メジャーモードの選択方法</A>）。
<CODE>find-file-noselect</CODE>や
デフォルトの復元処理関数（see 節 <A HREF="elisp_26.html#SEC402">25.3 復元 <EM>(2003/10/30)</EM></A>）から呼ばれる。
<P>

<A NAME="IDX1544"></A>
<A NAME="IDX1545"></A>
ディレクトリはあるのにファイルが存在しないために
ファイルの読み込みがエラーになった場合には、
呼び出し側は<VAR>error</VAR>の値として<CODE>nil</CODE>以外を渡すこと。
その場合、<CODE>after-find-file</CODE>は警告`<SAMP>(New File)</SAMP>'を表示する。
より重大なエラーの場合には、<CODE>after-find-file</CODE>を呼び出すべきでない。
<P>

<VAR>warn</VAR>が<CODE>nil</CODE>以外であると、
自動保存ファイルが存在しそれが訪問したファイルより新しい場合には、
この関数は警告を発する。
<P>

<CODE>after-find-file</CODE>が最後に行うことは、
リスト<CODE>find-file-hooks</CODE>内のすべての関数を呼び出すことである。
</DL>
<P>

<A NAME="Saving Buffers"></A>
<HR SIZE="6">
<br><A NAME="SEC373"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC372"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC374"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Saving Buffers"></A>
<H2> 24.2 バッファの保存 </H2>
<!--docid::SEC373::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Saving%20Buffers">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Saving%20Buffers</a>"<br>
"texi/elisp21/バッファの保存"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D0%A5%C3%A5%D5%A5%A1%A4%CE%CA%DD%C2%B8">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

Emacsでファイルを編集するときには、
ファイルを訪問したバッファを実際には扱っています。
つまり、ファイルの内容はバッファにコピーされ、
そのコピーを編集しているのです。
バッファを変更しても、当該バッファを<EM>保存</EM>（save）するまで、
つまり、バッファの内容をファイルへコピーするまでは、
ファイルを変更しません。
<P>

<A NAME="IDX1546"></A>
<DL>
<DT><U>コマンド:</U> <B>save-buffer</B> <I>&#38;optional backup-option</I>
<DD>この関数は、最後に訪問／保存してからカレントバッファが変更されていれば、
カレントバッファの内容を訪問しているファイルへ保存する。
<P>

<CODE>save-buffer</CODE>は、バックアップの作成に責任がある。
通常、<VAR>backup-option</VAR>は<CODE>nil</CODE>であり、
<CODE>save-buffer</CODE>は、ファイルを訪問してから
最初に保存するときにのみバックアップファイルを作成する。
<VAR>backup-option</VAR>が別の値であると、
別の場面でもバックアップファイルを作成することを指示する。
<P>

<UL>
<LI>
引数が1つか3つの<KBD>C-u</KBD>を反映した4か64であると、
関数<CODE>save-buffer</CODE>は、バッファをつぎに保存したときに
ファイルの現在の版をバックアップするように印を付ける。
<P>

<LI>
引数が2つか3つの<KBD>C-u</KBD>を反映した16か64であると、
<CODE>save-buffer</CODE>は、保存するまえに無条件に
ファイルのまえの版をバックアップする。
</UL>
</DL>
<P>

<A NAME="IDX1547"></A>
<DL>
<DT><U>コマンド:</U> <B>save-some-buffers</B> <I>&#38;optional save-silently-p exiting</I>
<DD>このコマンドは、ファイルを訪問している変更されたバッファを保存する。
通常、各バッファについてユーザーに問い合わせる。
しかし、<VAR>save-silently-p</VAR>が<CODE>nil</CODE>以外であると、
ユーザーに問い合わせずにファイルを訪問しているバッファをすべて保存する。
<P>

省略可能な引数<VAR>exiting</VAR>が<CODE>nil</CODE>以外であると、
この関数は、ファイルを訪問していないある種のバッファを保存する機会も与える。
<CODE>buffer-offer-save</CODE>のバッファローカルな値が
<CODE>nil</CODE>以外のバッファが対象となる。
（ユーザーがこれらのバッファの1つを保存するように答えると、
ファイル名を指定するように聞いてくる。）
関数<CODE>save-buffers-kill-emacs</CODE>は、
この引数に<CODE>nil</CODE>以外の値を渡す。
</DL>
<P>

<A NAME="IDX1548"></A>
<DL>
<DT><U>コマンド:</U> <B>write-file</B> <I>filename</I>
<DD>この関数は、カレントバッファをファイル<VAR>filename</VAR>に保存し、
当該ファイルを訪問しているバッファとし、さらに未変更という印を付ける。
続いて、バッファ名を一意にするために必要ならば`<SAMP>&#60;2&#62;</SAMP>'のような
文字列を付加して、バッファを<VAR>filename</VAR>に基づいた名前に改名する。
この処理のほとんどは、<CODE>set-visited-file-name</CODE>（see 節 <A HREF="elisp_27.html#SEC407">26.4 バッファファイル名 <EM>(2003/10/30)</EM></A>）
と<CODE>save-buffer</CODE>を呼び出して行う。
</DL>
<P>

バッファを保存すると、いくつかのフックを実行します。
また、書式変換（see 節 <A HREF="elisp_25.html#SEC394">24.12 ファイル書式変換</A>）を行い、
テキスト属性を『注記』（annotations）（see 節 <A HREF="elisp_32.html#SEC520">31.19.7 テキスト属性をファイルへ保存する</A>）に
保存することもあります。
<P>

<A NAME="IDX1549"></A>
<DL>
<DT><U>Variable:</U> <B>write-file-hooks</B>
<DD>この変数の値は、バッファを訪問しているファイルに書き出すまえに
呼ばれる関数のリストである。
それらの1つが<CODE>nil</CODE>以外を返すと、すでにファイルに書き出したとみなして
残りの関数を呼び出さず、ファイルに書き出すための通常のコードも実行しない。
<P>

<CODE>write-file-hooks</CODE>の関数が<CODE>nil</CODE>以外を返すときには、
その関数には（必要ならば）バックアップファイルを作成する責任がある。
そのためにはつぎのコードを実行する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(or buffer-backed-up (backup-buffer))
</pre></td></tr></table><P>

<CODE>backup-buffer</CODE>が返したファイルモードの値を保存しておき、
読者が書くファイルのモードにその値を使いたい場合がある。
<CODE>save-buffer</CODE>は通常そのようにする。
<P>

<CODE>write-file-hooks</CODE>のフック関数は、
（必要ならば）データの符号化にも責任がある。
適切なコーディングシステム（see 節 <A HREF="elisp_33.html#SEC541">32.10.3 Lispにおけるコーディングシステム</A>）を選び、
符号化（see 節 <A HREF="elisp_33.html#SEC545">32.10.7 明示的な符号化と復号化</A>）を行い、
使用したコーディングシステムを<CODE>last-coding-system-used</CODE>に設定する
（see 節 <A HREF="elisp_33.html#SEC540">32.10.2 符号化と入出力</A>）。
<P>

この変数をバッファローカルにはしないこと。
バッファ固有のフック関数を指定するには、
かわりに<CODE>write-contents-hooks</CODE>を使う。
<P>

これはノーマルフックではないが、
<CODE>add-hook</CODE>と<CODE>remove-hook</CODE>でリストを扱える。
see 節 <A HREF="elisp_23.html#SEC362">22.6 フック</A>。
</DL>
<P>

<A NAME="IDX1550"></A>
<DL>
<DT><U>Variable:</U> <B>local-write-file-hooks</B>
<DD>これは<CODE>write-file-hooks</CODE>のように働くが、
特定のバッファにバッファローカルにするように意図してあり、
ファイル名に関するフックやバッファ内容を得た方法に関する
フックとして使われる。
<P>

変数は恒久的にバッファローカルと印が付いているので、
メジャーモードを変更してもバッファローカルな値は変更されない。
これは、『ファイル』の内容を特別な方法で読み込み、
対応した方法でデータを保存するフックを設定するようなパッケージには便利である。
</DL>
<P>

<A NAME="IDX1551"></A>
<DL>
<DT><U>Variable:</U> <B>write-contents-hooks</B>
<DD>この変数は<CODE>write-file-hooks</CODE>のように働くが、
ファイルの場所に関するフックではなく、
ファイルの内容に関するフックであると意図されている。
そのようなフックは、この変数のバッファローカルな束縛として
メジャーモードが通常設定する。
<P>

この変数に設定すると自動的にバッファローカルになる。
このフックに要素を追加するために<CODE>add-hooks</CODE>を使うときには、
引数<VAR>local</VAR>に<CODE>nil</CODE>以外を指定し<EM>ない</EM>こと。
この変数はバッファローカル<EM>のみ</EM>であるからである。
</DL>
<P>

<A NAME="IDX1552"></A>
<DL>
<DT><U>Variable:</U> <B>after-save-hook</B>
<DD>このノーマルフックは、バッファを訪問したファイルに
保存し終えてから実行される。
このフックの用途の1つは高速ロック（fast-lock）モードである。
このフックを使って強調表示情報をキャッシュファイルに保存する。
</DL>
<P>

<A NAME="IDX1553"></A>
<DL>
<DT><U>Variable:</U> <B>file-precious-flag</B>
<DD>この変数が<CODE>nil</CODE>以外ならば、
<CODE>save-buffer</CODE>は保存処理中の入出力エラーに備えて対処する。
つまり、目的の名前のファイルにではなく一時的な名前の新規ファイルに書き出し、
エラーがないことを確認してから目的の名前に改名する。
これにより、不正なファイルに起因する問題からディスク容量の不足といった
問題を回避できる。
<P>

副作用として、バックアップも必然的にコピーして行う。
see 節 <A HREF="elisp_26.html#SEC398">25.1.2 改名によるバックアップかコピーによるバックアップか <EM>(2003/10/30)</EM></A>。
それと同時に、大事な（precious）ファイルとして保存すると、
読者が保存したファイルと別のファイル名とのあいだの
ハードリンクをつねに切ってしまう。
<P>

特定のバッファではこの変数に<CODE>nil</CODE>以外のバッファローカルな値を
指定するモードもある。
</DL>
<P>

<A NAME="IDX1554"></A>
<DL>
<DT><U>User Option:</U> <B>require-final-newline</B>
<DD>この変数は、改行で終ら<EM>ない</EM>ファイルを書き出すかどうかを決定する。
この変数の値が<CODE>t</CODE>であると、<CODE>save-buffer</CODE>は、
保存するバッファが改行で終っていないと黙ってファイルの末尾に改行を追加する。
この変数の値が<CODE>t</CODE>ではない<CODE>nil</CODE>以外であると、
<CODE>save-buffer</CODE>は、必要な場面では
改行を追加するかどうかユーザーに問い合わせる。
<P>

この変数の値が<CODE>nil</CODE>であると、<CODE>save-buffer</CODE>は改行を追加しない。
デフォルト値は<CODE>nil</CODE>であるが、特定のバッファでは<CODE>t</CODE>に
設定するメジャーモードもある。
</DL>
<P>

関数<CODE>set-visited-file-name</CODE>（see 節 <A HREF="elisp_27.html#SEC407">26.4 バッファファイル名 <EM>(2003/10/30)</EM></A>）も
参照してください。
<P>

<A NAME="Reading from Files"></A>
<HR SIZE="6">
<br><A NAME="SEC374"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC373"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC375"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Reading from Files"></A>
<H2> 24.3 ファイルの読み込み </H2>
<!--docid::SEC374::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Reading%20from%20Files">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Reading%20from%20Files</a>"<br>
"texi/elisp21/ファイルの読み込み"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A1%A5%A4%A5%EB%A4%CE%C6%C9%A4%DF%B9%FE%A4%DF">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

関数<CODE>insert-file-contents</CODE>を使って
ディスクからファイルをバッファへコピーできます。
ユーザーレベルのコマンド<CODE>insert-file</CODE>はマークを設定するので
Lispプログラムでは使わないでください。
<P>

<A NAME="IDX1555"></A>
<DL>
<DT><U>Function:</U> <B>insert-file-contents</B> <I>filename &#38;optional visit beg end replace</I>
<DD>この関数は、ファイル<VAR>filename</VAR>の内容をカレントバッファの
ポイントのうしろに挿入する。
絶対ファイル名と挿入したデータの長さから成るリストを返す。
<VAR>filename</VAR>が読み込めるファイルの名前でないと、エラーを通知する。
<P>

関数<CODE>insert-file-contents</CODE>は、
ファイルの内容を定義済みのファイルの書式と比較し、
必要ならばファイルの内容を変換する。
see 節 <A HREF="elisp_25.html#SEC394">24.12 ファイル書式変換</A>。
リスト<CODE>after-insert-file-functions</CODE>の関数も呼び出す。
<A HREF="elisp_32.html#SEC520">31.19.7 テキスト属性をファイルへ保存する</A>を参照。
<P>

<VAR>visit</VAR>が<CODE>nil</CODE>以外であると、
この関数はバッファを未変更と印を付け、
ファイル<VAR>filename</VAR>を訪問しているバッファとなるように
バッファのさまざまな部分を設定する。
これには、バッファが訪問しているファイルの名前、ファイル更新時刻を含む。
この機能は<CODE>find-file-noselect</CODE>で使われており、
読者自身が使うことはないであろう。
<P>

<VAR>beg</VAR>と<VAR>end</VAR>が<CODE>nil</CODE>以外であると、
それらは挿入すべきファイルの部分を指定する整数であること。
この場合、<VAR>visit</VAR>は<CODE>nil</CODE>であること。
たとえば、
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(insert-file-contents filename nil 0 500)
</pre></td></tr></table><P>

はファイルの最初の500文字を挿入する。
<P>

引数<VAR>replace</VAR>が<CODE>nil</CODE>以外であると、
バッファの内容（実際には参照可能な部分のみ）を
ファイルの内容で置き換えることを意味する。
これは、単純にバッファの内容を削除してからファイル全体を挿入するより
好ましい。
なぜなら、（1）マーカ位置を保存できる場合がある、
（2）アンドゥリストにほとんどデータを入れない、からである。
<P>

<VAR>replace</VAR>と<VAR>visit</VAR>が<CODE>nil</CODE>である限り、
<CODE>insert-file-contents</CODE>で（FIFOや入出力装置などの）
特別なファイルを読むことも可能である。
</DL>
<P>

<A NAME="IDX1556"></A>
<DL>
<DT><U>Function:</U> <B>insert-file-contents-literally</B> <I>filename &#38;optional visit beg end replace</I>
<DD><A NAME="IDX1557"></A>
この関数は<CODE>insert-file-contents</CODE>のように動作するが、
書式を変換しない（see 節 <A HREF="elisp_25.html#SEC394">24.12 ファイル書式変換</A>）、
文字コードを変換しない（see 節 <A HREF="elisp_33.html#SEC538">32.10 コーディングシステム</A>）、
<CODE>find-file-hooks</CODE>を実行しない、自動的に解凍しないなどが異なる。
</DL>
<P>

別のプログラムが読めるようにファイル名を別のプロセスに渡すには、
関数<CODE>file-local-copy</CODE>を使います。
<A HREF="elisp_25.html#SEC393">24.11 ファイル名を『マジック』にする</A>を参照してください。
<P>

<A NAME="Writing to Files"></A>
<HR SIZE="6">
<br><A NAME="SEC375"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC374"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC376"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Writing to Files"></A>
<H2> 24.4 ファイルへの書き出し </H2>
<!--docid::SEC375::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Writing%20to%20Files">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Writing%20to%20Files</a>"<br>
"texi/elisp21/ファイルへの書き出し"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A1%A5%A4%A5%EB%A4%D8%A4%CE%BD%F1%A4%AD%BD%D0%A4%B7">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

関数<CODE>append-to-file</CODE>や<CODE>write-region</CODE>を使って、
バッファの内容やその一部をディスク上のファイルへ直接書き出せます。
訪問しているファイルには、これらの関数で書き出さないでください。
訪問の機構に混乱をきたすことがあります。
<P>

<A NAME="IDX1558"></A>
<DL>
<DT><U>コマンド:</U> <B>append-to-file</B> <I>start end filename</I>
<DD>この関数は、カレントバッファの<VAR>start</VAR>から<VAR>end</VAR>で
区切られる領域の内容をファイル<VAR>filename</VAR>の末尾に追加する。
当該ファイルが存在しなければ作成する。
この関数は<CODE>nil</CODE>を返す。
<P>

書き込めないファイルを<VAR>filename</VAR>に指定したり、
ファイルを作成できないディレクトリ上の存在しないファイルを
<VAR>filename</VAR>に指定するとエラーを通知する。
</DL>
<P>

<A NAME="IDX1559"></A>
<DL>
<DT><U>コマンド:</U> <B>write-region</B> <I>start end filename &#38;optional append visit confirm</I>
<DD>この関数は、カレントバッファの<VAR>start</VAR>から<VAR>end</VAR>で
区切られる領域の内容を<VAR>filename</VAR>で指定したファイルに書き出す。
<P>

<VAR>start</VAR>が文字列であると、
<CODE>write-region</CODE>はバッファのテキストではなく
その文字列を書いたり追加する。
<P>

<VAR>append</VAR>が<CODE>nil</CODE>以外であると、
指定したテキストを既存ファイル（があれば）の内容に追加する。
<P>

<VAR>confirm</VAR>が<CODE>nil</CODE>以外であると、
<VAR>filename</VAR>が既存ファイルの名前であると
<CODE>write-region</CODE>は確認を求める。
<P>

<VAR>visit</VAR>が<CODE>t</CODE>であると、
Emacsはバッファとファイルの対応を確立する。
つまり、バッファはそのファイルを訪問していることになる。
さらに、カレントバッファの最終ファイル更新時刻を
<VAR>filename</VAR>の更新時刻にし、
バッファには未変更と印を付ける。
この機能は<CODE>save-buffer</CODE>が使っているが、
読者自身が使うことはないであろう。
<P>

<VAR>visit</VAR>が文字列であると、訪問するファイルの名前を指定する。
このようにして、データを1つのファイル（<VAR>filename</VAR>）に書き出す一方で、
バッファは別のファイル（<VAR>visit</VAR>）を訪問していると設定できる。
引数<VAR>visit</VAR>はエコー領域のメッセージに使われ、
ファイルのロックにも使われる。
<VAR>visit</VAR>は<CODE>buffer-file-name</CODE>に保存される。
この機能は<CODE>file-precious-flag</CODE>の実装に使われているが、
読者は、なにをしているか理解できない限り、この機能を使わないこと。
<P>

関数<CODE>write-region</CODE>は、書き出すデータを
<CODE>buffer-file-format</CODE>で指定される適切なファイル書式に変換する。
see 節 <A HREF="elisp_25.html#SEC394">24.12 ファイル書式変換</A>。
さらに、リスト<CODE>write-region-annotate-functions</CODE>の関数も呼び出す。
<A HREF="elisp_32.html#SEC520">31.19.7 テキスト属性をファイルへ保存する</A>を参照。
<P>

通常、<CODE>write-region</CODE>はエコー領域にメッセージ
`<SAMP>Wrote <VAR>filename</VAR></SAMP>'を表示する。
<VAR>visit</VAR>が<CODE>t</CODE>でも<CODE>nil</CODE>でも文字列でもないと、
このメッセージは表示しない。
この機能は、ユーザーが知る必要のない
内部目的にファイルを使うプログラムに有用である。
</DL>
<P>

<A NAME="IDX1560"></A>
<DL>
<DT><U>Macro:</U> <B>with-temp-file</B> <I>file body...</I>
<DD><A NAME="IDX1561"></A>
マクロ<CODE>with-temp-file</CODE>は、一時的なバッファをカレントバッファとして
フォーム<VAR>body</VAR>を評価する。
そして最後にバッファの内容をファイル<VAR>file</VAR>に書き出す。
終了すると一時的なバッファを削除し、
フォーム<CODE>with-temp-file</CODE>のまえにカレントバッファであったバッファに戻る。
<VAR>body</VAR>の最後のフォームの値を返す。
<P>

<CODE>throw</CODE>やエラーによる異常終了（see 節 <A HREF="elisp_10.html#SEC127">9.5 非ローカル脱出</A>）であっても
カレントバッファに戻る。
<P>

<A HREF="elisp_27.html#SEC405">26.2 カレントバッファ <EM>(2003/10/30)</EM></A>の<CODE>with-temp-buffer</CODE>も参照。
</DL>
<P>

<A NAME="File Locks"></A>
<HR SIZE="6">
<br><A NAME="SEC376"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC375"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC377"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="File Locks"></A>
<H2> 24.5 ファイルロック </H2>
<!--docid::SEC376::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=File%20Locks">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=File%20Locks</a>"<br>
"texi/elisp21/ファイルロック"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A1%A5%A4%A5%EB%A5%ED%A5%C3%A5%AF">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1562"></A>
<A NAME="IDX1563"></A>
<P>

2人のユーザーが同時に同じファイルを編集すると、互いに干渉し合います。
Emacsは、ファイルが変更されると<EM>ファイルロック</EM>（file lock）を
記録することで、このような状況が発生しないように努めます。
すると、Emacsは別のEmacsがロックしているファイルを訪問した
バッファを変更しようとする最初の試みを検出でき、
ユーザーにどうすべきかを問い合わせます。
<P>

複数の計算機がファイルシステムを共有している場合には、
ファイルロックには完全な信頼性はありません。
ファイルロックが働かないと、
2人のユーザーが同時に変更する可能性がありますが、
それでも、Emacsは2番目に保存したユーザーに警告できます。
また、ディスク上で変更されたファイルを訪問しているバッファの変更を
検出することで、同時編集のある場面を捕捉できます。
<A HREF="elisp_27.html#SEC409">26.6 更新時刻の比較 <EM>(2003/10/30)</EM></A>を参照してください。
<P>

<A NAME="IDX1564"></A>
<DL>
<DT><U>Function:</U> <B>file-locked-p</B> <I>filename</I>
<DD>ファイル<VAR>filename</VAR>がロックされていなければ、この関数は<CODE>nil</CODE>を返す。
このEmacsプロセスがロックしているときには<CODE>t</CODE>を返す。
他のEmacsがロックしている場合には、ロックしているユーザーの名前を返す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(file-locked-p "foo")
     => nil
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1565"></A>
<DL>
<DT><U>Function:</U> <B>lock-buffer</B> <I>&#38;optional filename</I>
<DD>この関数は、カレントバッファが変更されていれば
ファイル<VAR>filename</VAR>をロックする。
引数<VAR>filename</VAR>のデフォルトは、
カレントバッファで訪問しているファイルである。
カレントバッファがファイルを訪問していなかったり、
未変更ならばなにもしない。
</DL>
<P>

<A NAME="IDX1566"></A>
<DL>
<DT><U>Function:</U> <B>unlock-buffer</B>
<DD>この関数は、バッファが変更されていれば、
カレントバッファで訪問しているファイルのロックを解除する。
バッファが未変更ならばファイルをロックしていないはずであり、
この関数はなにもしない。
カレントバッファがファイルを訪問していなければ、
やはりなにもしない。
</DL>
<P>

<A NAME="IDX1567"></A>
<DL>
<DT><U>Function:</U> <B>ask-user-about-lock</B> <I>file other-user</I>
<DD>この関数は、別のユーザー<VAR>other-user</VAR>がロックしている
ファイル<VAR>file</VAR>をユーザーが変更しようとしたときに呼び出される。
この関数のデフォルトの定義は、ユーザーになにをすべきか
問い合わせることである。
この関数の戻り値がEmacsのつぎの動作を決定する。
<P>

<UL>
<LI>
値が<CODE>t</CODE>であると、ファイルのロックを取得することを意味する。
すると、このユーザーはファイルを編集でき、
別のユーザー<VAR>other-user</VAR>はロックを失う。
<P>

<LI>
値が<CODE>nil</CODE>であると、ロックを無視して
とにかくユーザーにファイルの編集を許す。
<P>

<LI>
<A NAME="IDX1568"></A>
この関数はエラー<CODE>file-locked</CODE>を通知する。
この場合、ユーザーが行おうとしていた変更は行われない。
<P>

このエラーのエラーメッセージはつぎのようである。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>error--> File is locked: <VAR>file</VAR> <VAR>other-user</VAR>
</pre></td></tr></table><P>

ここで、<CODE>file</CODE>はファイル名であり、
<VAR>other-user</VAR>はそのファイルをロックしているユーザー名である。
</UL>
<P>

読者は、関数<CODE>ask-user-about-lock</CODE>を
別の方法で決定する読者独自のものに置き換えてもよい。
通常の定義に対応したコードは`<TT>userlock.el</TT>'にある。
</DL>
<P>

<A NAME="Information about Files"></A>
<HR SIZE="6">
<br><A NAME="SEC377"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC376"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC378"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Information about Files"></A>
<H2> 24.6 ファイルに関する情報 </H2>
<!--docid::SEC377::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Information%20about%20Files">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Information%20about%20Files</a>"<br>
"texi/elisp21/ファイルに関する情報"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A1%A5%A4%A5%EB%A4%CB%B4%D8%A4%B9%A4%EB%BE%F0%CA%F3">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

本節に述べる関数はすべて、ファイル名を表す文字列に作用します。
すべての関数の名前は単語`<SAMP>file</SAMP>'で始まり、
それらの引数は、特に断らないかぎり、
既存のファイルやディレクトリである必要があります。
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC378">24.6.1 参照可能性の検査</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Is a given file readable?  Writable?</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC379">24.6.2 ファイルの種類の区別</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Is it a directory?  A symbolic link?</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC380">24.6.3 実名</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Eliminating symbolic links from a file name.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC381">24.6.4 ファイルに関する他の情報</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How large is it?  Any other names?  Etc.</TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Testing Accessibility"></A>
<HR SIZE="6">
<br><A NAME="SEC378"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC377"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC379"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Testing Accessibility"></A>
<H3> 24.6.1 参照可能性の検査 </H3>
<!--docid::SEC378::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Testing%20Accessibility">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Testing%20Accessibility</a>"<br>
"texi/elisp21/参照可能性の検査"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%BB%B2%BE%C8%B2%C4%C7%BD%C0%AD%A4%CE%B8%A1%BA%BA">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1569"></A>
<A NAME="IDX1570"></A>
<P>

これらの関数は、特別な方法でファイル参照のパーミッションを検査します。
<P>

<A NAME="IDX1571"></A>
<DL>
<DT><U>Function:</U> <B>file-exists-p</B> <I>filename</I>
<DD>ファイル<VAR>filename</VAR>が存在すれば、この関数は<CODE>t</CODE>を返す。
これは必ずしもファイルを読めることは意味せず、
単にファイルの属性を調べられるだけである。
（UNIXでは、ファイルが存在し、かつ、
それを収めたディレクトリに対する実行パーミッションがあれば、
ファイル自体のパーミッションに関係なくこのようになる。）
<P>

ファイルが存在しなかったり、ファイルの属性を探す権限がなければ、
この関数は<CODE>nil</CODE>を返す。
</DL>
<P>

<A NAME="IDX1572"></A>
<DL>
<DT><U>Function:</U> <B>file-readable-p</B> <I>filename</I>
<DD>ファイル<VAR>filename</VAR>が存在しそれを読むことができるならば、
この関数は<CODE>t</CODE>を返す。
さもなければ<CODE>nil</CODE>を返す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(file-readable-p "files.texi")
     => t
(file-exists-p "/usr/spool/mqueue")
     => t
(file-readable-p "/usr/spool/mqueue")
     => nil
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1573"></A>
<DL>
<DT><U>Function:</U> <B>file-executable-p</B> <I>filename</I>
<DD>ファイル<VAR>filename</VAR>が存在しそれを実行できるならば、
この関数は<CODE>t</CODE>を返す。
さもなければ<CODE>nil</CODE>を返す。
ファイルがディレクトリである場合、実行パーミッションは、
ディレクトリ内のファイルの存在やその属性を検査でき、
それらのファイルのモードが許せばオープンできることを意味する。
</DL>
<P>

<A NAME="IDX1574"></A>
<DL>
<DT><U>Function:</U> <B>file-writable-p</B> <I>filename</I>
<DD>ファイル<VAR>filename</VAR>に書き出したり作成できるならば、
この関数は<CODE>t</CODE>を返し、さもなければ<CODE>nil</CODE>を返す。
ファイルに書き出せるのは、ファイルが存在し書ける場合である。
作成できるのは、ファイルは存在しないが
指定したディレクトリが存在しそのディレクトリに書ける場合である。
<P>

以下の3番目の例では、`<TT>foo</TT>'の親ディレクトリが存在しないので、
たとえディレクトリを作成できるとしても`<TT>foo</TT>'は書けない。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(file-writable-p "~/foo")
     => t
(file-writable-p "/foo")
     => nil
(file-writable-p "~/no-such-dir/foo")
     => nil
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1575"></A>
<DL>
<DT><U>Function:</U> <B>file-accessible-directory-p</B> <I>dirname</I>
<DD>ディレクトリ<VAR>dirname</VAR>の既存ファイルをオープンするパーミッションがあれば、
この関数は<CODE>t</CODE>を返す。
さもなければ（あるいは当該ディレクトリが存在しなければ）<CODE>nil</CODE>を返す。
<VAR>dirname</VAR>の値はディレクトリ名である。
<P>

例：<CODE> </CODE>つぎの例では、
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(file-accessible-directory-p "/foo")
     => nil
</pre></td></tr></table><P>

から、`<TT>/foo/</TT>'内のファイルを読もうとすると
エラーになると推論できる。
</DL>
<P>

<A NAME="IDX1576"></A>
<DL>
<DT><U>Function:</U> <B>access-file</B> <I>filename string</I>
<DD><A NAME="IDX1577"></A>
この関数は、ファイル<VAR>filename</VAR>を読むためにオープンし、
クローズしてから<CODE>nil</CODE>を返す。
しかし、オープンに失敗すると<VAR>string</VAR>をエラーメッセージのテキストとした
エラーを通知する。
</DL>
<P>

<A NAME="IDX1578"></A>
<DL>
<DT><U>Function:</U> <B>file-ownership-preserved-p</B> <I>filename</I>
<DD>もしファイル<VAR>filename</VAR>を削除して改めて作成しても
ファイルの所有者が変更されなければ、この関数は<CODE>t</CODE>を返す。
</DL>
<P>

<A NAME="IDX1579"></A>
<DL>
<DT><U>Function:</U> <B>file-newer-than-file-p</B> <I>filename1 filename2</I>
<DD><A NAME="IDX1580"></A>
<A NAME="IDX1581"></A>
ファイル<VAR>filename1</VAR>が<VAR>filename2</VAR>より新しければ、
この関数は<CODE>t</CODE>を返す。
<VAR>filename1</VAR>が存在しなければ<CODE>nil</CODE>を返す。
<VAR>filename2</VAR>が存在しなければ<CODE>t</CODE>を返す。
<P>

以下の例で、ファイル`<TT>aug-19</TT>'は19日に書かれ、
ファイル`<TT>aug-20</TT>'は20日に書かれ、
ファイル`<TT>no-file</TT>'は存在しないと仮定する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(file-newer-than-file-p "aug-19" "aug-20")
     => nil
(file-newer-than-file-p "aug-20" "aug-19")
     => t
(file-newer-than-file-p "aug-19" "no-file")
     => t
(file-newer-than-file-p "no-file" "aug-19")
     => nil
</pre></td></tr></table><P>

<CODE>file-attributes</CODE>を使って、
2つの数から成るリストとしてファイルの最終更新時刻を取得できる。
see 節 <A HREF="elisp_25.html#SEC381">24.6.4 ファイルに関する他の情報</A>。
</DL>
<P>

<A NAME="Kinds of Files"></A>
<HR SIZE="6">
<br><A NAME="SEC379"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC378"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC380"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Kinds of Files"></A>
<H3> 24.6.2 ファイルの種類の区別 </H3>
<!--docid::SEC379::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Kinds%20of%20Files">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Kinds%20of%20Files</a>"<br>
"texi/elisp21/ファイルの種類の区別"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A1%A5%A4%A5%EB%A4%CE%BC%EF%CE%E0%A4%CE%B6%E8%CA%CC">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

本節ではさまざまな種類のファイル、つまり、
ディレクトリ、シンボリックリンク、普通のファイルを区別する方法を
説明します。
<P>

<A NAME="IDX1582"></A>
<DL>
<DT><U>Function:</U> <B>file-symlink-p</B> <I>filename</I>
<DD><A NAME="IDX1583"></A>
<A NAME="IDX1584"></A>
ファイル<VAR>filename</VAR>がシンボリックリンクであると、
関数<CODE>file-symlink-p</CODE>は当該リンクが指すファイルの名前を返す。
これは、テキストファイル、ディレクトリ、別のシンボリックリンク、
存在しないファイルの名前のいずれかである。
<P>

ファイル<VAR>filename</VAR>がシンボリックリンクでない
（あるいは当該ファイルが存在しない）場合、
<CODE>file-symlink-p</CODE>は<CODE>nil</CODE>を返す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(file-symlink-p "foo")
     => nil
(file-symlink-p "sym-link")
     => "foo"
(file-symlink-p "sym-link2")
     => "sym-link"
(file-symlink-p "/bin")
     => "/pub/bin"
</pre></td></tr></table><P>

</DL>
<P>

<A NAME="IDX1585"></A>
<DL>
<DT><U>Function:</U> <B>file-directory-p</B> <I>filename</I>
<DD>ファイル<VAR>filename</VAR>が既存ディレクトリの名前であると<CODE>t</CODE>を返し、
さもなければ<CODE>nil</CODE>を返す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(file-directory-p "~rms")
     => t
(file-directory-p "~rms/lewis/files.texi")
     => nil
(file-directory-p "~rms/lewis/no-such-file")
     => nil
(file-directory-p "$HOME")
     => nil
(file-directory-p
 (substitute-in-file-name "$HOME"))
     => t
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1586"></A>
<DL>
<DT><U>Function:</U> <B>file-regular-p</B> <I>filename</I>
<DD>ファイル<VAR>filename</VAR>が存在しそれが普通のファイル
（ディレクトリでもシンボリックリンクでも名前付きパイプでも
端末でもその他の入出力装置でもない）であれば、
この関数は<CODE>t</CODE>を返す。
</DL>
<P>

<A NAME="Truenames"></A>
<HR SIZE="6">
<br><A NAME="SEC380"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC379"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC381"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Truenames"></A>
<H3> 24.6.3 実名 </H3>
<!--docid::SEC380::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Truenames">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Truenames</a>"<br>
"texi/elisp21/実名"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%BC%C2%CC%BE">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1587"></A>
<A NAME="IDX1588"></A>
<P>

ファイルの<EM>実名</EM>（truename）とは、
シンボリックリンクをすべて辿り尽くしてから、
要素として現れる`<SAMP>.</SAMP>' や`<SAMP>..</SAMP>' を簡略化して得られる名前です。
厳密にいえば、ファイルが一意の実名を持つ必要はありません。
ファイルの異なる実名の個数は、当該ファイルに対するハードリンクの個数に
等しいのです。
それでも、実名はシンボリックリンクによる名前の変動を取り除くため、
実名は有用です。
<P>

<A NAME="IDX1589"></A>
<DL>
<DT><U>Function:</U> <B>file-truename</B> <I>filename</I>
<DD>関数<CODE>file-truename</CODE>はファイル<VAR>filename</VAR>の実名を返す。
これはシンボリックリンクをすべて辿り尽くして得られる名前である。
引数は絶対ファイル名であること。
</DL>
<P>

関連情報については、See 節 <A HREF="elisp_27.html#SEC407">26.4 バッファファイル名 <EM>(2003/10/30)</EM></A>。
<P>

<A NAME="File Attributes"></A>
<HR SIZE="6">
<br><A NAME="SEC381"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC380"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC382"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="File Attributes"></A>
<H3> 24.6.4 ファイルに関する他の情報 </H3>
<!--docid::SEC381::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=File%20Attributes">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=File%20Attributes</a>"<br>
"texi/elisp21/ファイルに関する他の情報"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A1%A5%A4%A5%EB%A4%CB%B4%D8%A4%B9%A4%EB%C2%BE%A4%CE%BE%F0%CA%F3">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

本節では、ファイルの内容以外の詳しい情報を得るための関数を説明します。
この情報には、参照パーミッションを制御するモードビット、
所有者とグループの番号、名前の個数、iノード番号、サイズ、
参照時刻と更新時刻が含まれます。
<P>

<A NAME="IDX1590"></A>
<DL>
<DT><U>Function:</U> <B>file-modes</B> <I>filename</I>
<DD><A NAME="IDX1591"></A>
<A NAME="IDX1592"></A>
この関数は<VAR>filename</VAR>のモードビットを整数で返す。
モードビットはファイルのパーミッションとも呼ばれ、
UNIX流の参照制御を指定する。
最下位ビットが1であると、当該ファイルはすべてのユーザーが実行でき、
2番目の下位ビットが1であると、当該ファイルはすべてのユーザーが書ける
といった具合である。
<P>

戻り値の最大値は4095（8進数7777）であり、これは、
だれもが読み／書き／実行でき、
所有者とグループの両者にビットSUIDが設定してあり、
スティッキービットも設定されていることを意味する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(file-modes "~/junk/diffs")
     => 492               ; 10進整数
(format "%o" 492)
     => "754"             ; 8進数に変換

(set-file-modes "~/junk/diffs" 438)
     => nil

(format "%o" 438)
     => "666"             ; 8進数に変換

% ls -l diffs
  -rw-rw-rw-  1 lewis 0 3063 Oct 30 16:00 diffs
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1593"></A>
<DL>
<DT><U>Function:</U> <B>file-nlinks</B> <I>filename</I>
<DD>この関数は、ファイル<VAR>filename</VAR>の
名前（つまりハードリンク）の個数を返す。
ファイルが存在しなければ、この関数は<CODE>nil</CODE>を返す。
シンボリックリンクはそれが指すファイルの名前とはみなさないので、
シンボリックリンクはこの関数には効果を持たない。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>% ls -l foo*
-rw-rw-rw-  2 rms       4 Aug 19 01:27 foo
-rw-rw-rw-  2 rms       4 Aug 19 01:27 foo1

(file-nlinks "foo")
     => 2
(file-nlinks "doesnt-exist")
     => nil
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1594"></A>
<DL>
<DT><U>Function:</U> <B>file-attributes</B> <I>filename</I>
<DD>この関数はファイル<VAR>filename</VAR>の属性のリストを返す。
オープンできないファイルを指定すると<CODE>nil</CODE>を返す。
<P>

リストの要素は順につぎのとおりである。
<P>

<OL>
<LI>
ディレクトリは<CODE>t</CODE>、
シンボリックリンクは（それが指す名前の）文字列、
テキストファイルは<CODE>nil</CODE>である。
<P>

<LI>
ファイルの名前の個数。
別の名前、つまり、
ハードリンクは関数<CODE>add-name-to-file</CODE>（see 節 <A HREF="elisp_25.html#SEC382">24.7 ファイルの名前と属性の変更</A>）
を使って作成する。
<P>

<LI>
ファイルのUID（所有者番号）。
<P>

<LI>
ファイルのGID（グループ番号）。
<P>

<LI>
2つの整数から成るリストとしての最終参照時刻。
最初の整数は時刻の上位16ビットであり、2番目は下位16ビット。
（これは<CODE>current-time</CODE>の値と同様。
<A HREF="elisp_40.html#SEC647">39.5 時刻</A>を参照。）
<P>

<LI>
2つの整数から成るリストとしての最終更新時刻（上記と同様）。
<P>

<LI>
2つの整数から成るリストとしての最終状態更新時刻（上記と同様）。
<P>

<LI>
バイト単位でのファイルのサイズ。
<P>

<LI>
`<SAMP>ls -l</SAMP>'と同様のファイルのモードを表す10文字の文字列。
<P>

<LI>
もしファイルを削除して再度作成した場合に
ファイルのGID（グループ番号）が変わる場合には<CODE>t</CODE>。
さもなければ<CODE>nil</CODE>。
<P>

<LI>
ファイルのiノード番号。
可能ならばこれは整数である。
iノード番号がEmacs Lispの整数として表現できないほど大きな場合、
値は<CODE>(<VAR>high</VAR> . <VAR>low</VAR>)</CODE>の形である。
ただし、<VAR>low</VAR>は下位16ビットである。
<P>

<LI>
ファイルが置いてあるファイルシステムのファイルシステム番号。
この要素とファイルのiノード番号により、
システム上の任意の2つのファイルを区別するために十分な情報を与える。
つまり、2つのファイルが同じ値のこれらの番号を持つことはない。
</OL>
<P>

たとえば、`<TT>files.texi</TT>'のファイル属性はつぎのようである。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(file-attributes "files.texi")
     =>  (nil 1 2235 75 
          (8489 20284) 
          (8489 20284) 
          (8489 20285)
          14906 "-rw-rw-rw-" 
          nil 129500 -32252)
</pre></td></tr></table><P>

この意味はつぎのとおりである。
<P>

<DL COMPACT>
<DT><CODE>nil</CODE>
<DD>ディレクトリでもシンボリックリンクでもない。
<P>

<DT><CODE>1</CODE>
<DD>唯一の名前（カレントディレクトリで`<TT>files.texi</TT>'）を持つ。
<P>

<DT><CODE>2235</CODE>
<DD>UID（ユーザー番号）2235のユーザーが所有している。
<P>

<DT><CODE>75</CODE>
<DD>GID（グループ番号）75のグループに属する。
<P>

<DT><CODE>(8489 20284)</CODE>
<DD>最後に参照されたのは8月19日00時09分である。
<P>

<DT><CODE>(8489 20284)</CODE>
<DD>最後に更新されたのは8月19日00時09分である。
<P>

<DT><CODE>(8489 20285)</CODE>
<DD>最後にこのiノードを変更したのは8月19日00時09分である。
<P>

<DT><CODE>14906</CODE>
<DD>長さは14906バイトである。
<P>

<DT><CODE>"-rw-rw-rw-"</CODE>
<DD>モードは、所有者／グループ／その他は読み書きできる。
<P>

<DT><CODE>nil</CODE>
<DD>再度作成してもGID（グループ番号）は保存される。
<P>

<DT><CODE>129500</CODE>
<DD>iノード番号は129500。
<DT><CODE>-32252</CODE>
<DD>ファイルシステム番号は-32252。
</DL>
</DL>
<P>

<A NAME="Changing Files"></A>
<HR SIZE="6">
<br><A NAME="SEC382"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC381"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC383"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Changing Files"></A>
<H2> 24.7 ファイルの名前と属性の変更 </H2>
<!--docid::SEC382::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Changing%20Files">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Changing%20Files</a>"<br>
"texi/elisp21/ファイルの名前と属性の変更"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A1%A5%A4%A5%EB%A4%CE%CC%BE%C1%B0%A4%C8%C2%B0%C0%AD%A4%CE%CA%D1%B9%B9">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1595"></A>
<A NAME="IDX1596"></A>
<A NAME="IDX1597"></A>
<A NAME="IDX1598"></A>
<A NAME="IDX1599"></A>
<P>

本節の関数は、ファイルを改名／コピー／削除／リンクしたり、
ファイルのモードを設定するためのものです。
<P>

引数<VAR>newname</VAR>をとる関数では、
<VAR>newname</VAR>で指定したファイルが既存の場合、
関数の動作は引数<VAR>ok-if-already-exists</VAR>の値に依存します。
<P>

<UL>
<LI>
<VAR>ok-if-already-exists</VAR>が<CODE>nil</CODE>であると、
エラー<CODE>file-already-exists</CODE>を通知する。
<P>

<LI>
<VAR>ok-if-already-exists</VAR>が数であると、確認を必要とする。
<P>

<LI>
<VAR>ok-if-already-exists</VAR>がそれ以外の値であると、
確認せずに古いファイルを置き換える。
</UL>
<P>

<A NAME="IDX1600"></A>
<DL>
<DT><U>Function:</U> <B>add-name-to-file</B> <I>oldname newname &#38;optional ok-if-already-exists</I>
<DD><A NAME="IDX1601"></A>
<A NAME="IDX1602"></A>
この関数は、<VAR>oldname</VAR>で指定したファイルに
追加の名前<VAR>newname</VAR>を与える。
つまり、<VAR>newname</VAR>は<VAR>oldname</VAR>への新たな『ハードリンク』になる。
<P>

つぎの例では、2つのファイル`<TT>foo</TT>'と`<TT>foo3</TT>'がある。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>% ls -li fo*
81908 -rw-rw-rw-  1 rms       29 Aug 18 20:32 foo
84302 -rw-rw-rw-  1 rms       24 Aug 18 20:31 foo3
</pre></td></tr></table><P>

<CODE>add-name-to-file</CODE>を呼んでハードリンクを作成し、
ファイル一覧を表示し直す。
1つのファイルに2つの名前`<TT>foo</TT>'と`<TT>foo2</TT>'があることがわかる。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(add-name-to-file "foo" "foo2")
     => nil

% ls -li fo*
81908 -rw-rw-rw-  2 rms       29 Aug 18 20:32 foo
81908 -rw-rw-rw-  2 rms       29 Aug 18 20:32 foo2
84302 -rw-rw-rw-  1 rms       24 Aug 18 20:31 foo3
</pre></td></tr></table><P>

最後につぎの式を評価し
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(add-name-to-file "foo" "foo3" t)
</pre></td></tr></table><P>

ファイル一覧を表示し直す。
今度は、1つのファイルに3つの名前`<TT>foo</TT>'、`<TT>foo2</TT>'、`<TT>foo3</TT>'がある。
古い`<TT>foo3</TT>'の内容は失われている。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(add-name-to-file "foo1" "foo3")
     => nil

% ls -li fo*
81908 -rw-rw-rw-  3 rms       29 Aug 18 20:32 foo
81908 -rw-rw-rw-  3 rms       29 Aug 18 20:32 foo2
81908 -rw-rw-rw-  3 rms       29 Aug 18 20:32 foo3
</pre></td></tr></table><P>

1つのファイルに複数の名前を許さないオペレーティングシステムでは、
この関数は意味がない。
<P>

<A HREF="elisp_25.html#SEC381">24.6.4 ファイルに関する他の情報</A>の<CODE>file-nlinks</CODE>も参照。
</DL>
<P>

<A NAME="IDX1603"></A>
<DL>
<DT><U>コマンド:</U> <B>rename-file</B> <I>filename newname &#38;optional ok-if-already-exists</I>
<DD>このコマンドは、ファイル<VAR>filename</VAR>を<VAR>newname</VAR>と改名する。
<P>

<VAR>filename</VAR>に<VAR>filename</VAR>以外の名前があれば、
それらの名前は存在し続ける。
実際、<CODE>add-name-to-file</CODE>で名前<VAR>newname</VAR>を追加してから
<VAR>filename</VAR>を削除すると、一時的な中間状態があることを除けば、
改名と同じ効果がある。
<P>

対話的に呼び出されると、この関数は
ミニバッファで<VAR>filename</VAR>と<VAR>newname</VAR>を聞く。
また、<VAR>newname</VAR>が既存であると確認を求める。
</DL>
<P>

<A NAME="IDX1604"></A>
<DL>
<DT><U>コマンド:</U> <B>copy-file</B> <I>oldname newname &#38;optional ok-if-exists time</I>
<DD>このコマンドはファイル<VAR>oldname</VAR>を<VAR>newname</VAR>へコピーする。
<VAR>oldname</VAR>が存在しないとエラーを通知する。
<P>

<VAR>time</VAR>が<CODE>nil</CODE>以外であると、
この関数は新たなファイルに古いファイルと同じ最終更新時刻を与える。
（これは特定のオペレーティングシステムでのみ動作する。）
時刻設定でエラーがあると、<CODE>copy-file</CODE>は
エラー<CODE>file-date-error</CODE>を通知する。
<P>

対話的に呼び出されると、この関数は
ミニバッファで<VAR>oldname</VAR>と<VAR>newname</VAR>を聞く。
また、<VAR>newname</VAR>が既存であると確認を求める。
</DL>
<P>

<A NAME="IDX1605"></A>
<DL>
<DT><U>コマンド:</U> <B>delete-file</B> <I>filename</I>
<DD><A NAME="IDX1606"></A>
このコマンドは、シェルコマンド`<SAMP>rm <VAR>filename</VAR></SAMP>'と同様に
ファイル<VAR>filename</VAR>を削除する。
ファイルに複数の名前があると、他の名前では存在し続ける。
<P>

ファイルが存在しなかったり削除できないと、
エラー<CODE>file-error</CODE>の適切な種類が通知される。
（UNIXでは、ファイルを収めたディレクトリに書けると
当該ファイルは削除可能である。）
<P>

<A HREF="elisp_25.html#SEC392">24.10 ディレクトリの作成と削除</A>の<CODE>delete-directory</CODE>も参照。
</DL>
<P>

<A NAME="IDX1607"></A>
<DL>
<DT><U>コマンド:</U> <B>make-symbolic-link</B> <I>filename newname &#38;optional ok-if-exists</I>
<DD><A NAME="IDX1608"></A>
<A NAME="IDX1609"></A>
このコマンドは、<VAR>filename</VAR>に対するシンボリックリンク<VAR>newname</VAR>を
作成する。
これはシェルコマンド`<SAMP>ln -s <VAR>filename</VAR> <VAR>newname</VAR></SAMP>'と同じである。
<P>

対話的に呼び出されると、この関数は
ミニバッファで<VAR>filename</VAR>と<VAR>newname</VAR>を聞く。
また、<VAR>newname</VAR>が既存であると確認を求める。
</DL>
<P>

<A NAME="IDX1610"></A>
<DL>
<DT><U>Function:</U> <B>define-logical-name</B> <I>name string</I>
<DD>この関数は論理名<VAR>name</VAR>に値<VAR>string</VAR>を定義する。
VMSでのみ使える。
</DL>
<P>

<A NAME="IDX1611"></A>
<DL>
<DT><U>Function:</U> <B>set-file-modes</B> <I>filename mode</I>
<DD>この関数は<VAR>filename</VAR>のモードビットを
<VAR>mode</VAR>（整数であること）と設定する。
<VAR>mode</VAR>の下位12ビットのみを使う。
</DL>
<P>

<A NAME="IDX1612"></A>
<DL>
<DT><U>Function:</U> <B>set-default-file-modes</B> <I>mode</I>
<DD>この関数は、Emacsやそのサブプロセスが作成する新規ファイルの
デフォルトのファイルモードを設定する。
Emacsが作成する各ファイルは最初このモードになる。
UNIXでは、デフォルトのモードは『umask』の値の1の補数である。
<P>

引数<VAR>mode</VAR>は整数であること。
ほとんどのシステムでは、<VAR>mode</VAR>の下位9ビットのみが意味を持つ。
<P>

既存ファイルの変更を保存することはファイルの作成とはみなさないため、
ファイルのモードは変わらず、デフォルトのファイルモードを使わない。
</DL>
<P>

<A NAME="IDX1613"></A>
<DL>
<DT><U>Function:</U> <B>default-file-modes</B>
<DD>この関数は、現在のデフォルトのファイルモードの値を返す。
</DL>
<P>

<A NAME="IDX1614"></A>
<A NAME="IDX1615"></A>
MS-DOSでは、『実行可能』ファイルモードビットのようなものはありません。
そのためEmacsは、`<SAMP>.com</SAMP>'、`<SAMP>.bat</SAMP>'、`<SAMP>.exe</SAMP>'のいずれかで
終る名前のファイルを実行可能であるとみなします。
これは、<CODE>file-modes</CODE>や<CODE>file-attributes</CODE>が返す値に反映されます。
<P>

<A NAME="File Names"></A>
<HR SIZE="6">
<br><A NAME="SEC383"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC382"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC384"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="File Names"></A>
<H2> 24.8 ファイル名 </H2>
<!--docid::SEC383::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=File%20Names">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=File%20Names</a>"<br>
"texi/elisp21/ファイル名"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A1%A5%A4%A5%EB%CC%BE">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1616"></A>
<P>

他の場面と同様にEmacsでは、一般にファイルはその名前で参照します。
Emacsではファイル名は文字列で表します。
ファイルを操作する関数はすべてファイル名引数を仮定します。
<P>

ファイル自体の操作に加えて、Emacs Lispプログラムは
ファイルの名前そのものを操作する必要があります。
つまり、ファイル名を分解したり、関連するファイル名を作成するために
その一部を使います。
本節ではファイル名を操作する方法を説明します。
<P>

本節の関数は実際にはファイルを参照しませんから、
既存のファイルやディレクトリを表さないファイル名を操作できます。
<P>

VMSでは、これらの関数はすべて、VMSのファイル名構文と
UNIXの構文の両方を理解します。
つまり、標準LispライブラリはUNIX構文でファイル名を指定でき、
変更せずにVMS上で正しく動作します。
MS-DOSやMS-Windowsでは、これらの関数は、
UNIX構文に加えてMS-DOSやMS-Windowsのファイル名構文を理解します。
<P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC384">24.8.1 ファイル名の構成要素</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">The directory part of a file name, and the rest.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC385">24.8.2 ディレクトリ名</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">A directory's name as a directory
                            is different from its name as a file.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC386">24.8.3 ファイルの絶対名と相対名</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Some file names are relative to a current directory.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC387">24.8.4 ファイル名を展開する関数</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Converting relative file names to absolute ones.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC388">24.8.5 一意なファイル名の生成</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Generating names for temporary files.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC389">24.8.6 ファイル名の補完</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Finding the completions for a given file name.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_25.html#SEC390">24.8.7 標準ファイル名</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">If your package uses a fixed file name,
                            how to handle various operating systems simply.</TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="File Name Components"></A>
<HR SIZE="6">
<br><A NAME="SEC384"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC383"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC385"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="File Name Components"></A>
<H3> 24.8.1 ファイル名の構成要素 </H3>
<!--docid::SEC384::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=File%20Name%20Components">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=File%20Name%20Components</a>"<br>
"texi/elisp21/ファイル名の構成要素"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A1%A5%A4%A5%EB%CC%BE%A4%CE%B9%BD%C0%AE%CD%D7%C1%C7">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1617"></A>
<A NAME="IDX1618"></A>
<A NAME="IDX1619"></A>
<P>

オペレーティングシステムは、一連のファイルをディレクトリにまとめます。
ファイルを指定するには、ディレクトリと当該ディレクトリ内のファイルの名前を
指定する必要があります。
そのためEmacsは、ファイル名には2つの部分、
<EM>ディレクトリ名</EM>（directory name）部分と
<EM>非ディレクトリ名</EM>（nondirectory name）部分
（つまり<EM>ディレクトリ内のファイル名</EM>）があるとみなします。
どちらかの部分は空でもかまいません。
これらの2つの部分を連結するともとのファイル名になります。
<P>

UNIXでは、ディレクトリ部分は最後のスラッシュまでを含んだ部分であり、
非ディレクトリ部分は残りの部分です。
VMSの構文規則は複雑です。
<P>

ある種の目的のために、非ディレクトリ部分をさらに
名前だけの部分と<EM>版番号</EM>（version number）に分けます。
UNIXでは、バックアップファイルだけにそれらの名前に版番号があります。
VMSでは各ファイルに版番号がありますが、
ほとんどの場合、Emacsで実際に使うファイル名では版番号を省略します。
そのため、Emacsで版番号が見えるのは多くの場合ディレクトリ一覧です。
<P>

<A NAME="IDX1620"></A>
<DL>
<DT><U>Function:</U> <B>file-name-directory</B> <I>filename</I>
<DD>この関数は<VAR>filename</VAR>のディレクトリ部分
（ディレクトリ部分がなければ<CODE>nil</CODE>）を返す。
UNIXでは、この関数はスラッシュで終る文字列を返す。
VMSでは、`<SAMP>:</SAMP>'、`<SAMP>]</SAMP>'、`<SAMP>&#62;</SAMP>'のいずれかで終る文字列を返す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(file-name-directory "lewis/foo")  ; UNIXの例
     => "lewis/"
(file-name-directory "foo")        ; UNIXの例
     => nil
(file-name-directory "[X]FOO.TMP") ; VMSの例
     => "[X]"
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1621"></A>
<DL>
<DT><U>Function:</U> <B>file-name-nondirectory</B> <I>filename</I>
<DD>この関数は<VAR>filename</VAR>の非ディレクトリ部分を返す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(file-name-nondirectory "lewis/foo")
     => "foo"
(file-name-nondirectory "foo")
     => "foo"
;; つぎの例はVMSでのみ正確である
(file-name-nondirectory "[X]FOO.TMP")
     => "FOO.TMP"
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1622"></A>
<DL>
<DT><U>Function:</U> <B>file-name-sans-versions</B> <I>filename</I>
<DD>この関数は、<VAR>filename</VAR>から版番号、バックアップ版番号、
末尾のティルダをすべて削除したものを返す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(file-name-sans-versions "~rms/foo.~1~")
     => "~rms/foo"
(file-name-sans-versions "~rms/foo~")
     => "~rms/foo"
(file-name-sans-versions "~rms/foo")
     => "~rms/foo"
;; つぎの例はVMSでのみ正確である
(file-name-sans-versions "foo;23")
     => "foo"
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1623"></A>
<DL>
<DT><U>Function:</U> <B>file-name-sans-extension</B> <I>filename</I>
<DD>この関数は、<VAR>filename</VAR>からあれば『拡張子』を除いたものを返す。
ファイル名の拡張子とは、
名前の最後の部分にある`<SAMP>.</SAMP>'で始まる部分である。
たとえばつぎのとおりである。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(file-name-sans-extension "foo.lose.c")
     => "foo.lose"
(file-name-sans-extension "big.hack/foo")
     => "big.hack/foo"
</pre></td></tr></table></DL>
<P>

<A NAME="Directory Names"></A>
<HR SIZE="6">
<br><A NAME="SEC385"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC384"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC386"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Directory Names"></A>
<H3> 24.8.2 ディレクトリ名 </H3>
<!--docid::SEC385::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Directory%20Names">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Directory%20Names</a>"<br>
"texi/elisp21/ディレクトリ名"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8%A5%EA%CC%BE">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1624"></A>
<A NAME="IDX1625"></A>
<P>

<EM>ディレクトリ名</EM>（directory name）とはディレクトリの名前です。
ディレクトリはファイルの一種であり、ファイル名を持ちますが、
それはディレクトリ名に関連付けられますが同一ではありません。
（これはUNIXの通常の用語と同じではない。）
同じものに対するこれらの異なる2つの名前は、構文の変換で関連付けます。
UNIXではこれは簡単であり、ディレクトリ名はスラッシュで終りますが、
ファイルとしてのディレクトリの名前にはスラッシュはありません。
VMSでは、関係はより複雑です。
<P>

ディレクトリ名とそのファイルとしての名前との違いはわずかですが重大です。
Emacsの変数や関数引数がディレクトリ名と記述されているときには、
ディレクトリのファイルとしての名前は受け付けません。
<P>

つぎの2つの関数はディレクトリ名とファイルとしての名前を相互に変換します。
これらは、`<SAMP>$HOME</SAMP>'などの環境変数置換や
`<SAMP>~</SAMP>'や`<SAMP>..</SAMP>'などの構造にはなにも特別なことはしません。
<P>

<A NAME="IDX1626"></A>
<DL>
<DT><U>Function:</U> <B>file-name-as-directory</B> <I>filename</I>
<DD>この関数は、オペレーティングシステムが
ディレクトリ名と解釈する表現で表した<VAR>filename</VAR>の文字列を返す。
UNIXでは、文字列に（最後にスラッシュがなければ）スラッシュを
付加することを意味する。
VMSでは、`<TT>[X]Y.DIR.1</TT>'の形の文字列を`<TT>[X.Y]</TT>'の形に変換する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(file-name-as-directory "~rms/lewis")
     => "~rms/lewis/"
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1627"></A>
<DL>
<DT><U>Function:</U> <B>directory-file-name</B> <I>dirname</I>
<DD>この関数は、オペレーティングシステムが
ファイルの名前と解釈する表現で表した<VAR>dirname</VAR>の文字列を返す。
UNIXでは、文字列の最後のスラッシュを取り除くことを意味する。
VMSでは、`<TT>[X.Y]</TT>'の形の文字列を`<TT>[X]Y.DIR.1</TT>'の形に変換する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(directory-file-name "~lewis/")
     => "~lewis"
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1628"></A>
<A NAME="IDX1629"></A>
シンボリックリンクを介して通常参照されるディレクトリには
ディレクトリ名の省略形が有用です。
ユーザーはリンクの名前をディレクトリの『名前』としばしばみなし、
ディレクトリの『本当の』名前を見るのをわずらわしく思うことがあります。
リンク名を『本当の』名前の省略形と定義しておくと、
Emacsはユーザーに省略形を表示します。
<P>

<A NAME="IDX1630"></A>
<DL>
<DT><U>Variable:</U> <B>directory-abbrev-alist</B>
<DD>変数<CODE>directory-abbrev-alist</CODE>は、
ディレクトリに使う省略形の連想リストを保持する。
各要素は<CODE>(<VAR>from</VAR> . <VAR>to</VAR>)</CODE>の形であり、
ディレクトリ名に<VAR>from</VAR>が現れるとこれを<VAR>to</VAR>に置き換えることを指示する。
文字列<VAR>from</VAR>は実際には正規表現であり、つねに`<SAMP>^</SAMP>'で始まること。
関数<CODE>abbreviate-file-name</CODE>がこれらの置換を行う。
<P>

ファイル`<TT>site-init.el</TT>'でこの変数に設定し、
読者のサイトに適した省略形を記述できる。
<P>

ファイルシステム`<TT>/home/fsf</TT>'などをシンボリック名`<TT>/fsf</TT>'で通常参照する
システムの例をつぎに示す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(("^/home/fsf" . "/fsf")
 ("^/home/gp" . "/gp")
 ("^/home/gd" . "/gd"))
</pre></td></tr></table></DL>
<P>

ディレクトリ名をその省略形に変換するには、つぎの関数を使います。
<P>

<A NAME="IDX1631"></A>
<DL>
<DT><U>Function:</U> <B>abbreviate-file-name</B> <I>dirname</I>
<DD>この関数は、<CODE>directory-abbrev-alist</CODE>の省略形を引数に適用し、
ユーザーのホームディレクトリを`<SAMP>~</SAMP>'に置き換える。
</DL>
<P>

<A NAME="Relative File Names"></A>
<HR SIZE="6">
<br><A NAME="SEC386"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC385"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC387"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Relative File Names"></A>
<H3> 24.8.3 ファイルの絶対名と相対名 </H3>
<!--docid::SEC386::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Relative%20File%20Names">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Relative%20File%20Names</a>"<br>
"texi/elisp21/ファイルの絶対名と相対名"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A1%A5%A4%A5%EB%A4%CE%C0%E4%C2%D0%CC%BE%A4%C8%C1%EA%C2%D0%CC%BE">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1632"></A>
<A NAME="IDX1633"></A>
<P>

ファイルシステム内のすべてのディレクトリは、
ルートディレクトリから始まる木を形作ります。
ファイル名では、木のルートから始まるすべてのディレクトリ名を指定できて、
これを<EM>絶対</EM>（absolute）ファイル名と呼びます。
あるいは、デフォルトディレクトリを基準に
木の中でのファイルの位置を指定することもでき、
これを<EM>相対</EM>（relative）ファイル名と呼びます。
UNIXでは、絶対ファイル名はスラッシュかティルダ（`<SAMP>~</SAMP>'）で始まり、
相対ファイル名はそれらでは始まりません。
VMSでの規則は複雑です。
<P>

<A NAME="IDX1634"></A>
<DL>
<DT><U>Function:</U> <B>file-name-absolute-p</B> <I>filename</I>
<DD>この関数は、ファイル<VAR>filename</VAR>が絶対ファイル名であれば<CODE>t</CODE>を返し、
さもなければ<CODE>nil</CODE>を返す。
VMS上では、この関数はUNIXの構文とVMSの構文の両方を理解する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(file-name-absolute-p "~rms/foo")
     => t
(file-name-absolute-p "rms/foo")
     => nil
(file-name-absolute-p "/user/rms/foo")
     => t
</pre></td></tr></table></DL>
<P>

<A NAME="File Name Expansion"></A>
<HR SIZE="6">
<br><A NAME="SEC387"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC386"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC388"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="File Name Expansion"></A>
<H3> 24.8.4 ファイル名を展開する関数 </H3>
<!--docid::SEC387::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=File%20Name%20Expansion">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=File%20Name%20Expansion</a>"<br>
"texi/elisp21/ファイル名を展開する関数"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A1%A5%A4%A5%EB%CC%BE%A4%F2%C5%B8%B3%AB%A4%B9%A4%EB%B4%D8%BF%F4">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1635"></A>
<P>

ファイル名の<EM>展開</EM>（expansion）とは、
相対ファイル名を絶対ファイル名に変換することです。
これはデフォルトディレクトリを基準に行うので、
展開すべきファイル名に加えて、デフォルトディレクトリの名前も
指定する必要があります。
また、展開では、`<TT>./</TT>'や`<TT><VAR>name</VAR>/../</TT>'のような冗長部分を
取り除いてファイル名を単純にします。
<P>

<A NAME="IDX1636"></A>
<DL>
<DT><U>Function:</U> <B>expand-file-name</B> <I>filename &#38;optional directory</I>
<DD>この関数は<VAR>filename</VAR>を絶対ファイル名に変換する。
<VAR>directory</VAR>が与えられると、
<VAR>filename</VAR>が相対ファイル名であれば、
デフォルトディレクトリを基準にする。
（<VAR>directory</VAR>の値そのものは絶対ディレクトリ名であること。
`<SAMP>~</SAMP>'で始まってもよい。）
さもなければ、バッファの<CODE>default-directory</CODE>の値を使う。
たとえばつぎのとおり。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(expand-file-name "foo")
     => "/xcssun/users/rms/lewis/foo"
(expand-file-name "../foo")
     => "/xcssun/users/rms/foo"
(expand-file-name "foo" "/usr/spool/")
     => "/usr/spool/foo"
(expand-file-name "$HOME/foo")
     => "/xcssun/users/rms/lewis/$HOME/foo"
</pre></td></tr></table><P>

`<SAMP>.</SAMP>'や`<SAMP>..</SAMP>'を含むファイル名は、それらの正則な形に単純化する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(expand-file-name "bar/../foo")
     => "/xcssun/users/rms/lewis/foo"
</pre></td></tr></table><P>

<CODE>expand-file-name</CODE>は環境変数を展開<EM>しない</EM>ことに注意。
<CODE>substitute-in-file-name</CODE>だけがそれを行う。
</DL>
<P>

<A NAME="IDX1637"></A>
<DL>
<DT><U>Function:</U> <B>file-relative-name</B> <I>filename directory</I>
<DD>この関数は展開の逆操作を行う。
つまり、<VAR>directory</VAR>を基準に解釈すると
<VAR>filename</VAR>と等価になる相対名を返す。
<P>

絶対ファイル名が装置名で始まるシステムもある。
そのようなシステムでは、<VAR>directory</VAR>と<VAR>filename</VAR>が
2つの異なる装置名で始まると、
<VAR>filename</VAR>に等価な<VAR>directory</VAR>を基準にした相対名はない。
そのような場合、<CODE>file-relative-name</CODE>は
絶対名の形で<VAR>filename</VAR>を返す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(file-relative-name "/foo/bar" "/foo/")
     => "bar"
(file-relative-name "/foo/bar" "/hack/")
     => "/foo/bar"
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1638"></A>
<DL>
<DT><U>Variable:</U> <B>default-directory</B>
<DD>このバッファローカルな変数の値は、
カレントバッファのデフォルトディレクトリである。
これは絶対ディレクトリ名であること。
`<SAMP>~</SAMP>'で始まってもよい。
この変数は各バッファにおいてバッファローカルである。
<P>

<CODE>expand-file-name</CODE>は、その第2引数が<CODE>nil</CODE>であると
デフォルトディレクトリを使う。
<P>

UNIXでは、この値はつねにスラッシュで終る文字列である。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>default-directory
     => "/user/lewis/manual/"
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1639"></A>
<DL>
<DT><U>Function:</U> <B>substitute-in-file-name</B> <I>filename</I>
<DD>この関数は、<VAR>filename</VAR>内の環境変数の参照を
環境変数の値で置き換える。
UNIXのシェルの構文規則に従って、
`<SAMP>$</SAMP>'は環境変数の値に置換するための接頭辞である。
<P>

環境変数名は、`<SAMP>$</SAMP>'に続く（下線を含む）英数字の列である。
`<SAMP>$</SAMP>'のつぎの文字が`<SAMP>{</SAMP>'であると、
対応する`<SAMP>}</SAMP>'までが変数名である。
<P>

ここでは、環境変数<CODE>HOME</CODE>はユーザーのホームディレクトリ名
`<SAMP>/xcssun/users/rms</SAMP>'を保持していると仮定する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(substitute-in-file-name "$HOME/foo")
     => "/xcssun/users/rms/foo"
</pre></td></tr></table><P>

置換後、`<SAMP>/</SAMP>'のつぎに`<SAMP>~</SAMP>'か`<SAMP>/</SAMP>'が現れると、
`<SAMP>/</SAMP>'までの部分をすべて取り除く。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(substitute-in-file-name "bar/~/foo")
     => "~/foo"
(substitute-in-file-name "/usr/local/$HOME/foo")
     => "/xcssun/users/rms/foo"
     ;; `<TT>/usr/local/</TT>' has been discarded.
</pre></td></tr></table><P>

VMSでは、`<SAMP>$</SAMP>'による置換は行わないため、
この関数は冗長部分を取り除く以外にはなにも行わない。
</DL>
<P>

<A NAME="Unique File Names"></A>
<HR SIZE="6">
<br><A NAME="SEC388"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC387"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC389"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Unique File Names"></A>
<H3> 24.8.5 一意なファイル名の生成 </H3>
<!--docid::SEC388::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Unique%20File%20Names">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Unique%20File%20Names</a>"<br>
"texi/elisp21/一意なファイル名の生成"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%B0%EC%B0%D5%A4%CA%A5%D5%A5%A1%A5%A4%A5%EB%CC%BE%A4%CE%C0%B8%C0%AE">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

一時的なファイルに書く必要があるプログラムもあります。
そのようなファイル向けの名前を作る通常の方法はつぎのとおりです。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(make-temp-name
 (expand-file-name <VAR>name-of-application</VAR>
                   temporary-file-directory))
</pre></td></tr></table><P>

<CODE>make-temp-name</CODE>の仕事は、
異なる2人のユーザーや異なる2つのジョブがまったく同じファイル名を
使わないようにすることです。
この例では、変数<CODE>temporary-file-directory</CODE>を使って
一時的なファイルを置く場所を決めています。
すべてのEmacs Lispプログラムでは、
すべての一時的なファイル向けのディレクトリを指定する
一意な方法をユーザーに提供するために、
この目的には<CODE>temporary-file-directory</CODE>を使うべきです。
<P>

<A NAME="IDX1640"></A>
<DL>
<DT><U>Function:</U> <B>make-temp-name</B> <I>string</I>
<DD>この関数は、一意なファイル名として使える文字列を生成する。
名前は<VAR>string</VAR>で始まり、各Emacsジョブごとに異なる数を含む。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(make-temp-name "/tmp/foo")
     => "/tmp/foo232J6v"
</pre></td></tr></table><P>

同じEmacsで動作している異なるライブラリのあいだで衝突しないように、
<CODE>make-temp-name</CODE>を使う各Lispプログラムでは、
独自の<VAR>string</VAR>を使うべきである。
<VAR>string</VAR>の末尾に付加される数は、
異なるEmacsジョブで動いている同じアプリケーションを区別する。
文字を余計に追加することで、1つのEmacsジョブであっても
異なる名前の個数を非常に多くできる。
</DL>
<P>

<A NAME="IDX1641"></A>
<DL>
<DT><U>Variable:</U> <B>temporary-file-directory</B>
<DD><A NAME="IDX1642"></A>
<A NAME="IDX1643"></A>
<A NAME="IDX1644"></A>
<A NAME="IDX1645"></A>
この変数は、一時的なファイルを作成するためのディレクトリ名を指定する。
その値はディレクトリ名（see 節 <A HREF="elisp_25.html#SEC385">24.8.2 ディレクトリ名</A>）であるべきだが、
Lispプログラムにとっては、
その値がディレクトリのファイルとしての名前であっても処理できるほうがよい。
この値を<CODE>expand-file-name</CODE>の第2引数に使うと、
そのようにできる。
<P>

デフォルト値は、読者のオペレーティングシステムにおいて
合理的な方法で決定される。
GNUとUNIXシステムでは、環境変数<CODE>TMP</CODE>や<CODE>TMPDIR</CODE>を基にする。
<P>

読者が一時的なファイル名を選ぶために<CODE>make-temp-name</CODE>を
使わない場合であっても、
一時的なファイル名を置くディレクトリを決めるために
この変数を使うべきである。
</DL>
<P>

<A NAME="File Name Completion"></A>
<HR SIZE="6">
<br><A NAME="SEC389"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC388"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC390"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="File Name Completion"></A>
<H3> 24.8.6 ファイル名の補完 </H3>
<!--docid::SEC389::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=File%20Name%20Completion">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=File%20Name%20Completion</a>"<br>
"texi/elisp21/ファイル名の補完"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A1%A5%A4%A5%EB%CC%BE%A4%CE%CA%E4%B4%B0">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1646"></A>
<A NAME="IDX1647"></A>
<P>

本節では、ファイル名の補完向けの低レベルのサブルーティンについて述べます。
他の補完関数については、<A HREF="elisp_20.html#SEC270">19.5 補完</A>を参照してください。
<P>

<A NAME="IDX1648"></A>
<DL>
<DT><U>Function:</U> <B>file-name-all-completions</B> <I>partial-filename directory</I>
<DD>この関数は、ディレクトリ<VAR>directory</VAR>において
<VAR>partial-filename</VAR>で始まる名前のファイルに対する
すべての補完候補から成るリストを返す。
候補の順番はディレクトリ内でのファイルの順番であり、
それは予測できず有用な情報はなにもない。
<P>

引数<VAR>partial-filename</VAR>は、ディレクトリ部分やスラッシュを
いっさい含まないファイル名であること。
<VAR>directory</VAR>が絶対名でないと、
カレントバッファのデフォルトディレクトリを<VAR>directory</VAR>のまえに補う。
<P>

つぎの例で、カレントデフォルトディレクトリは`<TT>~rms/lewis</TT>'であり、
`<SAMP>f</SAMP>'で始まる名前のファイルは、
`<TT>foo</TT>'、`<TT>file~</TT>'、`<TT>file.c</TT>'、`<TT>file.c.~1~</TT>'、
`<TT>file.c.~2~</TT>'の5つであると仮定する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(file-name-all-completions "f" "")
     => ("foo" "file~" "file.c.~2~" 
                "file.c.~1~" "file.c")

(file-name-all-completions "fo" "")  
     => ("foo")
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1649"></A>
<DL>
<DT><U>Function:</U> <B>file-name-completion</B> <I>filename directory</I>
<DD>この関数は、ディレクトリ<VAR>directory</VAR>においてファイル名<VAR>filename</VAR>を
補完する。
ディレクトリ<VAR>directory</VAR>において<VAR>filename</VAR>で始まる
すべてのファイル名に共通な最長の文字列を返す。
<P>

<VAR>filename</VAR>で始まるものがたった1つであり完全に一致すると、
この関数は<CODE>t</CODE>を返す。
ディレクトリ<VAR>directory</VAR>に<VAR>filename</VAR>で始まる名前がないと
<CODE>nil</CODE>を返す。
<P>

つぎの例で、カレントデフォルトディレクトリには
`<SAMP>f</SAMP>'で始まる名前のファイルは、
`<TT>foo</TT>'、`<TT>file~</TT>'、`<TT>file.c</TT>'、`<TT>file.c.~1~</TT>'、
`<TT>file.c.~2~</TT>'の5つであると仮定する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(file-name-completion "fi" "")
     => "file"

(file-name-completion "file.c.~1" "")
     => "file.c.~1~"

(file-name-completion "file.c.~1~" "")
     => t

(file-name-completion "file.c.~3" "")
     => nil
</pre></td></tr></table></DL>
<P>

<A NAME="IDX1650"></A>
<DL>
<DT><U>User Option:</U> <B>completion-ignored-extensions</B>
<DD><CODE>file-name-completion</CODE>は、このリスト内のいずれかの文字列で終る
名前のファイルを通常無視する。
補完候補すべてがこれらの接頭辞の1つで終る場合や、
補完候補すべてを含んだバッファが表示されている場合には無視しない。
<P>

典型的な値はつぎのとおりである。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>completion-ignored-extensions
     => (".o" ".elc" "~" ".dvi")
</pre></td></tr></table></DL>
<P>

<A NAME="Standard File Names"></A>
<HR SIZE="6">
<br><A NAME="SEC390"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC389"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC391"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Standard File Names"></A>
<H3> 24.8.7 標準ファイル名 </H3>
<!--docid::SEC390::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Standard%20File%20Names">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Standard%20File%20Names</a>"<br>
"texi/elisp21/標準ファイル名"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%C9%B8%BD%E0%A5%D5%A5%A1%A5%A4%A5%EB%CC%BE">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

Lispプログラムで使われるほとんどのファイル名は、
ユーザーが入力したものです。
しかし、Lispプログラムでは、
特定目的の標準ファイル名を指定する必要がある場合があります。
典型的には、各ユーザーごとのカスタマイズ情報を保持するものです。
たとえば、省略形の定義は（デフォルトでは）
ファイル`<TT>~/.abbrev_defs</TT>'に保存されます。
パッケージ<CODE>completion</CODE>は、
補完情報をファイル`<TT>~/.completions</TT>'に保存します。
これらは、Emacsで特定目的に使われる多くの標準ファイル名のうちの2つです。
<P>

さまざまなのオペレーティングシステムには、
正しいファイル名やユーザーのプロフィールデータに使うファイル名に
独自の慣習があります。
標準ファイル名を使用するファイルを読み込むLispプログラムでは、
各システムごとに当該システムに適したファイル名を使うべきです。
関数<CODE>convert-standard-filename</CODE>は、これを簡単にします。
<P>

<A NAME="IDX1651"></A>
<DL>
<DT><U>Function:</U> <B>convert-standard-filename</B> <I>filename</I>
<DD>この関数は、ファイル名<VAR>filename</VAR>を使用しているオペレーティングシステム
の慣習に従うように変換し、新たな文字列として結果を返す。
</DL>
<P>

Lispプログラムにおいて標準ファイル名を指定する推奨方法は、
GNUとUNIXシステムの慣習に従った名前を選ぶことです。
つまり、ピリオドで始まる非ディレクトリ部分を選び、
それを直接使うかわりに<CODE>convert-standard-filename</CODE>に渡します。
パッケージ<CODE>completion</CODE>からの例をつぎに示します。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defvar save-completions-file-name
        (convert-standard-filename "~/.completions")
  "*The file name to save completions to.")
</pre></td></tr></table><P>

GNUとUNIXシステム、および、他のいくつかのシステムでは、
<CODE>convert-standard-filename</CODE>は引数を未変更で返します。
別のシステムでは、システムの慣習に従うように名前を変更します。
<P>

たとえば、MS-DOSではこの関数は、先頭の`<SAMP>.</SAMP>'を`<SAMP>_</SAMP>'に、
`<SAMP>.</SAMP>'がどこにもなければ名前の途中の`<SAMP>_</SAMP>'を`<SAMP>.</SAMP>'に、
8文字目のうしろに`<SAMP>.</SAMP>'がなければ`<SAMP>.</SAMP>'を挿入し、
`<SAMP>.</SAMP>'以降の3文字よりうしろを切り詰めるなどを行います。
（これ以外にも変更する。）
したがって、`<TT>.abbrev_defs</TT>'は`<TT>_abbrev.def</TT>'となり、
`<TT>.completions</TT>'は`<TT>_complet.ion</TT>'となります。
<P>

<A NAME="Contents of Directories"></A>
<HR SIZE="6">
<br><A NAME="SEC391"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC390"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC392"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Contents of Directories"></A>
<H2> 24.9 ディレクトリの内容 </H2>
<!--docid::SEC391::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Contents%20of%20Directories">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Contents%20of%20Directories</a>"<br>
"texi/elisp21/ディレクトリの内容"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8%A5%EA%A4%CE%C6%E2%CD%C6">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1652"></A>
<A NAME="IDX1653"></A>
<P>

ディレクトリは、さまざまな名前で入れた別のファイルを
収めているファイルの一種です。
ディレクトリは、ファイルシステムの機能です。
<P>

Emacsは、ディレクトリ内のファイル名をLispのリストとして一覧にしたり、
シェルコマンド<CODE>ls</CODE>を使ってバッファに名前を表示できます。
後者の場合、コマンド<CODE>ls</CODE>に渡したオプションに応じて、
各ファイルに関する情報も表示できます。
<P>

<A NAME="IDX1654"></A>
<DL>
<DT><U>Function:</U> <B>directory-files</B> <I>directory &#38;optional full-name match-regexp nosort</I>
<DD>この関数は、ディレクトリ<VAR>directory</VAR>内の
ファイルの名前から成るリストを返す。
デフォルトでは、リストはアルファベット順になる。
<P>

<VAR>full-name</VAR>が<CODE>nil</CODE>以外であると、
関数はファイルの絶対ファイル名を返す。
さもなければ、指定したディレクトリに対する相対名を返す。
<P>

<VAR>match-regexp</VAR>が<CODE>nil</CODE>以外であると、
この関数は正規表現<VAR>match-regexp</VAR>に一致するファイル名のみを返す。
つまり、他の名前のファイルはリストから除かれる。
<P>

<VAR>nosort</VAR>が<CODE>nil</CODE>以外であると、
<CODE>directory-files</CODE>はリストをソートしないので、
ファイル名の順番に規則はない。
処理速度を最大にしてファイルの処理順序に拘らないならば、これを用いる。
処理順序がユーザーに見える場合には、
ソートしたほうがユーザーは幸せであろう。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(directory-files "~lewis")
     => ("#foo#" "#foo.el#" "." ".."
         "dired-mods.el" "files.texi" 
         "files.texi.~1~")
</pre></td></tr></table><P>

<VAR>directory</VAR>が読めないディレクトリの名前であるとエラーを通知する。
</DL>
<P>

<A NAME="IDX1655"></A>
<DL>
<DT><U>Function:</U> <B>file-name-all-versions</B> <I>file dirname</I>
<DD>この関数は、ディレクトリ<VAR>dirname</VAR>内の<VAR>file</VAR>という名前の
ファイルのすべての版から成るリストを返す。
</DL>
<P>

<A NAME="IDX1656"></A>
<DL>
<DT><U>Function:</U> <B>insert-directory</B> <I>file switches &#38;optional wildcard full-directory-p</I>
<DD>この関数は、<CODE>ls</CODE>に<VAR>switches</VAR>を渡して表示した
ディレクトリ<VAR>file</VAR>の一覧を（カレントバッファに）挿入する。
ポイントは挿入したテキストのうしろに置かれる。
<P>

引数<VAR>file</VAR>は、ディレクトリ名であるか
ワイルドカードを含んだファイル指定である。
<VAR>wildcard</VAR>が<CODE>nil</CODE>以外であると、
<VAR>file</VAR>をワイルドカードを含むファイル指定として扱う。
<P>

<VAR>full-directory-p</VAR>が<CODE>nil</CODE>以外であると、
ディレクトリ一覧はディレクトリの全内容を表すと仮定することを意味する。
<VAR>file</VAR>がディレクトリであり<VAR>switches</VAR>に`<SAMP>-d</SAMP>'を含まない場合には、
<CODE>t</CODE>を指定すべきである。
（<CODE>ls</CODE>のオプション`<SAMP>-d</SAMP>'は、
ディレクトリの内容ではなく、ファイルとしてのディレクトリ自身を
表示することを意味する。）
<P>

この関数は、変数<CODE>insert-directory-program</CODE>で指定される
名前のディレクトリ表示プログラムを実行して動作する。
<VAR>wildcard</VAR>が<CODE>nil</CODE>以外であると、
ワイルドカードを展開するために<CODE>shell-file-name</CODE>で指定される
シェルを実行する。
</DL>
<P>

<A NAME="IDX1657"></A>
<DL>
<DT><U>Variable:</U> <B>insert-directory-program</B>
<DD>この変数の値は、関数<CODE>insert-directory</CODE>で
ディレクトリ一覧を生成するために実行するプログラムである。
</DL>
<P>

<A NAME="Create/Delete Dirs"></A>
<HR SIZE="6">
<br><A NAME="SEC392"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC391"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC393"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Create/Delete Dirs"></A>
<H2> 24.10 ディレクトリの作成と削除 </H2>
<!--docid::SEC392::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Create/Delete%20Dirs">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Create/Delete%20Dirs</a>"<br>
"texi/elisp21/ディレクトリの作成と削除"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8%A5%EA%A4%CE%BA%EE%C0%AE%A4%C8%BA%EF%BD%FC">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

Emacs Lispのほとんどのファイル操作関数は、
ディレクトリであるファイルに使うとエラーになります。
たとえば、<CODE>delete-file</CODE>ではディレクトリを削除できません。
これらの特別な関数はディレクトリを作成したり削除するためのものです。
<P>

<A NAME="IDX1658"></A>
<DL>
<DT><U>Function:</U> <B>make-directory</B> <I>dirname</I>
<DD>この関数は<VAR>dirname</VAR>という名前のディレクトリを作る。
</DL>
<P>

<A NAME="IDX1659"></A>
<DL>
<DT><U>Function:</U> <B>delete-directory</B> <I>dirname</I>
<DD>この関数は、ディレクトリ<VAR>dirname</VAR>を削除する。
関数<CODE>delete-file</CODE>は、ディレクトリであるファイルには使えない。
ディレクトリには<CODE>delete-directory</CODE>を使う必要がある。
ディレクトリ内にファイルがあると、<CODE>delete-directory</CODE>は
エラーを通知する。
</DL>
<P>

<A NAME="Magic File Names"></A>
<HR SIZE="6">
<br><A NAME="SEC393"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC392"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC394"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Magic File Names"></A>
<H2> 24.11 ファイル名を『マジック』にする </H2>
<!--docid::SEC393::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Magic%20File%20Names">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Magic%20File%20Names</a>"<br>
"texi/elisp21/ファイル名を『マジック』にする"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A1%A5%A4%A5%EB%CC%BE%A4%F2%A1%D8%A5%DE%A5%B8%A5%C3%A5%AF%A1%D9%A4%CB%A4%B9%A4%EB">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX1660"></A>
<P>

特定のファイル名を特別に扱うことができます。
これをそれらの名前を<EM>マジック</EM>（magic）にするといいます。
この機能の主な用途はリモートファイル名
（see <a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=emacs21&node=Remote%20Files">GNU Emacs マニュアル</a>）
を実装することです。
<P>

マジックファイル名の種類を定義するには、
名前のクラス（正規表現に一致するものすべて）を定義する正規表現と、
それに一致するファイルに対する
Emacsの基本ファイル操作を実装するハンドラを指定する必要があります。
<P>

変数<CODE>file-name-handler-alist</CODE>は、
ハンドラと当該ハンドラの適用を決定する正規表現からなるリストを保持します。
各要素の形はつぎのとおりです。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(<VAR>regexp</VAR> . <VAR>handler</VAR>)
</pre></td></tr></table><P>

Emacsのすべてのファイル操作基本関数とファイル名変換基本関数は、
指定された名前を<CODE>file-name-handler-alist</CODE>に対して検査します。
ファイル名が<VAR>regexp</VAR>に一致すると、
基本関数は<VAR>handler</VAR>を呼び出して当該ファイルを処理します。
<P>

<VAR>handler</VAR>に与える最初の引数は基本関数の名前です。
残りの引数は当該操作に渡されるべき引数です。
（それらの引数の最初のものは典型的にはファイル名自身である。）
たとえば、つぎのようにした場合、
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(file-exists-p <VAR>filename</VAR>)
</pre></td></tr></table><P>

<VAR>filename</VAR>にハンドラ<VAR>handler</VAR>があると、
<VAR>handler</VAR>はつぎのように呼び出されます。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(funcall <VAR>handler</VAR> 'file-exists-p <VAR>filename</VAR>)
</pre></td></tr></table><P>

つぎは、マジックファイル名のハンドラが処理すべき操作です。
<P>

<CODE>add-name-to-file</CODE>、<CODE>copy-file</CODE>、<CODE>delete-directory</CODE>、
<CODE>delete-file</CODE>、
<CODE>diff-latest-backup-file</CODE>、
<CODE>directory-file-name</CODE>、
<CODE>directory-files</CODE>、
<CODE>dired-call-process</CODE>、
<CODE>dired-compress-file</CODE>、<CODE>dired-uncache</CODE>、
<CODE>expand-file-name</CODE>、
<CODE>file-accessible-directory-p</CODE>、<BR>
<CODE>file-attributes</CODE>、
<CODE>file-directory-p</CODE>、
<CODE>file-executable-p</CODE>、<CODE>file-exists-p</CODE>、<BR>
<CODE>file-local-copy</CODE>、
<CODE>file-modes</CODE>、<CODE>file-name-all-completions</CODE>，<BR>
<CODE>file-name-as-directory</CODE>、
<CODE>file-name-completion</CODE>、
<CODE>file-name-directory</CODE>、
<CODE>file-name-nondirectory</CODE>、
<CODE>file-name-sans-versions</CODE>、<CODE>file-newer-than-file-p</CODE>、
<CODE>file-ownership-preserved-p</CODE>、
<CODE>file-readable-p</CODE>、<CODE>file-regular-p</CODE>、<CODE>file-symlink-p</CODE>、
<CODE>file-truename</CODE>、<CODE>file-writable-p</CODE>、
<CODE>find-backup-file-name</CODE>、
<CODE>get-file-buffer</CODE>、<BR>
<CODE>insert-directory</CODE>、
<CODE>insert-file-contents</CODE>、
<CODE>load</CODE>, <CODE>make-directory</CODE>、
<CODE>make-symbolic-link</CODE>、<CODE>rename-file</CODE>、<CODE>set-file-modes</CODE>、
<CODE>set-visited-file-modtime</CODE>、<CODE>shell-command</CODE>、<BR>
<CODE>unhandled-file-name-directory</CODE>、
<CODE>vc-registered</CODE>、
<CODE>verify-visited-file-modtime</CODE>、<BR>
<CODE>write-region</CODE>。
<P>

<CODE>insert-file-contents</CODE>に対するハンドラは、
引数<VAR>visit</VAR>が<CODE>nil</CODE>以外であるときには
<CODE>(set-buffer-modified-p nil)</CODE>を使って
バッファの変更フラグをクリアする必要が典型的にはあります。
<P>

ハンドラ関数は、上のすべての操作、ならびに、
将来追加されるものを扱える必要があります。
これらの操作すべてをハンドラ自身で実装する必要はありません。
特定の操作について特別なことを行う必要がなければ、
『通常どおりに』操作を処理するために基本関数を再起動できます。
ハンドラが認識できない操作については、
基本関数を再起動するべきです。
1つの方法はつぎのとおりです。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(defun my-file-handler (operation &#38;rest args)
  ;; まず、特別に扱う必要がある操作かどうか検査する
  (cond ((eq operation 'insert-file-contents) <small>...</small>)
        ((eq operation 'write-region) <small>...</small>)
        <small>...</small>
        ;; 知らない操作を扱う
        (t (let ((inhibit-file-name-handlers
                  (cons 'my-file-handler 
                        (and (eq inhibit-file-name-operation operation)
                             inhibit-file-name-handlers)))
                 (inhibit-file-name-operation operation))
             (apply operation args)))))
</FONT></pre></td></tr></table><P>

ハンドラ関数で、指定された操作についてはEmacsの通常の基本関数を呼び出すと
決定したときには、基本関数から同じハンドラが再度呼ばれて
無限再帰になることを防ぐ必要があります。
上の例は、変数<CODE>inhibit-file-name-handlers</CODE>と
<CODE>inhibit-file-name-operation</CODE>を使ってこれを行う方法を示すものです。
それらを上に示したとおりに使うように注意してください。
複数のハンドラがあったり、
2つのファイルを扱う操作において各ファイルにハンドラがある場合には、
この詳細は重要です。
<P>

<A NAME="IDX1661"></A>
<DL>
<DT><U>Variable:</U> <B>inhibit-file-name-handlers</B>
<DD>この変数は、特定操作については
現在適用を禁止されているハンドラのリストを保持する。
</DL>
<P>

<A NAME="IDX1662"></A>
<DL>
<DT><U>Variable:</U> <B>inhibit-file-name-operation</B>
<DD>特定のハンドラにおいて現在禁止されている操作。
</DL>
<P>

<A NAME="IDX1663"></A>
<DL>
<DT><U>Function:</U> <B>find-file-name-handler</B> <I>file operation</I>
<DD>この関数はファイル名<VAR>file</VAR>に対するハンドラ関数を返す。
ハンドラがなければ<CODE>nil</CODE>を返す。
引数<VAR>operation</VAR>は、ファイルに対して適用する操作であること。
つまり、ハンドラを呼び出すときに第1引数として渡される値。
当該操作は<CODE>inhibit-file-name-operation</CODE>と比較する必要がある。
</DL>
<P>

<A NAME="IDX1664"></A>
<DL>
<DT><U>Function:</U> <B>file-local-copy</B> <I>filename</I>
<DD>この関数は、ファイル<VAR>filename</VAR>がマジックでない普通のファイルでなければ、
<VAR>filename</VAR>をマジックでない普通のファイルにコピーする。
<P>

<VAR>filename</VAR>が、
Emacsの外側のプログラムからは直接読んだり書けないマジックファイル名であると、
この関数は普通のファイルにコピーしてそのファイルの名前を返す。
<P>

<VAR>filename</VAR>が普通のファイル名でマジックでなければ、
この関数はなにもせずに<CODE>nil</CODE>を返す。
</DL>
<P>

<A NAME="IDX1665"></A>
<DL>
<DT><U>Function:</U> <B>unhandled-file-name-directory</B> <I>filename</I>
<DD>この関数は、マジックではないディレクトリの名前を返す。
<VAR>filename</VAR>がマジックでなければ、
<VAR>filename</VAR>のディレクトリ部分を使う。
マジックファイル名であると、ファイル名ハンドラを起動し、
当該ハンドラがどんな値を返すか決定する。
<P>

これは実行中のサブプロセスに有用である。
各サブプロセスには、カレントディレクトリとしてマジックでないディレクトリが
必要であり、この関数はそれを扱うのによい方法である。
</DL>
<P>

<A NAME="Format Conversion"></A>
<HR SIZE="6">
<br><A NAME="SEC394"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_25.html#SEC393"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_26.html#SEC395"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Format Conversion"></A>
<H2> 24.12 ファイル書式変換 </H2>
<!--docid::SEC394::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Format%20Conversion">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Format%20Conversion</a>"<br>
"texi/elisp21/ファイル書式変換"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D5%A5%A1%A5%A4%A5%EB%BD%F1%BC%B0%CA%D1%B4%B9">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

<A NAME="IDX1666"></A>
<A NAME="IDX1667"></A>
<A NAME="IDX1668"></A>
変数<CODE>format-alist</CODE>は、
Emacsバッファ内のデータ（テキスト、テキスト属性、その他の情報）を
ファイル内でテキスト表現する方法を記述した
<EM>ファイル書式</EM>（file format）のリストを定義します。
Emacsはファイルを読み書きするときに必要ならば書式変換を行います。
<P>

<A NAME="IDX1669"></A>
<DL>
<DT><U>Variable:</U> <B>format-alist</B>
<DD>このリストは、各ファイル書式の定義を含んだリストである。
</DL>
<P>

<A NAME="IDX1670"></A>
各書式定義はつぎの形のリストです。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(<VAR>name</VAR> <VAR>doc-string</VAR> <VAR>regexp</VAR> <VAR>from-fn</VAR> <VAR>to-fn</VAR> <VAR>modify</VAR> <VAR>mode-fn</VAR>)
</pre></td></tr></table><P>

書式定義の各要素の意味はつぎのとおりです。
<P>

<DL COMPACT>
<DT><VAR>name</VAR>
<DD>当該書式の名前。
<P>

<DT><VAR>doc-string</VAR>
<DD>当該書式の説明文字列。
<P>

<DT><VAR>regexp</VAR>
<DD>当該書式で表現されたファイルを認識するために使用する正規表現。
<P>

<DT><VAR>from-fn</VAR>
<DD>当該書式のデータを復号化（ファイル内のデータをEmacsの通常のデータ表現へ
変換）するためのシェルコマンドか関数。
<P>

シェルコマンドは文字列で表現し、
Emacsは変換を行うために当該コマンドをフィルタとして実行する。
<P>

<VAR>from-fn</VAR>が関数であると、
バッファの変換すべき部分を指定する<VAR>begin</VAR>と<VAR>end</VAR>の2つの引数で
呼ばれる。
当該関数はその場で編集してテキストを変換すること。
これによりテキストの長さが変わる可能性があるので、
<VAR>from-fn</VAR>は変更部分の末尾位置を返すこと。
<P>

<VAR>from-fn</VAR>の責任の1つは、
ファイルの先頭が<VAR>regexp</VAR>で始まらないように保証することである。
さもないと、再度呼び出される可能性がある。
<P>

<DT><VAR>to-fn</VAR>
<DD>当該書式にデータを符号化するためのシェルコマンドか関数。
つまり、Emacsの通常のデータ表現を当該書式に変換する。
<P>

<VAR>to-fn</VAR>が文字列であるとそれはシェルコマンドであり、
Emacsは変換を行うために当該コマンドをフィルタとして実行する。
<P>

<VAR>to-fn</VAR>が関数であると、
バッファの変換すべき部分を指定する<VAR>begin</VAR>と<VAR>end</VAR>の2つの引数で
呼ばれる。
変換を行うには2つの方法がある。
<P>

<UL>
<LI>
その場でバッファを編集する。
この場合、<VAR>to-fn</VAR>は変更したテキスト範囲の終了位置を返すこと。
<P>

<LI>
注記のリストを返す。
このリストは、<CODE>(<VAR>position</VAR> . <VAR>string</VAR>)</CODE>の形の要素から成り、
<VAR>position</VAR>は書き出すべきテキスト内での相対位置を指定する整数、
<VAR>string</VAR>はそこに追加すべき注記である。
<VAR>to-fn</VAR>がリストを返すときには、
リストは<VAR>position</VAR>の順にソートしてあること。
<P>

<CODE>write-region</CODE>がバッファからファイルへ実際に書き出すとき、
指定された注記を対応する位置に埋め込む。
これらすべては、バッファを変更せずに行われる。
</UL>
<P>

<DT><VAR>modify</VAR>
<DD>フラグであり、
符号化関数がバッファを変更する場合には<CODE>t</CODE>、
注記のリストを返す場合には<CODE>nil</CODE>である。
<P>

<DT><VAR>mode</VAR>
<DD>当該書式から変換されたファイルを訪問後に呼び出されるモード関数。
</DL>
<P>

関数<CODE>insert-file-contents</CODE>は、指定されたファイルを読み込むときに
ファイル書式を自動的に認識します。
ファイルの先頭のテキストを書式定義の正規表現に対して検査して、
一致がみつかれば当該書式の復号化関数を呼び出します。
そして、既知の書式について再度調べ直します。
適用できる書式がなくなるまで検査し続けます。
<P>

関数<CODE>find-file-noselect</CODE>やこれを使うコマンドでファイルを訪問すると、
（<CODE>insert-file-contents</CODE>を呼び出すので）同様に変換を行います。
さらに、この関数は、復号した各書式についてモード関数を呼び出します。
バッファローカルな変数<CODE>buffer-file-format</CODE>に
書式名のリストを保存します。
<P>

<A NAME="IDX1671"></A>
<DL>
<DT><U>Variable:</U> <B>buffer-file-format</B>
<DD>この変数は、訪問したファイルの書式を記述している。
より正確には、カレントバッファのファイルを訪問する過程で
復号したファイル書式名のリストである。
この変数は、すべてのバッファにおいてつねにバッファローカルである。
</DL>
<P>

<CODE>write-region</CODE>がデータをファイルに書き出すときには、まず、
<CODE>buffer-file-format</CODE>で指定された書式の符号化関数を
リストに現れる順に呼び出します。
<P>

<A NAME="IDX1672"></A>
<DL>
<DT><U>コマンド:</U> <B>format-write-file</B> <I>file format</I>
<DD>このコマンドは、カレントバッファの内容を書式<VAR>format</VAR>にて
ファイル<VAR>file</VAR>に書き出す。
さらに、当該書式をバッファを将来保存するときのデフォルトとする。
引数<VAR>format</VAR>は、書式名のリストである。
</DL>
<P>

<A NAME="IDX1673"></A>
<DL>
<DT><U>コマンド:</U> <B>format-find-file</B> <I>file format</I>
<DD>このコマンドは、ファイル<VAR>file</VAR>を探し、
それを書式<VAR>format</VAR>に従って変換する。
さらに、当該書式をバッファをのちに保存するときのデフォルトとする。
<P>

引数<VAR>format</VAR>は、書式名のリストである。
<VAR>format</VAR>が<CODE>nil</CODE>であると、変換を行わない。
対話的に呼び出した場合、
<VAR>format</VAR>に<CODE>nil</CODE>を指定するには<KBD>RET</KBD>のみを打つ。
</DL>
<P>

<A NAME="IDX1674"></A>
<DL>
<DT><U>コマンド:</U> <B>format-insert-file</B> <I>file format &#38;optional beg end</I>
<DD>このコマンドは、ファイル<VAR>file</VAR>の内容を書式<VAR>format</VAR>に従って
変換して挿入する。
<VAR>beg</VAR>と<VAR>end</VAR>が<CODE>nil</CODE>以外であると、
それらは、<CODE>insert-file-contents</CODE>（see 節 <A HREF="elisp_25.html#SEC374">24.3 ファイルの読み込み</A>）と同様に、
読み込むべきファイルの部分を指定する。
<P>

戻り値は、<CODE>insert-file-contents</CODE>が返す値に似ており、
絶対ファイル名と挿入データの（変換後の）長さのリストである。
<P>

引数<VAR>format</VAR>は、書式名のリストである。
<VAR>format</VAR>が<CODE>nil</CODE>であると、変換を行わない。
対話的に呼び出した場合、
<VAR>format</VAR>に<CODE>nil</CODE>を指定するには<KBD>RET</KBD>のみを打つ。
</DL>
<P>

<A NAME="IDX1675"></A>
<DL>
<DT><U>Variable:</U> <B>auto-save-file-format</B>
<DD>この変数は、自動保存に対して使用する書式を指定する。
その値は、<CODE>buffer-file-format</CODE>の値のように、書式名のリストであるが、
<CODE>buffer-file-format</CODE>のかわりに
自動保存ファイルを書くために使われる。
この変数は、すべてのバッファにおいてつねにバッファローカルである。
</DL>
<P>

<A NAME="Backups and Auto-Saving"></A>
<HR SIZE="6">
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<a name="bottom"> </a>
<script type="text/javascript" src="style2.js"></script>
<div class="footer">
    <br>
    このページはMeadow (Emacs) の紹介ページです <br>
このWebページの各文書は自由にリンク・複製・再配布・改変していただいて構いません．
<br>ただし，複製・再配布・改変の場合は Meadow Memo のURLを記載しておいて下さい．<br>
<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=about%20link">Medow memoへのリンクについて</a>．<br>

間違い，要望等があれば<a href="mailto:akihisa@mail.ne.jp">akihisa@mail.ne.jp</a> か下記でどうぞ<br>

<br>

<FORM METHOD="post" ACTION="http://www.bookshelf.jp/cgi-bin/wwwmail.cgi" >
お名前：<INPUT TYPE="text" NAME="name" SIZE="30" MAXLENGTH="40" VALUE="ななしさん"><br>
メールアドレス：<INPUT TYPE="text" NAME="EMAIL" SIZE="25" MAXLENGTH="60" VALUE="secret@mail.adr"><br>
<input type="hidden" name="HPAGE" value="">
つっこみ：<br><TEXTAREA NAME="MESSAGE" ROWS="5" COLS="50">
</TEXTAREA><br><br>
<INPUT TYPE="submit" VALUE="送信">
<INPUT TYPE="reset" VALUE="クリア">
</FORM>

<br><A HREF="http://www.bookshelf.jp/cgi-bin/xct.cgi">ページ別カウンタ</a>
<br> Since 2002/12/13 <br>
</div>

</BODY>

</HTML>
