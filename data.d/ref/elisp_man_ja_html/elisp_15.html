<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML lang="ja">
<!-- Created on October, 1  2005 by texi2html 1.64 -->
<!-- 
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Olaf Bachmann <obachman@mathematik.uni-kl.de>
Send bugs and suggestions to <texi2html@mathematik.uni-kl.de>
 
-->
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html;CHARSET=euc-jp">
<META NAME="keywords" CONTENT="meadow,mule,emacs,lisp,elisp,gnus,setting,設定,unix,cygwin">
<META http-equiv="Content-Script-Type" content="text/javascript">
<META NAME="description" CONTENT="Meadowの設定を紹介するページです">
<TITLE>GNU Emacs Lispリファレンスマニュアル:  ロード</TITLE>

<META NAME="description" CONTENT="GNU Emacs Lispリファレンスマニュアル:  ロード">
<META NAME="keywords" CONTENT="GNU Emacs Lispリファレンスマニュアル:  ロード">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META NAME="Generator" CONTENT="texi2html 1.64">

<LINK REL="contents" HREF="elisp_toc.html#SEC_Contents">
<LINK REL="index" HREF="elisp_48.html#SEC681">
<LINK REL="next" HREF="elisp_16.html#SEC200">
<LINK REL="prev" HREF="elisp_14.html#SEC182">

<META http-equiv="Content-Style-Type" content="text/css">
<!-- 鶯と龜 ←日本語EUC誤判別対策用らしい; -->
<link rel="StyleSheet" href="../../../../soft/css/midnight.css" type="text/css" id="css1">
<script type="text/javascript" src="style1.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../soft/css/meadowmemo.css">

</HEAD>
<BODY LANG="ja" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">
<!--Infoseek Analyzer start-->
<script LANGUAGE="javascript">PgNo=6;</script>
<script src="http://js1.infoseek.co.jp/bin/57/00170.js"></script>
<noscript><a href="http://ax1.www.infoseek.co.jp/bin/go?0017057f" target="_blank">
<img src="http://ax1.www.infoseek.co.jp/bin/logo?0017057f" border=0></a></noscript>
<!--Infoseek Analyzer end-->
<a name="top"> </a>

<br><A NAME="SEC191"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_14.html#SEC190"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_15.html#SEC192"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_14.html#SEC182"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_16.html#SEC200"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Loading"></A>
<H1> 14. ロード </H1>
<!--docid::SEC191::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Loading">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Loading</a>"<br>
"texi/elisp21/ロード"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%ED%A1%BC%A5%C9">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX711"></A>
<A NAME="IDX712"></A>
<A NAME="IDX713"></A>
<P>

Lispコードのファイルをロードするとは、
その内容をLispオブジェクトの形でLisp環境に取り込むことです。
Emacsは、ファイルを探してオープンし、テキストを読み取り、
各フォームを評価し、そしてファイルをクローズします。
<P>

ロード関数は、関数<CODE>eval-current-buffer</CODE>がバッファ内の
すべての式を評価するように、ファイル内のすべての式を評価します。
異なる点は、ロード関数は、Emacsバッファ内のテキストではなく
ディスク上のファイル内のテキストを読み取って評価することです。
<P>

<A NAME="IDX714"></A>
<A NAME="IDX715"></A>
ロードするファイルには、Lisp式のソースコードかバイトコンパイル済みコードが
入っている必要があります。
ファイルの各フォームを<EM>トップレベルのフォーム</EM>（top-level form）と
呼びます。
ロード可能なファイル内のフォーム向けの特別な書式はありません。
ファイル内のどんなフォームでも、バッファに直接打ち込んで評価できます。
（もちろん、ほとんどのコードはこのようにして試したはず。）
ほとんどの場合、フォームは関数定義や変数定義です。
<P>

Lispコードを収めたファイルをしばしば<EM>ライブラリ</EM>（library）と呼びます。
したがって、『rmailライブラリ』は、rmailモード用のコードを収めたファイルです。
同様に、『Lispライブラリディレクトリ』は、
Lispコードを収めたファイルのディレクトリです。
<P>

<div class="menuindex"><SCRIPT language=JavaScript src="index14.js"></SCRIPT></div><noscript><BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_15.html#SEC192">14.1 プログラムからのロード方法</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">The <CODE>load</CODE> function and others.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_15.html#SEC193">14.2 ライブラリの探索</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Finding a library to load.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_15.html#SEC194">14.3 非ASCII文字のロード</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Non-ASCII characters in Emacs Lisp files.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_15.html#SEC195">14.4 自動ロード</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Setting up a function to autoload.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_15.html#SEC196">14.5 ロードの繰り返し</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Precautions about loading a file twice.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_15.html#SEC197">14.6 機能</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Loading a library if it isn't already loaded.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_15.html#SEC198">14.7 アンロード</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How to "unload" a library that was loaded.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="elisp_15.html#SEC199">14.8 ロード時のフック</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Providing code to be run when
				  particular libraries are loaded.</TD></TR>
</TABLE></BLOCKQUOTE></noscript>
<P>

<A NAME="How Programs Do Loading"></A>
<HR SIZE="6">
<br><A NAME="SEC192"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_15.html#SEC191"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_15.html#SEC193"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="How Programs Do Loading"></A>
<H2> 14.1 プログラムからのロード方法 </H2>
<!--docid::SEC192::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=How%20Programs%20Do%20Loading">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=How%20Programs%20Do%20Loading</a>"<br>
"texi/elisp21/プログラムからのロード方法"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%D7%A5%ED%A5%B0%A5%E9%A5%E0%A4%AB%A4%E9%A4%CE%A5%ED%A1%BC%A5%C9%CA%FD%CB%A1">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

Emacs Lispには、ロードのためのインターフェイスがいくつかあります。
たとえば、<CODE>autoload</CODE>は、
ファイルで定義された関数向けに場所を確保するオブジェクトを作成します。
自動ロードする関数を呼び出すと、
ファイルの実際の定義を得るためにファイルをロードします（see 節 <A HREF="elisp_15.html#SEC195">14.4 自動ロード</A>）。
<CODE>require</CODE>は、ファイルをすでにロードしていなければロードします
（see 節 <A HREF="elisp_15.html#SEC197">14.6 機能</A>）。
これらの機構はすべて、最終的には、関数<CODE>load</CODE>を呼び出して動作します。
<P>

<A NAME="IDX716"></A>
<DL>
<DT><U>Function:</U> <B>load</B> <I>filename &#38;optional missing-ok nomessage nosuffix must-suffix</I>
<DD>この関数は、Lispコードのファイルを探してオープンし、
その中のフォームすべてを評価してから、ファイルをクローズする。
<P>

ファイルを探すために、
<CODE>load</CODE>はまず`<TT><VAR>filename</VAR>.elc</TT>'という名前のファイル、
つまり、<VAR>filename</VAR>に`<SAMP>.elc</SAMP>'を付加した名前のファイルを探す。
そのようなファイルが存在すれば、それをロードする。
そのような名前のファイルがなければ、
<CODE>load</CODE>は`<TT><VAR>filename</VAR>.el</TT>'という名前のファイルを探す。
そのファイルが存在すれば、それをロードする。
いずれの名前のファイルもみつからなければ、
最終的に、<CODE>load</CODE>は、なにも付加しない<VAR>filename</VAR>という名前のファイルを
探し、存在すればそれをロードする。
（関数<CODE>load</CODE>が<VAR>filename</VAR>を探す手順は賢くない。
<CODE>(load "foo.el")</CODE>を評価すると、
`<TT>foo.el.el</TT>'という名前のファイルを探してしまう。）
<P>

省略可能な引数<VAR>nosuffix</VAR>が<CODE>nil</CODE>以外であれば、
`<SAMP>.elc</SAMP>'と`<SAMP>.el</SAMP>'の接尾辞を試さない。
この場合、目的のファイルの正確な名前を指定する必要がある。
正確なファイル名を指定し、かつ、<VAR>nosuffix</VAR>に<CODE>t</CODE>を使えば、
`<TT>foo.el.el</TT>'のようなファイル名を探してしまうことを防げる。
<P>

省略可能な引数<VAR>must-suffix</VAR>が<CODE>nil</CODE>以外であれば、
<CODE>load</CODE>は、ディレクトリ名を明示していない限り、
ファイル名は`<SAMP>.el</SAMP>'か`<SAMP>.elc</SAMP>'で終るものと仮定する。
<VAR>filename</VAR>にディレクトリ名が明示してなく、かつ、
接尾辞も指定してなければ、<CODE>load</CODE>は接尾辞を必ず付加する。
<P>

<VAR>filename</VAR>が`<TT>foo</TT>'や`<TT>baz/foo.bar</TT>'のように
相対ファイル名であると、<CODE>load</CODE>は変数<CODE>load-path</CODE>を使って
ファイルを探す。
<VAR>filename</VAR>に<CODE>load-path</CODE>に指定した各ディレクトリを付加し、
最初にみつかったファイルをロードする。
デフォルトディレクトリを表す<CODE>nil</CODE>が<CODE>load-path</CODE>に
指定されている場合に限り、カレントディレクトリを試す。
<CODE>load</CODE>は、まず最初のディレクトリで3つの可能な接尾辞を試し、
続いて2番目のディレクトリで3つの可能な接尾辞を試し、
というように行う。
see 節 <A HREF="elisp_15.html#SEC193">14.2 ライブラリの探索</A>。
<P>

`<TT>foo.elc</TT>'が`<TT>foo.el</TT>'より古いという旨の警告を受け取った場合には、
`<TT>foo.el</TT>'の再コンパイルを考えるべきである。
see 節 <A HREF="elisp_16.html#SEC200">15. バイトコンパイル</A>。
<P>

（コンパイルしていない）ソースファイルをロードするときには、
Emacsがファイルを訪問する場合と同様に、
<CODE>load</CODE>は文字集合を変換する。
see 節 <A HREF="elisp_33.html#SEC538">32.10 コーディングシステム</A>。
<P>

<VAR>nomessage</VAR>が<CODE>nil</CODE>であると、
ロード中にはエコー領域に
`<SAMP>Loading foo...</SAMP>'や`<SAMP>Loading foo...done</SAMP>'のメッセージを表示する。
<P>

<A NAME="IDX717"></A>
<A NAME="IDX718"></A>
ファイルをロード中に処理できないエラーに出会うと、ロードを終了する。
<CODE>autoload</CODE>によるロードの場合には、
ロード中に行われた関数定義はすべてもとに戻す。
<P>

<A NAME="IDX719"></A>
<CODE>load</CODE>がロードすべきファイルをみつけられないと、
普通、（`<SAMP>Cannot open load file <VAR>filename</VAR></SAMP>'を伴った）
エラー<CODE>file-error</CODE>を通知する。
<VAR>missing-ok</VAR>が<CODE>nil</CODE>以外であれば、
<CODE>load</CODE>は<CODE>nil</CODE>を返すだけである。
<P>

変数<CODE>load-read-function</CODE>を使って、
式を読み取るために<CODE>read</CODE>のかわりに<CODE>load</CODE>が使う関数を指定できる。
下記参照。
<P>

ファイルを正しくロードできると<CODE>load</CODE>は<CODE>t</CODE>を返す。
</DL>
<P>

<A NAME="IDX720"></A>
<DL>
<DT><U>コマンド:</U> <B>load-file</B> <I>filename</I>
<DD>このコマンドはファイル<VAR>filename</VAR>をロードする。
<VAR>filename</VAR>が相対ファイル名であると、
現在のデフォルトディレクトリを仮定する。
<CODE>load-path</CODE>を使わず、接尾辞も付加しない。
ロードするファイル名を正確に指定したい場合にこのコマンドを使う。
</DL>
<P>

<A NAME="IDX721"></A>
<DL>
<DT><U>コマンド:</U> <B>load-library</B> <I>library</I>
<DD>このコマンドは、<VAR>library</VAR>という名前のライブラリをロードする。
<CODE>load</CODE>と等価であるが、引数を対話的に読み取る点が異なる。
</DL>
<P>

<A NAME="IDX722"></A>
<DL>
<DT><U>Variable:</U> <B>load-in-progress</B>
<DD>Emacsがファイルをロード処理中であると、
この変数は<CODE>nil</CODE>以外であり、さもなければ<CODE>nil</CODE>である。
</DL>
<P>

<A NAME="IDX723"></A>
<DL>
<DT><U>Variable:</U> <B>load-read-function</B>
<DD>この変数は、<CODE>load</CODE>や<CODE>eval-region</CODE>が、
<CODE>read</CODE>のかわりに使う、式を読み取る関数を指定する。
その関数は<CODE>read</CODE>と同様に引数を1つとること。
<P>

通常、この変数の値は<CODE>nil</CODE>であり、
これらの関数が<CODE>read</CODE>を使うことを意味する。
<P>

<STRONG>注意：</STRONG><CODE> </CODE>
この変数を使うかわりに、<CODE>eval-region</CODE>の引数<VAR>read-function</VAR>として
関数を渡す新しい別の機能を使ったほうが見通しがよい。
see 節 <A HREF="elisp_9.html#SEC121">8.4 評価（eval）</A>。
</DL>
<P>

Emacs構築時の<CODE>load</CODE>の使い方についての情報は、
See 節 <A HREF="elisp_43.html#SEC668">C.1 Emacsの構築方法</A>。
<P>

<A NAME="Library Search"></A>
<HR SIZE="6">
<br><A NAME="SEC193"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_15.html#SEC192"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_15.html#SEC194"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Library Search"></A>
<H2> 14.2 ライブラリの探索 </H2>
<!--docid::SEC193::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Library%20Search">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Library%20Search</a>"<br>
"texi/elisp21/ライブラリの探索"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%E9%A5%A4%A5%D6%A5%E9%A5%EA%A4%CE%C3%B5%BA%F7">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

EmacsがLispライブラリをロードするときには、
変数<CODE>load-path</CODE>で指定したディレクトリ群でライブラリを探します。
<P>

<A NAME="IDX724"></A>
<DL>
<DT><U>User Option:</U> <B>load-path</B>
<DD><A NAME="IDX725"></A>
<A NAME="IDX726"></A>
この変数の値は、<CODE>load</CODE>でファイルをロードするときに探索する
ディレクトリのリストである。
各要素は、（ディレクトリ名である）文字列か
（カレント作業ディレクトリを表す）<CODE>nil</CODE>である。
</DL>
<P>

<CODE>load-path</CODE>の値は、環境変数<CODE>EMACSLOADPATH</CODE>があれば、
それで初期化します。
さもなければ、デフォルト値は、
Emacsを構築したときに`<TT>emacs/src/paths.h</TT>'で指定したものです。
そして、リスト内のディレクトリのサブディレクトリをリストに追加して
拡張します。
<P>

<CODE>EMACSLOADPATH</CODE>の構文は<CODE>PATH</CODE>と同じです。
`<SAMP>:</SAMP>'（オペレーティングシステムによっては`<SAMP>;</SAMP>'）で
ディレクトリ名を区切ります。
デフォルトのカレントディレクトリには`<SAMP>.</SAMP>'を使います。
<CODE>csh</CODE>の`<TT>.login</TT>'ファイルで環境変数<CODE>EMACSLOADPATH</CODE>を
指定する例はつぎのとおりです。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>setenv EMACSLOADPATH .:/user/bil/emacs:/usr/local/share/emacs/20.3/lisp
</FONT></pre></td></tr></table><P>

<CODE>sh</CODE>を使っている場合はつぎのようにします。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>export EMACSLOADPATH
EMACSLOADPATH=.:/user/bil/emacs:/usr/local/share/emacs/20.3/lisp
</FONT></pre></td></tr></table><P>

`<TT>.emacs</TT>'ファイルで、
デフォルトの<CODE>load-path</CODE>の先頭に複数のディレクトリを追加するには、
つぎのようなコードを書きます。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(setq load-path
      (append (list nil "/user/bil/emacs"
                    "/usr/local/lisplib"
                    "~/emacs")
              load-path))
</FONT></pre></td></tr></table><P>

この例では、Lispコードを、まずカレント作業ディレクトリで探索し、
続いて、`<TT>/user/bil/emacs</TT>'ディレクトリ、
`<TT>/usr/local/lisplib</TT>'ディレクトリ、`<TT>~/emacs</TT>'ディレクトリ、
さらに、標準のディレクトリで探索します。
<P>

Emacsのダンプには、<CODE>load-path</CODE>の特別な値を使います。
ダンプ終了時に<CODE>load-path</CODE>の値が未変更（つまり、同じ特別な値）であれば、
ダンプ版Emacsは起動時に、上に述べたように、普通の<CODE>load-path</CODE>の値を
使います。
しかし、ダンプ終了時に<CODE>load-path</CODE>の値が別の値であれば、
ダンプ版Emacsの実行でもその（別の）値を使います。
<P>

したがって、`<TT>site-init.el</TT>'や`<TT>site-load.el</TT>'で
少数のライブラリをロードするために
一時的に<CODE>load-path</CODE>を変更したい場合には、
<CODE>load</CODE>の呼び出しを<CODE>let</CODE>で囲んで
<CODE>load-path</CODE>をローカルに束縛するべきです。
<P>

システムにインストールしたEmacsを実行中は、
<CODE>load-path</CODE>のデフォルト値には、2つの特別なディレクトリ
（とそれらのサブディレクトリ）が含まれます。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>"/usr/local/share/emacs/<VAR>version</VAR>/site-lisp"
</FONT></pre></td></tr></table><P>

と
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>"/usr/local/share/emacs/site-lisp"
</FONT></pre></td></tr></table><P>

です。
前者は、Emacsの特定の版向けにローカルにインストールしたパッケージ用です。
後者は、Emacsの任意の版向けにローカルにインストールしたパッケージ用です。
<P>

Emacsのある版向けのパッケージが別の版ではトラブルを引き起こす理由は
いくつかあります。
Emacsの互換性のない変更のために更新を必要とするパッケージもあります。
予告なしに変更される可能性のある明文化していない
Emacsの内部データに依存するものもあります。
Emacsの新しい版では、パッケージの特定の版と一体になっているものもあり、
その版だけで使うべきです。
<P>

Emacsは、起動すると、ディレクトリのサブディレクトリを捜し出して、
それらを<CODE>load-path</CODE>に追加します。
直下のサブディレクトリも複数レベル下のサブディレクトリも
<CODE>load-path</CODE>に追加します。
<P>

しかし、サブディレクトリすべてを含むわけではありません。
英数字で始まらない名前のサブディレクトリは除外します。
`<TT>RCS</TT>'という名前のサブディレクトリも除外します。
また、`<TT>.nosearch</TT>'という名前のファイルを置いた
サブディレクトリも除外します。
これらの方法を用いれば、`<TT>site-lisp</TT>'ディレクトリ下の
特定のサブディレクトリの探索を防げます。
<P>

Emacsを構築したディレクトリでEmacsを起動すると、
つまり、正式にインストールしてない実行形式を起動すると、
<CODE>load-path</CODE>には、普通、2つのディレクトリを追加します。
主構築ディレクトリのサブディレクトリ、<CODE>lisp</CODE>と<CODE>site-lisp</CODE>です。
（どちらも、絶対ファイル名で表される。）
<P>

<A NAME="IDX727"></A>
<DL>
<DT><U>コマンド:</U> <B>locate-library</B> <I>library &#38;optional nosuffix path interactive-call</I>
<DD>このコマンドは、ライブラリ<VAR>library</VAR>の正確なファイル名を探す。
<CODE>load</CODE>と同様にライブラリを探索する。
引数<VAR>nosuffix</VAR>の意味は<CODE>load</CODE>と同じであり、
指定した名前<VAR>library</VAR>に接尾辞`<SAMP>.elc</SAMP>'や`<SAMP>.el</SAMP>'を付加しない。
<P>

<VAR>path</VAR>が<CODE>nil</CODE>以外であると、
それは<CODE>load-path</CODE>のかわりに使うディレクトリのリストである。
<P>

<CODE>locate-library</CODE>をプログラムから呼び出した場合、
文字列でファイル名を返す。
ユーザーが<CODE>locate-library</CODE>を対話的に実行した場合、
引数<VAR>interactive-call</VAR>は<CODE>t</CODE>であり、これは
<CODE>locate-library</CODE>に対してファイル名をエコー領域に表示するように指示する。
</DL>
<P>

<A NAME="Loading Non-ASCII"></A>
<HR SIZE="6">
<br><A NAME="SEC194"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_15.html#SEC193"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_15.html#SEC195"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Loading Non-ASCII"></A>
<H2> 14.3 非ASCII文字のロード </H2>
<!--docid::SEC194::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Loading%20Non-ASCII">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Loading%20Non-ASCII</a>"<br>
"texi/elisp21/非ASCII文字のロード"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%C8%F3ASCII%CA%B8%BB%FA%A4%CE%A5%ED%A1%BC%A5%C9">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<P>

Emacs Lispプログラムが非ASCII文字の文字列定数を含む場合、
Emacs内部では、それらはユニバイト文字列かマルチバイト文字列で表現できます
（see 節 <A HREF="elisp_33.html#SEC529">32.1 テキスト表現</A>）。
どちらの表現形式を用いるかは、
どのようにファイルをEmacsに読み込んだかに依存します。
マルチバイト表現へ復号化して読んだ場合には、
Lispプログラムのテキストはマルチバイトテキストになり、
その文字列定数はマルチバイト文字列になります。
（たとえば）Lantin-1文字を含むファイルを復号化せずに読むと、
プログラムテキストはユニバイトテキストになり、
その文字列定数はユニバイト文字列になります。
See 節 <A HREF="elisp_33.html#SEC538">32.10 コーディングシステム</A>。
<P>

結果をより予測可能にするために、
オプション`<SAMP>--unibyte</SAMP>'を指定して起動した場合であっても、
Lispファイルをロードするときには、
Emacsはつねにマルチバイト表現に復号化します。
つまり、非ASCII文字の文字列定数はマルチバイト文字列に変換します。
唯一の例外は、特定のファイルで無変換を指定した場合だけです。
<P>

Emacsをこのように設計したのは、
Emacsの起動方法によらずに、
Lispプログラムが予測可能な結果をもたらすようにするためです。
さらに、こうすることで、ユニバイト動作のEmacsであっても、
マルチバイトテキストを使うことに依存したプログラムが動作します。
もちろん、そのようなプログラムは、
<CODE>default-enable-multibyte-characters</CODE>を検査して適切に表現を変換して、
ユーザーがユニバイトテキストとマルチバイトテキストのどちらを
好んでいるか調べるように設計すべきです。
<P>

Emacs Lispのほとんどのプログラムでは、
非ASCII文字列はマルチバイト文字列であるということに
気づかないでしょう。
というのは、それらをユニバイトバッファに挿入すると
自動的にユニバイトに変換するからです。
しかしながら、これで違いがでるならば、
Lispファイルの先頭行のコメントに`<SAMP>-*-unibyte: t;-*-</SAMP>'と書くことで、
特定のLispファイルをユニバイトと解釈するように強制できます。
このように指定すると、マルチバイト動作のEmacsであっても、
そのファイルを無条件にユニバイトと解釈します。
<P>

<A NAME="Autoload"></A>
<HR SIZE="6">
<br><A NAME="SEC195"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_15.html#SEC194"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_15.html#SEC196"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Autoload"></A>
<H2> 14.4 自動ロード </H2>
<!--docid::SEC195::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Autoload">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Autoload</a>"<br>
"texi/elisp21/自動ロード"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%BC%AB%C6%B0%A5%ED%A1%BC%A5%C9">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX728"></A>
<P>

<EM>自動ロード</EM>（autoload）機能により、
関数やマクロを定義しているファイルをロードしていなくても、
関数やマクロをLispに登録できます。
関数を初めて呼び出すと、
適切なファイルを読み込んで実際の定義と関連する他のコードを
インストールしてから、すでにロードしてあったかのように実際の定義を実行します。
<P>

関数を自動的にロードするように設定する方法は2つあります。
<CODE>autoload</CODE>を呼び出すか、あるいは、
ソース内の実際の定義のまえに特別な『マジック』コメントを書きます。
<CODE>autoload</CODE>は自動ロードを行う低レベルの基本関数です。
任意のLispプログラムでいつでも<CODE>autoload</CODE>を呼び出せます。
マジックコメントは、Emacsで使うパッケージ向けに
関数を自動的にロードするように設定するとても便利な方法です。
これらのコメントそのものはなにもしませんが、
コマンド<CODE>update-file-autoloads</CODE>に対する指針として働きます。
このコマンドは、<CODE>autoload</CODE>の呼び出しを作成し、
Emacs構築時にそれらを実行するように設定します。
<P>

<A NAME="IDX729"></A>
<DL>
<DT><U>Function:</U> <B>autoload</B> <I>function filename &#38;optional docstring interactive type</I>
<DD>この関数は、<VAR>function</VAR>という名前の関数（やマクロ）を
<VAR>filename</VAR>から自動的にロードするように定義する。
文字列<VAR>filename</VAR>は、<VAR>function</VAR>の実際の定義を取得するために
ロードするファイルを指定する。
<P>

<VAR>filename</VAR>にディレクトリ名や接尾辞<CODE>.el</CODE>や<CODE>.elc</CODE>がなければ、
<CODE>autoload</CODE>はこれらの接尾辞の1つを必ず付加し、
接尾辞を付けない<VAR>filename</VAR>という名前のファイルはロードしない。
<P>

引数<VAR>docstring</VAR>は、関数に対する説明文字列である。
通常、これは関数定義そのものの説明文字列と同一であること。
<CODE>autoload</CODE>の呼び出しにおいて説明文字列を指定しておくことで、
関数の実際の定義をロードしなくても説明文を見ることが可能になる。
<P>

<VAR>interactive</VAR>が<CODE>nil</CODE>以外ならば、
<VAR>function</VAR>を対話的に呼び出せることを意味する。
つまり、関数の実際の定義をロードしなくても
<KBD>M-x</KBD>の補完が動作するのである。
完全な対話指定を指定しない。
ユーザーが<VAR>function</VAR>を実際に呼び出すまでは必要なく、
呼び出し時点で実際の定義をロードするからである。
<P>

普通の関数と同様に、マクロやキーマップも自動的にロードできる。
<VAR>function</VAR>が実際にはマクロならば、<VAR>type</VAR>には<CODE>macro</CODE>を指定する。
<VAR>function</VAR>が実際にはキーマップならば、
<VAR>type</VAR>には<CODE>keymap</CODE>を指定する。
Emacsのさまざまな部分では、
実際の定義をロードせずにこの情報を知る必要がある。
<P>

自動ロードと指定したキーマップは、
プレフィックスキーのバインディングがシンボル<VAR>function</VAR>であるときに、
キーを探す過程で自動的にロードする。
キーマップのこれ以外の参照方法では、自動的にロードしない。
特に、変数名がシンボル<VAR>function</VAR>と同じであっても、
Lispプログラムで変数の値からキーマップを取得して
<CODE>define-key</CODE>を呼び出す場合には、自動的にロードしない。
<P>

<A NAME="IDX730"></A>
<VAR>function</VAR>が自動ロードオブジェクトではない
空でない関数定義を有する場合には、
<CODE>autoload</CODE>はなにもせずに<CODE>nil</CODE>を返す。
<VAR>function</VAR>の関数セルが空であったり、
すでに自動ロードオブジェクトである場合には、
つぎのような自動ロードオブジェクトとして関数セルを定義する。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(autoload <VAR>filename</VAR> <VAR>docstring</VAR> <VAR>interactive</VAR> <VAR>type</VAR>)
</pre></td></tr></table><P>

たとえばつぎのとおり。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(symbol-function 'run-prolog)
     => (autoload "prolog" 169681 t nil)
</pre></td></tr></table><P>

この場合、<CODE>"prolog"</CODE>はロードすべきファイルの名前であり、
169681はファイル`<TT>emacs/etc/DOC-<VAR>version</VAR></TT>'
（see 節 <A HREF="elisp_24.html#SEC364">23.1 説明文の基本</A>）内の説明文字列を指す。
<CODE>t</CODE>は関数が対話的であることを示し、
<CODE>nil</CODE>はマクロでもキーマップでもないことを示す。
</DL>
<P>

<A NAME="IDX731"></A>
<A NAME="IDX732"></A>
自動ロード対象のファイルでは、通常、他の定義や
複数の機能を提供したり必要としたりします。
（その内容の評価中のエラーなどで）ファイルを完全にロードできないと、
ロード中に行った関数定義や<CODE>provide</CODE>の呼び出しをもとに戻します。
そのファイルから自動ロードする任意の関数をつぎに呼び出そうとしたときに、
そのファイルを再度ロードすることを保証するためです。
こうしておかないと、
自動ロードをアボートしたファイルで関数が定義されても、
そのファイルのうしろの部分で定義される
その関数に必要なサブルーティンが必ずしもロードされないために
その関数が動作しない可能性があるからです。
<P>

自動ロード対象のファイルで必要なLisp関数やマクロの定義に失敗すると、
<CODE>"Autoloading failed to define function <VAR>function-name</VAR>"</CODE>を
伴ったエラーを通知します。
<P>

<A NAME="IDX733"></A>
<A NAME="IDX734"></A>
自動ロードを指定するマジックコメントは、
`<SAMP>;;;###autoload</SAMP>'だけを書いた行であり、
自動ロード対象のソースファイル上で実際の関数定義の直前に必要です。
コマンド<KBD>M-x update-file-autoloads</KBD>は、
対応する<CODE>autoload</CODE>呼び出しを`<TT>loaddefs.el</TT>'に書き込みます。
Emacs構築時には`<TT>loaddefs.el</TT>'をロードするので、
<CODE>autoload</CODE>を呼び出します。
<KBD>M-x update-directory-autoloads</KBD>はもっと強力で、
カレントディレクトリのすべてのファイルに対する自動ロード情報を更新します。
<P>

同じマジックコメントは、任意の種類のフォームを`<TT>loaddefs.el</TT>'に
コピーできます。
マジックコメントに続くフォームが関数定義でない場合、
そのフォームをそのままコピーします。
構築時にはフォームを実行しても、
ファイルのロード時にはそのフォームを実行しないように
マジックコメントを使うこともできます。
そうするには、マジックコメントと<EM>同じ行に</EM>そのフォームを書きます。
するとそれはコメントなので、ソースファイルをロードするときにはなにもしません。
一方、<KBD>M-x update-file-autoloads</KBD>はそのフォームを`<TT>loaddefs.el</TT>'に
コピーするので、Emacs構築時には実行されるのです。
<P>

つぎの例は、マジックコメントを使って<CODE>doctor</CODE>を自動ロードする方法です。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>;;;###autoload
(defun doctor ()
  "Switch to *doctor* buffer and start giving psychotherapy."
  (interactive)
  (switch-to-buffer "*doctor*")
  (doctor-mode))
</FONT></pre></td></tr></table><P>

こうすると、`<TT>loaddefs.el</TT>'ではつぎのようになります。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(autoload 'doctor "doctor"
  "\
Switch to *doctor* buffer and start giving psychotherapy."
  t)
</FONT></pre></td></tr></table><P>

ダブルクォートの直後にバックスラッシュや改行を書く慣習は、
`<TT>loaddefs.el</TT>'などの
あらかじめロードするLispファイルの中だけで使うものです。
これは、<CODE>make-docfile</CODE>に対して、
説明文字列を`<TT>etc/DOC</TT>'ファイルに書くように指示します。
See 節 <A HREF="elisp_43.html#SEC668">C.1 Emacsの構築方法</A>。
<P>

<A NAME="Repeated Loading"></A>
<HR SIZE="6">
<br><A NAME="SEC196"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_15.html#SEC195"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_15.html#SEC197"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Repeated Loading"></A>
<H2> 14.5 ロードの繰り返し </H2>
<!--docid::SEC196::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Repeated%20Loading">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Repeated%20Loading</a>"<br>
"texi/elisp21/ロードの繰り返し"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%ED%A1%BC%A5%C9%A4%CE%B7%AB%A4%EA%CA%D6%A4%B7">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX735"></A>
<P>

1つのEmacsセッションにおいて、あるファイルを複数回ロードできます。
たとえば、バッファ内の関数定義を編集して、
関数定義を書き直してインストールし直したあとで、
もとの版に戻したいこともあるでしょう。
これには、もとのファイルを再ロードすればよいのです。
<P>

ファイルをロードしたり再ロードするとき、
関数<CODE>load</CODE>や<CODE>load-library</CODE>は、
コンパイルしていないファイルではなく、
バイトコンパイル済みのファイルを自動的にロードすることに注意してください。
ファイルを書き直して保存してから再インストールする場合、
新しい版をバイトコンパイルする必要があります。
さもないと、Emacsは、新しいコンパイルしていないファイルではなく、
バイトコンパイル済みの古いファイルをロードしてしまいます。
そのような場合、ファイルをロードすると、
`<SAMP>(compiled; note, source is newer)</SAMP>'とメッセージを表示して、
再コンパイルするように忠告してきます。
<P>

Lispライブラリファイルにフォームを書くときには、
ファイルを複数回ロードする可能性があることを忘れないでください。
たとえば、ライブラリを再ロードするたびに
各変数を再初期化すべきかどうか考えましょう。
<CODE>defvar</CODE>は、初期化済みの変数の値を変更しません。
（see 節 <A HREF="elisp_11.html#SEC141">10.5 グローバル変数を定義する</A>。）
<P>

連想リストに要素を追加するもっとも簡単な方法はつぎのとおりです。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(setq minor-mode-alist
      (cons '(leif-mode " Leif") minor-mode-alist))
</pre></td></tr></table><P>

しかし、これでは、ライブラリを再ロードすると、
複数の要素を追加してしまいます。
これを避けるにはつぎのようにします。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(or (assq 'leif-mode minor-mode-alist)
    (setq minor-mode-alist
          (cons '(leif-mode " Leif") minor-mode-alist)))
</pre></td></tr></table><P>

リストに要素を1回だけ追加するには、
<CODE>add-to-list</CODE>（see 節 <A HREF="elisp_11.html#SEC144">10.8 変数値の変更</A>）も使えます。
<P>

ライブラリをすでにロードしたかどうか明示的に調べたいこともあるでしょう。
ライブラリ内で以前ロードされたかどうか検査する方法の1つは、
つぎのとおりです。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(defvar foo-was-loaded nil)

(unless foo-was-loaded
  <VAR>execute-first-time-only</VAR>
  (setq foo-was-loaded t))
</pre></td></tr></table><P>

ライブラリで名前付き機能を提供するために<CODE>provide</CODE>を使っていれば、
ファイルの始めのほうで<CODE>featurep</CODE>を使って、
<CODE>provide</CODE>を以前呼び出したかどうか検査できます。
See 節 <A HREF="elisp_15.html#SEC197">14.6 機能</A>。
<P>

<A NAME="Named Features"></A>
<HR SIZE="6">
<br><A NAME="SEC197"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_15.html#SEC196"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_15.html#SEC198"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Named Features"></A>
<H2> 14.6 機能 </H2>
<!--docid::SEC197::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Named%20Features">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Named%20Features</a>"<br>
"texi/elisp21/機能"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%B5%A1%C7%BD">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX736"></A>
<A NAME="IDX737"></A>
<A NAME="IDX738"></A>
<P>

<CODE>provide</CODE>と<CODE>require</CODE>は、
ファイルを自動的にロードするための<CODE>autoload</CODE>の代替手段です。
それらは指定した<EM>機能</EM>（features）という考え方で動作します。
自動ロードは特定の関数を呼び出すことで起動しますが、
機能はその名前でプログラムが最初に要求したときにロードします。
<P>

機能名は、関数や変数などの集合を表すシンボルです。
それらを定義するファイルでは、その機能を<EM>提供</EM>（provide）します。
それらを使う別のプログラムでは、
その機能を<EM>要求</EM>（require）することで、
それらが定義されることを確実にします。
こうすると、未ロードであれば定義しているファイルをロードします。
<P>

機能を要求するには、機能名を引数にして<CODE>require</CODE>を呼び出します。
<CODE>require</CODE>は、グローバル変数<CODE>features</CODE>を調べて、
目的の機能がすでに提供されているかどうか調べます。
提供されていなければ、適当なファイルから機能をロードします。
このファイルでは、トップレベルで<CODE>provide</CODE>を呼び出して、
<CODE>features</CODE>に機能を追加するべきです。
そうしないと、<CODE>require</CODE>はエラーを通知します。
<A NAME="IDX739"></A>
<P>

たとえば、`<TT>emacs/lisp/prolog.el</TT>' には、
つぎのコードのような<CODE>run-prolog</CODE>の定義が入っています。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(defun run-prolog ()
  "Run an inferior Prolog process, with I/O via buffer *prolog*."
  (interactive)
  (require 'comint)
  (switch-to-buffer (make-comint "prolog" prolog-program-name))
  (inferior-prolog-mode))
</FONT></pre></td></tr></table><P>

<CODE>(require 'comint)</CODE>は、ファイル`<TT>comint.el</TT>'が未ロードであると、
そのファイルをロードします。
これにより、<CODE>make-comint</CODE>が定義済みであることを保証します。
普通、機能には、その機能を提供するファイル名からとった名前を付けますから、
<CODE>require</CODE>にファイル名を指定する必要はありません。
<P>

`<TT>comint.el</TT>'ファイルには、つぎのトップレベルの式が入っています。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(provide 'comint)
</FONT></pre></td></tr></table><P>

これにより、グローバル変数<CODE>features</CODE>のリストに
<CODE>comint</CODE>が追加されるので、
これ以降に<CODE>(require 'comint)</CODE>を実行しても、
なにもしないでよいことになります。
<P>

<A NAME="IDX740"></A>
ファイルのトップレベルで<CODE>require</CODE>を使うと、
そのファイルをロードする場合と同様に、
そのファイルをバイトコンパイルするとき（see 節 <A HREF="elisp_16.html#SEC200">15. バイトコンパイル</A>）にも
<CODE>require</CODE>には効果があります。
要求したパッケージに、
バイトコンパイラが知っている必要があるマクロが入っている場合です。
<P>

トップレベルの<CODE>require</CODE>の呼び出しは、
バイトコンパイル中に評価されますが、
<CODE>provide</CODE>の呼び出しは評価しません。
したがって、つぎの例のように、
同じ機能に対する<CODE>provide</CODE>に続けて<CODE>require</CODE>を書くことで、
バイトコンパイルするまえに定義のファイルをロードすることを確実にできます。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>(provide 'my-feature)  ; バイトコンパイラは無視し、
                       ;   <CODE>load</CODE>は評価する
(require 'my-feature)  ; バイトコンパイラは評価する
</FONT></pre></td></tr></table><P>

コンパイラは<CODE>provide</CODE>を無視し、
続く<CODE>require</CODE>の処理では当該ファイルをロードします。
ファイルのロード時には<CODE>provide</CODE>の呼び出しを実行するので、
そのあとの<CODE>require</CODE>の呼び出しは、
ファイルをロードするときにはなにもしません。
<P>

<A NAME="IDX741"></A>
<DL>
<DT><U>Function:</U> <B>provide</B> <I>feature</I>
<DD>この関数は、機能<VAR>feature</VAR>をロードし終えたこと、あるいは、
ロード中であることを現在のEmacsセッション内で宣言する。
つまり、<VAR>feature</VAR>に関連した機能が他のLispプログラムから利用できることを
意味する。
<P>

<CODE>provide</CODE>の呼び出しの直接の効果は、
<VAR>feature</VAR>がリスト<CODE>features</CODE>に入っていなければ、
<VAR>feature</VAR>をリスト<CODE>features</CODE>の先頭に入れることである。
引数<VAR>feature</VAR>はシンボルであること。
<CODE>provide</CODE>は<VAR>feature</VAR>を返す。
<P>

<TABLE><tr><td>&nbsp;</td><td class=smallexample><FONT SIZE=-1><pre>features
     => (bar bish)

(provide 'foo)
     => foo
features
     => (foo bar bish)
</FONT></pre></td></tr></table><P>

自動ロードによってファイルをロードしているとき、
その内容を評価することでエラーになってロードを中止すると、
ロード中に行われた関数定義や<CODE>provide</CODE>の呼び出しはもとに戻す。
see 節 <A HREF="elisp_15.html#SEC195">14.4 自動ロード</A>。
</DL>
<P>

<A NAME="IDX742"></A>
<DL>
<DT><U>Function:</U> <B>require</B> <I>feature &#38;optional filename</I>
<DD>この関数は（<CODE>(featurep <VAR>feature</VAR>)</CODE>を使って）
現在のEmacsセッション内に<VAR>feature</VAR>が存在するかどうか調べる。
引数<VAR>feature</VAR>はシンボルであること。
<P>

機能が存在していなければ、<CODE>require</CODE>は、
<CODE>load</CODE>を使って<VAR>filename</VAR>をロードする。
<VAR>filename</VAR>を指定しないと、シンボル<VAR>feature</VAR>の名前を
ロードすべきファイル名の基にする。
しかしながら、この場合には、<CODE>require</CODE>は、
接尾辞を必ず付加して<VAR>feature</VAR>を探す。
<VAR>feature</VAR>だけの名前のファイルは探さない。
<P>

<VAR>feature</VAR>を提供するファイルのロードに失敗すると、
<CODE>require</CODE>はエラー
`<SAMP>Required feature <VAR>feature</VAR> was not provided</SAMP>'を通知する。
</DL>
<P>

<A NAME="IDX743"></A>
<DL>
<DT><U>Function:</U> <B>featurep</B> <I>feature</I>
<DD>この関数は、現在のEmacsセッションで<VAR>feature</VAR>が提供されていれば
（つまり、<VAR>feature</VAR>が<CODE>features</CODE>のメンバであれば）
<CODE>t</CODE>を返す。
</DL>
<P>

<A NAME="IDX744"></A>
<DL>
<DT><U>Variable:</U> <B>features</B>
<DD>この変数の値は、
現在のEmacsセッションにロード済みの機能を表すシンボルのリストである。
各シンボルは、<CODE>provide</CODE>を呼び出すことでこのリストに追加される。
リスト<CODE>features</CODE>内の要素の順番は関係ない。
</DL>
<P>

<A NAME="Unloading"></A>
<HR SIZE="6">
<br><A NAME="SEC198"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_15.html#SEC197"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_15.html#SEC199"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Unloading"></A>
<H2> 14.7 アンロード </H2>
<!--docid::SEC198::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Unloading">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Unloading</a>"<br>
"texi/elisp21/アンロード"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%A2%A5%F3%A5%ED%A1%BC%A5%C9">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX745"></A>
<P>

ライブラリでロードした関数や変数を捨てさって
他のLispオブジェクト向けにメモリを回収することができます。
そうするには関数<CODE>unload-feature</CODE>を使います。
<P>

<A NAME="IDX746"></A>
<DL>
<DT><U>コマンド:</U> <B>unload-feature</B> <I>feature &#38;optional force</I>
<DD>このコマンドは、<VAR>feature</VAR>を提供するライブラリをアンロードする。
つまり、当該ライブラリにおいて、<CODE>defun</CODE>、<CODE>defalias</CODE>、
<CODE>defsubst</CODE>、<CODE>defmacro</CODE>、<CODE>defconst</CODE>、<CODE>defvar</CODE>、
<CODE>defcustom</CODE>で定義した関数、マクロ、変数すべてを未定義にする。
そうして、これらのシンボルに以前設定してあった自動ロードの設定を復元する。
（ロード時に、これらをシンボルの属性<CODE>autoload</CODE>に保存している。）
<P>

以前の定義に復元するまえに、<CODE>unload-feature</CODE>は<CODE>remove-hook</CODE>を
実行して、ライブラリ内の関数を特定のフックから取り除く。
これらのフックは、`<SAMP>-hook</SAMP>'や`<SAMP>-hooks</SAMP>'で終る名前の変数、および、
<CODE>loadhist-special-hooks</CODE>に入っているものである。
これは、重要なフックにおいて存在しない関数を参照することで
Emacsが動作不能になるのを防ぐ。
<P>

<A NAME="IDX747"></A>
これらの処置でも誤動作防止には不十分であるときには、
ライブラリで明示的なアンロードフックを定義できる。
<CODE><VAR>feature</VAR>-unload-hook</CODE>を定義してあると、
以前の定義を復元するまえに、
フックを削除する通常の動作の<EM>かわりに</EM>
このフックをノーマルフックとして実行する。
アンロードフックでは、
ライブラリをいったんアンロードすると動作不能になるような
ライブラリで変更したグローバルな状態をすべてアンドゥすべきである。
<P>

通常、<CODE>unload-feature</CODE>は、他のライブラリが依存している
ライブラリのアンロードは拒否する。
（ライブラリ<VAR>a</VAR>で<VAR>b</VAR>を<CODE>require</CODE>（要求）していると、
ライブラリ<VAR>a</VAR>はライブラリ<VAR>b</VAR>に依存している。）
省略可能な引数<VAR>force</VAR>が<CODE>nil</CODE>以外であると、
依存関係を無視し、任意のライブラリをアンロードできる。
</DL>
<P>

関数<CODE>unload-feature</CODE>はLispで書いてあり、
その動作は<CODE>load-history</CODE>に基づきます。
<P>

<A NAME="IDX748"></A>
<DL>
<DT><U>Variable:</U> <B>load-history</B>
<DD>この変数の値は、ライブラリ名をそのライブラリが定義する関数や変数の名前、
そのライブラリが提供する機能、そのライブラリが要求する機能に対応付ける
連想リストである。
<P>

各要素はリストであり、1つ1つが1つのライブラリを記述する。
リストのCARは文字列であり、ライブラリ名である。
リストの残りは、以下の種類のオブジェクトから成る。
<P>

<UL>
<LI>
このライブラリで定義されたシンボル。
<LI>
<CODE>(require . <VAR>feature</VAR>)</CODE>の形のリストであり、
要求する機能を示す。
<LI>
<CODE>(provide . <VAR>feature</VAR>)</CODE>の形のリストであり、
提供する機能を示す。
</UL>
<P>

<CODE>load-history</CODE>の値には、CARが<CODE>nil</CODE>であるような
1つの要素があってもよい。
この要素は、ファイルを訪問してないバッファ内で<CODE>eval-buffer</CODE>によって
作られた定義であることを示す。
</DL>
<P>

コマンド<CODE>eval-region</CODE>は<CODE>load-history</CODE>を更新しますが、
訪問先ファイルに対応する要素に、定義されるシンボルを追加するのであって、
要素を置き換えるのではありません。
<P>

あらかじめロード済みのライブラリは、<CODE>load-history</CODE>に寄与しません。
<P>

<A NAME="IDX749"></A>
<A NAME="IDX750"></A>
<DL>
<DT><U>Variable:</U> <B>loadhist-special-hooks</B>
<DD>この変数は、ライブラリ内で定義された関数を削除するために
ライブラリをアンロードするまえに走査するフックのリストを保持する。
</DL>
<P>

<A NAME="Hooks for Loading"></A>
<HR SIZE="6">
<br><A NAME="SEC199"> </A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_15.html#SEC198"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_16.html#SEC200"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<A NAME="Hooks for Loading"></A>
<H2> 14.8 ロード時のフック </H2>
<!--docid::SEC199::-->
<div class="info">URL="<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Hooks%20for%20Loading">http://www.bookshelf.jp/cgi-bin/goto.cgi?file=elisp21&node=Hooks%20for%20Loading</a>"<br>
"texi/elisp21/ロード時のフック"への<a href="http://www.bookshelf.jp/pukiwiki/pukiwiki.php?refer=Meadow%20memo&cmd=read&page=texi%2Felisp21%2F%A5%ED%A1%BC%A5%C9%BB%FE%A4%CE%A5%D5%A5%C3%A5%AF">コメント</a>(無し)</div><FORM METHOD="GET" ACTION="http://www.bookshelf.jp/cgi-bin/wwwsrch.cgi"><div class="info">検索<INPUT TYPE=text NAME=WORD SIZE=30><INPUT TYPE=hidden NAME=index VALUE=memo CHECKED><INPUT TYPE=hidden NAME=target VALUE=all CHECKED><INPUT TYPE=hidden NAME="memoall" VALUE="on" CHECKED><INPUT TYPE=hidden NAME=ANDOR VALUE=and CHECKED><INPUT TYPE=radio NAME=lisp VALUE=off CHECKED>全文<INPUT TYPE=radio NAME=lisp VALUE=on>Elisp<INPUT TYPE=submit VALUE="検索"></div></FORM>
<A NAME="IDX751"></A>
<A NAME="IDX752"></A>
<P>

<CODE>eval-after-load</CODE>を呼び出すと、
特定のライブラリをロードする／してあるときに実行するコードを指定できます。
<P>

<A NAME="IDX753"></A>
<DL>
<DT><U>Function:</U> <B>eval-after-load</B> <I>library form</I>
<DD>この関数は、ライブラリ<VAR>library</VAR>をロードする／してあるときに、
ライブラリ<VAR>library</VAR>のロードの最後に<VAR>form</VAR>を評価するように設定する。
<VAR>library</VAR>をすでにロードしてあると、
この関数は<VAR>form</VAR>をただちに評価する。
<P>

ライブラリ名<VAR>library</VAR>は<CODE>load</CODE>の引数に正確に一致する必要がある。
<CODE>load-path</CODE>を探索してインストールするライブラリを探したときに
正しい結果を得るために、<VAR>library</VAR>にはディレクトリ名を含めないこと。
<P>

<VAR>form</VAR>でエラーが発生してもロード処理をもとに戻さないが、
<VAR>form</VAR>の残りは実行しない。
</DL>
<P>

一般に、よく設計されたLispプログラムはこの機能を使うべきではありません。
Lispライブラリを見通しよくモジュール化して扱うには、
（1）ライブラリの（外部から使うことを意図した）変数を調べて設定し、
（2）ライブラリの関数を呼び出すことです。
（1）を行いたければ、すぐにしてかまいません。
ライブラリをロードするまで待つ必要はありません。
（2）を行うには、ライブラリをロードする必要があります
（<CODE>require</CODE>で行うことが好ましい）。
<P>

広く使われるプログラムに対する設計基準に合わなくても、
個人のカスタマイズで<CODE>eval-after-load</CODE>を使うのはかまいません。
<P>

<A NAME="IDX754"></A>
<DL>
<DT><U>Variable:</U> <B>after-load-alist</B>
<DD>特定のライブラリをロードする／してあるときに評価する式の連想リスト。
各要素はつぎのとおり。
<P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>(<VAR>filename</VAR> <VAR>forms</VAR><small>...</small>)
</pre></td></tr></table><P>

関数<CODE>load</CODE>は、<CODE>eval-after-load</CODE>を実現するために
<CODE>after-load-alist</CODE>を調べる。
</DL>
<P>

<A NAME="Byte Compilation"></A>
<HR SIZE="6">
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[ &lt;&lt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt;&gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp.html#SEC_Top">表紙</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_toc.html#SEC_Contents">目次</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="elisp_48.html#SEC681">索引</A>]</TD>
<TD> [<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=search">検索</a>] [<a href="#top">上端</a> / <a href="#bottom">下端</a>]</TD></TR></TABLE>
<a name="bottom"> </a>
<script type="text/javascript" src="style2.js"></script>
<div class="footer">
    <br>
    このページはMeadow (Emacs) の紹介ページです <br>
このWebページの各文書は自由にリンク・複製・再配布・改変していただいて構いません．
<br>ただし，複製・再配布・改変の場合は Meadow Memo のURLを記載しておいて下さい．<br>
<a href="http://www.bookshelf.jp/cgi-bin/goto.cgi?file=meadow&node=about%20link">Medow memoへのリンクについて</a>．<br>

間違い，要望等があれば<a href="mailto:akihisa@mail.ne.jp">akihisa@mail.ne.jp</a> か下記でどうぞ<br>

<br>

<FORM METHOD="post" ACTION="http://www.bookshelf.jp/cgi-bin/wwwmail.cgi" >
お名前：<INPUT TYPE="text" NAME="name" SIZE="30" MAXLENGTH="40" VALUE="ななしさん"><br>
メールアドレス：<INPUT TYPE="text" NAME="EMAIL" SIZE="25" MAXLENGTH="60" VALUE="secret@mail.adr"><br>
<input type="hidden" name="HPAGE" value="">
つっこみ：<br><TEXTAREA NAME="MESSAGE" ROWS="5" COLS="50">
</TEXTAREA><br><br>
<INPUT TYPE="submit" VALUE="送信">
<INPUT TYPE="reset" VALUE="クリア">
</FORM>

<br><A HREF="http://www.bookshelf.jp/cgi-bin/xct.cgi">ページ別カウンタ</a>
<br> Since 2002/12/13 <br>
</div>

</BODY>

</HTML>
